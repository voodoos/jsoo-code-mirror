"use strict";function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr);}function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj;}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;},_typeof(obj);}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _createForOfIteratorHelper(o,allowArrayLike){var it=typeof Symbol!=="undefined"&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]};},e:function e(_e3){throw _e3;},f:F};}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion=true,didErr=false,err;return{s:function s(){it=it.call(o);},n:function n(){var step=it.next();normalCompletion=step.done;return step;},e:function e(_e4){didErr=true;err=_e4;},f:function f(){try{if(!normalCompletion&&it["return"]!=null)it["return"]();}finally{if(didErr)throw err;}}};}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen);}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i];}return arr2;}function _get(){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get;}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(arguments.length<3?target:receiver);}return desc.value;};}return _get.apply(this,arguments);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});Object.defineProperty(subClass,"prototype",{writable:false});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}else if(call!==void 0){throw new TypeError("Derived constructors may only return object or undefined");}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}(function(){var __defProp=Object.defineProperty;var __export=function __export(target,all){for(var name2 in all){__defProp(target,name2,{get:all[name2],enumerable:true});}};// ../node_modules/@codemirror/text/dist/index.js
var extend=/* @__PURE__ */"lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(function(s){return s?parseInt(s,36):1;});for(var _i=1;_i<extend.length;_i++){extend[_i]+=extend[_i-1];}function isExtendingChar(code){for(var _i2=1;_i2<extend.length;_i2+=2){if(extend[_i2]>code)return extend[_i2-1]<=code;}return false;}function isRegionalIndicator(code){return code>=127462&&code<=127487;}var ZWJ=8205;function findClusterBreak(str,pos){var forward=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var includeExtending=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;return(forward?nextClusterBreak:prevClusterBreak)(str,pos,includeExtending);}function nextClusterBreak(str,pos,includeExtending){if(pos==str.length)return pos;if(pos&&surrogateLow(str.charCodeAt(pos))&&surrogateHigh(str.charCodeAt(pos-1)))pos--;var prev=codePointAt(str,pos);pos+=codePointSize(prev);while(pos<str.length){var next=codePointAt(str,pos);if(prev==ZWJ||next==ZWJ||includeExtending&&isExtendingChar(next)){pos+=codePointSize(next);prev=next;}else if(isRegionalIndicator(next)){var countBefore=0,_i3=pos-2;while(_i3>=0&&isRegionalIndicator(codePointAt(str,_i3))){countBefore++;_i3-=2;}if(countBefore%2==0)break;else pos+=2;}else{break;}}return pos;}function prevClusterBreak(str,pos,includeExtending){while(pos>0){var found=nextClusterBreak(str,pos-2,includeExtending);if(found<pos)return found;pos--;}return 0;}function surrogateLow(ch){return ch>=56320&&ch<57344;}function surrogateHigh(ch){return ch>=55296&&ch<56320;}function codePointAt(str,pos){var code0=str.charCodeAt(pos);if(!surrogateHigh(code0)||pos+1==str.length)return code0;var code1=str.charCodeAt(pos+1);if(!surrogateLow(code1))return code0;return(code0-55296<<10)+(code1-56320)+65536;}function fromCodePoint(code){if(code<=65535)return String.fromCharCode(code);code-=65536;return String.fromCharCode((code>>10)+55296,(code&1023)+56320);}function codePointSize(code){return code<65536?1:2;}function _countColumn(string2,tabSize){var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:string2.length;var n=0;for(var _i4=0;_i4<to;){if(string2.charCodeAt(_i4)==9){n+=tabSize-n%tabSize;_i4++;}else{n++;_i4=findClusterBreak(string2,_i4);}}return n;}function findColumn(string2,col,tabSize,strict){for(var _i5=0,n=0;;){if(n>=col)return _i5;if(_i5==string2.length)break;n+=string2.charCodeAt(_i5)==9?tabSize-n%tabSize:1;_i5=findClusterBreak(string2,_i5);}return strict===true?-1:string2.length;}var Text=/*#__PURE__*/function(){function Text(){_classCallCheck(this,Text);}_createClass(Text,[{key:"lineAt",value:function lineAt(pos){if(pos<0||pos>this.length)throw new RangeError("Invalid position ".concat(pos," in document of length ").concat(this.length));return this.lineInner(pos,false,1,0);}},{key:"line",value:function line(n){if(n<1||n>this.lines)throw new RangeError("Invalid line number ".concat(n," in ").concat(this.lines,"-line document"));return this.lineInner(n,true,1,0);}},{key:"replace",value:function replace(from,to,text){var parts=[];this.decompose(0,from,parts,2);if(text.length)text.decompose(0,text.length,parts,1|2);this.decompose(to,this.length,parts,1);return TextNode.from(parts,this.length-(to-from)+text.length);}},{key:"append",value:function append(other){return this.replace(this.length,this.length,other);}},{key:"slice",value:function slice(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.length;var parts=[];this.decompose(from,to,parts,0);return TextNode.from(parts,to-from);}},{key:"eq",value:function eq(other){if(other==this)return true;if(other.length!=this.length||other.lines!=this.lines)return false;var start=this.scanIdentical(other,1),end=this.length-this.scanIdentical(other,-1);var a=new RawTextCursor(this),b=new RawTextCursor(other);for(var skip=start,pos=start;;){a.next(skip);b.next(skip);skip=0;if(a.lineBreak!=b.lineBreak||a.done!=b.done||a.value!=b.value)return false;pos+=a.value.length;if(a.done||pos>=end)return true;}}},{key:"iter",value:function iter(){var dir=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return new RawTextCursor(this,dir);}},{key:"iterRange",value:function iterRange(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.length;return new PartialTextCursor(this,from,to);}},{key:"iterLines",value:function iterLines(from,to){var inner;if(from==null){inner=this.iter();}else{if(to==null)to=this.lines+1;var start=this.line(from).from;inner=this.iterRange(start,Math.max(start,to==this.lines+1?this.length:to<=1?0:this.line(to-1).to));}return new LineCursor(inner);}},{key:"toString",value:function toString(){return this.sliceString(0);}},{key:"toJSON",value:function toJSON(){var lines=[];this.flatten(lines);return lines;}}],[{key:"of",value:function of(text){if(text.length==0)throw new RangeError("A document must have at least one line");if(text.length==1&&!text[0])return Text.empty;return text.length<=32?new TextLeaf(text):TextNode.from(TextLeaf.split(text,[]));}}]);return Text;}();var TextLeaf=/*#__PURE__*/function(_Text){_inherits(TextLeaf,_Text);var _super=_createSuper(TextLeaf);function TextLeaf(text){var _this;var length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:textLength(text);_classCallCheck(this,TextLeaf);_this=_super.call(this);_this.text=text;_this.length=length;return _this;}_createClass(TextLeaf,[{key:"lines",get:function get(){return this.text.length;}},{key:"children",get:function get(){return null;}},{key:"lineInner",value:function lineInner(target,isLine,line,offset){for(var _i6=0;;_i6++){var string2=this.text[_i6],end=offset+string2.length;if((isLine?line:end)>=target)return new Line(offset,end,line,string2);offset=end+1;line++;}}},{key:"decompose",value:function decompose(from,to,target,open){var text=from<=0&&to>=this.length?this:new TextLeaf(sliceText(this.text,from,to),Math.min(to,this.length)-Math.max(0,from));if(open&1){var prev=target.pop();var joined=appendText(text.text,prev.text.slice(),0,text.length);if(joined.length<=32){target.push(new TextLeaf(joined,prev.length+text.length));}else{var mid=joined.length>>1;target.push(new TextLeaf(joined.slice(0,mid)),new TextLeaf(joined.slice(mid)));}}else{target.push(text);}}},{key:"replace",value:function replace(from,to,text){if(!(text instanceof TextLeaf))return _get(_getPrototypeOf(TextLeaf.prototype),"replace",this).call(this,from,to,text);var lines=appendText(this.text,appendText(text.text,sliceText(this.text,0,from)),to);var newLen=this.length+text.length-(to-from);if(lines.length<=32)return new TextLeaf(lines,newLen);return TextNode.from(TextLeaf.split(lines,[]),newLen);}},{key:"sliceString",value:function sliceString(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.length;var lineSep=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"\n";var result="";for(var pos=0,_i7=0;pos<=to&&_i7<this.text.length;_i7++){var line=this.text[_i7],end=pos+line.length;if(pos>from&&_i7)result+=lineSep;if(from<end&&to>pos)result+=line.slice(Math.max(0,from-pos),to-pos);pos=end+1;}return result;}},{key:"flatten",value:function flatten(target){var _iterator=_createForOfIteratorHelper(this.text),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var line=_step.value;target.push(line);}}catch(err){_iterator.e(err);}finally{_iterator.f();}}},{key:"scanIdentical",value:function scanIdentical(){return 0;}}],[{key:"split",value:function split(text,target){var part=[],len=-1;var _iterator2=_createForOfIteratorHelper(text),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var line=_step2.value;part.push(line);len+=line.length+1;if(part.length==32){target.push(new TextLeaf(part,len));part=[];len=-1;}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}if(len>-1)target.push(new TextLeaf(part,len));return target;}}]);return TextLeaf;}(Text);var TextNode=/*#__PURE__*/function(_Text2){_inherits(TextNode,_Text2);var _super2=_createSuper(TextNode);function TextNode(children,length){var _this2;_classCallCheck(this,TextNode);_this2=_super2.call(this);_this2.children=children;_this2.length=length;_this2.lines=0;var _iterator3=_createForOfIteratorHelper(children),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var child=_step3.value;_this2.lines+=child.lines;}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}return _this2;}_createClass(TextNode,[{key:"lineInner",value:function lineInner(target,isLine,line,offset){for(var _i8=0;;_i8++){var child=this.children[_i8],end=offset+child.length,endLine=line+child.lines-1;if((isLine?endLine:end)>=target)return child.lineInner(target,isLine,line,offset);offset=end+1;line=endLine+1;}}},{key:"decompose",value:function decompose(from,to,target,open){for(var _i9=0,pos=0;pos<=to&&_i9<this.children.length;_i9++){var child=this.children[_i9],end=pos+child.length;if(from<=end&&to>=pos){var childOpen=open&((pos<=from?1:0)|(end>=to?2:0));if(pos>=from&&end<=to&&!childOpen)target.push(child);else child.decompose(from-pos,to-pos,target,childOpen);}pos=end+1;}}},{key:"replace",value:function replace(from,to,text){if(text.lines<this.lines)for(var _i10=0,pos=0;_i10<this.children.length;_i10++){var child=this.children[_i10],end=pos+child.length;if(from>=pos&&to<=end){var updated=child.replace(from-pos,to-pos,text);var totalLines=this.lines-child.lines+updated.lines;if(updated.lines<totalLines>>5-1&&updated.lines>totalLines>>5+1){var copy=this.children.slice();copy[_i10]=updated;return new TextNode(copy,this.length-(to-from)+text.length);}return _get(_getPrototypeOf(TextNode.prototype),"replace",this).call(this,pos,end,updated);}pos=end+1;}return _get(_getPrototypeOf(TextNode.prototype),"replace",this).call(this,from,to,text);}},{key:"sliceString",value:function sliceString(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.length;var lineSep=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"\n";var result="";for(var _i11=0,pos=0;_i11<this.children.length&&pos<=to;_i11++){var child=this.children[_i11],end=pos+child.length;if(pos>from&&_i11)result+=lineSep;if(from<end&&to>pos)result+=child.sliceString(from-pos,to-pos,lineSep);pos=end+1;}return result;}},{key:"flatten",value:function flatten(target){var _iterator4=_createForOfIteratorHelper(this.children),_step4;try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var child=_step4.value;child.flatten(target);}}catch(err){_iterator4.e(err);}finally{_iterator4.f();}}},{key:"scanIdentical",value:function scanIdentical(other,dir){if(!(other instanceof TextNode))return 0;var length=0;var _ref=dir>0?[0,0,this.children.length,other.children.length]:[this.children.length-1,other.children.length-1,-1,-1],_ref2=_slicedToArray(_ref,4),iA=_ref2[0],iB=_ref2[1],eA=_ref2[2],eB=_ref2[3];for(;;iA+=dir,iB+=dir){if(iA==eA||iB==eB)return length;var chA=this.children[iA],chB=other.children[iB];if(chA!=chB)return length+chA.scanIdentical(chB,dir);length+=chA.length+1;}}}],[{key:"from",value:function from(children){var length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:children.reduce(function(l,ch){return l+ch.length+1;},-1);var lines=0;var _iterator5=_createForOfIteratorHelper(children),_step5;try{for(_iterator5.s();!(_step5=_iterator5.n()).done;){var _ch=_step5.value;lines+=_ch.lines;}}catch(err){_iterator5.e(err);}finally{_iterator5.f();}if(lines<32){var flat=[];var _iterator6=_createForOfIteratorHelper(children),_step6;try{for(_iterator6.s();!(_step6=_iterator6.n()).done;){var ch=_step6.value;ch.flatten(flat);}}catch(err){_iterator6.e(err);}finally{_iterator6.f();}return new TextLeaf(flat,length);}var chunk=Math.max(32,lines>>5),maxChunk=chunk<<1,minChunk=chunk>>1;var chunked=[],currentLines=0,currentLen=-1,currentChunk=[];function add2(child){var last;if(child.lines>maxChunk&&child instanceof TextNode){var _iterator7=_createForOfIteratorHelper(child.children),_step7;try{for(_iterator7.s();!(_step7=_iterator7.n()).done;){var node=_step7.value;add2(node);}}catch(err){_iterator7.e(err);}finally{_iterator7.f();}}else if(child.lines>minChunk&&(currentLines>minChunk||!currentLines)){flush();chunked.push(child);}else if(child instanceof TextLeaf&&currentLines&&(last=currentChunk[currentChunk.length-1])instanceof TextLeaf&&child.lines+last.lines<=32){currentLines+=child.lines;currentLen+=child.length+1;currentChunk[currentChunk.length-1]=new TextLeaf(last.text.concat(child.text),last.length+1+child.length);}else{if(currentLines+child.lines>chunk)flush();currentLines+=child.lines;currentLen+=child.length+1;currentChunk.push(child);}}function flush(){if(currentLines==0)return;chunked.push(currentChunk.length==1?currentChunk[0]:TextNode.from(currentChunk,currentLen));currentLen=-1;currentLines=currentChunk.length=0;}var _iterator8=_createForOfIteratorHelper(children),_step8;try{for(_iterator8.s();!(_step8=_iterator8.n()).done;){var child=_step8.value;add2(child);}}catch(err){_iterator8.e(err);}finally{_iterator8.f();}flush();return chunked.length==1?chunked[0]:new TextNode(chunked,length);}}]);return TextNode;}(Text);Text.empty=/* @__PURE__ */new TextLeaf([""],0);function textLength(text){var length=-1;var _iterator9=_createForOfIteratorHelper(text),_step9;try{for(_iterator9.s();!(_step9=_iterator9.n()).done;){var line=_step9.value;length+=line.length+1;}}catch(err){_iterator9.e(err);}finally{_iterator9.f();}return length;}function appendText(text,target){var from=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var to=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1e9;for(var pos=0,_i12=0,first=true;_i12<text.length&&pos<=to;_i12++){var line=text[_i12],end=pos+line.length;if(end>=from){if(end>to)line=line.slice(0,to-pos);if(pos<from)line=line.slice(from-pos);if(first){target[target.length-1]+=line;first=false;}else target.push(line);}pos=end+1;}return target;}function sliceText(text,from,to){return appendText(text,[""],from,to);}var RawTextCursor=/*#__PURE__*/function(){function RawTextCursor(text){var dir=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;_classCallCheck(this,RawTextCursor);this.dir=dir;this.done=false;this.lineBreak=false;this.value="";this.nodes=[text];this.offsets=[dir>0?1:(text instanceof TextLeaf?text.text.length:text.children.length)<<1];}_createClass(RawTextCursor,[{key:"nextInner",value:function nextInner(skip,dir){this.done=this.lineBreak=false;for(;;){var last=this.nodes.length-1;var top2=this.nodes[last],offsetValue=this.offsets[last],offset=offsetValue>>1;var size=top2 instanceof TextLeaf?top2.text.length:top2.children.length;if(offset==(dir>0?size:0)){if(last==0){this.done=true;this.value="";return this;}if(dir>0)this.offsets[last-1]++;this.nodes.pop();this.offsets.pop();}else if((offsetValue&1)==(dir>0?0:1)){this.offsets[last]+=dir;if(skip==0){this.lineBreak=true;this.value="\n";return this;}skip--;}else if(top2 instanceof TextLeaf){var next=top2.text[offset+(dir<0?-1:0)];this.offsets[last]+=dir;if(next.length>Math.max(0,skip)){this.value=skip==0?next:dir>0?next.slice(skip):next.slice(0,next.length-skip);return this;}skip-=next.length;}else{var _next=top2.children[offset+(dir<0?-1:0)];if(skip>_next.length){skip-=_next.length;this.offsets[last]+=dir;}else{if(dir<0)this.offsets[last]--;this.nodes.push(_next);this.offsets.push(dir>0?1:(_next instanceof TextLeaf?_next.text.length:_next.children.length)<<1);}}}}},{key:"next",value:function next(){var skip=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(skip<0){this.nextInner(-skip,-this.dir);skip=this.value.length;}return this.nextInner(skip,this.dir);}}]);return RawTextCursor;}();var PartialTextCursor=/*#__PURE__*/function(){function PartialTextCursor(text,start,end){_classCallCheck(this,PartialTextCursor);this.value="";this.done=false;this.cursor=new RawTextCursor(text,start>end?-1:1);this.pos=start>end?text.length:0;this.from=Math.min(start,end);this.to=Math.max(start,end);}_createClass(PartialTextCursor,[{key:"nextInner",value:function nextInner(skip,dir){if(dir<0?this.pos<=this.from:this.pos>=this.to){this.value="";this.done=true;return this;}skip+=Math.max(0,dir<0?this.pos-this.to:this.from-this.pos);var limit=dir<0?this.pos-this.from:this.to-this.pos;if(skip>limit)skip=limit;limit-=skip;var _this$cursor$next=this.cursor.next(skip),value=_this$cursor$next.value;this.pos+=(value.length+skip)*dir;this.value=value.length<=limit?value:dir<0?value.slice(value.length-limit):value.slice(0,limit);this.done=!this.value;return this;}},{key:"next",value:function next(){var skip=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;if(skip<0)skip=Math.max(skip,this.from-this.pos);else if(skip>0)skip=Math.min(skip,this.to-this.pos);return this.nextInner(skip,this.cursor.dir);}},{key:"lineBreak",get:function get(){return this.cursor.lineBreak&&this.value!="";}}]);return PartialTextCursor;}();var LineCursor=/*#__PURE__*/function(){function LineCursor(inner){_classCallCheck(this,LineCursor);this.inner=inner;this.afterBreak=true;this.value="";this.done=false;}_createClass(LineCursor,[{key:"next",value:function next(){var skip=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var _this$inner$next=this.inner.next(skip),done=_this$inner$next.done,lineBreak=_this$inner$next.lineBreak,value=_this$inner$next.value;if(done){this.done=true;this.value="";}else if(lineBreak){if(this.afterBreak){this.value="";}else{this.afterBreak=true;this.next();}}else{this.value=value;this.afterBreak=false;}return this;}},{key:"lineBreak",get:function get(){return false;}}]);return LineCursor;}();if(typeof Symbol!="undefined"){Text.prototype[Symbol.iterator]=function(){return this.iter();};RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this;};}var Line=/*#__PURE__*/function(){function Line(from,to,number2,text){_classCallCheck(this,Line);this.from=from;this.to=to;this.number=number2;this.text=text;}_createClass(Line,[{key:"length",get:function get(){return this.to-this.from;}}]);return Line;}();// ../node_modules/@codemirror/state/dist/index.js
var DefaultSplit=/\r\n?|\n/;var MapMode=/* @__PURE__ */function(MapMode2){MapMode2[MapMode2["Simple"]=0]="Simple";MapMode2[MapMode2["TrackDel"]=1]="TrackDel";MapMode2[MapMode2["TrackBefore"]=2]="TrackBefore";MapMode2[MapMode2["TrackAfter"]=3]="TrackAfter";return MapMode2;}(MapMode||(MapMode={}));var ChangeDesc=/*#__PURE__*/function(){function ChangeDesc(sections){_classCallCheck(this,ChangeDesc);this.sections=sections;}_createClass(ChangeDesc,[{key:"length",get:function get(){var result=0;for(var _i13=0;_i13<this.sections.length;_i13+=2){result+=this.sections[_i13];}return result;}},{key:"newLength",get:function get(){var result=0;for(var _i14=0;_i14<this.sections.length;_i14+=2){var ins=this.sections[_i14+1];result+=ins<0?this.sections[_i14]:ins;}return result;}},{key:"empty",get:function get(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0;}},{key:"iterGaps",value:function iterGaps(f){for(var _i15=0,posA=0,posB=0;_i15<this.sections.length;){var len=this.sections[_i15++],ins=this.sections[_i15++];if(ins<0){f(posA,posB,len);posB+=len;}else{posB+=ins;}posA+=len;}}},{key:"iterChangedRanges",value:function iterChangedRanges(f){var individual=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_iterChanges(this,f,individual);}},{key:"invertedDesc",get:function get(){var sections=[];for(var _i16=0;_i16<this.sections.length;){var len=this.sections[_i16++],ins=this.sections[_i16++];if(ins<0)sections.push(len,ins);else sections.push(ins,len);}return new ChangeDesc(sections);}},{key:"composeDesc",value:function composeDesc(other){return this.empty?other:other.empty?this:composeSets(this,other);}},{key:"mapDesc",value:function mapDesc(other){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return other.empty?this:mapSet(this,other,before);}},{key:"mapPos",value:function mapPos(pos){var assoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var mode=arguments.length>2&&arguments[2]!==undefined?arguments[2]:MapMode.Simple;var posA=0,posB=0;for(var _i17=0;_i17<this.sections.length;){var len=this.sections[_i17++],ins=this.sections[_i17++],endA=posA+len;if(ins<0){if(endA>pos)return posB+(pos-posA);posB+=len;}else{if(mode!=MapMode.Simple&&endA>=pos&&(mode==MapMode.TrackDel&&posA<pos&&endA>pos||mode==MapMode.TrackBefore&&posA<pos||mode==MapMode.TrackAfter&&endA>pos))return null;if(endA>pos||endA==pos&&assoc<0&&!len)return pos==posA||assoc<0?posB:posB+ins;posB+=ins;}posA=endA;}if(pos>posA)throw new RangeError("Position ".concat(pos," is out of range for changeset of length ").concat(posA));return posB;}},{key:"touchesRange",value:function touchesRange(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;for(var _i18=0,pos=0;_i18<this.sections.length&&pos<=to;){var len=this.sections[_i18++],ins=this.sections[_i18++],end=pos+len;if(ins>=0&&pos<=to&&end>=from)return pos<from&&end>to?"cover":true;pos=end;}return false;}},{key:"toString",value:function toString(){var result="";for(var _i19=0;_i19<this.sections.length;){var len=this.sections[_i19++],ins=this.sections[_i19++];result+=(result?" ":"")+len+(ins>=0?":"+ins:"");}return result;}},{key:"toJSON",value:function toJSON(){return this.sections;}}],[{key:"fromJSON",value:function fromJSON(json){if(!Array.isArray(json)||json.length%2||json.some(function(a){return typeof a!="number";}))throw new RangeError("Invalid JSON representation of ChangeDesc");return new ChangeDesc(json);}}]);return ChangeDesc;}();var ChangeSet=/*#__PURE__*/function(_ChangeDesc){_inherits(ChangeSet,_ChangeDesc);var _super3=_createSuper(ChangeSet);function ChangeSet(sections,inserted){var _this3;_classCallCheck(this,ChangeSet);_this3=_super3.call(this,sections);_this3.inserted=inserted;return _this3;}_createClass(ChangeSet,[{key:"apply",value:function apply(doc6){if(this.length!=doc6.length)throw new RangeError("Applying change set to a document with the wrong length");_iterChanges(this,function(fromA,toA,fromB,_toB,text){return doc6=doc6.replace(fromB,fromB+(toA-fromA),text);},false);return doc6;}},{key:"mapDesc",value:function mapDesc(other){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return mapSet(this,other,before,true);}},{key:"invert",value:function invert(doc6){var sections=this.sections.slice(),inserted=[];for(var _i20=0,pos=0;_i20<sections.length;_i20+=2){var len=sections[_i20],ins=sections[_i20+1];if(ins>=0){sections[_i20]=ins;sections[_i20+1]=len;var index=_i20>>1;while(inserted.length<index){inserted.push(Text.empty);}inserted.push(len?doc6.slice(pos,pos+len):Text.empty);}pos+=len;}return new ChangeSet(sections,inserted);}},{key:"compose",value:function compose(other){return this.empty?other:other.empty?this:composeSets(this,other,true);}},{key:"map",value:function map(other){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return other.empty?this:mapSet(this,other,before,true);}},{key:"iterChanges",value:function iterChanges(f){var individual=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_iterChanges(this,f,individual);}},{key:"desc",get:function get(){return new ChangeDesc(this.sections);}},{key:"filter",value:function filter(ranges){var resultSections=[],resultInserted=[],filteredSections=[];var iter=new SectionIter(this);done:for(var _i21=0,pos=0;;){var next=_i21==ranges.length?1e9:ranges[_i21++];while(pos<next||pos==next&&iter.len==0){if(iter.done)break done;var len=Math.min(iter.len,next-pos);addSection(filteredSections,len,-1);var ins=iter.ins==-1?-1:iter.off==0?iter.ins:0;addSection(resultSections,len,ins);if(ins>0)addInsert(resultInserted,resultSections,iter.text);iter.forward(len);pos+=len;}var end=ranges[_i21++];while(pos<end){if(iter.done)break done;var _len=Math.min(iter.len,end-pos);addSection(resultSections,_len,-1);addSection(filteredSections,_len,iter.ins==-1?-1:iter.off==0?iter.ins:0);iter.forward(_len);pos+=_len;}}return{changes:new ChangeSet(resultSections,resultInserted),filtered:new ChangeDesc(filteredSections)};}},{key:"toJSON",value:function toJSON(){var parts=[];for(var _i22=0;_i22<this.sections.length;_i22+=2){var len=this.sections[_i22],ins=this.sections[_i22+1];if(ins<0)parts.push(len);else if(ins==0)parts.push([len]);else parts.push([len].concat(this.inserted[_i22>>1].toJSON()));}return parts;}}],[{key:"of",value:function of(changes,length,lineSep){var sections=[],inserted=[],pos=0;var total=null;function flush(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!force&&!sections.length)return;if(pos<length)addSection(sections,length-pos,-1);var set=new ChangeSet(sections,inserted);total=total?total.compose(set.map(total)):set;sections=[];inserted=[];pos=0;}function process(spec){if(Array.isArray(spec)){var _iterator10=_createForOfIteratorHelper(spec),_step10;try{for(_iterator10.s();!(_step10=_iterator10.n()).done;){var sub=_step10.value;process(sub);}}catch(err){_iterator10.e(err);}finally{_iterator10.f();}}else if(spec instanceof ChangeSet){if(spec.length!=length)throw new RangeError("Mismatched change set length (got ".concat(spec.length,", expected ").concat(length,")"));flush();total=total?total.compose(spec.map(total)):spec;}else{var from=spec.from,_spec$to=spec.to,to=_spec$to===void 0?from:_spec$to,insert2=spec.insert;if(from>to||from<0||to>length)throw new RangeError("Invalid change range ".concat(from," to ").concat(to," (in doc of length ").concat(length,")"));var insText=!insert2?Text.empty:typeof insert2=="string"?Text.of(insert2.split(lineSep||DefaultSplit)):insert2;var insLen=insText.length;if(from==to&&insLen==0)return;if(from<pos)flush();if(from>pos)addSection(sections,from-pos,-1);addSection(sections,to-from,insLen);addInsert(inserted,sections,insText);pos=to;}}process(changes);flush(!total);return total;}},{key:"empty",value:function empty(length){return new ChangeSet(length?[length,-1]:[],[]);}},{key:"fromJSON",value:function fromJSON(json){if(!Array.isArray(json))throw new RangeError("Invalid JSON representation of ChangeSet");var sections=[],inserted=[];for(var _i23=0;_i23<json.length;_i23++){var part=json[_i23];if(typeof part=="number"){sections.push(part,-1);}else if(!Array.isArray(part)||typeof part[0]!="number"||part.some(function(e,i2){return i2&&typeof e!="string";})){throw new RangeError("Invalid JSON representation of ChangeSet");}else if(part.length==1){sections.push(part[0],0);}else{while(inserted.length<_i23){inserted.push(Text.empty);}inserted[_i23]=Text.of(part.slice(1));sections.push(part[0],inserted[_i23].length);}}return new ChangeSet(sections,inserted);}}]);return ChangeSet;}(ChangeDesc);function addSection(sections,len,ins){var forceJoin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(len==0&&ins<=0)return;var last=sections.length-2;if(last>=0&&ins<=0&&ins==sections[last+1])sections[last]+=len;else if(len==0&&sections[last]==0)sections[last+1]+=ins;else if(forceJoin){sections[last]+=len;sections[last+1]+=ins;}else sections.push(len,ins);}function addInsert(values,sections,value){if(value.length==0)return;var index=sections.length-2>>1;if(index<values.length){values[values.length-1]=values[values.length-1].append(value);}else{while(values.length<index){values.push(Text.empty);}values.push(value);}}function _iterChanges(desc,f,individual){var inserted=desc.inserted;for(var posA=0,posB=0,_i24=0;_i24<desc.sections.length;){var len=desc.sections[_i24++],ins=desc.sections[_i24++];if(ins<0){posA+=len;posB+=len;}else{var endA=posA,endB=posB,_text=Text.empty;for(;;){endA+=len;endB+=ins;if(ins&&inserted)_text=_text.append(inserted[_i24-2>>1]);if(individual||_i24==desc.sections.length||desc.sections[_i24+1]<0)break;len=desc.sections[_i24++];ins=desc.sections[_i24++];}f(posA,endA,posB,endB,_text);posA=endA;posB=endB;}}}function mapSet(setA,setB,before){var mkSet=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var sections=[],insert2=mkSet?[]:null;var a=new SectionIter(setA),b=new SectionIter(setB);for(var posA=0,posB=0;;){if(a.ins==-1){posA+=a.len;a.next();}else if(b.ins==-1&&posB<posA){var skip=Math.min(b.len,posA-posB);b.forward(skip);addSection(sections,skip,-1);posB+=skip;}else if(b.ins>=0&&(a.done||posB<posA||posB==posA&&(b.len<a.len||b.len==a.len&&!before))){addSection(sections,b.ins,-1);while(posA>posB&&!a.done&&posA+a.len<posB+b.len){posA+=a.len;a.next();}posB+=b.len;b.next();}else if(a.ins>=0){var len=0,end=posA+a.len;for(;;){if(b.ins>=0&&posB>posA&&posB+b.len<end){len+=b.ins;posB+=b.len;b.next();}else if(b.ins==-1&&posB<end){var _skip=Math.min(b.len,end-posB);len+=_skip;b.forward(_skip);posB+=_skip;}else{break;}}addSection(sections,len,a.ins);if(insert2)addInsert(insert2,sections,a.text);posA=end;a.next();}else if(a.done&&b.done){return insert2?new ChangeSet(sections,insert2):new ChangeDesc(sections);}else{throw new Error("Mismatched change set lengths");}}}function composeSets(setA,setB){var mkSet=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var sections=[];var insert2=mkSet?[]:null;var a=new SectionIter(setA),b=new SectionIter(setB);for(var open=false;;){if(a.done&&b.done){return insert2?new ChangeSet(sections,insert2):new ChangeDesc(sections);}else if(a.ins==0){addSection(sections,a.len,0,open);a.next();}else if(b.len==0&&!b.done){addSection(sections,0,b.ins,open);if(insert2)addInsert(insert2,sections,b.text);b.next();}else if(a.done||b.done){throw new Error("Mismatched change set lengths");}else{var len=Math.min(a.len2,b.len),sectionLen=sections.length;if(a.ins==-1){var insB=b.ins==-1?-1:b.off?0:b.ins;addSection(sections,len,insB,open);if(insert2&&insB)addInsert(insert2,sections,b.text);}else if(b.ins==-1){addSection(sections,a.off?0:a.len,len,open);if(insert2)addInsert(insert2,sections,a.textBit(len));}else{addSection(sections,a.off?0:a.len,b.off?0:b.ins,open);if(insert2&&!b.off)addInsert(insert2,sections,b.text);}open=(a.ins>len||b.ins>=0&&b.len>len)&&(open||sections.length>sectionLen);a.forward2(len);b.forward(len);}}}var SectionIter=/*#__PURE__*/function(){function SectionIter(set){_classCallCheck(this,SectionIter);this.set=set;this.i=0;this.next();}_createClass(SectionIter,[{key:"next",value:function next(){var sections=this.set.sections;if(this.i<sections.length){this.len=sections[this.i++];this.ins=sections[this.i++];}else{this.len=0;this.ins=-2;}this.off=0;}},{key:"done",get:function get(){return this.ins==-2;}},{key:"len2",get:function get(){return this.ins<0?this.len:this.ins;}},{key:"text",get:function get(){var inserted=this.set.inserted,index=this.i-2>>1;return index>=inserted.length?Text.empty:inserted[index];}},{key:"textBit",value:function textBit(len){var inserted=this.set.inserted,index=this.i-2>>1;return index>=inserted.length&&!len?Text.empty:inserted[index].slice(this.off,len==null?void 0:this.off+len);}},{key:"forward",value:function forward(len){if(len==this.len)this.next();else{this.len-=len;this.off+=len;}}},{key:"forward2",value:function forward2(len){if(this.ins==-1)this.forward(len);else if(len==this.ins)this.next();else{this.ins-=len;this.off+=len;}}}]);return SectionIter;}();var SelectionRange=/*#__PURE__*/function(){function SelectionRange(from,to,flags){_classCallCheck(this,SelectionRange);this.from=from;this.to=to;this.flags=flags;}_createClass(SelectionRange,[{key:"anchor",get:function get(){return this.flags&16?this.to:this.from;}},{key:"head",get:function get(){return this.flags&16?this.from:this.to;}},{key:"empty",get:function get(){return this.from==this.to;}},{key:"assoc",get:function get(){return this.flags&4?-1:this.flags&8?1:0;}},{key:"bidiLevel",get:function get(){var level=this.flags&3;return level==3?null:level;}},{key:"goalColumn",get:function get(){var value=this.flags>>5;return value==33554431?void 0:value;}},{key:"map",value:function map(change){var assoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;var from=change.mapPos(this.from,assoc),to=change.mapPos(this.to,assoc);return from==this.from&&to==this.to?this:new SelectionRange(from,to,this.flags);}},{key:"extend",value:function extend(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(from<=this.anchor&&to>=this.anchor)return EditorSelection.range(from,to);var head=Math.abs(from-this.anchor)>Math.abs(to-this.anchor)?from:to;return EditorSelection.range(this.anchor,head);}},{key:"eq",value:function eq(other){return this.anchor==other.anchor&&this.head==other.head;}},{key:"toJSON",value:function toJSON(){return{anchor:this.anchor,head:this.head};}}],[{key:"fromJSON",value:function fromJSON(json){if(!json||typeof json.anchor!="number"||typeof json.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(json.anchor,json.head);}}]);return SelectionRange;}();var EditorSelection=/*#__PURE__*/function(){function EditorSelection(ranges){var mainIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,EditorSelection);this.ranges=ranges;this.mainIndex=mainIndex;}_createClass(EditorSelection,[{key:"map",value:function map(change){var assoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1;if(change.empty)return this;return EditorSelection.create(this.ranges.map(function(r){return r.map(change,assoc);}),this.mainIndex);}},{key:"eq",value:function eq(other){if(this.ranges.length!=other.ranges.length||this.mainIndex!=other.mainIndex)return false;for(var _i25=0;_i25<this.ranges.length;_i25++){if(!this.ranges[_i25].eq(other.ranges[_i25]))return false;}return true;}},{key:"main",get:function get(){return this.ranges[this.mainIndex];}},{key:"asSingle",value:function asSingle(){return this.ranges.length==1?this:new EditorSelection([this.main]);}},{key:"addRange",value:function addRange(range){var main=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return EditorSelection.create([range].concat(this.ranges),main?0:this.mainIndex+1);}},{key:"replaceRange",value:function replaceRange(range){var which=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.mainIndex;var ranges=this.ranges.slice();ranges[which]=range;return EditorSelection.create(ranges,this.mainIndex);}},{key:"toJSON",value:function toJSON(){return{ranges:this.ranges.map(function(r){return r.toJSON();}),main:this.mainIndex};}}],[{key:"fromJSON",value:function fromJSON(json){if(!json||!Array.isArray(json.ranges)||typeof json.main!="number"||json.main>=json.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new EditorSelection(json.ranges.map(function(r){return SelectionRange.fromJSON(r);}),json.main);}},{key:"single",value:function single(anchor){var head=arguments.length>1&&arguments[1]!==undefined?arguments[1]:anchor;return new EditorSelection([EditorSelection.range(anchor,head)],0);}},{key:"create",value:function create(ranges){var mainIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(ranges.length==0)throw new RangeError("A selection needs at least one range");for(var pos=0,_i26=0;_i26<ranges.length;_i26++){var range=ranges[_i26];if(range.empty?range.from<=pos:range.from<pos)return normalized(ranges.slice(),mainIndex);pos=range.to;}return new EditorSelection(ranges,mainIndex);}},{key:"cursor",value:function cursor(pos){var assoc=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var bidiLevel=arguments.length>2?arguments[2]:undefined;var goalColumn=arguments.length>3?arguments[3]:undefined;return new SelectionRange(pos,pos,(assoc==0?0:assoc<0?4:8)|(bidiLevel==null?3:Math.min(2,bidiLevel))|(goalColumn!==null&&goalColumn!==void 0?goalColumn:33554431)<<5);}},{key:"range",value:function range(anchor,head,goalColumn){var goal=(goalColumn!==null&&goalColumn!==void 0?goalColumn:33554431)<<5;return head<anchor?new SelectionRange(head,anchor,16|goal):new SelectionRange(anchor,head,goal);}}]);return EditorSelection;}();function normalized(ranges){var mainIndex=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var main=ranges[mainIndex];ranges.sort(function(a,b){return a.from-b.from;});mainIndex=ranges.indexOf(main);for(var _i27=1;_i27<ranges.length;_i27++){var range=ranges[_i27],prev=ranges[_i27-1];if(range.empty?range.from<=prev.to:range.from<prev.to){var from=prev.from,to=Math.max(range.to,prev.to);if(_i27<=mainIndex)mainIndex--;ranges.splice(--_i27,2,range.anchor>range.head?EditorSelection.range(to,from):EditorSelection.range(from,to));}}return new EditorSelection(ranges,mainIndex);}function checkSelection(selection2,docLength){var _iterator11=_createForOfIteratorHelper(selection2.ranges),_step11;try{for(_iterator11.s();!(_step11=_iterator11.n()).done;){var range=_step11.value;if(range.to>docLength)throw new RangeError("Selection points outside of document");}}catch(err){_iterator11.e(err);}finally{_iterator11.f();}}var nextID=0;var Facet=/*#__PURE__*/function(){function Facet(combine,compareInput,compare2,isStatic,extensions){_classCallCheck(this,Facet);this.combine=combine;this.compareInput=compareInput;this.compare=compare2;this.isStatic=isStatic;this.extensions=extensions;this.id=nextID++;this["default"]=combine([]);}_createClass(Facet,[{key:"of",value:function of(value){return new FacetProvider([],this,0,value);}},{key:"compute",value:function compute(deps,get){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(deps,this,1,get);}},{key:"computeN",value:function computeN(deps,get){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(deps,this,2,get);}},{key:"from",value:function from(field,get){if(!get)get=function get(x){return x;};return this.compute([field],function(state){return get(state.field(field));});}}],[{key:"define",value:function define(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new Facet(config2.combine||function(a){return a;},config2.compareInput||function(a,b){return a===b;},config2.compare||(!config2.combine?sameArray:function(a,b){return a===b;}),!!config2["static"],config2.enables);}}]);return Facet;}();function sameArray(a,b){return a==b||a.length==b.length&&a.every(function(e,i){return e===b[i];});}var FacetProvider=/*#__PURE__*/function(){function FacetProvider(dependencies,facet,type,value){_classCallCheck(this,FacetProvider);this.dependencies=dependencies;this.facet=facet;this.type=type;this.value=value;this.id=nextID++;}_createClass(FacetProvider,[{key:"dynamicSlot",value:function dynamicSlot(addresses){var _a;var getter=this.value;var compare2=this.facet.compareInput;var idx=addresses[this.id]>>1,multi=this.type==2;var depDoc=false,depSel=false,depAddrs=[];var _iterator12=_createForOfIteratorHelper(this.dependencies),_step12;try{for(_iterator12.s();!(_step12=_iterator12.n()).done;){var dep=_step12.value;if(dep=="doc")depDoc=true;else if(dep=="selection")depSel=true;else if((((_a=addresses[dep.id])!==null&&_a!==void 0?_a:1)&1)==0)depAddrs.push(addresses[dep.id]);}}catch(err){_iterator12.e(err);}finally{_iterator12.f();}return function(state,tr){var oldVal=state.values[idx];if(oldVal===Uninitialized){state.values[idx]=getter(state);return 1;}if(tr){var depChanged=depDoc&&tr.docChanged||depSel&&(tr.docChanged||tr.selection)||depAddrs.some(function(addr){return(ensureAddr(state,addr)&1)>0;});if(depChanged){var newVal=getter(state);if(multi?!compareArray(newVal,oldVal,compare2):!compare2(newVal,oldVal)){state.values[idx]=newVal;return 1;}}}return 0;};}}]);return FacetProvider;}();function compareArray(a,b,compare2){if(a.length!=b.length)return false;for(var _i28=0;_i28<a.length;_i28++){if(!compare2(a[_i28],b[_i28]))return false;}return true;}function dynamicFacetSlot(addresses,facet,providers){var providerAddrs=providers.map(function(p){return addresses[p.id];});var providerTypes=providers.map(function(p){return p.type;});var dynamic=providerAddrs.filter(function(p){return!(p&1);});var idx=addresses[facet.id]>>1;return function(state,tr){var oldVal=state.values[idx],changed=oldVal===Uninitialized||!tr;var _iterator13=_createForOfIteratorHelper(dynamic),_step13;try{for(_iterator13.s();!(_step13=_iterator13.n()).done;){var dynAddr=_step13.value;if(ensureAddr(state,dynAddr)&1)changed=true;}}catch(err){_iterator13.e(err);}finally{_iterator13.f();}if(!changed)return 0;var values=[];for(var _i29=0;_i29<providerAddrs.length;_i29++){var value2=getAddr(state,providerAddrs[_i29]);if(providerTypes[_i29]==2){var _iterator14=_createForOfIteratorHelper(value2),_step14;try{for(_iterator14.s();!(_step14=_iterator14.n()).done;){var val=_step14.value;values.push(val);}}catch(err){_iterator14.e(err);}finally{_iterator14.f();}}else values.push(value2);}var value=facet.combine(values);if(facet.compare(value,oldVal))return 0;state.values[idx]=value;return 1;};}var initField=/* @__PURE__ */Facet.define({"static":true});var StateField=/*#__PURE__*/function(){function StateField(id,createF,updateF,compareF,spec){_classCallCheck(this,StateField);this.id=id;this.createF=createF;this.updateF=updateF;this.compareF=compareF;this.spec=spec;this.provides=void 0;}_createClass(StateField,[{key:"create",value:function create(state){var _this4=this;var init=state.facet(initField).find(function(i){return i.field==_this4;});return((init===null||init===void 0?void 0:init.create)||this.createF)(state);}},{key:"slot",value:function slot(addresses){var _this5=this;var idx=addresses[this.id]>>1;return function(state,tr){var oldVal=state.values[idx];if(oldVal===Uninitialized){state.values[idx]=_this5.create(state);return 1;}if(tr){var value=_this5.updateF(oldVal,tr);if(!_this5.compareF(oldVal,value)){state.values[idx]=value;return 1;}}return 0;};}},{key:"init",value:function init(create){return[this,initField.of({field:this,create:create})];}},{key:"extension",get:function get(){return this;}}],[{key:"define",value:function define(config2){var field=new StateField(nextID++,config2.create,config2.update,config2.compare||function(a,b){return a===b;},config2);if(config2.provide)field.provides=config2.provide(field);return field;}}]);return StateField;}();var Prec_={lowest:4,low:3,"default":2,high:1,highest:0};function prec(value){return function(ext){return new PrecExtension(ext,value);};}var Prec={lowest:/* @__PURE__ */prec(Prec_.lowest),low:/* @__PURE__ */prec(Prec_.low),"default":/* @__PURE__ */prec(Prec_["default"]),high:/* @__PURE__ */prec(Prec_.high),highest:/* @__PURE__ */prec(Prec_.highest),fallback:/* @__PURE__ */prec(Prec_.lowest),extend:/* @__PURE__ */prec(Prec_.high),override:/* @__PURE__ */prec(Prec_.highest)};var PrecExtension=/*#__PURE__*/_createClass(function PrecExtension(inner,prec2){_classCallCheck(this,PrecExtension);this.inner=inner;this.prec=prec2;});var Compartment=/*#__PURE__*/function(){function Compartment(){_classCallCheck(this,Compartment);}_createClass(Compartment,[{key:"of",value:function of(ext){return new CompartmentInstance(this,ext);}},{key:"reconfigure",value:function reconfigure(content2){return Compartment.reconfigure.of({compartment:this,extension:content2});}},{key:"get",value:function get(state){return state.config.compartments.get(this);}}]);return Compartment;}();var CompartmentInstance=/*#__PURE__*/_createClass(function CompartmentInstance(compartment,inner){_classCallCheck(this,CompartmentInstance);this.compartment=compartment;this.inner=inner;});var Configuration=/*#__PURE__*/function(){function Configuration(base2,compartments,dynamicSlots,address,staticValues){_classCallCheck(this,Configuration);this.base=base2;this.compartments=compartments;this.dynamicSlots=dynamicSlots;this.address=address;this.staticValues=staticValues;this.statusTemplate=[];while(this.statusTemplate.length<dynamicSlots.length){this.statusTemplate.push(0);}}_createClass(Configuration,[{key:"staticFacet",value:function staticFacet(facet){var addr=this.address[facet.id];return addr==null?facet["default"]:this.staticValues[addr>>1];}}],[{key:"resolve",value:function resolve(base2,compartments,oldState){var fields=[];var facets=/* @__PURE__ */Object.create(null);var newCompartments=/* @__PURE__ */new Map();var _iterator15=_createForOfIteratorHelper(flatten(base2,compartments,newCompartments)),_step15;try{for(_iterator15.s();!(_step15=_iterator15.n()).done;){var ext=_step15.value;if(ext instanceof StateField)fields.push(ext);else(facets[ext.facet.id]||(facets[ext.facet.id]=[])).push(ext);}}catch(err){_iterator15.e(err);}finally{_iterator15.f();}var address=/* @__PURE__ */Object.create(null);var staticValues=[];var dynamicSlots=[];var _loop=function _loop(){var field=_fields[_i30];address[field.id]=dynamicSlots.length<<1;dynamicSlots.push(function(a){return field.slot(a);});};for(var _i30=0,_fields=fields;_i30<_fields.length;_i30++){_loop();}var _loop2=function _loop2(id){var providers=facets[id],facet=providers[0].facet;if(providers.every(function(p){return p.type==0;})){address[facet.id]=staticValues.length<<1|1;var value=facet.combine(providers.map(function(p){return p.value;}));var oldAddr=oldState?oldState.config.address[facet.id]:null;if(oldAddr!=null){var oldVal=getAddr(oldState,oldAddr);if(facet.compare(value,oldVal))value=oldVal;}staticValues.push(value);}else{var _iterator16=_createForOfIteratorHelper(providers),_step16;try{var _loop3=function _loop3(){var p=_step16.value;if(p.type==0){address[p.id]=staticValues.length<<1|1;staticValues.push(p.value);}else{address[p.id]=dynamicSlots.length<<1;dynamicSlots.push(function(a){return p.dynamicSlot(a);});}};for(_iterator16.s();!(_step16=_iterator16.n()).done;){_loop3();}}catch(err){_iterator16.e(err);}finally{_iterator16.f();}address[facet.id]=dynamicSlots.length<<1;dynamicSlots.push(function(a){return dynamicFacetSlot(a,facet,providers);});}};for(var id in facets){_loop2(id);}return new Configuration(base2,newCompartments,dynamicSlots.map(function(f){return f(address);}),address,staticValues);}}]);return Configuration;}();function flatten(extension,compartments,newCompartments){var result=[[],[],[],[],[]];var seen=/* @__PURE__ */new Map();function inner(ext,prec2){var known=seen.get(ext);if(known!=null){if(known>=prec2)return;var found=result[known].indexOf(ext);if(found>-1)result[known].splice(found,1);if(ext instanceof CompartmentInstance)newCompartments["delete"](ext.compartment);}seen.set(ext,prec2);if(Array.isArray(ext)){var _iterator17=_createForOfIteratorHelper(ext),_step17;try{for(_iterator17.s();!(_step17=_iterator17.n()).done;){var e=_step17.value;inner(e,prec2);}}catch(err){_iterator17.e(err);}finally{_iterator17.f();}}else if(ext instanceof CompartmentInstance){if(newCompartments.has(ext.compartment))throw new RangeError("Duplicate use of compartment in extensions");var content2=compartments.get(ext.compartment)||ext.inner;newCompartments.set(ext.compartment,content2);inner(content2,prec2);}else if(ext instanceof PrecExtension){inner(ext.inner,ext.prec);}else if(ext instanceof StateField){result[prec2].push(ext);if(ext.provides)inner(ext.provides,prec2);}else if(ext instanceof FacetProvider){result[prec2].push(ext);if(ext.facet.extensions)inner(ext.facet.extensions,prec2);}else{var _content=ext.extension;if(!_content)throw new Error("Unrecognized extension value in extension set (".concat(ext,"). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks."));inner(_content,prec2);}}inner(extension,Prec_["default"]);return result.reduce(function(a,b){return a.concat(b);});}var Uninitialized={};function ensureAddr(state,addr){if(addr&1)return 2;var idx=addr>>1;var status=state.status[idx];if(status==4)throw new Error("Cyclic dependency between fields and/or facets");if(status&2)return status;state.status[idx]=4;var changed=state.config.dynamicSlots[idx](state,state.applying);return state.status[idx]=2|changed;}function getAddr(state,addr){return addr&1?state.config.staticValues[addr>>1]:state.values[addr>>1];}var languageData=/* @__PURE__ */Facet.define();var allowMultipleSelections=/* @__PURE__ */Facet.define({combine:function combine(values){return values.some(function(v){return v;});},"static":true});var lineSeparator=/* @__PURE__ */Facet.define({combine:function combine(values){return values.length?values[0]:void 0;},"static":true});var changeFilter=/* @__PURE__ */Facet.define();var transactionFilter=/* @__PURE__ */Facet.define();var transactionExtender=/* @__PURE__ */Facet.define();var readOnly=/* @__PURE__ */Facet.define({combine:function combine(values){return values.length?values[0]:false;}});var Annotation=/*#__PURE__*/function(){function Annotation(type,value){_classCallCheck(this,Annotation);this.type=type;this.value=value;}_createClass(Annotation,null,[{key:"define",value:function define(){return new AnnotationType();}}]);return Annotation;}();var AnnotationType=/*#__PURE__*/function(){function AnnotationType(){_classCallCheck(this,AnnotationType);}_createClass(AnnotationType,[{key:"of",value:function of(value){return new Annotation(this,value);}}]);return AnnotationType;}();var StateEffectType=/*#__PURE__*/function(){function StateEffectType(map){_classCallCheck(this,StateEffectType);this.map=map;}_createClass(StateEffectType,[{key:"of",value:function of(value){return new StateEffect(this,value);}}]);return StateEffectType;}();var StateEffect=/*#__PURE__*/function(){function StateEffect(type,value){_classCallCheck(this,StateEffect);this.type=type;this.value=value;}_createClass(StateEffect,[{key:"map",value:function map(mapping){var mapped=this.type.map(this.value,mapping);return mapped===void 0?void 0:mapped==this.value?this:new StateEffect(this.type,mapped);}},{key:"is",value:function is(type){return this.type==type;}}],[{key:"define",value:function define(){var spec=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new StateEffectType(spec.map||function(v){return v;});}},{key:"mapEffects",value:function mapEffects(effects,mapping){if(!effects.length)return effects;var result=[];var _iterator18=_createForOfIteratorHelper(effects),_step18;try{for(_iterator18.s();!(_step18=_iterator18.n()).done;){var effect=_step18.value;var mapped=effect.map(mapping);if(mapped)result.push(mapped);}}catch(err){_iterator18.e(err);}finally{_iterator18.f();}return result;}}]);return StateEffect;}();StateEffect.reconfigure=/* @__PURE__ */StateEffect.define();StateEffect.appendConfig=/* @__PURE__ */StateEffect.define();var Transaction=/*#__PURE__*/function(){function Transaction(startState,changes,selection2,effects,annotations,scrollIntoView6){_classCallCheck(this,Transaction);this.startState=startState;this.changes=changes;this.selection=selection2;this.effects=effects;this.annotations=annotations;this.scrollIntoView=scrollIntoView6;this._doc=null;this._state=null;if(selection2)checkSelection(selection2,changes.newLength);if(!annotations.some(function(a){return a.type==Transaction.time;}))this.annotations=annotations.concat(Transaction.time.of(Date.now()));}_createClass(Transaction,[{key:"newDoc",get:function get(){return this._doc||(this._doc=this.changes.apply(this.startState.doc));}},{key:"newSelection",get:function get(){return this.selection||this.startState.selection.map(this.changes);}},{key:"state",get:function get(){if(!this._state)this.startState.applyTransaction(this);return this._state;}},{key:"annotation",value:function annotation(type){var _iterator19=_createForOfIteratorHelper(this.annotations),_step19;try{for(_iterator19.s();!(_step19=_iterator19.n()).done;){var ann=_step19.value;if(ann.type==type)return ann.value;}}catch(err){_iterator19.e(err);}finally{_iterator19.f();}return void 0;}},{key:"docChanged",get:function get(){return!this.changes.empty;}},{key:"reconfigured",get:function get(){return this.startState.config!=this.state.config;}},{key:"isUserEvent",value:function isUserEvent(event){var e=this.annotation(Transaction.userEvent);return!!(e&&(e==event||e.length>event.length&&e.slice(0,event.length)==event&&e[event.length]=="."));}}]);return Transaction;}();Transaction.time=/* @__PURE__ */Annotation.define();Transaction.userEvent=/* @__PURE__ */Annotation.define();Transaction.addToHistory=/* @__PURE__ */Annotation.define();Transaction.remote=/* @__PURE__ */Annotation.define();function joinRanges(a,b){var result=[];for(var iA=0,iB=0;;){var from=void 0,to=void 0;if(iA<a.length&&(iB==b.length||b[iB]>=a[iA])){from=a[iA++];to=a[iA++];}else if(iB<b.length){from=b[iB++];to=b[iB++];}else return result;if(!result.length||result[result.length-1]<from)result.push(from,to);else if(result[result.length-1]<to)result[result.length-1]=to;}}function mergeTransaction(a,b,sequential){var _a;var mapForA,mapForB,changes;if(sequential){mapForA=b.changes;mapForB=ChangeSet.empty(b.changes.length);changes=a.changes.compose(b.changes);}else{mapForA=b.changes.map(a.changes);mapForB=a.changes.mapDesc(b.changes,true);changes=a.changes.compose(mapForA);}return{changes:changes,selection:b.selection?b.selection.map(mapForB):(_a=a.selection)===null||_a===void 0?void 0:_a.map(mapForA),effects:StateEffect.mapEffects(a.effects,mapForA).concat(StateEffect.mapEffects(b.effects,mapForB)),annotations:a.annotations.length?a.annotations.concat(b.annotations):b.annotations,scrollIntoView:a.scrollIntoView||b.scrollIntoView};}function resolveTransactionInner(state,spec,docSize){var sel=spec.selection,annotations=asArray(spec.annotations);if(spec.userEvent)annotations=annotations.concat(Transaction.userEvent.of(spec.userEvent));return{changes:spec.changes instanceof ChangeSet?spec.changes:ChangeSet.of(spec.changes||[],docSize,state.facet(lineSeparator)),selection:sel&&(sel instanceof EditorSelection?sel:EditorSelection.single(sel.anchor,sel.head)),effects:asArray(spec.effects),annotations:annotations,scrollIntoView:!!spec.scrollIntoView};}function resolveTransaction(state,specs,filter){var s=resolveTransactionInner(state,specs.length?specs[0]:{},state.doc.length);if(specs.length&&specs[0].filter===false)filter=false;for(var _i31=1;_i31<specs.length;_i31++){if(specs[_i31].filter===false)filter=false;var seq=!!specs[_i31].sequential;s=mergeTransaction(s,resolveTransactionInner(state,specs[_i31],seq?s.changes.newLength:state.doc.length),seq);}var tr=new Transaction(state,s.changes,s.selection,s.effects,s.annotations,s.scrollIntoView);return extendTransaction(filter?filterTransaction(tr):tr);}function filterTransaction(tr){var state=tr.startState;var result=true;var _iterator20=_createForOfIteratorHelper(state.facet(changeFilter)),_step20;try{for(_iterator20.s();!(_step20=_iterator20.n()).done;){var filter=_step20.value;var value=filter(tr);if(value===false){result=false;break;}if(Array.isArray(value))result=result===true?value:joinRanges(result,value);}}catch(err){_iterator20.e(err);}finally{_iterator20.f();}if(result!==true){var changes,back;if(result===false){back=tr.changes.invertedDesc;changes=ChangeSet.empty(state.doc.length);}else{var filtered=tr.changes.filter(result);changes=filtered.changes;back=filtered.filtered.invertedDesc;}tr=new Transaction(state,changes,tr.selection&&tr.selection.map(back),StateEffect.mapEffects(tr.effects,back),tr.annotations,tr.scrollIntoView);}var filters=state.facet(transactionFilter);for(var _i32=filters.length-1;_i32>=0;_i32--){var _filtered=filters[_i32](tr);if(_filtered instanceof Transaction)tr=_filtered;else if(Array.isArray(_filtered)&&_filtered.length==1&&_filtered[0]instanceof Transaction)tr=_filtered[0];else tr=resolveTransaction(state,asArray(_filtered),false);}return tr;}function extendTransaction(tr){var state=tr.startState,extenders=state.facet(transactionExtender),spec=tr;for(var _i33=extenders.length-1;_i33>=0;_i33--){var extension=extenders[_i33](tr);if(extension&&Object.keys(extension).length)spec=mergeTransaction(tr,resolveTransactionInner(state,extension,tr.changes.newLength),true);}return spec==tr?tr:new Transaction(state,tr.changes,tr.selection,spec.effects,spec.annotations,spec.scrollIntoView);}var none=[];function asArray(value){return value==null?none:Array.isArray(value)?value:[value];}var CharCategory=/* @__PURE__ */function(CharCategory2){CharCategory2[CharCategory2["Word"]=0]="Word";CharCategory2[CharCategory2["Space"]=1]="Space";CharCategory2[CharCategory2["Other"]=2]="Other";return CharCategory2;}(CharCategory||(CharCategory={}));var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;var wordChar;try{wordChar=/* @__PURE__ */new RegExp("[\\p{Alphabetic}\\p{Number}_]","u");}catch(_){}function hasWordChar(str){if(wordChar)return wordChar.test(str);for(var _i34=0;_i34<str.length;_i34++){var ch=str[_i34];if(/\w/.test(ch)||ch>"\x80"&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch)))return true;}return false;}function makeCategorizer(wordChars){return function(_char){if(!/\S/.test(_char))return CharCategory.Space;if(hasWordChar(_char))return CharCategory.Word;for(var _i35=0;_i35<wordChars.length;_i35++){if(_char.indexOf(wordChars[_i35])>-1)return CharCategory.Word;}return CharCategory.Other;};}var EditorState=/*#__PURE__*/function(){function EditorState(config2,doc6,selection2,values){var tr=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;_classCallCheck(this,EditorState);this.config=config2;this.doc=doc6;this.selection=selection2;this.values=values;this.applying=null;this.status=config2.statusTemplate.slice();this.applying=tr;if(tr)tr._state=this;for(var _i36=0;_i36<this.config.dynamicSlots.length;_i36++){ensureAddr(this,_i36<<1);}this.applying=null;}_createClass(EditorState,[{key:"field",value:function field(_field){var require2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var addr=this.config.address[_field.id];if(addr==null){if(require2)throw new RangeError("Field is not present in this state");return void 0;}ensureAddr(this,addr);return getAddr(this,addr);}},{key:"update",value:function update(){for(var _len2=arguments.length,specs=new Array(_len2),_key=0;_key<_len2;_key++){specs[_key]=arguments[_key];}return resolveTransaction(this,specs,true);}},{key:"applyTransaction",value:function applyTransaction(tr){var conf=this.config,_conf=conf,base2=_conf.base,compartments=_conf.compartments;var _iterator21=_createForOfIteratorHelper(tr.effects),_step21;try{for(_iterator21.s();!(_step21=_iterator21.n()).done;){var effect=_step21.value;if(effect.is(Compartment.reconfigure)){if(conf){compartments=/* @__PURE__ */new Map();conf.compartments.forEach(function(val,key){return compartments.set(key,val);});conf=null;}compartments.set(effect.value.compartment,effect.value.extension);}else if(effect.is(StateEffect.reconfigure)){conf=null;base2=effect.value;}else if(effect.is(StateEffect.appendConfig)){conf=null;base2=asArray(base2).concat(effect.value);}}}catch(err){_iterator21.e(err);}finally{_iterator21.f();}var startValues;if(!conf){conf=Configuration.resolve(base2,compartments,this);var updatedValues=conf.dynamicSlots.map(function(_){return Uninitialized;});for(var id in conf.address){var cur2=conf.address[id],prev=this.config.address[id];if(prev!=null&&(cur2&1)==0)updatedValues[cur2>>1]=getAddr(this,prev);}var intermediateState=new EditorState(conf,this.doc,this.selection,updatedValues,null);startValues=intermediateState.values;}else{startValues=tr.startState.values.slice();}new EditorState(conf,tr.newDoc,tr.newSelection,startValues,tr);}},{key:"replaceSelection",value:function replaceSelection(text){if(typeof text=="string")text=this.toText(text);return this.changeByRange(function(range){return{changes:{from:range.from,to:range.to,insert:text},range:EditorSelection.cursor(range.from+text.length)};});}},{key:"changeByRange",value:function changeByRange(f){var sel=this.selection;var result1=f(sel.ranges[0]);var changes=this.changes(result1.changes),ranges=[result1.range];var effects=asArray(result1.effects);for(var _i37=1;_i37<sel.ranges.length;_i37++){var result=f(sel.ranges[_i37]);var newChanges=this.changes(result.changes),newMapped=newChanges.map(changes);for(var j=0;j<_i37;j++){ranges[j]=ranges[j].map(newMapped);}var mapBy=changes.mapDesc(newChanges,true);ranges.push(result.range.map(mapBy));changes=changes.compose(newMapped);effects=StateEffect.mapEffects(effects,newMapped).concat(StateEffect.mapEffects(asArray(result.effects),mapBy));}return{changes:changes,selection:EditorSelection.create(ranges,sel.mainIndex),effects:effects};}},{key:"changes",value:function changes(){var spec=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];if(spec instanceof ChangeSet)return spec;return ChangeSet.of(spec,this.doc.length,this.facet(EditorState.lineSeparator));}},{key:"toText",value:function toText(string2){return Text.of(string2.split(this.facet(EditorState.lineSeparator)||DefaultSplit));}},{key:"sliceDoc",value:function sliceDoc(){var from=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:this.doc.length;return this.doc.sliceString(from,to,this.lineBreak);}},{key:"facet",value:function facet(_facet){var addr=this.config.address[_facet.id];if(addr==null)return _facet["default"];ensureAddr(this,addr);return getAddr(this,addr);}},{key:"toJSON",value:function toJSON(fields){var result={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(fields)for(var prop in fields){var value=fields[prop];if(value instanceof StateField)result[prop]=value.spec.toJSON(this.field(fields[prop]),this);}return result;}},{key:"tabSize",get:function get(){return this.facet(EditorState.tabSize);}},{key:"lineBreak",get:function get(){return this.facet(EditorState.lineSeparator)||"\n";}},{key:"readOnly",get:function get(){return this.facet(readOnly);}},{key:"phrase",value:function phrase(phrase2){var _iterator22=_createForOfIteratorHelper(this.facet(EditorState.phrases)),_step22;try{for(_iterator22.s();!(_step22=_iterator22.n()).done;){var map=_step22.value;if(Object.prototype.hasOwnProperty.call(map,phrase2))return map[phrase2];}}catch(err){_iterator22.e(err);}finally{_iterator22.f();}return phrase2;}},{key:"languageDataAt",value:function languageDataAt(name2,pos){var side=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;var values=[];var _iterator23=_createForOfIteratorHelper(this.facet(languageData)),_step23;try{for(_iterator23.s();!(_step23=_iterator23.n()).done;){var provider=_step23.value;var _iterator24=_createForOfIteratorHelper(provider(this,pos,side)),_step24;try{for(_iterator24.s();!(_step24=_iterator24.n()).done;){var result=_step24.value;if(Object.prototype.hasOwnProperty.call(result,name2))values.push(result[name2]);}}catch(err){_iterator24.e(err);}finally{_iterator24.f();}}}catch(err){_iterator23.e(err);}finally{_iterator23.f();}return values;}},{key:"charCategorizer",value:function charCategorizer(at){return makeCategorizer(this.languageDataAt("wordChars",at).join(""));}},{key:"wordAt",value:function wordAt(pos){var _this$doc$lineAt=this.doc.lineAt(pos),text=_this$doc$lineAt.text,from=_this$doc$lineAt.from,length=_this$doc$lineAt.length;var cat=this.charCategorizer(pos);var start=pos-from,end=pos-from;while(start>0){var prev=findClusterBreak(text,start,false);if(cat(text.slice(prev,start))!=CharCategory.Word)break;start=prev;}while(end<length){var next=findClusterBreak(text,end);if(cat(text.slice(end,next))!=CharCategory.Word)break;end=next;}return start==end?null:EditorSelection.range(start+from,end+from);}}],[{key:"fromJSON",value:function fromJSON(json){var config2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var fields=arguments.length>2?arguments[2]:undefined;if(!json||typeof json.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");var fieldInit=[];if(fields){var _loop4=function _loop4(prop){var field=fields[prop],value=json[prop];fieldInit.push(field.init(function(state){return field.spec.fromJSON(value,state);}));};for(var prop in fields){_loop4(prop);}}return EditorState.create({doc:json.doc,selection:EditorSelection.fromJSON(json.selection),extensions:config2.extensions?fieldInit.concat([config2.extensions]):fieldInit});}},{key:"create",value:function create(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var configuration=Configuration.resolve(config2.extensions||[],/* @__PURE__ */new Map());var doc6=config2.doc instanceof Text?config2.doc:Text.of((config2.doc||"").split(configuration.staticFacet(EditorState.lineSeparator)||DefaultSplit));var selection2=!config2.selection?EditorSelection.single(0):config2.selection instanceof EditorSelection?config2.selection:EditorSelection.single(config2.selection.anchor,config2.selection.head);checkSelection(selection2,doc6.length);if(!configuration.staticFacet(allowMultipleSelections))selection2=selection2.asSingle();return new EditorState(configuration,doc6,selection2,configuration.dynamicSlots.map(function(_){return Uninitialized;}));}}]);return EditorState;}();EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=/* @__PURE__ */Facet.define({combine:function combine(values){return values.length?values[0]:4;}});EditorState.lineSeparator=lineSeparator;EditorState.readOnly=readOnly;EditorState.phrases=/* @__PURE__ */Facet.define();EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=/* @__PURE__ */StateEffect.define();function combineConfig(configs,defaults3){var combine=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var result={};var _iterator25=_createForOfIteratorHelper(configs),_step25;try{for(_iterator25.s();!(_step25=_iterator25.n()).done;){var config2=_step25.value;for(var _i38=0,_Object$keys=Object.keys(config2);_i38<_Object$keys.length;_i38++){var _key2=_Object$keys[_i38];var value=config2[_key2],current=result[_key2];if(current===void 0)result[_key2]=value;else if(current===value||value===void 0);else if(Object.hasOwnProperty.call(combine,_key2))result[_key2]=combine[_key2](current,value);else throw new Error("Config merge conflict for field "+_key2);}}}catch(err){_iterator25.e(err);}finally{_iterator25.f();}for(var key in defaults3){if(result[key]===void 0)result[key]=defaults3[key];}return result;}// ../node_modules/style-mod/src/style-mod.js
var C="\u037C";var COUNT=typeof Symbol=="undefined"?"__"+C:Symbol["for"](C);var SET=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet");var top=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};var StyleModule=/*#__PURE__*/function(){function StyleModule(spec,options){_classCallCheck(this,StyleModule);this.rules=[];var _ref3=options||{},finish=_ref3.finish;function splitSelector(selector){return /^@/.test(selector)?[selector]:selector.split(/,\s*/);}function render(selectors,spec2,target,isKeyframes){var local=[],isAt=/^@(\w+)\b/.exec(selectors[0]),keyframes=isAt&&isAt[1]=="keyframes";if(isAt&&spec2==null)return target.push(selectors[0]+";");for(var prop in spec2){var value=spec2[prop];if(/&/.test(prop)){render(prop.split(/,\s*/).map(function(part){return selectors.map(function(sel){return part.replace(/&/,sel);});}).reduce(function(a,b){return a.concat(b);}),value,target);}else if(value&&_typeof(value)=="object"){if(!isAt)throw new RangeError("The value of a property ("+prop+") should be a primitive value.");render(splitSelector(prop),value,local,keyframes);}else if(value!=null){local.push(prop.replace(/_.*/,"").replace(/[A-Z]/g,function(l){return"-"+l.toLowerCase();})+": "+value+";");}}if(local.length||keyframes){target.push((finish&&!isAt&&!isKeyframes?selectors.map(finish):selectors).join(", ")+" {"+local.join(" ")+"}");}}for(var prop in spec){render(splitSelector(prop),spec[prop],this.rules);}}_createClass(StyleModule,[{key:"getRules",value:function getRules(){return this.rules.join("\n");}}],[{key:"newName",value:function newName(){var id=top[COUNT]||1;top[COUNT]=id+1;return C+id.toString(36);}},{key:"mount",value:function mount(root,modules){(root[SET]||new StyleSet(root)).mount(Array.isArray(modules)?modules:[modules]);}}]);return StyleModule;}();var adoptedSet=null;var StyleSet=/*#__PURE__*/function(){function StyleSet(root){_classCallCheck(this,StyleSet);if(!root.head&&root.adoptedStyleSheets&&typeof CSSStyleSheet!="undefined"){if(adoptedSet){root.adoptedStyleSheets=[adoptedSet.sheet].concat(root.adoptedStyleSheets);return root[SET]=adoptedSet;}this.sheet=new CSSStyleSheet();root.adoptedStyleSheets=[this.sheet].concat(root.adoptedStyleSheets);adoptedSet=this;}else{this.styleTag=(root.ownerDocument||root).createElement("style");var target=root.head||root;target.insertBefore(this.styleTag,target.firstChild);}this.modules=[];root[SET]=this;}_createClass(StyleSet,[{key:"mount",value:function mount(modules){var sheet=this.sheet;var pos=0,j=0;for(var _i39=0;_i39<modules.length;_i39++){var mod=modules[_i39],index=this.modules.indexOf(mod);if(index<j&&index>-1){this.modules.splice(index,1);j--;index=-1;}if(index==-1){this.modules.splice(j++,0,mod);if(sheet)for(var k=0;k<mod.rules.length;k++){sheet.insertRule(mod.rules[k],pos++);}}else{while(j<index){pos+=this.modules[j++].rules.length;}pos+=mod.rules.length;j++;}}if(!sheet){var _text2="";for(var _i40=0;_i40<this.modules.length;_i40++){_text2+=this.modules[_i40].getRules()+"\n";}this.styleTag.textContent=_text2;}}}]);return StyleSet;}();// ../node_modules/@codemirror/rangeset/dist/index.js
var RangeValue=/*#__PURE__*/function(){function RangeValue(){_classCallCheck(this,RangeValue);}_createClass(RangeValue,[{key:"eq",value:function eq(other){return this==other;}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;return new Range(from,to,this);}}]);return RangeValue;}();RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=false;RangeValue.prototype.mapMode=MapMode.TrackDel;var Range=/*#__PURE__*/_createClass(function Range(from,to,value){_classCallCheck(this,Range);this.from=from;this.to=to;this.value=value;});function cmpRange(a,b){return a.from-b.from||a.value.startSide-b.value.startSide;}var Chunk=/*#__PURE__*/function(){function Chunk(from,to,value,maxPoint){_classCallCheck(this,Chunk);this.from=from;this.to=to;this.value=value;this.maxPoint=maxPoint;}_createClass(Chunk,[{key:"length",get:function get(){return this.to[this.to.length-1];}},{key:"findIndex",value:function findIndex(pos,side,end){var startAt=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var arr=end?this.to:this.from;for(var lo=startAt,hi=arr.length;;){if(lo==hi)return lo;var mid=lo+hi>>1;var diff=arr[mid]-pos||(end?this.value[mid].endSide:this.value[mid].startSide)-side;if(mid==lo)return diff>=0?lo:hi;if(diff>=0)hi=mid;else lo=mid+1;}}},{key:"between",value:function between(offset,from,to,f){for(var _i41=this.findIndex(from,-1e9,true),e=this.findIndex(to,1e9,false,_i41);_i41<e;_i41++){if(f(this.from[_i41]+offset,this.to[_i41]+offset,this.value[_i41])===false)return false;}}},{key:"map",value:function map(offset,changes){var value=[],from=[],to=[],newPos=-1,maxPoint=-1;for(var _i42=0;_i42<this.value.length;_i42++){var val=this.value[_i42],curFrom=this.from[_i42]+offset,curTo=this.to[_i42]+offset,newFrom=void 0,newTo=void 0;if(curFrom==curTo){var mapped=changes.mapPos(curFrom,val.startSide,val.mapMode);if(mapped==null)continue;newFrom=newTo=mapped;if(val.startSide!=val.endSide){newTo=changes.mapPos(curFrom,val.endSide);if(newTo<newFrom)continue;}}else{newFrom=changes.mapPos(curFrom,val.startSide);newTo=changes.mapPos(curTo,val.endSide);if(newFrom>newTo||newFrom==newTo&&val.startSide>0&&val.endSide<=0)continue;}if((newTo-newFrom||val.endSide-val.startSide)<0)continue;if(newPos<0)newPos=newFrom;if(val.point)maxPoint=Math.max(maxPoint,newTo-newFrom);value.push(val);from.push(newFrom-newPos);to.push(newTo-newPos);}return{mapped:value.length?new Chunk(from,to,value,maxPoint):null,pos:newPos};}}]);return Chunk;}();var RangeSet=/*#__PURE__*/function(){function RangeSet(chunkPos,chunk){var nextLayer=arguments.length>2&&arguments[2]!==undefined?arguments[2]:RangeSet.empty;var maxPoint=arguments.length>3?arguments[3]:undefined;_classCallCheck(this,RangeSet);this.chunkPos=chunkPos;this.chunk=chunk;this.nextLayer=nextLayer;this.maxPoint=maxPoint;}_createClass(RangeSet,[{key:"length",get:function get(){var last=this.chunk.length-1;return last<0?0:Math.max(this.chunkEnd(last),this.nextLayer.length);}},{key:"size",get:function get(){if(this.isEmpty)return 0;var size=this.nextLayer.size;var _iterator26=_createForOfIteratorHelper(this.chunk),_step26;try{for(_iterator26.s();!(_step26=_iterator26.n()).done;){var chunk=_step26.value;size+=chunk.value.length;}}catch(err){_iterator26.e(err);}finally{_iterator26.f();}return size;}},{key:"chunkEnd",value:function chunkEnd(index){return this.chunkPos[index]+this.chunk[index].length;}},{key:"update",value:function update(updateSpec){var _updateSpec$add=updateSpec.add,add2=_updateSpec$add===void 0?[]:_updateSpec$add,_updateSpec$sort=updateSpec.sort,sort=_updateSpec$sort===void 0?false:_updateSpec$sort,_updateSpec$filterFro=updateSpec.filterFrom,filterFrom=_updateSpec$filterFro===void 0?0:_updateSpec$filterFro,_updateSpec$filterTo=updateSpec.filterTo,filterTo=_updateSpec$filterTo===void 0?this.length:_updateSpec$filterTo;var filter=updateSpec.filter;if(add2.length==0&&!filter)return this;if(sort)add2.slice().sort(cmpRange);if(this.isEmpty)return add2.length?RangeSet.of(add2):this;var cur2=new LayerCursor(this,null,-1)["goto"](0),i=0,spill=[];var builder=new RangeSetBuilder();while(cur2.value||i<add2.length){if(i<add2.length&&(cur2.from-add2[i].from||cur2.startSide-add2[i].value.startSide)>=0){var range=add2[i++];if(!builder.addInner(range.from,range.to,range.value))spill.push(range);}else if(cur2.rangeIndex==1&&cur2.chunkIndex<this.chunk.length&&(i==add2.length||this.chunkEnd(cur2.chunkIndex)<add2[i].from)&&(!filter||filterFrom>this.chunkEnd(cur2.chunkIndex)||filterTo<this.chunkPos[cur2.chunkIndex])&&builder.addChunk(this.chunkPos[cur2.chunkIndex],this.chunk[cur2.chunkIndex])){cur2.nextChunk();}else{if(!filter||filterFrom>cur2.to||filterTo<cur2.from||filter(cur2.from,cur2.to,cur2.value)){if(!builder.addInner(cur2.from,cur2.to,cur2.value))spill.push(new Range(cur2.from,cur2.to,cur2.value));}cur2.next();}}return builder.finishInner(this.nextLayer.isEmpty&&!spill.length?RangeSet.empty:this.nextLayer.update({add:spill,filter:filter,filterFrom:filterFrom,filterTo:filterTo}));}},{key:"map",value:function map(changes){if(changes.length==0||this.isEmpty)return this;var chunks=[],chunkPos=[],maxPoint=-1;for(var _i43=0;_i43<this.chunk.length;_i43++){var start=this.chunkPos[_i43],chunk=this.chunk[_i43];var touch=changes.touchesRange(start,start+chunk.length);if(touch===false){maxPoint=Math.max(maxPoint,chunk.maxPoint);chunks.push(chunk);chunkPos.push(changes.mapPos(start));}else if(touch===true){var _chunk$map=chunk.map(start,changes),mapped=_chunk$map.mapped,pos=_chunk$map.pos;if(mapped){maxPoint=Math.max(maxPoint,mapped.maxPoint);chunks.push(mapped);chunkPos.push(pos);}}}var next=this.nextLayer.map(changes);return chunks.length==0?next:new RangeSet(chunkPos,chunks,next,maxPoint);}},{key:"between",value:function between(from,to,f){if(this.isEmpty)return;for(var _i44=0;_i44<this.chunk.length;_i44++){var start=this.chunkPos[_i44],chunk=this.chunk[_i44];if(to>=start&&from<=start+chunk.length&&chunk.between(start,from-start,to-start,f)===false)return;}this.nextLayer.between(from,to,f);}},{key:"iter",value:function iter(){var from=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;return HeapCursor.from([this])["goto"](from);}},{key:"isEmpty",get:function get(){return this.nextLayer==this;}}],[{key:"iter",value:function iter(sets){var from=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return HeapCursor.from(sets)["goto"](from);}},{key:"compare",value:function compare(oldSets,newSets,textDiff,comparator){var minPointSize=arguments.length>4&&arguments[4]!==undefined?arguments[4]:-1;var a=oldSets.filter(function(set){return set.maxPoint>0||!set.isEmpty&&set.maxPoint>=minPointSize;});var b=newSets.filter(function(set){return set.maxPoint>0||!set.isEmpty&&set.maxPoint>=minPointSize;});var sharedChunks=findSharedChunks(a,b,textDiff);var sideA=new SpanCursor(a,sharedChunks,minPointSize);var sideB=new SpanCursor(b,sharedChunks,minPointSize);textDiff.iterGaps(function(fromA,fromB,length){return _compare(sideA,fromA,sideB,fromB,length,comparator);});if(textDiff.empty&&textDiff.length==0)_compare(sideA,0,sideB,0,0,comparator);}},{key:"eq",value:function eq(oldSets,newSets){var from=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var to=arguments.length>3?arguments[3]:undefined;if(to==null)to=1e9;var a=oldSets.filter(function(set){return!set.isEmpty&&newSets.indexOf(set)<0;});var b=newSets.filter(function(set){return!set.isEmpty&&oldSets.indexOf(set)<0;});if(a.length!=b.length)return false;if(!a.length)return true;var sharedChunks=findSharedChunks(a,b);var sideA=new SpanCursor(a,sharedChunks,0)["goto"](from),sideB=new SpanCursor(b,sharedChunks,0)["goto"](from);for(;;){if(sideA.to!=sideB.to||!sameValues(sideA.active,sideB.active)||sideA.point&&(!sideB.point||!sideA.point.eq(sideB.point)))return false;if(sideA.to>to)return true;sideA.next();sideB.next();}}},{key:"spans",value:function spans(sets,from,to,iterator){var minPointSize=arguments.length>4&&arguments[4]!==undefined?arguments[4]:-1;var _a;var cursor2=new SpanCursor(sets,null,minPointSize,(_a=iterator.filterPoint)===null||_a===void 0?void 0:_a.bind(iterator))["goto"](from),pos=from;var open=cursor2.openStart;for(;;){var curTo=Math.min(cursor2.to,to);if(cursor2.point){iterator.point(pos,curTo,cursor2.point,cursor2.activeForPoint(cursor2.to),open);open=cursor2.openEnd(curTo)+(cursor2.to>curTo?1:0);}else if(curTo>pos){iterator.span(pos,curTo,cursor2.active,open);open=cursor2.openEnd(curTo);}if(cursor2.to>to)break;pos=cursor2.to;cursor2.next();}return open;}},{key:"of",value:function of(ranges){var sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var build=new RangeSetBuilder();var _iterator27=_createForOfIteratorHelper(ranges instanceof Range?[ranges]:sort?lazySort(ranges):ranges),_step27;try{for(_iterator27.s();!(_step27=_iterator27.n()).done;){var range=_step27.value;build.add(range.from,range.to,range.value);}}catch(err){_iterator27.e(err);}finally{_iterator27.f();}return build.finish();}}]);return RangeSet;}();RangeSet.empty=/* @__PURE__ */new RangeSet([],[],null,-1);function lazySort(ranges){if(ranges.length>1)for(var prev=ranges[0],_i45=1;_i45<ranges.length;_i45++){var cur2=ranges[_i45];if(cmpRange(prev,cur2)>0)return ranges.slice().sort(cmpRange);prev=cur2;}return ranges;}RangeSet.empty.nextLayer=RangeSet.empty;var RangeSetBuilder=/*#__PURE__*/function(){function RangeSetBuilder(){_classCallCheck(this,RangeSetBuilder);this.chunks=[];this.chunkPos=[];this.chunkStart=-1;this.last=null;this.lastFrom=-1e9;this.lastTo=-1e9;this.from=[];this.to=[];this.value=[];this.maxPoint=-1;this.setMaxPoint=-1;this.nextLayer=null;}_createClass(RangeSetBuilder,[{key:"finishChunk",value:function finishChunk(newArrays){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint));this.chunkPos.push(this.chunkStart);this.chunkStart=-1;this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint);this.maxPoint=-1;if(newArrays){this.from=[];this.to=[];this.value=[];}}},{key:"add",value:function add(from,to,value){if(!this.addInner(from,to,value))(this.nextLayer||(this.nextLayer=new RangeSetBuilder())).add(from,to,value);}},{key:"addInner",value:function addInner(from,to,value){var diff=from-this.lastTo||value.startSide-this.last.endSide;if(diff<=0&&(from-this.lastFrom||value.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");if(diff<0)return false;if(this.from.length==250)this.finishChunk(true);if(this.chunkStart<0)this.chunkStart=from;this.from.push(from-this.chunkStart);this.to.push(to-this.chunkStart);this.last=value;this.lastFrom=from;this.lastTo=to;this.value.push(value);if(value.point)this.maxPoint=Math.max(this.maxPoint,to-from);return true;}},{key:"addChunk",value:function addChunk(from,chunk){if((from-this.lastTo||chunk.value[0].startSide-this.last.endSide)<0)return false;if(this.from.length)this.finishChunk(true);this.setMaxPoint=Math.max(this.setMaxPoint,chunk.maxPoint);this.chunks.push(chunk);this.chunkPos.push(from);var last=chunk.value.length-1;this.last=chunk.value[last];this.lastFrom=chunk.from[last]+from;this.lastTo=chunk.to[last]+from;return true;}},{key:"finish",value:function finish(){return this.finishInner(RangeSet.empty);}},{key:"finishInner",value:function finishInner(next){if(this.from.length)this.finishChunk(false);if(this.chunks.length==0)return next;var result=new RangeSet(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(next):next,this.setMaxPoint);this.from=null;return result;}}]);return RangeSetBuilder;}();function findSharedChunks(a,b,textDiff){var inA=/* @__PURE__ */new Map();var _iterator28=_createForOfIteratorHelper(a),_step28;try{for(_iterator28.s();!(_step28=_iterator28.n()).done;){var set=_step28.value;for(var _i46=0;_i46<set.chunk.length;_i46++){if(set.chunk[_i46].maxPoint<=0)inA.set(set.chunk[_i46],set.chunkPos[_i46]);}}}catch(err){_iterator28.e(err);}finally{_iterator28.f();}var shared=/* @__PURE__ */new Set();var _iterator29=_createForOfIteratorHelper(b),_step29;try{for(_iterator29.s();!(_step29=_iterator29.n()).done;){var _set=_step29.value;for(var _i47=0;_i47<_set.chunk.length;_i47++){var known=inA.get(_set.chunk[_i47]);if(known!=null&&(textDiff?textDiff.mapPos(known):known)==_set.chunkPos[_i47]&&!(textDiff===null||textDiff===void 0?void 0:textDiff.touchesRange(known,known+_set.chunk[_i47].length)))shared.add(_set.chunk[_i47]);}}}catch(err){_iterator29.e(err);}finally{_iterator29.f();}return shared;}var LayerCursor=/*#__PURE__*/function(){function LayerCursor(layer,skip,minPoint){var rank=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,LayerCursor);this.layer=layer;this.skip=skip;this.minPoint=minPoint;this.rank=rank;}_createClass(LayerCursor,[{key:"startSide",get:function get(){return this.value?this.value.startSide:0;}},{key:"endSide",get:function get(){return this.value?this.value.endSide:0;}},{key:"goto",value:function goto(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1e9;this.chunkIndex=this.rangeIndex=0;this.gotoInner(pos,side,false);return this;}},{key:"gotoInner",value:function gotoInner(pos,side,forward){while(this.chunkIndex<this.layer.chunk.length){var next=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(next)||this.layer.chunkEnd(this.chunkIndex)<pos||next.maxPoint<this.minPoint))break;this.chunkIndex++;forward=false;}if(this.chunkIndex<this.layer.chunk.length){var rangeIndex=this.layer.chunk[this.chunkIndex].findIndex(pos-this.layer.chunkPos[this.chunkIndex],side,true);if(!forward||this.rangeIndex<rangeIndex)this.setRangeIndex(rangeIndex);}this.next();}},{key:"forward",value:function forward(pos,side){if((this.to-pos||this.endSide-side)<0)this.gotoInner(pos,side,true);}},{key:"next",value:function next(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9;this.value=null;break;}else{var chunkPos=this.layer.chunkPos[this.chunkIndex],chunk=this.layer.chunk[this.chunkIndex];var from=chunkPos+chunk.from[this.rangeIndex];this.from=from;this.to=chunkPos+chunk.to[this.rangeIndex];this.value=chunk.value[this.rangeIndex];this.setRangeIndex(this.rangeIndex+1);if(this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break;}}}},{key:"setRangeIndex",value:function setRangeIndex(index){if(index==this.layer.chunk[this.chunkIndex].value.length){this.chunkIndex++;if(this.skip){while(this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex])){this.chunkIndex++;}}this.rangeIndex=0;}else{this.rangeIndex=index;}}},{key:"nextChunk",value:function nextChunk(){this.chunkIndex++;this.rangeIndex=0;this.next();}},{key:"compare",value:function compare(other){return this.from-other.from||this.startSide-other.startSide||this.to-other.to||this.endSide-other.endSide;}}]);return LayerCursor;}();var HeapCursor=/*#__PURE__*/function(){function HeapCursor(heap){_classCallCheck(this,HeapCursor);this.heap=heap;}_createClass(HeapCursor,[{key:"startSide",get:function get(){return this.value?this.value.startSide:0;}},{key:"goto",value:function goto(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1e9;var _iterator30=_createForOfIteratorHelper(this.heap),_step30;try{for(_iterator30.s();!(_step30=_iterator30.n()).done;){var cur2=_step30.value;cur2["goto"](pos,side);}}catch(err){_iterator30.e(err);}finally{_iterator30.f();}for(var _i48=this.heap.length>>1;_i48>=0;_i48--){heapBubble(this.heap,_i48);}this.next();return this;}},{key:"forward",value:function forward(pos,side){var _iterator31=_createForOfIteratorHelper(this.heap),_step31;try{for(_iterator31.s();!(_step31=_iterator31.n()).done;){var cur2=_step31.value;cur2.forward(pos,side);}}catch(err){_iterator31.e(err);}finally{_iterator31.f();}for(var _i49=this.heap.length>>1;_i49>=0;_i49--){heapBubble(this.heap,_i49);}if((this.to-pos||this.value.endSide-side)<0)this.next();}},{key:"next",value:function next(){if(this.heap.length==0){this.from=this.to=1e9;this.value=null;this.rank=-1;}else{var top2=this.heap[0];this.from=top2.from;this.to=top2.to;this.value=top2.value;this.rank=top2.rank;if(top2.value)top2.next();heapBubble(this.heap,0);}}}],[{key:"from",value:function from(sets){var skip=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var minPoint=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;var heap=[];for(var _i50=0;_i50<sets.length;_i50++){for(var cur2=sets[_i50];!cur2.isEmpty;cur2=cur2.nextLayer){if(cur2.maxPoint>=minPoint)heap.push(new LayerCursor(cur2,skip,minPoint,_i50));}}return heap.length==1?heap[0]:new HeapCursor(heap);}}]);return HeapCursor;}();function heapBubble(heap,index){for(var cur2=heap[index];;){var childIndex=(index<<1)+1;if(childIndex>=heap.length)break;var child=heap[childIndex];if(childIndex+1<heap.length&&child.compare(heap[childIndex+1])>=0){child=heap[childIndex+1];childIndex++;}if(cur2.compare(child)<0)break;heap[childIndex]=cur2;heap[index]=child;index=childIndex;}}var SpanCursor=/*#__PURE__*/function(){function SpanCursor(sets,skip,minPoint){var filterPoint=arguments.length>3&&arguments[3]!==undefined?arguments[3]:function(){return true;};_classCallCheck(this,SpanCursor);this.minPoint=minPoint;this.filterPoint=filterPoint;this.active=[];this.activeTo=[];this.activeRank=[];this.minActive=-1;this.point=null;this.pointFrom=0;this.pointRank=0;this.to=-1e9;this.endSide=0;this.openStart=-1;this.cursor=HeapCursor.from(sets,skip,minPoint);}_createClass(SpanCursor,[{key:"goto",value:function goto(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:-1e9;this.cursor["goto"](pos,side);this.active.length=this.activeTo.length=this.activeRank.length=0;this.minActive=-1;this.to=pos;this.endSide=side;this.openStart=-1;this.next();return this;}},{key:"forward",value:function forward(pos,side){while(this.minActive>-1&&(this.activeTo[this.minActive]-pos||this.active[this.minActive].endSide-side)<0){this.removeActive(this.minActive);}this.cursor.forward(pos,side);}},{key:"removeActive",value:function removeActive(index){remove(this.active,index);remove(this.activeTo,index);remove(this.activeRank,index);this.minActive=findMinIndex(this.active,this.activeTo);}},{key:"addActive",value:function addActive(trackOpen){var i=0,_this$cursor=this.cursor,value=_this$cursor.value,to=_this$cursor.to,rank=_this$cursor.rank;while(i<this.activeRank.length&&this.activeRank[i]<=rank){i++;}insert(this.active,i,value);insert(this.activeTo,i,to);insert(this.activeRank,i,rank);if(trackOpen)insert(trackOpen,i,this.cursor.from);this.minActive=findMinIndex(this.active,this.activeTo);}},{key:"next",value:function next(){var from=this.to,wasPoint=this.point;this.point=null;var trackOpen=this.openStart<0?[]:null,trackExtra=0;for(;;){var a=this.minActive;if(a>-1&&(this.activeTo[a]-this.cursor.from||this.active[a].endSide-this.cursor.startSide)<0){if(this.activeTo[a]>from){this.to=this.activeTo[a];this.endSide=this.active[a].endSide;break;}this.removeActive(a);if(trackOpen)remove(trackOpen,a);}else if(!this.cursor.value){this.to=this.endSide=1e9;break;}else if(this.cursor.from>from){this.to=this.cursor.from;this.endSide=this.cursor.startSide;break;}else{var nextVal=this.cursor.value;if(!nextVal.point){this.addActive(trackOpen);this.cursor.next();}else if(wasPoint&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to){this.cursor.next();}else if(!this.filterPoint(this.cursor.from,this.cursor.to,this.cursor.value,this.cursor.rank)){this.cursor.next();}else{this.point=nextVal;this.pointFrom=this.cursor.from;this.pointRank=this.cursor.rank;this.to=this.cursor.to;this.endSide=nextVal.endSide;if(this.cursor.from<from)trackExtra=1;this.cursor.next();if(this.to>from)this.forward(this.to,this.endSide);break;}}}if(trackOpen){var openStart=0;while(openStart<trackOpen.length&&trackOpen[openStart]<from){openStart++;}this.openStart=openStart+trackExtra;}}},{key:"activeForPoint",value:function activeForPoint(to){if(!this.active.length)return this.active;var active=[];for(var _i51=this.active.length-1;_i51>=0;_i51--){if(this.activeRank[_i51]<this.pointRank)break;if(this.activeTo[_i51]>to||this.activeTo[_i51]==to&&this.active[_i51].endSide>=this.point.endSide)active.push(this.active[_i51]);}return active.reverse();}},{key:"openEnd",value:function openEnd(to){var open=0;for(var _i52=this.activeTo.length-1;_i52>=0&&this.activeTo[_i52]>to;_i52--){open++;}return open;}}]);return SpanCursor;}();function _compare(a,startA,b,startB,length,comparator){a["goto"](startA);b["goto"](startB);var endB=startB+length;var pos=startB,dPos=startB-startA;for(;;){var diff=a.to+dPos-b.to||a.endSide-b.endSide;var end=diff<0?a.to+dPos:b.to,clipEnd=Math.min(end,endB);if(a.point||b.point){if(!(a.point&&b.point&&(a.point==b.point||a.point.eq(b.point))&&sameValues(a.activeForPoint(a.to+dPos),b.activeForPoint(b.to))))comparator.comparePoint(pos,clipEnd,a.point,b.point);}else{if(clipEnd>pos&&!sameValues(a.active,b.active))comparator.compareRange(pos,clipEnd,a.active,b.active);}if(end>endB)break;pos=end;if(diff<=0)a.next();if(diff>=0)b.next();}}function sameValues(a,b){if(a.length!=b.length)return false;for(var _i53=0;_i53<a.length;_i53++){if(a[_i53]!=b[_i53]&&!a[_i53].eq(b[_i53]))return false;}return true;}function remove(array,index){for(var _i54=index,e=array.length-1;_i54<e;_i54++){array[_i54]=array[_i54+1];}array.pop();}function insert(array,index,value){for(var _i55=array.length-1;_i55>=index;_i55--){array[_i55+1]=array[_i55];}array[index]=value;}function findMinIndex(value,array){var found=-1,foundPos=1e9;for(var _i56=0;_i56<array.length;_i56++){if((array[_i56]-foundPos||value[_i56].endSide-value[found].endSide)<0){found=_i56;foundPos=array[_i56];}}return found;}// ../node_modules/w3c-keyname/index.es.js
var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"};var shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"};var chrome=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent);var safari=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor);var gecko=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent);var mac=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);var ie=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);var brokenModifierNames=chrome&&(mac||+chrome[1]<57)||gecko&&mac;for(i=0;i<10;i++){base[48+i]=base[96+i]=String(i);}var i;for(i=1;i<=24;i++){base[i+111]="F"+i;}var i;for(i=65;i<=90;i++){base[i]=String.fromCharCode(i+32);shift[i]=String.fromCharCode(i);}var i;for(code in base){if(!shift.hasOwnProperty(code))shift[code]=base[code];}var code;function keyName(event){var ignoreKey=brokenModifierNames&&(event.ctrlKey||event.altKey||event.metaKey)||(safari||ie)&&event.shiftKey&&event.key&&event.key.length==1;var name2=!ignoreKey&&event.key||(event.shiftKey?shift:base)[event.keyCode]||event.key||"Unidentified";if(name2=="Esc")name2="Escape";if(name2=="Del")name2="Delete";if(name2=="Left")name2="ArrowLeft";if(name2=="Up")name2="ArrowUp";if(name2=="Right")name2="ArrowRight";if(name2=="Down")name2="ArrowDown";return name2;}// ../node_modules/@codemirror/view/dist/index.js
function getSelection(root){var target;if(root.nodeType==11){target=root.getSelection?root:root.ownerDocument;}else{target=root;}return target.getSelection();}function contains(dom,node){return node?dom.contains(node.nodeType!=1?node.parentNode:node):false;}function deepActiveElement(){var elt=document.activeElement;while(elt&&elt.shadowRoot){elt=elt.shadowRoot.activeElement;}return elt;}function hasSelection(dom,selection2){if(!selection2.anchorNode)return false;try{return contains(dom,selection2.anchorNode);}catch(_){return false;}}function clientRectsFor(dom){if(dom.nodeType==3)return textRange(dom,0,dom.nodeValue.length).getClientRects();else if(dom.nodeType==1)return dom.getClientRects();else return[];}function isEquivalentPosition(node,off,targetNode,targetOff){return targetNode?scanFor(node,off,targetNode,targetOff,-1)||scanFor(node,off,targetNode,targetOff,1):false;}function domIndex(node){for(var index=0;;index++){node=node.previousSibling;if(!node)return index;}}function scanFor(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return true;if(off==(dir<0?0:maxOffset(node))){if(node.nodeName=="DIV")return false;var parent=node.parentNode;if(!parent||parent.nodeType!=1)return false;off=domIndex(node)+(dir<0?0:1);node=parent;}else if(node.nodeType==1){node=node.childNodes[off+(dir<0?-1:0)];if(node.nodeType==1&&node.contentEditable=="false")return false;off=dir<0?maxOffset(node):0;}else{return false;}}}function maxOffset(node){return node.nodeType==3?node.nodeValue.length:node.childNodes.length;}var Rect0={left:0,right:0,top:0,bottom:0};function flattenRect(rect,left){var x=left?rect.left:rect.right;return{left:x,right:x,top:rect.top,bottom:rect.bottom};}function windowRect(win){return{left:0,right:win.innerWidth,top:0,bottom:win.innerHeight};}var ScrollSpace=5;function scrollRectIntoView(dom,rect,side,center){var doc6=dom.ownerDocument,win=doc6.defaultView;for(var cur2=dom;cur2;){if(cur2.nodeType==1){var bounding=void 0,top2=cur2==doc6.body;if(top2){bounding=windowRect(win);}else{if(cur2.scrollHeight<=cur2.clientHeight&&cur2.scrollWidth<=cur2.clientWidth){cur2=cur2.parentNode;continue;}var rect2=cur2.getBoundingClientRect();bounding={left:rect2.left,right:rect2.left+cur2.clientWidth,top:rect2.top,bottom:rect2.top+cur2.clientHeight};}var moveX=0,moveY=0;if(center){var rectHeight=rect.bottom-rect.top,boundingHeight=bounding.bottom-bounding.top;var targetTop=void 0;if(rectHeight<=boundingHeight)targetTop=rect.top+rectHeight/2-boundingHeight/2;else if(side<0)targetTop=rect.top-ScrollSpace;else targetTop=rect.bottom+ScrollSpace-boundingHeight;moveY=targetTop-bounding.top;if(Math.abs(moveY)<=1)moveY=0;}else if(rect.top<bounding.top){moveY=-(bounding.top-rect.top+ScrollSpace);if(side>0&&rect.bottom>bounding.bottom+moveY)moveY=rect.bottom-bounding.bottom+moveY+ScrollSpace;}else if(rect.bottom>bounding.bottom){moveY=rect.bottom-bounding.bottom+ScrollSpace;if(side<0&&rect.top-moveY<bounding.top)moveY=-(bounding.top+moveY-rect.top+ScrollSpace);}if(rect.left<bounding.left){moveX=-(bounding.left-rect.left+ScrollSpace);if(side>0&&rect.right>bounding.right+moveX)moveX=rect.right-bounding.right+moveX+ScrollSpace;}else if(rect.right>bounding.right){moveX=rect.right-bounding.right+ScrollSpace;if(side<0&&rect.left<bounding.left+moveX)moveX=-(bounding.left+moveX-rect.left+ScrollSpace);}if(moveX||moveY){if(top2){win.scrollBy(moveX,moveY);}else{if(moveY){var start=cur2.scrollTop;cur2.scrollTop+=moveY;moveY=cur2.scrollTop-start;}if(moveX){var _start2=cur2.scrollLeft;cur2.scrollLeft+=moveX;moveX=cur2.scrollLeft-_start2;}rect={left:rect.left-moveX,top:rect.top-moveY,right:rect.right-moveX,bottom:rect.bottom-moveY};}}if(top2)break;cur2=cur2.assignedSlot||cur2.parentNode;center=false;}else if(cur2.nodeType==11){cur2=cur2.host;}else{break;}}}var DOMSelection=/*#__PURE__*/function(){function DOMSelection(){_classCallCheck(this,DOMSelection);this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0;}_createClass(DOMSelection,[{key:"eq",value:function eq(domSel){return this.anchorNode==domSel.anchorNode&&this.anchorOffset==domSel.anchorOffset&&this.focusNode==domSel.focusNode&&this.focusOffset==domSel.focusOffset;}},{key:"set",value:function set(domSel){this.anchorNode=domSel.anchorNode;this.anchorOffset=domSel.anchorOffset;this.focusNode=domSel.focusNode;this.focusOffset=domSel.focusOffset;}}]);return DOMSelection;}();var preventScrollSupported=null;function focusPreventScroll(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported)return dom.focus(preventScrollSupported);var stack=[];for(var cur2=dom;cur2;cur2=cur2.parentNode){stack.push(cur2,cur2.scrollTop,cur2.scrollLeft);if(cur2==cur2.ownerDocument)break;}dom.focus(preventScrollSupported==null?Object.defineProperties({},{preventScroll:{get:function get(){preventScrollSupported={preventScroll:true};return true;},configurable:true,enumerable:true}}):void 0);if(!preventScrollSupported){preventScrollSupported=false;for(var _i57=0;_i57<stack.length;){var elt=stack[_i57++],top2=stack[_i57++],left=stack[_i57++];if(elt.scrollTop!=top2)elt.scrollTop=top2;if(elt.scrollLeft!=left)elt.scrollLeft=left;}}}var scratchRange;function textRange(node,from){var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:from;var range=scratchRange||(scratchRange=document.createRange());range.setEnd(node,to);range.setStart(node,from);return range;}function dispatchKey(elt,name2,code){var options={key:name2,code:name2,keyCode:code,which:code,cancelable:true};var down=new KeyboardEvent("keydown",options);down.synthetic=true;elt.dispatchEvent(down);var up=new KeyboardEvent("keyup",options);up.synthetic=true;elt.dispatchEvent(up);return down.defaultPrevented||up.defaultPrevented;}function getRoot(node){while(node){if(node&&(node.nodeType==9||node.nodeType==11&&node.host))return node;node=node.assignedSlot||node.parentNode;}return null;}var DOMPos=/*#__PURE__*/function(){function DOMPos(node,offset){var precise=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_classCallCheck(this,DOMPos);this.node=node;this.offset=offset;this.precise=precise;}_createClass(DOMPos,null,[{key:"before",value:function before(dom,precise){return new DOMPos(dom.parentNode,domIndex(dom),precise);}},{key:"after",value:function after(dom,precise){return new DOMPos(dom.parentNode,domIndex(dom)+1,precise);}}]);return DOMPos;}();var none$3=[];var ContentView=/*#__PURE__*/function(){function ContentView(){_classCallCheck(this,ContentView);this.parent=null;this.dom=null;this.dirty=2;}_createClass(ContentView,[{key:"editorView",get:function get(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"posAtStart",get:function get(){return this.parent?this.parent.posBefore(this):0;}},{key:"posAtEnd",get:function get(){return this.posAtStart+this.length;}},{key:"posBefore",value:function posBefore(view){var pos=this.posAtStart;var _iterator32=_createForOfIteratorHelper(this.children),_step32;try{for(_iterator32.s();!(_step32=_iterator32.n()).done;){var child=_step32.value;if(child==view)return pos;pos+=child.length+child.breakAfter;}}catch(err){_iterator32.e(err);}finally{_iterator32.f();}throw new RangeError("Invalid child in posBefore");}},{key:"posAfter",value:function posAfter(view){return this.posBefore(view)+view.length;}},{key:"coordsAt",value:function coordsAt(_pos,_side){return null;}},{key:"sync",value:function sync(track){var _a;if(this.dirty&2){var parent=this.dom;var pos=parent.firstChild;var _iterator33=_createForOfIteratorHelper(this.children),_step33;try{for(_iterator33.s();!(_step33=_iterator33.n()).done;){var child=_step33.value;if(child.dirty){if(!child.dom&&pos&&!((_a=ContentView.get(pos))===null||_a===void 0?void 0:_a.parent))child.reuseDOM(pos);child.sync(track);child.dirty=0;}if(track&&!track.written&&track.node==parent&&pos!=child.dom)track.written=true;if(child.dom.parentNode==parent){while(pos&&pos!=child.dom){pos=rm(pos);}pos=child.dom.nextSibling;}else{parent.insertBefore(child.dom,pos);}}}catch(err){_iterator33.e(err);}finally{_iterator33.f();}if(pos&&track&&track.node==parent)track.written=true;while(pos){pos=rm(pos);}}else if(this.dirty&1){var _iterator34=_createForOfIteratorHelper(this.children),_step34;try{for(_iterator34.s();!(_step34=_iterator34.n()).done;){var _child=_step34.value;if(_child.dirty){_child.sync(track);_child.dirty=0;}}}catch(err){_iterator34.e(err);}finally{_iterator34.f();}}}},{key:"reuseDOM",value:function reuseDOM(_dom){return false;}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){var after;if(node==this.dom){after=this.dom.childNodes[offset];}else{var bias=maxOffset(node)==0?0:offset==0?-1:1;for(;;){var parent=node.parentNode;if(parent==this.dom)break;if(bias==0&&parent.firstChild!=parent.lastChild){if(node==parent.firstChild)bias=-1;else bias=1;}node=parent;}if(bias<0)after=node;else after=node.nextSibling;}if(after==this.dom.firstChild)return 0;while(after&&!ContentView.get(after)){after=after.nextSibling;}if(!after)return this.length;for(var _i58=0,pos=0;;_i58++){var child=this.children[_i58];if(child.dom==after)return pos;pos+=child.length+child.breakAfter;}}},{key:"domBoundsAround",value:function domBoundsAround(from,to){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var fromI=-1,fromStart=-1,toI=-1,toEnd=-1;for(var _i59=0,pos=offset,prevEnd=offset;_i59<this.children.length;_i59++){var child=this.children[_i59],end=pos+child.length;if(pos<from&&end>to)return child.domBoundsAround(from,to,pos);if(end>=from&&fromI==-1){fromI=_i59;fromStart=pos;}if(pos>to&&child.dom.parentNode==this.dom){toI=_i59;toEnd=prevEnd;break;}prevEnd=end;pos=end+child.breakAfter;}return{from:fromStart,to:toEnd<0?offset+this.length:toEnd,startDOM:(fromI?this.children[fromI-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:toI<this.children.length&&toI>=0?this.children[toI].dom:null};}},{key:"markDirty",value:function markDirty(){var andParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.dirty|=2;this.markParentsDirty(andParent);}},{key:"markParentsDirty",value:function markParentsDirty(childList){for(var parent=this.parent;parent;parent=parent.parent){if(childList)parent.dirty|=2;if(parent.dirty&1)return;parent.dirty|=1;childList=false;}}},{key:"setParent",value:function setParent(parent){if(this.parent!=parent){this.parent=parent;if(this.dirty)this.markParentsDirty(true);}}},{key:"setDOM",value:function setDOM(dom){if(this.dom)this.dom.cmView=null;this.dom=dom;dom.cmView=this;}},{key:"rootView",get:function get(){for(var v=this;;){var parent=v.parent;if(!parent)return v;v=parent;}}},{key:"replaceChildren",value:function replaceChildren(from,to){var _this$children;var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:none$3;this.markDirty();for(var _i60=from;_i60<to;_i60++){var child=this.children[_i60];if(child.parent==this)child.parent=null;}(_this$children=this.children).splice.apply(_this$children,[from,to-from].concat(_toConsumableArray(children)));for(var _i61=0;_i61<children.length;_i61++){children[_i61].setParent(this);}}},{key:"ignoreMutation",value:function ignoreMutation(_rec){return false;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return false;}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;return new ChildCursor(this.children,pos,this.children.length);}},{key:"childPos",value:function childPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return this.childCursor().findPos(pos,bias);}},{key:"toString",value:function toString(){var name2=this.constructor.name.replace("View","");return name2+(this.children.length?"("+this.children.join()+")":this.length?"["+(name2=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"");}},{key:"isEditable",get:function get(){return true;}}],[{key:"get",value:function get(node){return node.cmView;}}]);return ContentView;}();ContentView.prototype.breakAfter=0;function rm(dom){var next=dom.nextSibling;dom.parentNode.removeChild(dom);return next;}var ChildCursor=/*#__PURE__*/function(){function ChildCursor(children,pos,i){_classCallCheck(this,ChildCursor);this.children=children;this.pos=pos;this.i=i;this.off=0;}_createClass(ChildCursor,[{key:"findPos",value:function findPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;for(;;){if(pos>this.pos||pos==this.pos&&(bias>0||this.i==0||this.children[this.i-1].breakAfter)){this.off=pos-this.pos;return this;}var next=this.children[--this.i];this.pos-=next.length+next.breakAfter;}}}]);return ChildCursor;}();var _ref4=typeof navigator!="undefined"?[navigator,document]:[{userAgent:"",vendor:"",platform:""},{documentElement:{style:{}}}],_ref5=_slicedToArray(_ref4,2),nav=_ref5[0],doc=_ref5[1];var ie_edge=/* @__PURE__ */ /Edge\/(\d+)/.exec(nav.userAgent);var ie_upto10=/* @__PURE__ */ /MSIE \d/.test(nav.userAgent);var ie_11up=/* @__PURE__ */ /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent);var ie2=!!(ie_upto10||ie_11up||ie_edge);var gecko2=!ie2&&/* @__PURE__ */ /gecko\/(\d+)/i.test(nav.userAgent);var chrome2=!ie2&&/* @__PURE__ */ /Chrome\/(\d+)/.exec(nav.userAgent);var webkit=("webkitFontSmoothing"in doc.documentElement.style);var safari2=!ie2&&/* @__PURE__ */ /Apple Computer/.test(nav.vendor);var ios=safari2&&(/* @__PURE__ */ /Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios||/* @__PURE__ */ /Mac/.test(nav.platform),windows:/* @__PURE__ */ /Win/.test(nav.platform),linux:/* @__PURE__ */ /Linux|X11/.test(nav.platform),ie:ie2,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko:gecko2,gecko_version:gecko2?+(/* @__PURE__ */ /Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome2,chrome_version:chrome2?+chrome2[1]:0,ios:ios,android:/* @__PURE__ */ /Android\b/.test(nav.userAgent),webkit:webkit,safari:safari2,webkit_version:webkit?+(/* @__PURE__ */ /\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var none$2=[];var InlineView=/*#__PURE__*/function(_ContentView){_inherits(InlineView,_ContentView);var _super4=_createSuper(InlineView);function InlineView(){_classCallCheck(this,InlineView);return _super4.apply(this,arguments);}_createClass(InlineView,[{key:"become",value:function become(_other){return false;}},{key:"getSide",value:function getSide(){return 0;}}]);return InlineView;}(ContentView);InlineView.prototype.children=none$2;var MaxJoinLen=256;var TextView=/*#__PURE__*/function(_InlineView){_inherits(TextView,_InlineView);var _super5=_createSuper(TextView);function TextView(text){var _this6;_classCallCheck(this,TextView);_this6=_super5.call(this);_this6.text=text;return _this6;}_createClass(TextView,[{key:"length",get:function get(){return this.text.length;}},{key:"createDOM",value:function createDOM(textDOM){this.setDOM(textDOM||document.createTextNode(this.text));}},{key:"sync",value:function sync(track){if(!this.dom)this.createDOM();if(this.dom.nodeValue!=this.text){if(track&&track.node==this.dom)track.written=true;this.dom.nodeValue=this.text;}}},{key:"reuseDOM",value:function reuseDOM(dom){if(dom.nodeType!=3)return false;this.createDOM(dom);return true;}},{key:"merge",value:function merge(from,to,source){if(source&&(!(source instanceof TextView)||this.length-(to-from)+source.length>MaxJoinLen))return false;this.text=this.text.slice(0,from)+(source?source.text:"")+this.text.slice(to);this.markDirty();return true;}},{key:"slice",value:function slice(from){var result=new TextView(this.text.slice(from));this.text=this.text.slice(0,from);return result;}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return node==this.dom?offset:offset?this.text.length:0;}},{key:"domAtPos",value:function domAtPos(pos){return new DOMPos(this.dom,pos);}},{key:"domBoundsAround",value:function domBoundsAround(_from,_to,offset){return{from:offset,to:offset+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling};}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords(this.dom,pos,side);}}]);return TextView;}(InlineView);var MarkView=/*#__PURE__*/function(_InlineView2){_inherits(MarkView,_InlineView2);var _super6=_createSuper(MarkView);function MarkView(mark){var _this7;var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,MarkView);_this7=_super6.call(this);_this7.mark=mark;_this7.children=children;_this7.length=length;var _iterator35=_createForOfIteratorHelper(children),_step35;try{for(_iterator35.s();!(_step35=_iterator35.n()).done;){var ch=_step35.value;ch.setParent(_assertThisInitialized(_this7));}}catch(err){_iterator35.e(err);}finally{_iterator35.f();}return _this7;}_createClass(MarkView,[{key:"createDOM",value:function createDOM(){var dom=document.createElement(this.mark.tagName);if(this.mark["class"])dom.className=this.mark["class"];if(this.mark.attrs)for(var name2 in this.mark.attrs){dom.setAttribute(name2,this.mark.attrs[name2]);}this.setDOM(dom);}},{key:"sync",value:function sync(track){if(!this.dom||this.dirty&4)this.createDOM();_get(_getPrototypeOf(MarkView.prototype),"sync",this).call(this,track);}},{key:"merge",value:function merge(from,to,source,openStart,openEnd){if(source&&(!(source instanceof MarkView&&source.mark.eq(this.mark))||from&&openStart<=0||to<this.length&&openEnd<=0))return false;mergeInlineChildren(this,from,to,source?source.children:none$2,openStart-1,openEnd-1);this.markDirty();return true;}},{key:"slice",value:function slice(from){var result=[],off=0,detachFrom=-1,i=0;var _iterator36=_createForOfIteratorHelper(this.children),_step36;try{for(_iterator36.s();!(_step36=_iterator36.n()).done;){var elt=_step36.value;var end=off+elt.length;if(end>from)result.push(off<from?elt.slice(from-off):elt);if(detachFrom<0&&off>=from)detachFrom=i;off=end;i++;}}catch(err){_iterator36.e(err);}finally{_iterator36.f();}var length=this.length-from;this.length=from;if(detachFrom>-1)this.replaceChildren(detachFrom,this.children.length);return new MarkView(this.mark,result,length);}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos(this.dom,this.children,pos);}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren(this,pos,side);}}]);return MarkView;}(InlineView);function textCoords(text,pos,side){var length=text.nodeValue.length;if(pos>length)pos=length;var from=pos,to=pos,flatten2=0;if(pos==0&&side<0||pos==length&&side>=0){if(!(browser.chrome||browser.gecko)){if(pos){from--;flatten2=1;}else{to++;flatten2=-1;}}}else{if(side<0)from--;else to++;}var rects=textRange(text,from,to).getClientRects();if(!rects.length)return Rect0;var rect=rects[(flatten2?flatten2<0:side>=0)?0:rects.length-1];if(browser.safari&&!flatten2&&rect.width==0)rect=Array.prototype.find.call(rects,function(r){return r.width;})||rect;return flatten2?flattenRect(rect,flatten2<0):rect;}var WidgetView=/*#__PURE__*/function(_InlineView3){_inherits(WidgetView,_InlineView3);var _super7=_createSuper(WidgetView);function WidgetView(widget,length,side){var _this8;_classCallCheck(this,WidgetView);_this8=_super7.call(this);_this8.widget=widget;_this8.length=length;_this8.side=side;return _this8;}_createClass(WidgetView,[{key:"slice",value:function slice(from){var result=WidgetView.create(this.widget,this.length-from,this.side);this.length-=from;return result;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"getSide",value:function getSide(){return this.side;}},{key:"merge",value:function merge(from,to,source,openStart,openEnd){if(source&&(!(source instanceof WidgetView)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"become",value:function become(other){if(other.length==this.length&&other instanceof WidgetView&&other.side==this.side){if(this.widget.constructor==other.widget.constructor){if(!this.widget.eq(other.widget))this.markDirty(true);this.widget=other.widget;return true;}}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}},{key:"overrideDOMText",get:function get(){if(this.length==0)return Text.empty;var top2=this;while(top2.parent){top2=top2.parent;}var view=top2.editorView,text=view&&view.state.doc,start=this.posAtStart;return text?text.slice(start,start+this.length):Text.empty;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length);}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){var rects=this.dom.getClientRects(),rect=null;if(!rects.length)return Rect0;for(var _i62=pos>0?rects.length-1:0;;_i62+=pos>0?-1:1){rect=rects[_i62];if(pos>0?_i62==0:_i62==rects.length-1||rect.top<rect.bottom)break;}return pos==0&&side>0||pos==this.length&&side<=0?rect:flattenRect(rect,pos==0);}},{key:"isEditable",get:function get(){return false;}}],[{key:"create",value:function create(widget,length,side){return new(widget.customView||WidgetView)(widget,length,side);}}]);return WidgetView;}(InlineView);var CompositionView=/*#__PURE__*/function(_WidgetView){_inherits(CompositionView,_WidgetView);var _super8=_createSuper(CompositionView);function CompositionView(){_classCallCheck(this,CompositionView);return _super8.apply(this,arguments);}_createClass(CompositionView,[{key:"domAtPos",value:function domAtPos(pos){return new DOMPos(this.widget.text,pos);}},{key:"sync",value:function sync(){if(!this.dom)this.setDOM(this.widget.toDOM());}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return!offset?0:node.nodeType==3?Math.min(offset,this.length):this.length;}},{key:"ignoreMutation",value:function ignoreMutation(){return false;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords(this.widget.text,pos,side);}},{key:"isEditable",get:function get(){return true;}}]);return CompositionView;}(WidgetView);var WidgetBufferView=/*#__PURE__*/function(_InlineView4){_inherits(WidgetBufferView,_InlineView4);var _super9=_createSuper(WidgetBufferView);function WidgetBufferView(side){var _this9;_classCallCheck(this,WidgetBufferView);_this9=_super9.call(this);_this9.side=side;return _this9;}_createClass(WidgetBufferView,[{key:"length",get:function get(){return 0;}},{key:"merge",value:function merge(){return false;}},{key:"become",value:function become(other){return other instanceof WidgetBufferView&&other.side==this.side;}},{key:"slice",value:function slice(){return new WidgetBufferView(this.side);}},{key:"sync",value:function sync(){if(!this.dom)this.setDOM(document.createTextNode("\u200B"));else if(this.dirty&&this.dom.nodeValue!="\u200B")this.dom.nodeValue="\u200B";}},{key:"getSide",value:function getSide(){return this.side;}},{key:"domAtPos",value:function domAtPos(pos){return DOMPos.before(this.dom);}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos){var rects=clientRectsFor(this.dom);return rects[rects.length-1];}},{key:"overrideDOMText",get:function get(){return Text.of([this.dom.nodeValue.replace(/\u200b/g,"")]);}}]);return WidgetBufferView;}(InlineView);function mergeInlineChildren(parent,from,to,elts,openStart,openEnd){var cur2=parent.childCursor();var _cur2$findPos=cur2.findPos(to,1),toI=_cur2$findPos.i,toOff=_cur2$findPos.off;var _cur2$findPos2=cur2.findPos(from,-1),fromI=_cur2$findPos2.i,fromOff=_cur2$findPos2.off;var dLen=from-to;var _iterator37=_createForOfIteratorHelper(elts),_step37;try{for(_iterator37.s();!(_step37=_iterator37.n()).done;){var view=_step37.value;dLen+=view.length;}}catch(err){_iterator37.e(err);}finally{_iterator37.f();}parent.length+=dLen;var children=parent.children;if(fromI==toI&&fromOff){var start=children[fromI];if(elts.length==1&&start.merge(fromOff,toOff,elts[0],openStart,openEnd))return;if(elts.length==0){start.merge(fromOff,toOff,null,openStart,openEnd);return;}var after=start.slice(toOff);if(after.merge(0,0,elts[elts.length-1],0,openEnd))elts[elts.length-1]=after;else elts.push(after);toI++;openEnd=toOff=0;}if(toOff){var end=children[toI];if(elts.length&&end.merge(0,toOff,elts[elts.length-1],0,openEnd)){elts.pop();openEnd=elts.length?0:openStart;}else{end.merge(0,toOff,null,0,0);}}else if(toI<children.length&&elts.length&&children[toI].merge(0,0,elts[elts.length-1],0,openEnd)){elts.pop();openEnd=elts.length?0:openStart;}if(fromOff){var _start3=children[fromI];if(elts.length&&_start3.merge(fromOff,_start3.length,elts[0],openStart,0)){elts.shift();openStart=elts.length?0:openEnd;}else{_start3.merge(fromOff,_start3.length,null,0,0);}fromI++;}else if(fromI&&elts.length){var _end2=children[fromI-1];if(_end2.merge(_end2.length,_end2.length,elts[0],openStart,0)){elts.shift();openStart=elts.length?0:openEnd;}}while(fromI<toI&&elts.length&&children[toI-1].become(elts[elts.length-1])){elts.pop();toI--;openEnd=elts.length?0:openStart;}while(fromI<toI&&elts.length&&children[fromI].become(elts[0])){elts.shift();fromI++;openStart=elts.length?0:openEnd;}if(!elts.length&&fromI&&toI<children.length&&children[toI].merge(0,0,children[fromI-1],openStart,openEnd))fromI--;if(elts.length||fromI!=toI)parent.replaceChildren(fromI,toI,elts);}function inlineDOMAtPos(dom,children,pos){var i=0;for(var off=0;i<children.length;i++){var child=children[i],end=off+child.length;if(end==off&&child.getSide()<=0)continue;if(pos>off&&pos<end&&child.dom.parentNode==dom)return child.domAtPos(pos-off);if(pos<=off)break;off=end;}for(;i>0;i--){var before=children[i-1].dom;if(before.parentNode==dom)return DOMPos.after(before);}return new DOMPos(dom,0);}function joinInlineInto(parent,view,open){var last,children=parent.children;if(open>0&&view instanceof MarkView&&children.length&&(last=children[children.length-1])instanceof MarkView&&last.mark.eq(view.mark)){joinInlineInto(last,view.children[0],open-1);}else{children.push(view);view.setParent(parent);}parent.length+=view.length;}function coordsInChildren(view,pos,side){for(var off=0,_i63=0;_i63<view.children.length;_i63++){var child=view.children[_i63],end=off+child.length,next=void 0;if((side<=0||end==view.length||child.getSide()>0?end>=pos:end>pos)&&(pos<end||_i63+1==view.children.length||(next=view.children[_i63+1]).length||next.getSide()>0)){var flatten2=0;if(end==off){if(child.getSide()<=0)continue;flatten2=side=-child.getSide();}var rect=child.coordsAt(pos-off,side);return flatten2&&rect?flattenRect(rect,side<0):rect;}off=end;}var last=view.dom.lastChild;if(!last)return view.dom.getBoundingClientRect();var rects=clientRectsFor(last);return rects[rects.length-1];}function combineAttrs(source,target){for(var name2 in source){if(name2=="class"&&target["class"])target["class"]+=" "+source["class"];else if(name2=="style"&&target.style)target.style+=";"+source.style;else target[name2]=source[name2];}return target;}function attrsEq(a,b){if(a==b)return true;if(!a||!b)return false;var keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length!=keysB.length)return false;for(var _i64=0,_keysA=keysA;_i64<_keysA.length;_i64++){var key=_keysA[_i64];if(keysB.indexOf(key)==-1||a[key]!==b[key])return false;}return true;}function _updateAttrs(dom,prev,attrs){if(prev){for(var name2 in prev){if(!(attrs&&name2 in attrs))dom.removeAttribute(name2);}}if(attrs){for(var _name in attrs){if(!(prev&&prev[_name]==attrs[_name]))dom.setAttribute(_name,attrs[_name]);}}}var WidgetType=/*#__PURE__*/function(){function WidgetType(){_classCallCheck(this,WidgetType);}_createClass(WidgetType,[{key:"eq",value:function eq(_widget){return false;}},{key:"updateDOM",value:function updateDOM(_dom){return false;}},{key:"compare",value:function compare(other){return this==other||this.constructor==other.constructor&&this.eq(other);}},{key:"estimatedHeight",get:function get(){return-1;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return true;}},{key:"customView",get:function get(){return null;}}]);return WidgetType;}();var BlockType=/* @__PURE__ */function(BlockType6){BlockType6[BlockType6["Text"]=0]="Text";BlockType6[BlockType6["WidgetBefore"]=1]="WidgetBefore";BlockType6[BlockType6["WidgetAfter"]=2]="WidgetAfter";BlockType6[BlockType6["WidgetRange"]=3]="WidgetRange";return BlockType6;}(BlockType||(BlockType={}));var Decoration=/*#__PURE__*/function(_RangeValue){_inherits(Decoration,_RangeValue);var _super10=_createSuper(Decoration);function Decoration(startSide,endSide,widget,spec){var _this10;_classCallCheck(this,Decoration);_this10=_super10.call(this);_this10.startSide=startSide;_this10.endSide=endSide;_this10.widget=widget;_this10.spec=spec;return _this10;}_createClass(Decoration,[{key:"heightRelevant",get:function get(){return false;}},{key:"hasHeight",value:function hasHeight(){return this.widget?this.widget.estimatedHeight>-1:false;}}],[{key:"mark",value:function mark(spec){return new MarkDecoration(spec);}},{key:"widget",value:function widget(spec){var side=spec.side||0;return new PointDecoration(spec,side,side,!!spec.block,spec.widget||null,false);}},{key:"replace",value:function replace(spec){var block=!!spec.block;var _getInclusive=getInclusive(spec,block),start=_getInclusive.start,end=_getInclusive.end;var startSide=1e8*(start?-1:1)*(block?2:1);var endSide=1e8*(end?1:-1)*(block?2:1);return new PointDecoration(spec,startSide,endSide,block,spec.widget||null,true);}},{key:"line",value:function line(spec){return new LineDecoration(spec);}},{key:"set",value:function set(of){var sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return RangeSet.of(of,sort);}}]);return Decoration;}(RangeValue);Decoration.none=RangeSet.empty;var MarkDecoration=/*#__PURE__*/function(_Decoration){_inherits(MarkDecoration,_Decoration);var _super11=_createSuper(MarkDecoration);function MarkDecoration(spec){var _this11;_classCallCheck(this,MarkDecoration);var _getInclusive2=getInclusive(spec),start=_getInclusive2.start,end=_getInclusive2.end;_this11=_super11.call(this,1e8*(start?-1:1),1e8*(end?1:-1),null,spec);_this11.tagName=spec.tagName||"span";_this11["class"]=spec["class"]||"";_this11.attrs=spec.attributes||null;return _this11;}_createClass(MarkDecoration,[{key:"eq",value:function eq(other){return this==other||other instanceof MarkDecoration&&this.tagName==other.tagName&&this["class"]==other["class"]&&attrsEq(this.attrs,other.attrs);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(from>=to)throw new RangeError("Mark decorations may not be empty");return _get(_getPrototypeOf(MarkDecoration.prototype),"range",this).call(this,from,to);}}]);return MarkDecoration;}(Decoration);MarkDecoration.prototype.point=false;var LineDecoration=/*#__PURE__*/function(_Decoration2){_inherits(LineDecoration,_Decoration2);var _super12=_createSuper(LineDecoration);function LineDecoration(spec){_classCallCheck(this,LineDecoration);return _super12.call(this,-1e8,-1e8,null,spec);}_createClass(LineDecoration,[{key:"eq",value:function eq(other){return other instanceof LineDecoration&&attrsEq(this.spec.attributes,other.spec.attributes);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(to!=from)throw new RangeError("Line decoration ranges must be zero-length");return _get(_getPrototypeOf(LineDecoration.prototype),"range",this).call(this,from,to);}}]);return LineDecoration;}(Decoration);LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=true;var PointDecoration=/*#__PURE__*/function(_Decoration3){_inherits(PointDecoration,_Decoration3);var _super13=_createSuper(PointDecoration);function PointDecoration(spec,startSide,endSide,block,widget,isReplace){var _this12;_classCallCheck(this,PointDecoration);_this12=_super13.call(this,startSide,endSide,widget,spec);_this12.block=block;_this12.isReplace=isReplace;_this12.mapMode=!block?MapMode.TrackDel:startSide<0?MapMode.TrackBefore:MapMode.TrackAfter;return _this12;}_createClass(PointDecoration,[{key:"type",get:function get(){return this.startSide<this.endSide?BlockType.WidgetRange:this.startSide<0?BlockType.WidgetBefore:BlockType.WidgetAfter;}},{key:"heightRelevant",get:function get(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5;}},{key:"eq",value:function eq(other){return other instanceof PointDecoration&&widgetsEq(this.widget,other.widget)&&this.block==other.block&&this.startSide==other.startSide&&this.endSide==other.endSide;}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(this.isReplace&&(from>to||from==to&&this.startSide>0&&this.endSide<0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&to!=from)throw new RangeError("Widget decorations can only have zero-length ranges");return _get(_getPrototypeOf(PointDecoration.prototype),"range",this).call(this,from,to);}}]);return PointDecoration;}(Decoration);PointDecoration.prototype.point=true;function getInclusive(spec){var block=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var start=spec.inclusiveStart,end=spec.inclusiveEnd;if(start==null)start=spec.inclusive;if(end==null)end=spec.inclusive;return{start:start!==null&&start!==void 0?start:block,end:end!==null&&end!==void 0?end:block};}function widgetsEq(a,b){return a==b||!!(a&&b&&a.compare(b));}function addRange(from,to,ranges){var margin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var last=ranges.length-1;if(last>=0&&ranges[last]+margin>from)ranges[last]=Math.max(ranges[last],to);else ranges.push(from,to);}var LineView=/*#__PURE__*/function(_ContentView2){_inherits(LineView,_ContentView2);var _super14=_createSuper(LineView);function LineView(){var _this13;_classCallCheck(this,LineView);_this13=_super14.apply(this,arguments);_this13.children=[];_this13.length=0;_this13.prevAttrs=void 0;_this13.attrs=null;_this13.breakAfter=0;return _this13;}_createClass(LineView,[{key:"merge",value:function merge(from,to,source,takeDeco,openStart,openEnd){if(source){if(!(source instanceof LineView))return false;if(!this.dom)source.transferDOM(this);}if(takeDeco)this.setDeco(source?source.attrs:null);mergeInlineChildren(this,from,to,source?source.children:none$1,openStart,openEnd);return true;}},{key:"split",value:function split(at){var end=new LineView();end.breakAfter=this.breakAfter;if(this.length==0)return end;var _this$childPos=this.childPos(at),i=_this$childPos.i,off=_this$childPos.off;if(off){end.append(this.children[i].slice(off),0);this.children[i].merge(off,this.children[i].length,null,0,0);i++;}for(var j=i;j<this.children.length;j++){end.append(this.children[j],0);}while(i>0&&this.children[i-1].length==0){this.children[i-1].parent=null;i--;}this.children.length=i;this.markDirty();this.length=at;return end;}},{key:"transferDOM",value:function transferDOM(other){if(!this.dom)return;other.setDOM(this.dom);other.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs;this.prevAttrs=void 0;this.dom=null;}},{key:"setDeco",value:function setDeco(attrs){if(!attrsEq(this.attrs,attrs)){if(this.dom){this.prevAttrs=this.attrs;this.markDirty();}this.attrs=attrs;}}},{key:"append",value:function append(child,openStart){joinInlineInto(this,child,openStart);}},{key:"addLineDeco",value:function addLineDeco(deco){var attrs=deco.spec.attributes,cls=deco.spec["class"];if(attrs)this.attrs=combineAttrs(attrs,this.attrs||{});if(cls)this.attrs=combineAttrs(attrs,{"class":cls});}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos(this.dom,this.children,pos);}},{key:"sync",value:function sync(track){var _a;if(!this.dom||this.dirty&4){this.setDOM(document.createElement("div"));this.dom.className="cm-line";this.prevAttrs=this.attrs?null:void 0;}if(this.prevAttrs!==void 0){_updateAttrs(this.dom,this.prevAttrs,this.attrs);this.dom.classList.add("cm-line");this.prevAttrs=void 0;}_get(_getPrototypeOf(LineView.prototype),"sync",this).call(this,track);var last=this.dom.lastChild;while(last&&ContentView.get(last)instanceof MarkView){last=last.lastChild;}if(!last||last.nodeName!="BR"&&((_a=ContentView.get(last))===null||_a===void 0?void 0:_a.isEditable)==false&&(!browser.ios||!this.children.some(function(ch){return ch instanceof TextView;}))){var hack=document.createElement("BR");hack.cmIgnore=true;this.dom.appendChild(hack);}}},{key:"measureTextSize",value:function measureTextSize(){if(this.children.length==0||this.length>20)return null;var totalWidth=0;var _iterator38=_createForOfIteratorHelper(this.children),_step38;try{for(_iterator38.s();!(_step38=_iterator38.n()).done;){var child=_step38.value;if(!(child instanceof TextView))return null;var rects=clientRectsFor(child.dom);if(rects.length!=1)return null;totalWidth+=rects[0].width;}}catch(err){_iterator38.e(err);}finally{_iterator38.f();}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:totalWidth/this.length};}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren(this,pos,side);}},{key:"match",value:function match(_other){return false;}},{key:"type",get:function get(){return BlockType.Text;}}],[{key:"find",value:function find(docView,pos){for(var _i65=0,off=0;;_i65++){var block=docView.children[_i65],end=off+block.length;if(end>=pos){if(block instanceof LineView)return block;if(block.length)return null;}off=end+block.breakAfter;}}}]);return LineView;}(ContentView);var none$1=[];var BlockWidgetView=/*#__PURE__*/function(_ContentView3){_inherits(BlockWidgetView,_ContentView3);var _super15=_createSuper(BlockWidgetView);function BlockWidgetView(widget,length,type){var _this14;_classCallCheck(this,BlockWidgetView);_this14=_super15.call(this);_this14.widget=widget;_this14.length=length;_this14.type=type;_this14.breakAfter=0;return _this14;}_createClass(BlockWidgetView,[{key:"merge",value:function merge(from,to,source,_takeDeco,openStart,openEnd){if(source&&(!(source instanceof BlockWidgetView)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos.before(this.dom):DOMPos.after(this.dom,pos==this.length);}},{key:"split",value:function split(at){var len=this.length-at;this.length=at;var end=new BlockWidgetView(this.widget,len,this.type);end.breakAfter=this.breakAfter;return end;}},{key:"children",get:function get(){return none$1;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"overrideDOMText",get:function get(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty;}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"match",value:function match(other){if(other instanceof BlockWidgetView&&other.type==this.type&&other.widget.constructor==this.widget.constructor){if(!other.widget.eq(this.widget))this.markDirty(true);this.widget=other.widget;this.length=other.length;this.breakAfter=other.breakAfter;return true;}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}}]);return BlockWidgetView;}(ContentView);var ContentBuilder=/*#__PURE__*/function(){function ContentBuilder(doc6,pos,end){_classCallCheck(this,ContentBuilder);this.doc=doc6;this.pos=pos;this.end=end;this.content=[];this.curLine=null;this.breakAtStart=0;this.pendingBuffer=0;this.atCursorPos=true;this.openStart=-1;this.openEnd=-1;this.text="";this.textOff=0;this.cursor=doc6.iter();this.skip=pos;}_createClass(ContentBuilder,[{key:"posCovered",value:function posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;var last=this.content[this.content.length-1];return!last.breakAfter&&!(last instanceof BlockWidgetView&&last.type==BlockType.WidgetBefore);}},{key:"getLine",value:function getLine(){if(!this.curLine){this.content.push(this.curLine=new LineView());this.atCursorPos=true;}return this.curLine;}},{key:"flushBuffer",value:function flushBuffer(active){if(this.pendingBuffer){this.curLine.append(wrapMarks(new WidgetBufferView(-1),active),active.length);this.pendingBuffer=0;}}},{key:"addBlockWidget",value:function addBlockWidget(view){this.flushBuffer([]);this.curLine=null;this.content.push(view);}},{key:"finish",value:function finish(openEnd){if(!openEnd)this.flushBuffer([]);else this.pendingBuffer=0;if(!this.posCovered())this.getLine();}},{key:"buildText",value:function buildText(length,active,openStart){while(length>0){if(this.textOff==this.text.length){var _this$cursor$next2=this.cursor.next(this.skip),value=_this$cursor$next2.value,lineBreak=_this$cursor$next2.lineBreak,done=_this$cursor$next2.done;this.skip=0;if(done)throw new Error("Ran out of text content when drawing inline views");if(lineBreak){if(!this.posCovered())this.getLine();if(this.content.length)this.content[this.content.length-1].breakAfter=1;else this.breakAtStart=1;this.flushBuffer([]);this.curLine=null;length--;continue;}else{this.text=value;this.textOff=0;}}var take=Math.min(this.text.length-this.textOff,length,512);this.flushBuffer(active);this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+take)),active),openStart);this.atCursorPos=true;this.textOff+=take;length-=take;openStart=0;}}},{key:"span",value:function span(from,to,active,openStart){this.buildText(to-from,active,openStart);this.pos=to;if(this.openStart<0)this.openStart=openStart;}},{key:"point",value:function point(from,to,deco,active,openStart){var len=to-from;if(deco instanceof PointDecoration){if(deco.block){var type=deco.type;if(type==BlockType.WidgetAfter&&!this.posCovered())this.getLine();this.addBlockWidget(new BlockWidgetView(deco.widget||new NullWidget("div"),len,type));}else{var view=WidgetView.create(deco.widget||new NullWidget("span"),len,deco.startSide);var cursorBefore=this.atCursorPos&&!view.isEditable&&openStart<=active.length&&(from<to||deco.startSide>0);var cursorAfter=!view.isEditable&&(from<to||deco.startSide<=0);var line=this.getLine();if(this.pendingBuffer==2&&!cursorBefore)this.pendingBuffer=0;this.flushBuffer(active);if(cursorBefore){line.append(wrapMarks(new WidgetBufferView(1),active),openStart);openStart=active.length+Math.max(0,openStart-active.length);}line.append(wrapMarks(view,active),openStart);this.atCursorPos=cursorAfter;this.pendingBuffer=!cursorAfter?0:from<to?1:2;}}else if(this.doc.lineAt(this.pos).from==this.pos){this.getLine().addLineDeco(deco);}if(len){if(this.textOff+len<=this.text.length){this.textOff+=len;}else{this.skip+=len-(this.text.length-this.textOff);this.text="";this.textOff=0;}this.pos=to;}if(this.openStart<0)this.openStart=openStart;}}],[{key:"build",value:function build(text,from,to,decorations6){var builder=new ContentBuilder(text,from,to);builder.openEnd=RangeSet.spans(decorations6,from,to,builder);if(builder.openStart<0)builder.openStart=builder.openEnd;builder.finish(builder.openEnd);return builder;}}]);return ContentBuilder;}();function wrapMarks(view,active){var _iterator39=_createForOfIteratorHelper(active),_step39;try{for(_iterator39.s();!(_step39=_iterator39.n()).done;){var mark=_step39.value;view=new MarkView(mark,[view],view.length);}}catch(err){_iterator39.e(err);}finally{_iterator39.f();}return view;}var NullWidget=/*#__PURE__*/function(_WidgetType){_inherits(NullWidget,_WidgetType);var _super16=_createSuper(NullWidget);function NullWidget(tag){var _this15;_classCallCheck(this,NullWidget);_this15=_super16.call(this);_this15.tag=tag;return _this15;}_createClass(NullWidget,[{key:"eq",value:function eq(other){return other.tag==this.tag;}},{key:"toDOM",value:function toDOM(){return document.createElement(this.tag);}},{key:"updateDOM",value:function updateDOM(elt){return elt.nodeName.toLowerCase()==this.tag;}}]);return NullWidget;}(WidgetType);var none2=[];var clickAddsSelectionRange=/* @__PURE__ */Facet.define();var dragMovesSelection$1=/* @__PURE__ */Facet.define();var mouseSelectionStyle=/* @__PURE__ */Facet.define();var exceptionSink=/* @__PURE__ */Facet.define();var updateListener=/* @__PURE__ */Facet.define();var inputHandler=/* @__PURE__ */Facet.define();var scrollTo=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});var centerOn=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});function logException(state,exception,context){var handler=state.facet(exceptionSink);if(handler.length)handler[0](exception);else if(window.onerror)window.onerror(String(exception),context,void 0,void 0,exception);else if(context)console.error(context+":",exception);else console.error(exception);}var editable=/* @__PURE__ */Facet.define({combine:function combine(values){return values.length?values[0]:true;}});var PluginFieldProvider=/*#__PURE__*/_createClass(function PluginFieldProvider(field,get){_classCallCheck(this,PluginFieldProvider);this.field=field;this.get=get;});var PluginField=/*#__PURE__*/function(){function PluginField(){_classCallCheck(this,PluginField);}_createClass(PluginField,[{key:"from",value:function from(get){return new PluginFieldProvider(this,get);}}],[{key:"define",value:function define(){return new PluginField();}}]);return PluginField;}();PluginField.decorations=/* @__PURE__ */PluginField.define();PluginField.atomicRanges=/* @__PURE__ */PluginField.define();PluginField.scrollMargins=/* @__PURE__ */PluginField.define();var nextPluginID=0;var viewPlugin=/* @__PURE__ */Facet.define();var ViewPlugin=/*#__PURE__*/function(){function ViewPlugin(id,create,fields){_classCallCheck(this,ViewPlugin);this.id=id;this.create=create;this.fields=fields;this.extension=viewPlugin.of(this);}_createClass(ViewPlugin,null,[{key:"define",value:function define(create,spec){var _ref6=spec||{},eventHandlers=_ref6.eventHandlers,provide=_ref6.provide,decorations6=_ref6.decorations;var fields=[];if(provide){var _iterator40=_createForOfIteratorHelper(Array.isArray(provide)?provide:[provide]),_step40;try{for(_iterator40.s();!(_step40=_iterator40.n()).done;){var provider=_step40.value;fields.push(provider);}}catch(err){_iterator40.e(err);}finally{_iterator40.f();}}if(eventHandlers)fields.push(domEventHandlers.from(function(value){return{plugin:value,handlers:eventHandlers};}));if(decorations6)fields.push(PluginField.decorations.from(decorations6));return new ViewPlugin(nextPluginID++,create,fields);}},{key:"fromClass",value:function fromClass(cls,spec){return ViewPlugin.define(function(view){return new cls(view);},spec);}}]);return ViewPlugin;}();var domEventHandlers=/* @__PURE__ */PluginField.define();var PluginInstance=/*#__PURE__*/function(){function PluginInstance(spec){_classCallCheck(this,PluginInstance);this.spec=spec;this.mustUpdate=null;this.value=null;}_createClass(PluginInstance,[{key:"takeField",value:function takeField(type,target){var _iterator41=_createForOfIteratorHelper(this.spec.fields),_step41;try{for(_iterator41.s();!(_step41=_iterator41.n()).done;){var _step41$value=_step41.value,field=_step41$value.field,get=_step41$value.get;if(field==type)target.push(get(this.value));}}catch(err){_iterator41.e(err);}finally{_iterator41.f();}}},{key:"update",value:function update(view){if(!this.value){try{this.value=this.spec.create(view);}catch(e){logException(view.state,e,"CodeMirror plugin crashed");return PluginInstance.dummy;}}else if(this.mustUpdate){var update=this.mustUpdate;this.mustUpdate=null;if(!this.value.update)return this;try{this.value.update(update);}catch(e){logException(update.state,e,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy();}catch(_){}return PluginInstance.dummy;}}return this;}},{key:"destroy",value:function destroy(view){var _a;if((_a=this.value)===null||_a===void 0?void 0:_a.destroy){try{this.value.destroy();}catch(e){logException(view.state,e,"CodeMirror plugin crashed");}}}}]);return PluginInstance;}();PluginInstance.dummy=/* @__PURE__ */new PluginInstance(/* @__PURE__ */ViewPlugin.define(function(){return{};}));var editorAttributes=/* @__PURE__ */Facet.define({combine:function combine(values){return values.reduce(function(a,b){return combineAttrs(b,a);},{});}});var contentAttributes=/* @__PURE__ */Facet.define({combine:function combine(values){return values.reduce(function(a,b){return combineAttrs(b,a);},{});}});var decorations=/* @__PURE__ */Facet.define();var styleModule=/* @__PURE__ */Facet.define();var ChangedRange=/*#__PURE__*/function(){function ChangedRange(fromA,toA,fromB,toB){_classCallCheck(this,ChangedRange);this.fromA=fromA;this.toA=toA;this.fromB=fromB;this.toB=toB;}_createClass(ChangedRange,[{key:"join",value:function join(other){return new ChangedRange(Math.min(this.fromA,other.fromA),Math.max(this.toA,other.toA),Math.min(this.fromB,other.fromB),Math.max(this.toB,other.toB));}},{key:"addToSet",value:function addToSet(set){var i=set.length,me=this;for(;i>0;i--){var range=set[i-1];if(range.fromA>me.toA)continue;if(range.toA<me.fromA)break;me=me.join(range);set.splice(i-1,1);}set.splice(i,0,me);return set;}}],[{key:"extendWithRanges",value:function extendWithRanges(diff,ranges){if(ranges.length==0)return diff;var result=[];for(var dI=0,rI=0,posA=0,posB=0;;dI++){var next=dI==diff.length?null:diff[dI],off=posA-posB;var end=next?next.fromB:1e9;while(rI<ranges.length&&ranges[rI]<end){var from=ranges[rI],to=ranges[rI+1];var fromB=Math.max(posB,from),toB=Math.min(end,to);if(fromB<=toB)new ChangedRange(fromB+off,toB+off,fromB,toB).addToSet(result);if(to>end)break;else rI+=2;}if(!next)return result;new ChangedRange(next.fromA,next.toA,next.fromB,next.toB).addToSet(result);posA=next.toA;posB=next.toB;}}}]);return ChangedRange;}();var ViewUpdate=/*#__PURE__*/function(){function ViewUpdate(view,state){var transactions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:none2;_classCallCheck(this,ViewUpdate);this.view=view;this.state=state;this.transactions=transactions;this.flags=0;this.startState=view.state;this.changes=ChangeSet.empty(this.startState.doc.length);var _iterator42=_createForOfIteratorHelper(transactions),_step42;try{for(_iterator42.s();!(_step42=_iterator42.n()).done;){var tr=_step42.value;this.changes=this.changes.compose(tr.changes);}}catch(err){_iterator42.e(err);}finally{_iterator42.f();}var changedRanges=[];this.changes.iterChangedRanges(function(fromA,toA,fromB,toB){return changedRanges.push(new ChangedRange(fromA,toA,fromB,toB));});this.changedRanges=changedRanges;var focus=view.hasFocus;if(focus!=view.inputState.notifiedFocused){view.inputState.notifiedFocused=focus;this.flags|=1;}if(this.docChanged)this.flags|=2;}_createClass(ViewUpdate,[{key:"viewportChanged",get:function get(){return(this.flags&4)>0;}},{key:"heightChanged",get:function get(){return(this.flags&2)>0;}},{key:"geometryChanged",get:function get(){return this.docChanged||(this.flags&(8|2))>0;}},{key:"focusChanged",get:function get(){return(this.flags&1)>0;}},{key:"docChanged",get:function get(){return this.transactions.some(function(tr){return tr.docChanged;});}},{key:"selectionSet",get:function get(){return this.transactions.some(function(tr){return tr.selection;});}},{key:"empty",get:function get(){return this.flags==0&&this.transactions.length==0;}}]);return ViewUpdate;}();var DocView=/*#__PURE__*/function(_ContentView4){_inherits(DocView,_ContentView4);var _super17=_createSuper(DocView);function DocView(view){var _this16;_classCallCheck(this,DocView);_this16=_super17.call(this);_this16.view=view;_this16.compositionDeco=Decoration.none;_this16.decorations=[];_this16.minWidth=0;_this16.minWidthFrom=0;_this16.minWidthTo=0;_this16.impreciseAnchor=null;_this16.impreciseHead=null;_this16.setDOM(view.contentDOM);_this16.children=[new LineView()];_this16.children[0].setParent(_assertThisInitialized(_this16));_this16.updateInner([new ChangedRange(0,0,0,view.state.doc.length)],_this16.updateDeco(),0);return _this16;}_createClass(DocView,[{key:"root",get:function get(){return this.view.root;}},{key:"editorView",get:function get(){return this.view;}},{key:"length",get:function get(){return this.view.state.doc.length;}},{key:"update",value:function update(_update){var _this17=this;var changedRanges=_update.changedRanges;if(this.minWidth>0&&changedRanges.length){if(!changedRanges.every(function(_ref7){var fromA=_ref7.fromA,toA=_ref7.toA;return toA<_this17.minWidthFrom||fromA>_this17.minWidthTo;})){this.minWidth=0;}else{this.minWidthFrom=_update.changes.mapPos(this.minWidthFrom,1);this.minWidthTo=_update.changes.mapPos(this.minWidthTo,1);}}if(this.view.inputState.composing<0)this.compositionDeco=Decoration.none;else if(_update.transactions.length)this.compositionDeco=computeCompositionDeco(this.view,_update.changes);var forceSelection=(browser.ie||browser.chrome)&&!this.compositionDeco.size&&_update&&_update.state.doc.lines!=_update.startState.doc.lines;var prevDeco=this.decorations,deco=this.updateDeco();var decoDiff=findChangedDeco(prevDeco,deco,_update.changes);changedRanges=ChangedRange.extendWithRanges(changedRanges,decoDiff);var pointerSel=_update.transactions.some(function(tr){return tr.isUserEvent("select.pointer");});if(this.dirty==0&&changedRanges.length==0&&!(_update.flags&4)&&_update.state.selection.main.from>=this.view.viewport.from&&_update.state.selection.main.to<=this.view.viewport.to){this.updateSelection(forceSelection,pointerSel);return false;}else{this.updateInner(changedRanges,deco,_update.startState.doc.length,forceSelection,pointerSel);return true;}}},{key:"reset",value:function reset(sel){var _this18=this;if(this.dirty){this.view.observer.ignore(function(){return _this18.view.docView.sync();});this.dirty=0;}if(sel)this.updateSelection();}},{key:"updateInner",value:function updateInner(changes,deco,oldLength){var _this19=this;var forceSelection=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var pointerSel=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;this.updateChildren(changes,deco,oldLength);var observer=this.view.observer;observer.ignore(function(){_this19.dom.style.height=_this19.view.viewState.domHeight+"px";_this19.dom.style.minWidth=_this19.minWidth?_this19.minWidth+"px":"";var track=browser.chrome||browser.ios?{node:observer.selectionRange.focusNode,written:false}:void 0;_this19.sync(track);_this19.dirty=0;if(track&&(track.written||observer.selectionRange.focusNode!=track.node))forceSelection=true;_this19.updateSelection(forceSelection,pointerSel);_this19.dom.style.height="";});var gaps=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length){var _iterator43=_createForOfIteratorHelper(this.children),_step43;try{for(_iterator43.s();!(_step43=_iterator43.n()).done;){var child=_step43.value;if(child instanceof BlockWidgetView&&child.widget instanceof BlockGapWidget)gaps.push(child.dom);}}catch(err){_iterator43.e(err);}finally{_iterator43.f();}}observer.updateGaps(gaps);}},{key:"updateChildren",value:function updateChildren(changes,deco,oldLength){var cursor2=this.childCursor(oldLength);for(var _i66=changes.length-1;;_i66--){var next=_i66>=0?changes[_i66]:null;if(!next)break;var fromA=next.fromA,toA=next.toA,fromB=next.fromB,toB=next.toB;var _ContentBuilder$build=ContentBuilder.build(this.view.state.doc,fromB,toB,deco),content2=_ContentBuilder$build.content,breakAtStart=_ContentBuilder$build.breakAtStart,openStart=_ContentBuilder$build.openStart,openEnd=_ContentBuilder$build.openEnd;var _cursor2$findPos=cursor2.findPos(toA,1),toI=_cursor2$findPos.i,toOff=_cursor2$findPos.off;var _cursor2$findPos2=cursor2.findPos(fromA,-1),fromI=_cursor2$findPos2.i,fromOff=_cursor2$findPos2.off;this.replaceRange(fromI,fromOff,toI,toOff,content2,breakAtStart,openStart,openEnd);}}},{key:"replaceRange",value:function replaceRange(fromI,fromOff,toI,toOff,content2,breakAtStart,openStart,openEnd){var before=this.children[fromI],last=content2.length?content2[content2.length-1]:null;var breakAtEnd=last?last.breakAfter:breakAtStart;if(fromI==toI&&!breakAtStart&&!breakAtEnd&&content2.length<2&&before.merge(fromOff,toOff,content2.length?last:null,fromOff==0,openStart,openEnd))return;var after=this.children[toI];if(toOff<after.length){if(fromI==toI){after=after.split(toOff);toOff=0;}if(!breakAtEnd&&last&&after.merge(0,toOff,last,true,0,openEnd)){content2[content2.length-1]=after;}else{if(toOff)after.merge(0,toOff,null,false,0,openEnd);content2.push(after);}}else if(after.breakAfter){if(last)last.breakAfter=1;else breakAtStart=1;}toI++;before.breakAfter=breakAtStart;if(fromOff>0){if(!breakAtStart&&content2.length&&before.merge(fromOff,before.length,content2[0],false,openStart,0)){before.breakAfter=content2.shift().breakAfter;}else if(fromOff<before.length||before.children.length&&before.children[before.children.length-1].length==0){before.merge(fromOff,before.length,null,false,openStart,0);}fromI++;}while(fromI<toI&&content2.length){if(this.children[toI-1].match(content2[content2.length-1]))toI--,content2.pop();else if(this.children[fromI].match(content2[0]))fromI++,content2.shift();else break;}if(fromI<toI||content2.length)this.replaceChildren(fromI,toI,content2);}},{key:"updateSelection",value:function updateSelection(){var _this20=this;var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var fromPointer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!(fromPointer||this.mayControlSelection())||browser.ios&&this.view.inputState.rapidCompositionStart)return;var main=this.view.state.selection.main;var anchor=this.domAtPos(main.anchor);var head=main.empty?anchor:this.domAtPos(main.head);if(browser.gecko&&main.empty&&betweenUneditable(anchor)){var dummy=document.createTextNode("");this.view.observer.ignore(function(){return anchor.node.insertBefore(dummy,anchor.node.childNodes[anchor.offset]||null);});anchor=head=new DOMPos(dummy,0);force=true;}var domSel=this.view.observer.selectionRange;if(force||!domSel.focusNode||!isEquivalentPosition(anchor.node,anchor.offset,domSel.anchorNode,domSel.anchorOffset)||!isEquivalentPosition(head.node,head.offset,domSel.focusNode,domSel.focusOffset)){this.view.observer.ignore(function(){if(browser.android&&browser.chrome&&_this20.dom.contains(domSel.focusNode)&&inUneditable(domSel.focusNode,_this20.dom)){_this20.dom.blur();_this20.dom.focus({preventScroll:true});}var rawSel=getSelection(_this20.root);if(main.empty){if(browser.gecko){var nextTo=nextToUneditable(anchor.node,anchor.offset);if(nextTo&&nextTo!=(1|2)){var _text3=nearbyTextNode(anchor.node,anchor.offset,nextTo==1?1:-1);if(_text3)anchor=new DOMPos(_text3,nextTo==1?0:_text3.nodeValue.length);}}rawSel.collapse(anchor.node,anchor.offset);if(main.bidiLevel!=null&&domSel.cursorBidiLevel!=null)domSel.cursorBidiLevel=main.bidiLevel;}else if(rawSel.extend){rawSel.collapse(anchor.node,anchor.offset);rawSel.extend(head.node,head.offset);}else{var range=document.createRange();if(main.anchor>main.head){var _ref8=[head,anchor];anchor=_ref8[0];head=_ref8[1];}range.setEnd(head.node,head.offset);range.setStart(anchor.node,anchor.offset);rawSel.removeAllRanges();rawSel.addRange(range);}});this.view.observer.setSelectionRange(anchor,head);}this.impreciseAnchor=anchor.precise?null:new DOMPos(domSel.anchorNode,domSel.anchorOffset);this.impreciseHead=head.precise?null:new DOMPos(domSel.focusNode,domSel.focusOffset);}},{key:"enforceCursorAssoc",value:function enforceCursorAssoc(){if(this.view.composing)return;var cursor2=this.view.state.selection.main;var sel=getSelection(this.root);if(!cursor2.empty||!cursor2.assoc||!sel.modify)return;var line=LineView.find(this,cursor2.head);if(!line)return;var lineStart=line.posAtStart;if(cursor2.head==lineStart||cursor2.head==lineStart+line.length)return;var before=this.coordsAt(cursor2.head,-1),after=this.coordsAt(cursor2.head,1);if(!before||!after||before.bottom>after.top)return;var dom=this.domAtPos(cursor2.head+cursor2.assoc);sel.collapse(dom.node,dom.offset);sel.modify("move",cursor2.assoc<0?"forward":"backward","lineboundary");}},{key:"mayControlSelection",value:function mayControlSelection(){return this.view.state.facet(editable)?this.root.activeElement==this.dom:hasSelection(this.dom,this.view.observer.selectionRange);}},{key:"nearest",value:function nearest(dom){for(var cur2=dom;cur2;){var domView=ContentView.get(cur2);if(domView&&domView.rootView==this)return domView;cur2=cur2.parentNode;}return null;}},{key:"posFromDOM",value:function posFromDOM(node,offset){var view=this.nearest(node);if(!view)throw new RangeError("Trying to find position for a DOM position outside of the document");return view.localPosFromDOM(node,offset)+view.posAtStart;}},{key:"domAtPos",value:function domAtPos(pos){var _this$childCursor$fin=this.childCursor().findPos(pos,-1),i=_this$childCursor$fin.i,off=_this$childCursor$fin.off;for(;i<this.children.length-1;){var child=this.children[i];if(off<child.length||child instanceof LineView)break;i++;off=0;}return this.children[i].domAtPos(off);}},{key:"coordsAt",value:function coordsAt(pos,side){for(var off=this.length,_i67=this.children.length-1;;_i67--){var child=this.children[_i67],start=off-child.breakAfter-child.length;if(pos>start||pos==start&&child.type!=BlockType.WidgetBefore&&child.type!=BlockType.WidgetAfter&&(!_i67||side==2||this.children[_i67-1].breakAfter||this.children[_i67-1].type==BlockType.WidgetBefore&&side>-2))return child.coordsAt(pos-start,side);off=start;}}},{key:"measureVisibleLineHeights",value:function measureVisibleLineHeights(){var result=[],_this$view$viewState$=this.view.viewState.viewport,from=_this$view$viewState$.from,to=_this$view$viewState$.to;var minWidth=Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;for(var pos=0,_i68=0;_i68<this.children.length;_i68++){var child=this.children[_i68],end=pos+child.length;if(end>to)break;if(pos>=from){result.push(child.dom.getBoundingClientRect().height);var width=child.dom.scrollWidth;if(width>minWidth){this.minWidth=minWidth=width;this.minWidthFrom=pos;this.minWidthTo=end;}}pos=end+child.breakAfter;}return result;}},{key:"measureTextSize",value:function measureTextSize(){var _this21=this;var _iterator44=_createForOfIteratorHelper(this.children),_step44;try{for(_iterator44.s();!(_step44=_iterator44.n()).done;){var child=_step44.value;if(child instanceof LineView){var measure=child.measureTextSize();if(measure)return measure;}}}catch(err){_iterator44.e(err);}finally{_iterator44.f();}var dummy=document.createElement("div"),lineHeight,charWidth;dummy.className="cm-line";dummy.textContent="abc def ghi jkl mno pqr stu";this.view.observer.ignore(function(){_this21.dom.appendChild(dummy);var rect=clientRectsFor(dummy.firstChild)[0];lineHeight=dummy.getBoundingClientRect().height;charWidth=rect?rect.width/27:7;dummy.remove();});return{lineHeight:lineHeight,charWidth:charWidth};}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;var i=this.children.length;if(i)pos-=this.children[--i].length;return new ChildCursor(this.children,pos,i);}},{key:"computeBlockGapDeco",value:function computeBlockGapDeco(){var deco=[],vs=this.view.viewState;for(var pos=0,_i69=0;;_i69++){var next=_i69==vs.viewports.length?null:vs.viewports[_i69];var end=next?next.from-1:this.length;if(end>pos){var height=vs.lineAt(end,0).bottom-vs.lineAt(pos,0).top;deco.push(Decoration.replace({widget:new BlockGapWidget(height),block:true,inclusive:true}).range(pos,end));}if(!next)break;pos=next.to+1;}return Decoration.set(deco);}},{key:"updateDeco",value:function updateDeco(){return this.decorations=[].concat(_toConsumableArray(this.view.pluginField(PluginField.decorations)),_toConsumableArray(this.view.state.facet(decorations)),[this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]);}},{key:"scrollIntoView",value:function scrollIntoView(_ref9){var range=_ref9.range,center=_ref9.center;var rect=this.coordsAt(range.head,range.empty?range.assoc:range.head>range.anchor?-1:1),other;if(!rect)return;if(!range.empty&&(other=this.coordsAt(range.anchor,range.anchor>range.head?-1:1)))rect={left:Math.min(rect.left,other.left),top:Math.min(rect.top,other.top),right:Math.max(rect.right,other.right),bottom:Math.max(rect.bottom,other.bottom)};var mLeft=0,mRight=0,mTop=0,mBottom=0;var _iterator45=_createForOfIteratorHelper(this.view.pluginField(PluginField.scrollMargins)),_step45;try{for(_iterator45.s();!(_step45=_iterator45.n()).done;){var margins=_step45.value;if(margins){var left=margins.left,right=margins.right,top2=margins.top,bottom=margins.bottom;if(left!=null)mLeft=Math.max(mLeft,left);if(right!=null)mRight=Math.max(mRight,right);if(top2!=null)mTop=Math.max(mTop,top2);if(bottom!=null)mBottom=Math.max(mBottom,bottom);}}}catch(err){_iterator45.e(err);}finally{_iterator45.f();}scrollRectIntoView(this.view.scrollDOM,{left:rect.left-mLeft,top:rect.top-mTop,right:rect.right+mRight,bottom:rect.bottom+mBottom},range.head<range.anchor?-1:1,center);}}]);return DocView;}(ContentView);function betweenUneditable(pos){return pos.node.nodeType==1&&pos.node.firstChild&&(pos.offset==0||pos.node.childNodes[pos.offset-1].contentEditable=="false")&&(pos.offset==pos.node.childNodes.length||pos.node.childNodes[pos.offset].contentEditable=="false");}var BlockGapWidget=/*#__PURE__*/function(_WidgetType2){_inherits(BlockGapWidget,_WidgetType2);var _super18=_createSuper(BlockGapWidget);function BlockGapWidget(height){var _this22;_classCallCheck(this,BlockGapWidget);_this22=_super18.call(this);_this22.height=height;return _this22;}_createClass(BlockGapWidget,[{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");this.updateDOM(elt);return elt;}},{key:"eq",value:function eq(other){return other.height==this.height;}},{key:"updateDOM",value:function updateDOM(elt){elt.style.height=this.height+"px";return true;}},{key:"estimatedHeight",get:function get(){return this.height;}}]);return BlockGapWidget;}(WidgetType);function computeCompositionDeco(view,changes){var sel=view.observer.selectionRange;var textNode=sel.focusNode&&nearbyTextNode(sel.focusNode,sel.focusOffset,0);if(!textNode)return Decoration.none;var cView=view.docView.nearest(textNode);var from,to,topNode=textNode;if(cView instanceof InlineView){while(cView.parent instanceof InlineView){cView=cView.parent;}from=cView.posAtStart;to=from+cView.length;topNode=cView.dom;}else if(cView instanceof LineView){while(topNode.parentNode!=cView.dom){topNode=topNode.parentNode;}var prev=topNode.previousSibling;while(prev&&!ContentView.get(prev)){prev=prev.previousSibling;}from=to=prev?ContentView.get(prev).posAtEnd:cView.posAtStart;}else{return Decoration.none;}var newFrom=changes.mapPos(from,1),newTo=Math.max(newFrom,changes.mapPos(to,-1));var text=textNode.nodeValue,state=view.state;if(newTo-newFrom<text.length){if(state.sliceDoc(newFrom,Math.min(state.doc.length,newFrom+text.length))==text)newTo=newFrom+text.length;else if(state.sliceDoc(Math.max(0,newTo-text.length),newTo)==text)newFrom=newTo-text.length;else return Decoration.none;}else if(state.sliceDoc(newFrom,newTo)!=text){return Decoration.none;}return Decoration.set(Decoration.replace({widget:new CompositionWidget(topNode,textNode)}).range(newFrom,newTo));}var CompositionWidget=/*#__PURE__*/function(_WidgetType3){_inherits(CompositionWidget,_WidgetType3);var _super19=_createSuper(CompositionWidget);function CompositionWidget(top2,text){var _this23;_classCallCheck(this,CompositionWidget);_this23=_super19.call(this);_this23.top=top2;_this23.text=text;return _this23;}_createClass(CompositionWidget,[{key:"eq",value:function eq(other){return this.top==other.top&&this.text==other.text;}},{key:"toDOM",value:function toDOM(){return this.top;}},{key:"ignoreEvent",value:function ignoreEvent(){return false;}},{key:"customView",get:function get(){return CompositionView;}}]);return CompositionWidget;}(WidgetType);function nearbyTextNode(node,offset,side){for(;;){if(node.nodeType==3)return node;if(node.nodeType==1&&offset>0&&side<=0){node=node.childNodes[offset-1];offset=maxOffset(node);}else if(node.nodeType==1&&offset<node.childNodes.length&&side>=0){node=node.childNodes[offset];offset=0;}else{return null;}}}function nextToUneditable(node,offset){if(node.nodeType!=1)return 0;return(offset&&node.childNodes[offset-1].contentEditable=="false"?1:0)|(offset<node.childNodes.length&&node.childNodes[offset].contentEditable=="false"?2:0);}var DecorationComparator$1=/*#__PURE__*/function(){function DecorationComparator$1(){_classCallCheck(this,DecorationComparator$1);this.changes=[];}_createClass(DecorationComparator$1,[{key:"compareRange",value:function compareRange(from,to){addRange(from,to,this.changes);}},{key:"comparePoint",value:function comparePoint(from,to){addRange(from,to,this.changes);}}]);return DecorationComparator$1;}();function findChangedDeco(a,b,diff){var comp=new DecorationComparator$1();RangeSet.compare(a,b,diff,comp);return comp.changes;}function inUneditable(node,inside6){for(var cur2=node;cur2&&cur2!=inside6;cur2=cur2.assignedSlot||cur2.parentNode){if(cur2.nodeType==1&&cur2.contentEditable=="false"){return true;}}return false;}var Direction=/* @__PURE__ */function(Direction6){Direction6[Direction6["LTR"]=0]="LTR";Direction6[Direction6["RTL"]=1]="RTL";return Direction6;}(Direction||(Direction={}));var LTR=Direction.LTR;var RTL=Direction.RTL;function dec(str){var result=[];for(var _i70=0;_i70<str.length;_i70++){result.push(1<<+str[_i70]);}return result;}var LowTypes=/* @__PURE__ */dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");var ArabicTypes=/* @__PURE__ */dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");var Brackets=/* @__PURE__ */Object.create(null);var BracketStack=[];for(var _i71=0,_arr2=["()","[]","{}"];_i71<_arr2.length;_i71++){var p=_arr2[_i71];var l=/* @__PURE__ */p.charCodeAt(0),r=/* @__PURE__ */p.charCodeAt(1);Brackets[l]=r;Brackets[r]=-l;}function charType(ch){return ch<=247?LowTypes[ch]:1424<=ch&&ch<=1524?2:1536<=ch&&ch<=1785?ArabicTypes[ch-1536]:1774<=ch&&ch<=2220?4:8192<=ch&&ch<=8203?256:ch==8204?256:1;}var BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var BidiSpan=/*#__PURE__*/function(){function BidiSpan(from,to,level){_classCallCheck(this,BidiSpan);this.from=from;this.to=to;this.level=level;}_createClass(BidiSpan,[{key:"dir",get:function get(){return this.level%2?RTL:LTR;}},{key:"side",value:function side(end,dir){return this.dir==dir==end?this.to:this.from;}}],[{key:"find",value:function find(order,index,level,assoc){var maybe=-1;for(var _i72=0;_i72<order.length;_i72++){var span=order[_i72];if(span.from<=index&&span.to>=index){if(span.level==level)return _i72;if(maybe<0||(assoc!=0?assoc<0?span.from<index:span.to>index:order[maybe].level>span.level))maybe=_i72;}}if(maybe<0)throw new RangeError("Index out of range");return maybe;}}]);return BidiSpan;}();var types=[];function computeOrder(line,direction){var len=line.length,outerType=direction==LTR?1:2,oppositeType=direction==LTR?2:1;if(!line||outerType==1&&!BidiRE.test(line))return trivialOrder(len);for(var _i73=0,prev=outerType,prevStrong=outerType;_i73<len;_i73++){var type=charType(line.charCodeAt(_i73));if(type==512)type=prev;else if(type==8&&prevStrong==4)type=16;types[_i73]=type==4?2:type;if(type&7)prevStrong=type;prev=type;}for(var _i74=0,_prev=outerType,_prevStrong=outerType;_i74<len;_i74++){var _type2=types[_i74];if(_type2==128){if(_i74<len-1&&_prev==types[_i74+1]&&_prev&24)_type2=types[_i74]=_prev;else types[_i74]=256;}else if(_type2==64){var end=_i74+1;while(end<len&&types[end]==64){end++;}var replace=_i74&&_prev==8||end<len&&types[end]==8?_prevStrong==1?1:8:256;for(var j=_i74;j<end;j++){types[j]=replace;}_i74=end-1;}else if(_type2==8&&_prevStrong==1){types[_i74]=1;}_prev=_type2;if(_type2&7)_prevStrong=_type2;}for(var _i75=0,sI=0,context=0,ch,br,_type3;_i75<len;_i75++){if(br=Brackets[ch=line.charCodeAt(_i75)]){if(br<0){for(var sJ=sI-3;sJ>=0;sJ-=3){if(BracketStack[sJ+1]==-br){var flags=BracketStack[sJ+2];var type2=flags&2?outerType:!(flags&4)?0:flags&1?oppositeType:outerType;if(type2)types[_i75]=types[BracketStack[sJ]]=type2;sI=sJ;break;}}}else if(BracketStack.length==189){break;}else{BracketStack[sI++]=_i75;BracketStack[sI++]=ch;BracketStack[sI++]=context;}}else if((_type3=types[_i75])==2||_type3==1){var embed=_type3==outerType;context=embed?0:1;for(var _sJ=sI-3;_sJ>=0;_sJ-=3){var cur2=BracketStack[_sJ+2];if(cur2&2)break;if(embed){BracketStack[_sJ+2]|=2;}else{if(cur2&4)break;BracketStack[_sJ+2]|=4;}}}}for(var _i76=0;_i76<len;_i76++){if(types[_i76]==256){var _end3=_i76+1;while(_end3<len&&types[_end3]==256){_end3++;}var beforeL=(_i76?types[_i76-1]:outerType)==1;var afterL=(_end3<len?types[_end3]:outerType)==1;var _replace=beforeL==afterL?beforeL?1:2:outerType;for(var _j=_i76;_j<_end3;_j++){types[_j]=_replace;}_i76=_end3-1;}}var order=[];if(outerType==1){for(var _i77=0;_i77<len;){var start=_i77,rtl=types[_i77++]!=1;while(_i77<len&&rtl==(types[_i77]!=1)){_i77++;}if(rtl){for(var _j2=_i77;_j2>start;){var _end4=_j2,_l=types[--_j2]!=2;while(_j2>start&&_l==(types[_j2-1]!=2)){_j2--;}order.push(new BidiSpan(_j2,_end4,_l?2:1));}}else{order.push(new BidiSpan(start,_i77,0));}}}else{for(var _i78=0;_i78<len;){var _start4=_i78,_rtl=types[_i78++]==2;while(_i78<len&&_rtl==(types[_i78]==2)){_i78++;}order.push(new BidiSpan(_start4,_i78,_rtl?1:2));}}return order;}function trivialOrder(length){return[new BidiSpan(0,length,0)];}var movedOver="";function moveVisually(line,order,dir,start,forward){var _a;var startIndex=start.head-line.from,spanI=-1;if(startIndex==0){if(!forward||!line.length)return null;if(order[0].level!=dir){startIndex=order[0].side(false,dir);spanI=0;}}else if(startIndex==line.length){if(forward)return null;var last=order[order.length-1];if(last.level!=dir){startIndex=last.side(true,dir);spanI=order.length-1;}}if(spanI<0)spanI=BidiSpan.find(order,startIndex,(_a=start.bidiLevel)!==null&&_a!==void 0?_a:-1,start.assoc);var span=order[spanI];if(startIndex==span.side(forward,dir)){span=order[spanI+=forward?1:-1];startIndex=span.side(!forward,dir);}var indexForward=forward==(span.dir==dir);var nextIndex=findClusterBreak(line.text,startIndex,indexForward);movedOver=line.text.slice(Math.min(startIndex,nextIndex),Math.max(startIndex,nextIndex));if(nextIndex!=span.side(forward,dir))return EditorSelection.cursor(nextIndex+line.from,indexForward?-1:1,span.level);var nextSpan=spanI==(forward?order.length-1:0)?null:order[spanI+(forward?1:-1)];if(!nextSpan&&span.level!=dir)return EditorSelection.cursor(forward?line.to:line.from,forward?-1:1,dir);if(nextSpan&&nextSpan.level<span.level)return EditorSelection.cursor(nextSpan.side(!forward,dir)+line.from,forward?1:-1,nextSpan.level);return EditorSelection.cursor(nextIndex+line.from,forward?-1:1,span.level);}function groupAt(state,pos){var bias=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var categorize=state.charCategorizer(pos);var line=state.doc.lineAt(pos),linePos=pos-line.from;if(line.length==0)return EditorSelection.cursor(pos);if(linePos==0)bias=1;else if(linePos==line.length)bias=-1;var from=linePos,to=linePos;if(bias<0)from=findClusterBreak(line.text,linePos,false);else to=findClusterBreak(line.text,linePos);var cat=categorize(line.text.slice(from,to));while(from>0){var prev=findClusterBreak(line.text,from,false);if(categorize(line.text.slice(prev,from))!=cat)break;from=prev;}while(to<line.length){var next=findClusterBreak(line.text,to);if(categorize(line.text.slice(to,next))!=cat)break;to=next;}return EditorSelection.range(from+line.from,to+line.from);}function getdx(x,rect){return rect.left>x?rect.left-x:Math.max(0,x-rect.right);}function getdy(y,rect){return rect.top>y?rect.top-y:Math.max(0,y-rect.bottom);}function yOverlap(a,b){return a.top<b.bottom-1&&a.bottom>b.top+1;}function upTop(rect,top2){return top2<rect.top?{top:top2,left:rect.left,right:rect.right,bottom:rect.bottom}:rect;}function upBot(rect,bottom){return bottom>rect.bottom?{top:rect.top,left:rect.left,right:rect.right,bottom:bottom}:rect;}function domPosAtCoords(parent,x,y){var closest,closestRect,closestX,closestY;var above,below,aboveRect,belowRect;for(var child=parent.firstChild;child;child=child.nextSibling){var rects=clientRectsFor(child);for(var _i79=0;_i79<rects.length;_i79++){var rect=rects[_i79];if(closestRect&&yOverlap(closestRect,rect))rect=upTop(upBot(rect,closestRect.bottom),closestRect.top);var dx=getdx(x,rect),dy=getdy(y,rect);if(dx==0&&dy==0)return child.nodeType==3?domPosInText(child,x,y):domPosAtCoords(child,x,y);if(!closest||closestY>dy||closestY==dy&&closestX>dx){closest=child;closestRect=rect;closestX=dx;closestY=dy;}if(dx==0){if(y>rect.bottom&&(!aboveRect||aboveRect.bottom<rect.bottom)){above=child;aboveRect=rect;}else if(y<rect.top&&(!belowRect||belowRect.top>rect.top)){below=child;belowRect=rect;}}else if(aboveRect&&yOverlap(aboveRect,rect)){aboveRect=upBot(aboveRect,rect.bottom);}else if(belowRect&&yOverlap(belowRect,rect)){belowRect=upTop(belowRect,rect.top);}}}if(aboveRect&&aboveRect.bottom>=y){closest=above;closestRect=aboveRect;}else if(belowRect&&belowRect.top<=y){closest=below;closestRect=belowRect;}if(!closest)return{node:parent,offset:0};var clipX=Math.max(closestRect.left,Math.min(closestRect.right,x));if(closest.nodeType==3)return domPosInText(closest,clipX,y);if(!closestX&&closest.contentEditable=="true")return domPosAtCoords(closest,clipX,y);var offset=Array.prototype.indexOf.call(parent.childNodes,closest)+(x>=(closestRect.left+closestRect.right)/2?1:0);return{node:parent,offset:offset};}function domPosInText(node,x,y){var len=node.nodeValue.length;var closestOffset=-1,closestDY=1e9,generalSide=0;for(var _i80=0;_i80<len;_i80++){var rects=textRange(node,_i80,_i80+1).getClientRects();for(var j=0;j<rects.length;j++){var rect=rects[j];if(rect.top==rect.bottom)continue;if(!generalSide)generalSide=x-rect.left;var dy=(rect.top>y?rect.top-y:y-rect.bottom)-1;if(rect.left-1<=x&&rect.right+1>=x&&dy<closestDY){var right=x>=(rect.left+rect.right)/2,after=right;if(browser.chrome||browser.gecko){var rectBefore=textRange(node,_i80).getBoundingClientRect();if(rectBefore.left==rect.right)after=!right;}if(dy<=0)return{node:node,offset:_i80+(after?1:0)};closestOffset=_i80+(after?1:0);closestDY=dy;}}}return{node:node,offset:closestOffset>-1?closestOffset:generalSide>0?node.nodeValue.length:0};}function _posAtCoords(view,_ref10,precise){var x=_ref10.x,y=_ref10.y;var bias=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var _a;var content2=view.contentDOM.getBoundingClientRect(),block;var halfLine=view.defaultLineHeight/2;for(var bounced=false;;){block=view.blockAtHeight(y,content2.top);if(block.top>y||block.bottom<y){bias=block.top>y?-1:1;y=Math.min(block.bottom-halfLine,Math.max(block.top+halfLine,y));if(bounced)return precise?null:0;else bounced=true;}if(block.type==BlockType.Text)break;y=bias>0?block.bottom+halfLine:block.top-halfLine;}var lineStart=block.from;x=Math.max(content2.left+1,Math.min(content2.right-1,x));if(lineStart<view.viewport.from)return view.viewport.from==0?0:posAtCoordsImprecise(view,content2,block,x,y);if(lineStart>view.viewport.to)return view.viewport.to==view.state.doc.length?view.state.doc.length:posAtCoordsImprecise(view,content2,block,x,y);var doc6=view.dom.ownerDocument;var element=(view.root.elementFromPoint?view.root:doc6).elementFromPoint(x,y);var node,offset=-1;if(element&&view.contentDOM.contains(element)&&((_a=view.docView.nearest(element))===null||_a===void 0?void 0:_a.isEditable)!=false){if(doc6.caretPositionFromPoint){var pos=doc6.caretPositionFromPoint(x,y);if(pos){node=pos.offsetNode;offset=pos.offset;}}else if(doc6.caretRangeFromPoint){var range=doc6.caretRangeFromPoint(x,y);if(range){node=range.startContainer;offset=range.startOffset;if(browser.safari&&isSuspiciousCaretResult(node,offset,x))node=void 0;}}}if(!node||!view.docView.dom.contains(node)){var line=LineView.find(view.docView,lineStart);var _domPosAtCoords=domPosAtCoords(line.dom,x,y);node=_domPosAtCoords.node;offset=_domPosAtCoords.offset;}return view.docView.posFromDOM(node,offset);}function posAtCoordsImprecise(view,contentRect,block,x,y){var into=Math.round((x-contentRect.left)*view.defaultCharacterWidth);if(view.lineWrapping&&block.height>view.defaultLineHeight*1.5){var line=Math.floor((y-block.top)/view.defaultLineHeight);into+=line*view.viewState.heightOracle.lineLength;}var content2=view.state.sliceDoc(block.from,block.to);return block.from+findColumn(content2,into,view.state.tabSize);}function isSuspiciousCaretResult(node,offset,x){var len;if(node.nodeType!=3||offset!=(len=node.nodeValue.length))return false;for(var next=node.nextSibling;next;next=next.nextSibling){if(next.nodeType!=1||next.nodeName!="BR")return false;}return textRange(node,len-1,len).getBoundingClientRect().left>x;}function _moveToLineBoundary(view,start,forward,includeWrap){var line=view.state.doc.lineAt(start.head);var coords=!includeWrap||!view.lineWrapping?null:view.coordsAtPos(start.assoc<0&&start.head>line.from?start.head-1:start.head);if(coords){var editorRect=view.dom.getBoundingClientRect();var pos=view.posAtCoords({x:forward==(view.textDirection==Direction.LTR)?editorRect.right-1:editorRect.left+1,y:(coords.top+coords.bottom)/2});if(pos!=null)return EditorSelection.cursor(pos,forward?-1:1);}var lineView=LineView.find(view.docView,start.head);var end=lineView?forward?lineView.posAtEnd:lineView.posAtStart:forward?line.to:line.from;return EditorSelection.cursor(end,forward?-1:1);}function _moveByChar(view,start,forward,by){var line=view.state.doc.lineAt(start.head),spans=view.bidiSpans(line);for(var cur2=start,check=null;;){var next=moveVisually(line,spans,view.textDirection,cur2,forward),_char2=movedOver;if(!next){if(line.number==(forward?view.state.doc.lines:1))return cur2;_char2="\n";line=view.state.doc.line(line.number+(forward?1:-1));spans=view.bidiSpans(line);next=EditorSelection.cursor(forward?line.from:line.to);}if(!check){if(!by)return next;check=by(_char2);}else if(!check(_char2)){return cur2;}cur2=next;}}function byGroup(view,pos,start){var categorize=view.state.charCategorizer(pos);var cat=categorize(start);return function(next){var nextCat=categorize(next);if(cat==CharCategory.Space)cat=nextCat;return cat==nextCat;};}function _moveVertically(view,start,forward,distance){var startPos=start.head,dir=forward?1:-1;if(startPos==(forward?view.state.doc.length:0))return EditorSelection.cursor(startPos);var goal=start.goalColumn,startY;var rect=view.contentDOM.getBoundingClientRect();var startCoords=view.coordsAtPos(startPos);if(startCoords){if(goal==null)goal=startCoords.left-rect.left;startY=dir<0?startCoords.top:startCoords.bottom;}else{var line=view.viewState.lineAt(startPos,view.dom.getBoundingClientRect().top);if(goal==null)goal=Math.min(rect.right-rect.left,view.defaultCharacterWidth*(startPos-line.from));startY=dir<0?line.top:line.bottom;}var resolvedGoal=rect.left+goal;var dist=distance!==null&&distance!==void 0?distance:view.defaultLineHeight>>1;for(var extra=0;;extra+=10){var curY=startY+(dist+extra)*dir;var pos=_posAtCoords(view,{x:resolvedGoal,y:curY},false,dir);if(curY<rect.top||curY>rect.bottom||(dir<0?pos<startPos:pos>startPos))return EditorSelection.cursor(pos,void 0,void 0,goal);}}function skipAtoms(view,oldPos,pos){var atoms=view.pluginField(PluginField.atomicRanges);for(;;){var moved=false;var _iterator46=_createForOfIteratorHelper(atoms),_step46;try{for(_iterator46.s();!(_step46=_iterator46.n()).done;){var set=_step46.value;set.between(pos.from-1,pos.from+1,function(from,to,value){if(pos.from>from&&pos.from<to){pos=oldPos.from>pos.from?EditorSelection.cursor(from,1):EditorSelection.cursor(to,-1);moved=true;}});}}catch(err){_iterator46.e(err);}finally{_iterator46.f();}if(!moved)return pos;}}var InputState=/*#__PURE__*/function(){function InputState(view){var _this24=this;_classCallCheck(this,InputState);this.lastKeyCode=0;this.lastKeyTime=0;this.pendingAndroidKey=void 0;this.pendingIOSKey=void 0;this.lastSelectionOrigin=null;this.lastSelectionTime=0;this.lastEscPress=0;this.lastContextMenu=0;this.scrollHandlers=[];this.registeredEvents=[];this.customHandlers=[];this.composing=-1;this.compositionFirstChange=null;this.compositionEndedAt=0;this.rapidCompositionStart=false;this.mouseSelection=null;var _loop5=function _loop5(type){var handler=handlers[type];view.contentDOM.addEventListener(type,function(event){if(type=="keydown"&&_this24.keydown(view,event))return;if(!eventBelongsToEditor(view,event)||_this24.ignoreDuringComposition(event))return;if(_this24.mustFlushObserver(event))view.observer.forceFlush();if(_this24.runCustomHandlers(type,view,event))event.preventDefault();else handler(view,event);});_this24.registeredEvents.push(type);};for(var type in handlers){_loop5(type);}this.notifiedFocused=view.hasFocus;this.ensureHandlers(view);if(browser.safari)view.contentDOM.addEventListener("input",function(){return null;});}_createClass(InputState,[{key:"setSelectionOrigin",value:function setSelectionOrigin(origin){this.lastSelectionOrigin=origin;this.lastSelectionTime=Date.now();}},{key:"ensureHandlers",value:function ensureHandlers(view){var _this25=this;var handlers6=this.customHandlers=view.pluginField(domEventHandlers);var _iterator47=_createForOfIteratorHelper(handlers6),_step47;try{for(_iterator47.s();!(_step47=_iterator47.n()).done;){var set=_step47.value;var _loop6=function _loop6(type){if(_this25.registeredEvents.indexOf(type)<0&&type!="scroll"){_this25.registeredEvents.push(type);view.contentDOM.addEventListener(type,function(event){if(!eventBelongsToEditor(view,event))return;if(_this25.runCustomHandlers(type,view,event))event.preventDefault();});}};for(var type in set.handlers){_loop6(type);}}}catch(err){_iterator47.e(err);}finally{_iterator47.f();}}},{key:"runCustomHandlers",value:function runCustomHandlers(type,view,event){var _iterator48=_createForOfIteratorHelper(this.customHandlers),_step48;try{for(_iterator48.s();!(_step48=_iterator48.n()).done;){var set=_step48.value;var handler=set.handlers[type],handled=false;if(handler){try{handled=handler.call(set.plugin,event,view);}catch(e){logException(view.state,e);}if(handled||event.defaultPrevented){if(browser.android&&type=="keydown"&&event.keyCode==13)view.observer.flushSoon();return true;}}}}catch(err){_iterator48.e(err);}finally{_iterator48.f();}return false;}},{key:"runScrollHandlers",value:function runScrollHandlers(view,event){var _iterator49=_createForOfIteratorHelper(this.customHandlers),_step49;try{for(_iterator49.s();!(_step49=_iterator49.n()).done;){var set=_step49.value;var handler=set.handlers.scroll;if(handler){try{handler.call(set.plugin,event,view);}catch(e){logException(view.state,e);}}}}catch(err){_iterator49.e(err);}finally{_iterator49.f();}}},{key:"keydown",value:function keydown(view,event){var _this26=this;this.lastKeyCode=event.keyCode;this.lastKeyTime=Date.now();if(this.screenKeyEvent(view,event))return true;var pending;if(browser.ios&&(pending=PendingKeys.find(function(key){return key.keyCode==event.keyCode;}))&&!(event.ctrlKey||event.altKey||event.metaKey)&&!event.synthetic){this.pendingIOSKey=pending;setTimeout(function(){return _this26.flushIOSKey(view);},250);return true;}return false;}},{key:"flushIOSKey",value:function flushIOSKey(view){var key=this.pendingIOSKey;if(!key)return false;this.pendingIOSKey=void 0;return dispatchKey(view.contentDOM,key.key,key.keyCode);}},{key:"setPendingAndroidKey",value:function setPendingAndroidKey(view,pending){var _this27=this;this.pendingAndroidKey=pending;requestAnimationFrame(function(){var key=_this27.pendingAndroidKey;if(!key)return;_this27.pendingAndroidKey=void 0;view.observer.processRecords();var startState=view.state;dispatchKey(view.contentDOM,key.key,key.keyCode);if(view.state==startState)view.docView.reset(true);});}},{key:"ignoreDuringComposition",value:function ignoreDuringComposition(event){if(!/^key/.test(event.type))return false;if(this.composing>0)return true;if(browser.safari&&Date.now()-this.compositionEndedAt<500){this.compositionEndedAt=0;return true;}return false;}},{key:"screenKeyEvent",value:function screenKeyEvent(view,event){var protectedTab=event.keyCode==9&&Date.now()<this.lastEscPress+2e3;if(event.keyCode==27)this.lastEscPress=Date.now();else if(modifierCodes.indexOf(event.keyCode)<0)this.lastEscPress=0;return protectedTab;}},{key:"mustFlushObserver",value:function mustFlushObserver(event){return event.type=="keydown"&&event.keyCode!=229||event.type=="compositionend"&&!browser.ios;}},{key:"startMouseSelection",value:function startMouseSelection(view,event,style){if(this.mouseSelection)this.mouseSelection.destroy();this.mouseSelection=new MouseSelection(this,view,event,style);}},{key:"update",value:function update(_update2){if(this.mouseSelection)this.mouseSelection.update(_update2);if(_update2.transactions.length)this.lastKeyCode=this.lastSelectionTime=0;}},{key:"destroy",value:function destroy(){if(this.mouseSelection)this.mouseSelection.destroy();}}]);return InputState;}();var PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}];var modifierCodes=[16,17,18,20,91,92,224,225];var MouseSelection=/*#__PURE__*/function(){function MouseSelection(inputState,view,startEvent,style){_classCallCheck(this,MouseSelection);this.inputState=inputState;this.view=view;this.style=style;this.lastEvent=startEvent;var doc6=view.contentDOM.ownerDocument;doc6.addEventListener("mousemove",this.move=this.move.bind(this));doc6.addEventListener("mouseup",this.up=this.up.bind(this));this.extend=startEvent.shiftKey;this.multiple=view.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(view,startEvent);this.dragMove=dragMovesSelection(view,startEvent);this.dragging=isInPrimarySelection(view,startEvent)?null:false;if(this.dragging===false){startEvent.preventDefault();this.select(startEvent);}}_createClass(MouseSelection,[{key:"move",value:function move(event){if(event.buttons==0)return this.destroy();if(this.dragging!==false)return;this.select(this.lastEvent=event);}},{key:"up",value:function up(event){if(this.dragging==null)this.select(this.lastEvent);if(!this.dragging)event.preventDefault();this.destroy();}},{key:"destroy",value:function destroy(){var doc6=this.view.contentDOM.ownerDocument;doc6.removeEventListener("mousemove",this.move);doc6.removeEventListener("mouseup",this.up);this.inputState.mouseSelection=null;}},{key:"select",value:function select(event){var selection2=this.style.get(event,this.extend,this.multiple);if(!selection2.eq(this.view.state.selection)||selection2.main.assoc!=this.view.state.selection.main.assoc)this.view.dispatch({selection:selection2,userEvent:"select.pointer",scrollIntoView:true});}},{key:"update",value:function update(_update3){var _this28=this;if(_update3.docChanged&&this.dragging)this.dragging=this.dragging.map(_update3.changes);if(this.style.update(_update3))setTimeout(function(){return _this28.select(_this28.lastEvent);},20);}}]);return MouseSelection;}();function addsSelectionRange(view,event){var facet=view.state.facet(clickAddsSelectionRange);return facet.length?facet[0](event):browser.mac?event.metaKey:event.ctrlKey;}function dragMovesSelection(view,event){var facet=view.state.facet(dragMovesSelection$1);return facet.length?facet[0](event):browser.mac?!event.altKey:!event.ctrlKey;}function isInPrimarySelection(view,event){var main=view.state.selection.main;if(main.empty)return false;var sel=getSelection(view.root);if(sel.rangeCount==0)return true;var rects=sel.getRangeAt(0).getClientRects();for(var _i81=0;_i81<rects.length;_i81++){var rect=rects[_i81];if(rect.left<=event.clientX&&rect.right>=event.clientX&&rect.top<=event.clientY&&rect.bottom>=event.clientY)return true;}return false;}function eventBelongsToEditor(view,event){if(!event.bubbles)return true;if(event.defaultPrevented)return false;for(var node=event.target,cView;node!=view.contentDOM;node=node.parentNode){if(!node||node.nodeType==11||(cView=ContentView.get(node))&&cView.ignoreEvent(event))return false;}return true;}var handlers=/* @__PURE__ */Object.create(null);var brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(view){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.focus();setTimeout(function(){view.focus();target.remove();doPaste(view,target.value);},50);}function doPaste(view,input){var state=view.state,changes,i=1,text=state.toText(input);var byLine=text.lines==state.selection.ranges.length;var linewise=lastLinewiseCopy!=null&&state.selection.ranges.every(function(r){return r.empty;})&&lastLinewiseCopy==text.toString();if(linewise){var lastLine=-1;changes=state.changeByRange(function(range){var line=state.doc.lineAt(range.from);if(line.from==lastLine)return{range:range};lastLine=line.from;var insert2=state.toText((byLine?text.line(i++).text:input)+state.lineBreak);return{changes:{from:line.from,insert:insert2},range:EditorSelection.cursor(range.from+insert2.length)};});}else if(byLine){changes=state.changeByRange(function(range){var line=text.line(i++);return{changes:{from:range.from,to:range.to,insert:line.text},range:EditorSelection.cursor(range.from+line.length)};});}else{changes=state.replaceSelection(text);}view.dispatch(changes,{userEvent:"input.paste",scrollIntoView:true});}handlers.keydown=function(view,event){view.inputState.setSelectionOrigin("select");};var lastTouch=0;handlers.touchstart=function(view,e){lastTouch=Date.now();view.inputState.setSelectionOrigin("select.pointer");};handlers.touchmove=function(view){view.inputState.setSelectionOrigin("select.pointer");};handlers.mousedown=function(view,event){view.observer.flush();if(lastTouch>Date.now()-2e3)return;var style=null;var _iterator50=_createForOfIteratorHelper(view.state.facet(mouseSelectionStyle)),_step50;try{for(_iterator50.s();!(_step50=_iterator50.n()).done;){var makeStyle=_step50.value;style=makeStyle(view,event);if(style)break;}}catch(err){_iterator50.e(err);}finally{_iterator50.f();}if(!style&&event.button==0)style=basicMouseSelection(view,event);if(style){if(view.root.activeElement!=view.contentDOM)view.observer.ignore(function(){return focusPreventScroll(view.contentDOM);});view.inputState.startMouseSelection(view,event,style);}};function rangeForClick(view,pos,bias,type){if(type==1){return EditorSelection.cursor(pos,bias);}else if(type==2){return groupAt(view.state,pos,bias);}else{var visual=LineView.find(view.docView,pos),line=view.state.doc.lineAt(visual?visual.posAtEnd:pos);var from=visual?visual.posAtStart:line.from,to=visual?visual.posAtEnd:line.to;if(to<view.state.doc.length&&to==line.to)to++;return EditorSelection.range(from,to);}}var insideY=function insideY(y,rect){return y>=rect.top&&y<=rect.bottom;};var inside=function inside(x,y,rect){return insideY(y,rect)&&x>=rect.left&&x<=rect.right;};function findPositionSide(view,pos,x,y){var line=LineView.find(view.docView,pos);if(!line)return 1;var off=pos-line.posAtStart;if(off==0)return 1;if(off==line.length)return-1;var before=line.coordsAt(off,-1);if(before&&inside(x,y,before))return-1;var after=line.coordsAt(off,1);if(after&&inside(x,y,after))return 1;return before&&insideY(y,before)?-1:1;}function queryPos(view,event){var pos=view.posAtCoords({x:event.clientX,y:event.clientY},false);return{pos:pos,bias:findPositionSide(view,pos,event.clientX,event.clientY)};}var BadMouseDetail=browser.ie&&browser.ie_version<=11;var lastMouseDown=null;var lastMouseDownCount=0;var lastMouseDownTime=0;function getClickType(event){if(!BadMouseDetail)return event.detail;var last=lastMouseDown,lastTime=lastMouseDownTime;lastMouseDown=event;lastMouseDownTime=Date.now();return lastMouseDownCount=!last||lastTime>Date.now()-400&&Math.abs(last.clientX-event.clientX)<2&&Math.abs(last.clientY-event.clientY)<2?(lastMouseDownCount+1)%3:1;}function basicMouseSelection(view,event){var start=queryPos(view,event),type=getClickType(event);var startSel=view.state.selection;var last=start,lastEvent=event;return{update:function update(_update4){if(_update4.changes){if(start)start.pos=_update4.changes.mapPos(start.pos);startSel=startSel.map(_update4.changes);lastEvent=null;}},get:function get(event2,extend2,multiple){var cur2;if(lastEvent&&event2.clientX==lastEvent.clientX&&event2.clientY==lastEvent.clientY)cur2=last;else{cur2=last=queryPos(view,event2);lastEvent=event2;}if(!cur2||!start)return startSel;var range=rangeForClick(view,cur2.pos,cur2.bias,type);if(start.pos!=cur2.pos&&!extend2){var startRange=rangeForClick(view,start.pos,start.bias,type);var from=Math.min(startRange.from,range.from),to=Math.max(startRange.to,range.to);range=from<range.from?EditorSelection.range(from,to):EditorSelection.range(to,from);}if(extend2)return startSel.replaceRange(startSel.main.extend(range.from,range.to));else if(multiple)return startSel.addRange(range);else return EditorSelection.create([range]);}};}handlers.dragstart=function(view,event){var main=view.state.selection.main;var mouseSelection=view.inputState.mouseSelection;if(mouseSelection)mouseSelection.dragging=main;if(event.dataTransfer){event.dataTransfer.setData("Text",view.state.sliceDoc(main.from,main.to));event.dataTransfer.effectAllowed="copyMove";}};function dropText(view,event,text,direct){var dropPos=view.posAtCoords({x:event.clientX,y:event.clientY});if(dropPos==null||!text)return;event.preventDefault();var mouseSelection=view.inputState.mouseSelection;var del=direct&&mouseSelection&&mouseSelection.dragging&&mouseSelection.dragMove?{from:mouseSelection.dragging.from,to:mouseSelection.dragging.to}:null;var ins={from:dropPos,insert:text};var changes=view.state.changes(del?[del,ins]:ins);view.focus();view.dispatch({changes:changes,selection:{anchor:changes.mapPos(dropPos,-1),head:changes.mapPos(dropPos,1)},userEvent:del?"move.drop":"input.drop"});}handlers.drop=function(view,event){if(!event.dataTransfer)return;if(view.state.readOnly)return event.preventDefault();var files=event.dataTransfer.files;if(files&&files.length){(function(){event.preventDefault();var text=Array(files.length),read=0;var finishFile=function finishFile(){if(++read==files.length)dropText(view,event,text.filter(function(s){return s!=null;}).join(view.state.lineBreak),false);};var _loop7=function _loop7(_i82){var reader=new FileReader();reader.onerror=finishFile;reader.onload=function(){if(!/[\x00-\x08\x0e-\x1f]{2}/.test(reader.result))text[_i82]=reader.result;finishFile();};reader.readAsText(files[_i82]);};for(var _i82=0;_i82<files.length;_i82++){_loop7(_i82);}})();}else{dropText(view,event,event.dataTransfer.getData("Text"),true);}};handlers.paste=function(view,event){if(view.state.readOnly)return event.preventDefault();view.observer.flush();var data=brokenClipboardAPI?null:event.clipboardData;if(data){doPaste(view,data.getData("text/plain"));event.preventDefault();}else{capturePaste(view);}};function captureCopy(view,text){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.value=text;target.focus();target.selectionEnd=text.length;target.selectionStart=0;setTimeout(function(){target.remove();view.focus();},50);}function copiedRange(state){var content2=[],ranges=[],linewise=false;var _iterator51=_createForOfIteratorHelper(state.selection.ranges),_step51;try{for(_iterator51.s();!(_step51=_iterator51.n()).done;){var range=_step51.value;if(!range.empty){content2.push(state.sliceDoc(range.from,range.to));ranges.push(range);}}}catch(err){_iterator51.e(err);}finally{_iterator51.f();}if(!content2.length){var upto=-1;var _iterator52=_createForOfIteratorHelper(state.selection.ranges),_step52;try{for(_iterator52.s();!(_step52=_iterator52.n()).done;){var from=_step52.value.from;var line=state.doc.lineAt(from);if(line.number>upto){content2.push(line.text);ranges.push({from:line.from,to:Math.min(state.doc.length,line.to+1)});}upto=line.number;}}catch(err){_iterator52.e(err);}finally{_iterator52.f();}linewise=true;}return{text:content2.join(state.lineBreak),ranges:ranges,linewise:linewise};}var lastLinewiseCopy=null;handlers.copy=handlers.cut=function(view,event){var _copiedRange=copiedRange(view.state),text=_copiedRange.text,ranges=_copiedRange.ranges,linewise=_copiedRange.linewise;if(!text&&!linewise)return;lastLinewiseCopy=linewise?text:null;var data=brokenClipboardAPI?null:event.clipboardData;if(data){event.preventDefault();data.clearData();data.setData("text/plain",text);}else{captureCopy(view,text);}if(event.type=="cut"&&!view.state.readOnly)view.dispatch({changes:ranges,scrollIntoView:true,userEvent:"delete.cut"});};handlers.focus=handlers.blur=function(view){setTimeout(function(){if(view.hasFocus!=view.inputState.notifiedFocused)view.update([]);},10);};handlers.beforeprint=function(view){view.viewState.printing=true;view.requestMeasure();setTimeout(function(){view.viewState.printing=false;view.requestMeasure();},2e3);};function forceClearComposition(view,rapid){if(view.docView.compositionDeco.size){view.inputState.rapidCompositionStart=rapid;try{view.update([]);}finally{view.inputState.rapidCompositionStart=false;}}}handlers.compositionstart=handlers.compositionupdate=function(view){if(view.inputState.compositionFirstChange==null)view.inputState.compositionFirstChange=true;if(view.inputState.composing<0){if(view.docView.compositionDeco.size){view.observer.flush();forceClearComposition(view,true);}view.inputState.composing=0;}};handlers.compositionend=function(view){view.inputState.composing=-1;view.inputState.compositionEndedAt=Date.now();view.inputState.compositionFirstChange=null;setTimeout(function(){if(view.inputState.composing<0)forceClearComposition(view,false);},50);};handlers.contextmenu=function(view){view.inputState.lastContextMenu=Date.now();};handlers.beforeinput=function(view,event){var _a;var pending;if(browser.chrome&&browser.android&&(pending=PendingKeys.find(function(key){return key.inputType==event.inputType;}))){view.inputState.setPendingAndroidKey(view,pending);if(pending.key=="Backspace"||pending.key=="Delete"){var startViewHeight=((_a=window.visualViewport)===null||_a===void 0?void 0:_a.height)||0;setTimeout(function(){var _a2;if((((_a2=window.visualViewport)===null||_a2===void 0?void 0:_a2.height)||0)>startViewHeight+10&&view.hasFocus){view.contentDOM.blur();view.focus();}},100);}}};var wrappingWhiteSpace=["pre-wrap","normal","pre-line"];var HeightOracle=/*#__PURE__*/function(){function HeightOracle(){_classCallCheck(this,HeightOracle);this.doc=Text.empty;this.lineWrapping=false;this.direction=Direction.LTR;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.lineLength=30;this.heightChanged=false;}_createClass(HeightOracle,[{key:"heightForGap",value:function heightForGap(from,to){var lines=this.doc.lineAt(to).number-this.doc.lineAt(from).number+1;if(this.lineWrapping)lines+=Math.ceil((to-from-lines*this.lineLength*0.5)/this.lineLength);return this.lineHeight*lines;}},{key:"heightForLine",value:function heightForLine(length){if(!this.lineWrapping)return this.lineHeight;var lines=1+Math.max(0,Math.ceil((length-this.lineLength)/(this.lineLength-5)));return lines*this.lineHeight;}},{key:"setDoc",value:function setDoc(doc6){this.doc=doc6;return this;}},{key:"mustRefresh",value:function mustRefresh(lineHeights,whiteSpace,direction){var newHeight=false;for(var _i83=0;_i83<lineHeights.length;_i83++){var h=lineHeights[_i83];if(h<0){_i83++;}else if(!this.heightSamples[Math.floor(h*10)]){newHeight=true;this.heightSamples[Math.floor(h*10)]=true;}}return newHeight||wrappingWhiteSpace.indexOf(whiteSpace)>-1!=this.lineWrapping||this.direction!=direction;}},{key:"refresh",value:function refresh(whiteSpace,direction,lineHeight,charWidth,lineLength,knownHeights){var lineWrapping=wrappingWhiteSpace.indexOf(whiteSpace)>-1;var changed=Math.round(lineHeight)!=Math.round(this.lineHeight)||this.lineWrapping!=lineWrapping||this.direction!=direction;this.lineWrapping=lineWrapping;this.direction=direction;this.lineHeight=lineHeight;this.charWidth=charWidth;this.lineLength=lineLength;if(changed){this.heightSamples={};for(var _i84=0;_i84<knownHeights.length;_i84++){var h=knownHeights[_i84];if(h<0)_i84++;else this.heightSamples[Math.floor(h*10)]=true;}}return changed;}}]);return HeightOracle;}();var MeasuredHeights=/*#__PURE__*/function(){function MeasuredHeights(from,heights){_classCallCheck(this,MeasuredHeights);this.from=from;this.heights=heights;this.index=0;}_createClass(MeasuredHeights,[{key:"more",get:function get(){return this.index<this.heights.length;}}]);return MeasuredHeights;}();var BlockInfo=/*#__PURE__*/function(){function BlockInfo(from,length,top2,height,type){_classCallCheck(this,BlockInfo);this.from=from;this.length=length;this.top=top2;this.height=height;this.type=type;}_createClass(BlockInfo,[{key:"to",get:function get(){return this.from+this.length;}},{key:"bottom",get:function get(){return this.top+this.height;}},{key:"join",value:function join(other){var detail=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(other.type)?other.type:[other]);return new BlockInfo(this.from,this.length+other.length,this.top,this.height+other.height,detail);}}]);return BlockInfo;}();var QueryType=/* @__PURE__ */function(QueryType7){QueryType7[QueryType7["ByPos"]=0]="ByPos";QueryType7[QueryType7["ByHeight"]=1]="ByHeight";QueryType7[QueryType7["ByPosNoHeight"]=2]="ByPosNoHeight";return QueryType7;}(QueryType||(QueryType={}));var Epsilon=1e-4;var HeightMap=/*#__PURE__*/function(){function HeightMap(length,height){var flags=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;_classCallCheck(this,HeightMap);this.length=length;this.height=height;this.flags=flags;}_createClass(HeightMap,[{key:"outdated",get:function get(){return(this.flags&2)>0;},set:function set(value){this.flags=(value?2:0)|this.flags&~2;}},{key:"setHeight",value:function setHeight(oracle,height){if(this.height!=height){if(Math.abs(this.height-height)>Epsilon)oracle.heightChanged=true;this.height=height;}}},{key:"replace",value:function replace(_from,_to,nodes){return HeightMap.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(_to,result){result.push(this);}},{key:"decomposeRight",value:function decomposeRight(_from,result){result.push(this);}},{key:"applyChanges",value:function applyChanges(decorations6,oldDoc,oracle,changes){var me=this;for(var _i85=changes.length-1;_i85>=0;_i85--){var _changes$_i=changes[_i85],fromA=_changes$_i.fromA,toA=_changes$_i.toA,fromB=_changes$_i.fromB,toB=_changes$_i.toB;var start=me.lineAt(fromA,QueryType.ByPosNoHeight,oldDoc,0,0);var end=start.to>=toA?start:me.lineAt(toA,QueryType.ByPosNoHeight,oldDoc,0,0);toB+=end.to-toA;toA=end.to;while(_i85>0&&start.from<=changes[_i85-1].toA){fromA=changes[_i85-1].fromA;fromB=changes[_i85-1].fromB;_i85--;if(fromA<start.from)start=me.lineAt(fromA,QueryType.ByPosNoHeight,oldDoc,0,0);}fromB+=start.from-fromA;fromA=start.from;var nodes=NodeBuilder.build(oracle,decorations6,fromB,toB);me=me.replace(fromA,toA,nodes);}return me.updateHeight(oracle,0);}}],[{key:"empty",value:function empty(){return new HeightMapText(0,0);}},{key:"of",value:function of(nodes){if(nodes.length==1)return nodes[0];var i=0,j=nodes.length,before=0,after=0;for(;;){if(i==j){if(before>after*2){var split=nodes[i-1];if(split["break"])nodes.splice(--i,1,split.left,null,split.right);else nodes.splice(--i,1,split.left,split.right);j+=1+split["break"];before-=split.size;}else if(after>before*2){var _split=nodes[j];if(_split["break"])nodes.splice(j,1,_split.left,null,_split.right);else nodes.splice(j,1,_split.left,_split.right);j+=2+_split["break"];after-=_split.size;}else{break;}}else if(before<after){var next=nodes[i++];if(next)before+=next.size;}else{var _next2=nodes[--j];if(_next2)after+=_next2.size;}}var brk=0;if(nodes[i-1]==null){brk=1;i--;}else if(nodes[i]==null){brk=1;j++;}return new HeightMapBranch(HeightMap.of(nodes.slice(0,i)),brk,HeightMap.of(nodes.slice(j)));}}]);return HeightMap;}();HeightMap.prototype.size=1;var HeightMapBlock=/*#__PURE__*/function(_HeightMap){_inherits(HeightMapBlock,_HeightMap);var _super20=_createSuper(HeightMapBlock);function HeightMapBlock(length,height,type){var _this29;_classCallCheck(this,HeightMapBlock);_this29=_super20.call(this,length,height);_this29.type=type;return _this29;}_createClass(HeightMapBlock,[{key:"blockAt",value:function blockAt(_height,_doc,top2,offset){return new BlockInfo(offset,this.length,top2,this.height,this.type);}},{key:"lineAt",value:function lineAt(_value,_type,doc6,top2,offset){return this.blockAt(0,doc6,top2,offset);}},{key:"forEachLine",value:function forEachLine(_from,_to,doc6,top2,offset,f){f(this.blockAt(0,doc6,top2,offset));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var _force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);this.outdated=false;return this;}},{key:"toString",value:function toString(){return"block(".concat(this.length,")");}}]);return HeightMapBlock;}(HeightMap);var HeightMapText=/*#__PURE__*/function(_HeightMapBlock){_inherits(HeightMapText,_HeightMapBlock);var _super21=_createSuper(HeightMapText);function HeightMapText(length,height){var _this30;_classCallCheck(this,HeightMapText);_this30=_super21.call(this,length,height,BlockType.Text);_this30.collapsed=0;_this30.widgetHeight=0;return _this30;}_createClass(HeightMapText,[{key:"replace",value:function replace(_from,_to,nodes){var node=nodes[0];if(nodes.length==1&&(node instanceof HeightMapText||node instanceof HeightMapGap&&node.flags&4)&&Math.abs(this.length-node.length)<10){if(node instanceof HeightMapGap)node=new HeightMapText(node.length,this.height);else node.height=this.height;if(!this.outdated)node.outdated=false;return node;}else{return HeightMap.of(nodes);}}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);else if(force||this.outdated)this.setHeight(oracle,Math.max(this.widgetHeight,oracle.heightForLine(this.length-this.collapsed)));this.outdated=false;return this;}},{key:"toString",value:function toString(){return"line(".concat(this.length).concat(this.collapsed?-this.collapsed:"").concat(this.widgetHeight?":"+this.widgetHeight:"",")");}}]);return HeightMapText;}(HeightMapBlock);var HeightMapGap=/*#__PURE__*/function(_HeightMap2){_inherits(HeightMapGap,_HeightMap2);var _super22=_createSuper(HeightMapGap);function HeightMapGap(length){_classCallCheck(this,HeightMapGap);return _super22.call(this,length,0);}_createClass(HeightMapGap,[{key:"lines",value:function lines(doc6,offset){var firstLine=doc6.lineAt(offset).number,lastLine=doc6.lineAt(offset+this.length).number;return{firstLine:firstLine,lastLine:lastLine,lineHeight:this.height/(lastLine-firstLine+1)};}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var _this$lines=this.lines(doc6,offset),firstLine=_this$lines.firstLine,lastLine=_this$lines.lastLine,lineHeight=_this$lines.lineHeight;var line=Math.max(0,Math.min(lastLine-firstLine,Math.floor((height-top2)/lineHeight)));var _doc6$line=doc6.line(firstLine+line),from=_doc6$line.from,length=_doc6$line.length;return new BlockInfo(from,length,top2+lineHeight*line,lineHeight,BlockType.Text);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){if(type==QueryType.ByHeight)return this.blockAt(value,doc6,top2,offset);if(type==QueryType.ByPosNoHeight){var _doc6$lineAt=doc6.lineAt(value),from2=_doc6$lineAt.from,to=_doc6$lineAt.to;return new BlockInfo(from2,to-from2,0,0,BlockType.Text);}var _this$lines2=this.lines(doc6,offset),firstLine=_this$lines2.firstLine,lineHeight=_this$lines2.lineHeight;var _doc6$lineAt2=doc6.lineAt(value),from=_doc6$lineAt2.from,length=_doc6$lineAt2.length,number2=_doc6$lineAt2.number;return new BlockInfo(from,length,top2+lineHeight*(number2-firstLine),lineHeight,BlockType.Text);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var _this$lines3=this.lines(doc6,offset),firstLine=_this$lines3.firstLine,lineHeight=_this$lines3.lineHeight;for(var pos=Math.max(from,offset),end=Math.min(offset+this.length,to);pos<=end;){var line=doc6.lineAt(pos);if(pos==from)top2+=lineHeight*(line.number-firstLine);f(new BlockInfo(line.from,line.length,top2,lineHeight,BlockType.Text));top2+=lineHeight;pos=line.to+1;}}},{key:"replace",value:function replace(from,to,nodes){var after=this.length-to;if(after>0){var last=nodes[nodes.length-1];if(last instanceof HeightMapGap)nodes[nodes.length-1]=new HeightMapGap(last.length+after);else nodes.push(null,new HeightMapGap(after-1));}if(from>0){var first=nodes[0];if(first instanceof HeightMapGap)nodes[0]=new HeightMapGap(from+first.length);else nodes.unshift(new HeightMapGap(from-1),null);}return HeightMap.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){result.push(new HeightMapGap(to-1),null);}},{key:"decomposeRight",value:function decomposeRight(from,result){result.push(null,new HeightMapGap(this.length-from-1));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var end=offset+this.length;if(measured&&measured.from<=offset+this.length&&measured.more){var nodes=[],pos=Math.max(offset,measured.from);if(measured.from>offset)nodes.push(new HeightMapGap(measured.from-offset-1).updateHeight(oracle,offset));while(pos<=end&&measured.more){var len=oracle.doc.lineAt(pos).length;if(nodes.length)nodes.push(null);var line=new HeightMapText(len,measured.heights[measured.index++]);line.outdated=false;nodes.push(line);pos+=len+1;}if(pos<=end)nodes.push(null,new HeightMapGap(end-pos).updateHeight(oracle,pos));oracle.heightChanged=true;return HeightMap.of(nodes);}else if(force||this.outdated){this.setHeight(oracle,oracle.heightForGap(offset,offset+this.length));this.outdated=false;}return this;}},{key:"toString",value:function toString(){return"gap(".concat(this.length,")");}}]);return HeightMapGap;}(HeightMap);var HeightMapBranch=/*#__PURE__*/function(_HeightMap3){_inherits(HeightMapBranch,_HeightMap3);var _super23=_createSuper(HeightMapBranch);function HeightMapBranch(left,brk,right){var _this31;_classCallCheck(this,HeightMapBranch);_this31=_super23.call(this,left.length+brk+right.length,left.height+right.height,brk|(left.outdated||right.outdated?2:0));_this31.left=left;_this31.right=right;_this31.size=left.size+right.size;return _this31;}_createClass(HeightMapBranch,[{key:"break",get:function get(){return this.flags&1;}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var mid=top2+this.left.height;return height<mid||this.right.height==0?this.left.blockAt(height,doc6,top2,offset):this.right.blockAt(height,doc6,mid,offset+this.left.length+this["break"]);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];var left=type==QueryType.ByHeight?value<rightTop||this.right.height==0:value<rightOffset;var base2=left?this.left.lineAt(value,type,doc6,top2,offset):this.right.lineAt(value,type,doc6,rightTop,rightOffset);if(this["break"]||(left?base2.to<rightOffset:base2.from>rightOffset))return base2;var subQuery=type==QueryType.ByPosNoHeight?QueryType.ByPosNoHeight:QueryType.ByPos;if(left)return base2.join(this.right.lineAt(rightOffset,subQuery,doc6,rightTop,rightOffset));else return this.left.lineAt(rightOffset,subQuery,doc6,top2,offset).join(base2);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];if(this["break"]){if(from<rightOffset)this.left.forEachLine(from,to,doc6,top2,offset,f);if(to>=rightOffset)this.right.forEachLine(from,to,doc6,rightTop,rightOffset,f);}else{var mid=this.lineAt(rightOffset,QueryType.ByPos,doc6,top2,offset);if(from<mid.from)this.left.forEachLine(from,mid.from-1,doc6,top2,offset,f);if(mid.to>=from&&mid.from<=to)f(mid);if(to>mid.to)this.right.forEachLine(mid.to+1,to,doc6,rightTop,rightOffset,f);}}},{key:"replace",value:function replace(from,to,nodes){var rightStart=this.left.length+this["break"];if(to<rightStart)return this.balanced(this.left.replace(from,to,nodes),this.right);if(from>this.left.length)return this.balanced(this.left,this.right.replace(from-rightStart,to-rightStart,nodes));var result=[];if(from>0)this.decomposeLeft(from,result);var left=result.length;var _iterator53=_createForOfIteratorHelper(nodes),_step53;try{for(_iterator53.s();!(_step53=_iterator53.n()).done;){var node=_step53.value;result.push(node);}}catch(err){_iterator53.e(err);}finally{_iterator53.f();}if(from>0)mergeGaps(result,left-1);if(to<this.length){var right=result.length;this.decomposeRight(to,result);mergeGaps(result,right);}return HeightMap.of(result);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){var left=this.left.length;if(to<=left)return this.left.decomposeLeft(to,result);result.push(this.left);if(this["break"]){left++;if(to>=left)result.push(null);}if(to>left)this.right.decomposeLeft(to-left,result);}},{key:"decomposeRight",value:function decomposeRight(from,result){var left=this.left.length,right=left+this["break"];if(from>=right)return this.right.decomposeRight(from-right,result);if(from<left)this.left.decomposeRight(from,result);if(this["break"]&&from<right)result.push(null);result.push(this.right);}},{key:"balanced",value:function balanced(left,right){if(left.size>2*right.size||right.size>2*left.size)return HeightMap.of(this["break"]?[left,null,right]:[left,right]);this.left=left;this.right=right;this.height=left.height+right.height;this.outdated=left.outdated||right.outdated;this.size=left.size+right.size;this.length=left.length+this["break"]+right.length;return this;}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var left=this.left,right=this.right,rightStart=offset+left.length+this["break"],rebalance=null;if(measured&&measured.from<=offset+left.length&&measured.more)rebalance=left=left.updateHeight(oracle,offset,force,measured);else left.updateHeight(oracle,offset,force);if(measured&&measured.from<=rightStart+right.length&&measured.more)rebalance=right=right.updateHeight(oracle,rightStart,force,measured);else right.updateHeight(oracle,rightStart,force);if(rebalance)return this.balanced(left,right);this.height=this.left.height+this.right.height;this.outdated=false;return this;}},{key:"toString",value:function toString(){return this.left+(this["break"]?" ":"-")+this.right;}}]);return HeightMapBranch;}(HeightMap);function mergeGaps(nodes,around){var before,after;if(nodes[around]==null&&(before=nodes[around-1])instanceof HeightMapGap&&(after=nodes[around+1])instanceof HeightMapGap)nodes.splice(around-1,3,new HeightMapGap(before.length+1+after.length));}var relevantWidgetHeight=5;var NodeBuilder=/*#__PURE__*/function(){function NodeBuilder(pos,oracle){_classCallCheck(this,NodeBuilder);this.pos=pos;this.oracle=oracle;this.nodes=[];this.lineStart=-1;this.lineEnd=-1;this.covering=null;this.writtenTo=pos;}_createClass(NodeBuilder,[{key:"isCovered",get:function get(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering;}},{key:"span",value:function span(_from,to){if(this.lineStart>-1){var end=Math.min(to,this.lineEnd),last=this.nodes[this.nodes.length-1];if(last instanceof HeightMapText)last.length+=end-this.pos;else if(end>this.pos||!this.isCovered)this.nodes.push(new HeightMapText(end-this.pos,-1));this.writtenTo=end;if(to>end){this.nodes.push(null);this.writtenTo++;this.lineStart=-1;}}this.pos=to;}},{key:"point",value:function point(from,to,deco){if(from<to||deco.heightRelevant){var height=deco.widget?Math.max(0,deco.widget.estimatedHeight):0;var len=to-from;if(deco.block){this.addBlock(new HeightMapBlock(len,height,deco.type));}else if(len||height>=relevantWidgetHeight){this.addLineDeco(height,len);}}else if(to>from){this.span(from,to);}if(this.lineEnd>-1&&this.lineEnd<this.pos)this.lineEnd=this.oracle.doc.lineAt(this.pos).to;}},{key:"enterLine",value:function enterLine(){if(this.lineStart>-1)return;var _this$oracle$doc$line=this.oracle.doc.lineAt(this.pos),from=_this$oracle$doc$line.from,to=_this$oracle$doc$line.to;this.lineStart=from;this.lineEnd=to;if(this.writtenTo<from){if(this.writtenTo<from-1||this.nodes[this.nodes.length-1]==null)this.nodes.push(this.blankContent(this.writtenTo,from-1));this.nodes.push(null);}if(this.pos>from)this.nodes.push(new HeightMapText(this.pos-from,-1));this.writtenTo=this.pos;}},{key:"blankContent",value:function blankContent(from,to){var gap=new HeightMapGap(to-from);if(this.oracle.doc.lineAt(from).to==to)gap.flags|=4;return gap;}},{key:"ensureLine",value:function ensureLine(){this.enterLine();var last=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(last instanceof HeightMapText)return last;var line=new HeightMapText(0,-1);this.nodes.push(line);return line;}},{key:"addBlock",value:function addBlock(block){this.enterLine();if(block.type==BlockType.WidgetAfter&&!this.isCovered)this.ensureLine();this.nodes.push(block);this.writtenTo=this.pos=this.pos+block.length;if(block.type!=BlockType.WidgetBefore)this.covering=block;}},{key:"addLineDeco",value:function addLineDeco(height,length){var line=this.ensureLine();line.length+=length;line.collapsed+=length;line.widgetHeight=Math.max(line.widgetHeight,height);this.writtenTo=this.pos=this.pos+length;}},{key:"finish",value:function finish(from){var last=this.nodes.length==0?null:this.nodes[this.nodes.length-1];if(this.lineStart>-1&&!(last instanceof HeightMapText)&&!this.isCovered)this.nodes.push(new HeightMapText(0,-1));else if(this.writtenTo<this.pos||last==null)this.nodes.push(this.blankContent(this.writtenTo,this.pos));var pos=from;var _iterator54=_createForOfIteratorHelper(this.nodes),_step54;try{for(_iterator54.s();!(_step54=_iterator54.n()).done;){var node=_step54.value;if(node instanceof HeightMapText)node.updateHeight(this.oracle,pos);pos+=node?node.length:1;}}catch(err){_iterator54.e(err);}finally{_iterator54.f();}return this.nodes;}}],[{key:"build",value:function build(oracle,decorations6,from,to){var builder=new NodeBuilder(from,oracle);RangeSet.spans(decorations6,from,to,builder,0);return builder.finish(from);}}]);return NodeBuilder;}();function heightRelevantDecoChanges(a,b,diff){var comp=new DecorationComparator();RangeSet.compare(a,b,diff,comp,0);return comp.changes;}var DecorationComparator=/*#__PURE__*/function(){function DecorationComparator(){_classCallCheck(this,DecorationComparator);this.changes=[];}_createClass(DecorationComparator,[{key:"compareRange",value:function compareRange(){}},{key:"comparePoint",value:function comparePoint(from,to,a,b){if(from<to||a&&a.heightRelevant||b&&b.heightRelevant)addRange(from,to,this.changes,5);}}]);return DecorationComparator;}();function visiblePixelRange(dom,paddingTop){var rect=dom.getBoundingClientRect();var left=Math.max(0,rect.left),right=Math.min(innerWidth,rect.right);var top2=Math.max(0,rect.top),bottom=Math.min(innerHeight,rect.bottom);var body=dom.ownerDocument.body;for(var parent=dom.parentNode;parent&&parent!=body;){if(parent.nodeType==1){var elt=parent;var style=window.getComputedStyle(elt);if((elt.scrollHeight>elt.clientHeight||elt.scrollWidth>elt.clientWidth)&&style.overflow!="visible"){var parentRect=elt.getBoundingClientRect();left=Math.max(left,parentRect.left);right=Math.min(right,parentRect.right);top2=Math.max(top2,parentRect.top);bottom=Math.min(bottom,parentRect.bottom);}parent=style.position=="absolute"||style.position=="fixed"?elt.offsetParent:elt.parentNode;}else if(parent.nodeType==11){parent=parent.host;}else{break;}}return{left:left-rect.left,right:right-rect.left,top:top2-(rect.top+paddingTop),bottom:bottom-(rect.top+paddingTop)};}var LineGap=/*#__PURE__*/function(){function LineGap(from,to,size){_classCallCheck(this,LineGap);this.from=from;this.to=to;this.size=size;}_createClass(LineGap,[{key:"draw",value:function draw(wrapping){return Decoration.replace({widget:new LineGapWidget(this.size,wrapping)}).range(this.from,this.to);}}],[{key:"same",value:function same(a,b){if(a.length!=b.length)return false;for(var _i86=0;_i86<a.length;_i86++){var gA=a[_i86],gB=b[_i86];if(gA.from!=gB.from||gA.to!=gB.to||gA.size!=gB.size)return false;}return true;}}]);return LineGap;}();var LineGapWidget=/*#__PURE__*/function(_WidgetType4){_inherits(LineGapWidget,_WidgetType4);var _super24=_createSuper(LineGapWidget);function LineGapWidget(size,vertical){var _this32;_classCallCheck(this,LineGapWidget);_this32=_super24.call(this);_this32.size=size;_this32.vertical=vertical;return _this32;}_createClass(LineGapWidget,[{key:"eq",value:function eq(other){return other.size==this.size&&other.vertical==this.vertical;}},{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");if(this.vertical){elt.style.height=this.size+"px";}else{elt.style.width=this.size+"px";elt.style.height="2px";elt.style.display="inline-block";}return elt;}},{key:"estimatedHeight",get:function get(){return this.vertical?this.size:-1;}}]);return LineGapWidget;}(WidgetType);var ScrollTarget=/*#__PURE__*/function(){function ScrollTarget(range){var center=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;_classCallCheck(this,ScrollTarget);this.range=range;this.center=center;}_createClass(ScrollTarget,[{key:"map",value:function map(changes){return changes.empty?this:new ScrollTarget(this.range.map(changes),this.center);}}]);return ScrollTarget;}();var ViewState=/*#__PURE__*/function(){function ViewState(state){_classCallCheck(this,ViewState);this.state=state;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=true;this.paddingTop=0;this.paddingBottom=0;this.contentWidth=0;this.heightOracle=new HeightOracle();this.scaler=IdScaler;this.scrollTarget=null;this.printing=false;this.visibleRanges=[];this.mustEnforceCursorAssoc=false;this.heightMap=HeightMap.empty().applyChanges(state.facet(decorations),Text.empty,this.heightOracle.setDoc(state.doc),[new ChangedRange(0,0,0,state.doc.length)]);this.viewport=this.getViewport(0,null);this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Decoration.set(this.lineGaps.map(function(gap){return gap.draw(false);}));this.computeVisibleRanges();}_createClass(ViewState,[{key:"updateForViewport",value:function updateForViewport(){var _this33=this;var viewports=[this.viewport],main=this.state.selection.main;var _loop8=function _loop8(_i87){var pos=_i87?main.head:main.anchor;if(!viewports.some(function(_ref11){var from=_ref11.from,to=_ref11.to;return pos>=from&&pos<=to;})){var _this33$lineAt=_this33.lineAt(pos,0),from=_this33$lineAt.from,to=_this33$lineAt.to;viewports.push(new Viewport(from,to));}};for(var _i87=0;_i87<=1;_i87++){_loop8(_i87);}this.viewports=viewports.sort(function(a,b){return a.from-b.from;});this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle.doc,this.heightMap,this.viewports);}},{key:"update",value:function update(_update5){var scrollTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var prev=this.state;this.state=_update5.state;var newDeco=this.state.facet(decorations);var contentChanges=_update5.changedRanges;var heightChanges=ChangedRange.extendWithRanges(contentChanges,heightRelevantDecoChanges(_update5.startState.facet(decorations),newDeco,_update5?_update5.changes:ChangeSet.empty(this.state.doc.length)));var prevHeight=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(newDeco,prev.doc,this.heightOracle.setDoc(this.state.doc),heightChanges);if(this.heightMap.height!=prevHeight)_update5.flags|=2;var viewport=heightChanges.length?this.mapViewport(this.viewport,_update5.changes):this.viewport;if(scrollTarget&&(scrollTarget.range.head<viewport.from||scrollTarget.range.head>viewport.to)||!this.viewportIsAppropriate(viewport))viewport=this.getViewport(0,scrollTarget);this.viewport=viewport;this.updateForViewport();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,_update5.changes)));_update5.flags|=this.computeVisibleRanges();if(scrollTarget)this.scrollTarget=scrollTarget;if(!this.mustEnforceCursorAssoc&&_update5.selectionSet&&_update5.view.lineWrapping&&_update5.state.selection.main.empty&&_update5.state.selection.main.assoc)this.mustEnforceCursorAssoc=true;}},{key:"measure",value:function measure(docView,repeated){var dom=docView.dom,whiteSpace="",direction=Direction.LTR;var result=0;if(!repeated){var style=window.getComputedStyle(dom);whiteSpace=style.whiteSpace,direction=style.direction=="rtl"?Direction.RTL:Direction.LTR;var paddingTop=parseInt(style.paddingTop)||0,paddingBottom=parseInt(style.paddingBottom)||0;if(this.paddingTop!=paddingTop||this.paddingBottom!=paddingBottom){result|=8;this.paddingTop=paddingTop;this.paddingBottom=paddingBottom;}}var pixelViewport=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:visiblePixelRange(dom,this.paddingTop);var dTop=pixelViewport.top-this.pixelViewport.top,dBottom=pixelViewport.bottom-this.pixelViewport.bottom;this.pixelViewport=pixelViewport;this.inView=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(!this.inView)return 0;var lineHeights=docView.measureVisibleLineHeights();var refresh=false,bias=0,oracle=this.heightOracle;if(!repeated){var contentWidth=docView.dom.clientWidth;if(oracle.mustRefresh(lineHeights,whiteSpace,direction)||oracle.lineWrapping&&Math.abs(contentWidth-this.contentWidth)>oracle.charWidth){var _docView$measureTextS=docView.measureTextSize(),lineHeight=_docView$measureTextS.lineHeight,charWidth=_docView$measureTextS.charWidth;refresh=oracle.refresh(whiteSpace,direction,lineHeight,charWidth,contentWidth/charWidth,lineHeights);if(refresh){docView.minWidth=0;result|=8;}}if(this.contentWidth!=contentWidth){this.contentWidth=contentWidth;result|=8;}if(dTop>0&&dBottom>0)bias=Math.max(dTop,dBottom);else if(dTop<0&&dBottom<0)bias=Math.min(dTop,dBottom);}oracle.heightChanged=false;this.heightMap=this.heightMap.updateHeight(oracle,0,refresh,new MeasuredHeights(this.viewport.from,lineHeights));if(oracle.heightChanged)result|=2;if(!this.viewportIsAppropriate(this.viewport,bias)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to))this.viewport=this.getViewport(bias,this.scrollTarget);this.updateForViewport();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(refresh?[]:this.lineGaps));result|=this.computeVisibleRanges();if(this.mustEnforceCursorAssoc){this.mustEnforceCursorAssoc=false;docView.enforceCursorAssoc();}return result;}},{key:"visibleTop",get:function get(){return this.scaler.fromDOM(this.pixelViewport.top,0);}},{key:"visibleBottom",get:function get(){return this.scaler.fromDOM(this.pixelViewport.bottom,0);}},{key:"getViewport",value:function getViewport(bias,scrollTarget){var marginTop=0.5-Math.max(-0.5,Math.min(0.5,bias/1e3/2));var map=this.heightMap,doc6=this.state.doc,visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;var viewport=new Viewport(map.lineAt(visibleTop-marginTop*1e3,QueryType.ByHeight,doc6,0,0).from,map.lineAt(visibleBottom+(1-marginTop)*1e3,QueryType.ByHeight,doc6,0,0).to);if(scrollTarget){var head=scrollTarget.range.head,viewHeight=visibleBottom-visibleTop;if(head<viewport.from||head>viewport.to){var block=map.lineAt(head,QueryType.ByPos,doc6,0,0),topPos;if(scrollTarget.center)topPos=(block.top+block.bottom)/2-viewHeight/2;else if(head<viewport.from)topPos=block.top;else topPos=block.bottom-viewHeight;viewport=new Viewport(map.lineAt(topPos-1e3/2,QueryType.ByHeight,doc6,0,0).from,map.lineAt(topPos+viewHeight+1e3/2,QueryType.ByHeight,doc6,0,0).to);}}return viewport;}},{key:"mapViewport",value:function mapViewport(viewport,changes){var from=changes.mapPos(viewport.from,-1),to=changes.mapPos(viewport.to,1);return new Viewport(this.heightMap.lineAt(from,QueryType.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(to,QueryType.ByPos,this.state.doc,0,0).to);}},{key:"viewportIsAppropriate",value:function viewportIsAppropriate(_ref12){var from=_ref12.from,to=_ref12.to;var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var _this$heightMap$lineA=this.heightMap.lineAt(from,QueryType.ByPos,this.state.doc,0,0),top2=_this$heightMap$lineA.top;var _this$heightMap$lineA2=this.heightMap.lineAt(to,QueryType.ByPos,this.state.doc,0,0),bottom=_this$heightMap$lineA2.bottom;var visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;return(from==0||top2<=visibleTop-Math.max(10,Math.min(-bias,250)))&&(to==this.state.doc.length||bottom>=visibleBottom+Math.max(10,Math.min(bias,250)))&&top2>visibleTop-2*1e3&&bottom<visibleBottom+2*1e3;}},{key:"mapLineGaps",value:function mapLineGaps(gaps,changes){if(!gaps.length||changes.empty)return gaps;var mapped=[];var _iterator55=_createForOfIteratorHelper(gaps),_step55;try{for(_iterator55.s();!(_step55=_iterator55.n()).done;){var gap=_step55.value;if(!changes.touchesRange(gap.from,gap.to))mapped.push(new LineGap(changes.mapPos(gap.from),changes.mapPos(gap.to),gap.size));}}catch(err){_iterator55.e(err);}finally{_iterator55.f();}return mapped;}},{key:"ensureLineGaps",value:function ensureLineGaps(current){var _this34=this;var gaps=[];if(this.heightOracle.direction!=Direction.LTR)return gaps;this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,function(line){if(line.length<4e3)return;var structure=lineStructure(line.from,line.to,_this34.state);if(structure.total<4e3)return;var viewFrom,viewTo;if(_this34.heightOracle.lineWrapping){var marginHeight=2e3/_this34.heightOracle.lineLength*_this34.heightOracle.lineHeight;viewFrom=findPosition(structure,(_this34.visibleTop-line.top-marginHeight)/line.height);viewTo=findPosition(structure,(_this34.visibleBottom-line.top+marginHeight)/line.height);}else{var totalWidth=structure.total*_this34.heightOracle.charWidth;var marginWidth=2e3*_this34.heightOracle.charWidth;viewFrom=findPosition(structure,(_this34.pixelViewport.left-marginWidth)/totalWidth);viewTo=findPosition(structure,(_this34.pixelViewport.right+marginWidth)/totalWidth);}var outside=[];if(viewFrom>line.from)outside.push({from:line.from,to:viewFrom});if(viewTo<line.to)outside.push({from:viewTo,to:line.to});var sel=_this34.state.selection.main;if(sel.from>=line.from&&sel.from<=line.to)cutRange(outside,sel.from-10,sel.from+10);if(!sel.empty&&sel.to>=line.from&&sel.to<=line.to)cutRange(outside,sel.to-10,sel.to+10);var _loop9=function _loop9(){var _outside$_i=_outside[_i88],from=_outside$_i.from,to=_outside$_i.to;if(to-from>1e3){gaps.push(find(current,function(gap){return gap.from>=line.from&&gap.to<=line.to&&Math.abs(gap.from-from)<1e3&&Math.abs(gap.to-to)<1e3;})||new LineGap(from,to,_this34.gapSize(line,from,to,structure)));}};for(var _i88=0,_outside=outside;_i88<_outside.length;_i88++){_loop9();}});return gaps;}},{key:"gapSize",value:function gapSize(line,from,to,structure){var fraction=findFraction(structure,to)-findFraction(structure,from);if(this.heightOracle.lineWrapping){return line.height*fraction;}else{return structure.total*this.heightOracle.charWidth*fraction;}}},{key:"updateLineGaps",value:function updateLineGaps(gaps){var _this35=this;if(!LineGap.same(gaps,this.lineGaps)){this.lineGaps=gaps;this.lineGapDeco=Decoration.set(gaps.map(function(gap){return gap.draw(_this35.heightOracle.lineWrapping);}));}}},{key:"computeVisibleRanges",value:function computeVisibleRanges(){var deco=this.state.facet(decorations);if(this.lineGaps.length)deco=deco.concat(this.lineGapDeco);var ranges=[];RangeSet.spans(deco,this.viewport.from,this.viewport.to,{span:function span(from,to){ranges.push({from:from,to:to});},point:function point(){}},20);var changed=ranges.length!=this.visibleRanges.length||this.visibleRanges.some(function(r,i){return r.from!=ranges[i].from||r.to!=ranges[i].to;});this.visibleRanges=ranges;return changed?4:0;}},{key:"lineAt",value:function lineAt(pos,editorTop){editorTop+=this.paddingTop;return scaleBlock(this.heightMap.lineAt(pos,QueryType.ByPos,this.state.doc,editorTop,0),this.scaler,editorTop);}},{key:"lineAtHeight",value:function lineAtHeight(height,editorTop){editorTop+=this.paddingTop;return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(height,editorTop),QueryType.ByHeight,this.state.doc,editorTop,0),this.scaler,editorTop);}},{key:"blockAtHeight",value:function blockAtHeight(height,editorTop){editorTop+=this.paddingTop;return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(height,editorTop),this.state.doc,editorTop,0),this.scaler,editorTop);}},{key:"forEachLine",value:function forEachLine(from,to,f,editorTop){var _this36=this;editorTop+=this.paddingTop;return this.heightMap.forEachLine(from,to,this.state.doc,editorTop,0,this.scaler.scale==1?f:function(b){return f(scaleBlock(b,_this36.scaler,editorTop));});}},{key:"contentHeight",get:function get(){return this.domHeight+this.paddingTop+this.paddingBottom;}},{key:"domHeight",get:function get(){return this.scaler.toDOM(this.heightMap.height,this.paddingTop);}}]);return ViewState;}();var Viewport=/*#__PURE__*/_createClass(function Viewport(from,to){_classCallCheck(this,Viewport);this.from=from;this.to=to;});function lineStructure(from,to,state){var ranges=[],pos=from,total=0;RangeSet.spans(state.facet(decorations),from,to,{span:function span(){},point:function point(from2,to2){if(from2>pos){ranges.push({from:pos,to:from2});total+=from2-pos;}pos=to2;}},20);if(pos<to){ranges.push({from:pos,to:to});total+=to-pos;}return{total:total,ranges:ranges};}function findPosition(_ref13,ratio){var total=_ref13.total,ranges=_ref13.ranges;if(ratio<=0)return ranges[0].from;if(ratio>=1)return ranges[ranges.length-1].to;var dist=Math.floor(total*ratio);for(var _i89=0;;_i89++){var _ranges$_i=ranges[_i89],from=_ranges$_i.from,to=_ranges$_i.to,size=to-from;if(dist<=size)return from+dist;dist-=size;}}function findFraction(structure,pos){var counted=0;var _iterator56=_createForOfIteratorHelper(structure.ranges),_step56;try{for(_iterator56.s();!(_step56=_iterator56.n()).done;){var _step56$value=_step56.value,from=_step56$value.from,to=_step56$value.to;if(pos<=to){counted+=pos-from;break;}counted+=to-from;}}catch(err){_iterator56.e(err);}finally{_iterator56.f();}return counted/structure.total;}function cutRange(ranges,from,to){for(var _i90=0;_i90<ranges.length;_i90++){var _r=ranges[_i90];if(_r.from<to&&_r.to>from){var pieces=[];if(_r.from<from)pieces.push({from:_r.from,to:from});if(_r.to>to)pieces.push({from:to,to:_r.to});ranges.splice.apply(ranges,[_i90,1].concat(pieces));_i90+=pieces.length-1;}}}function find(array,f){var _iterator57=_createForOfIteratorHelper(array),_step57;try{for(_iterator57.s();!(_step57=_iterator57.n()).done;){var val=_step57.value;if(f(val))return val;}}catch(err){_iterator57.e(err);}finally{_iterator57.f();}return void 0;}var IdScaler={toDOM:function toDOM(n){return n;},fromDOM:function fromDOM(n){return n;},scale:1};var BigScaler=/*#__PURE__*/function(){function BigScaler(doc6,heightMap,viewports){_classCallCheck(this,BigScaler);var vpHeight=0,base2=0,domBase=0;this.viewports=viewports.map(function(_ref14){var from=_ref14.from,to=_ref14.to;var top2=heightMap.lineAt(from,QueryType.ByPos,doc6,0,0).top;var bottom=heightMap.lineAt(to,QueryType.ByPos,doc6,0,0).bottom;vpHeight+=bottom-top2;return{from:from,to:to,top:top2,bottom:bottom,domTop:0,domBottom:0};});this.scale=(7e6-vpHeight)/(heightMap.height-vpHeight);var _iterator58=_createForOfIteratorHelper(this.viewports),_step58;try{for(_iterator58.s();!(_step58=_iterator58.n()).done;){var obj=_step58.value;obj.domTop=domBase+(obj.top-base2)*this.scale;domBase=obj.domBottom=obj.domTop+(obj.bottom-obj.top);base2=obj.bottom;}}catch(err){_iterator58.e(err);}finally{_iterator58.f();}}_createClass(BigScaler,[{key:"toDOM",value:function toDOM(n,top2){n-=top2;for(var _i91=0,base2=0,domBase=0;;_i91++){var vp=_i91<this.viewports.length?this.viewports[_i91]:null;if(!vp||n<vp.top)return domBase+(n-base2)*this.scale+top2;if(n<=vp.bottom)return vp.domTop+(n-vp.top)+top2;base2=vp.bottom;domBase=vp.domBottom;}}},{key:"fromDOM",value:function fromDOM(n,top2){n-=top2;for(var _i92=0,base2=0,domBase=0;;_i92++){var vp=_i92<this.viewports.length?this.viewports[_i92]:null;if(!vp||n<vp.domTop)return base2+(n-domBase)/this.scale+top2;if(n<=vp.domBottom)return vp.top+(n-vp.domTop)+top2;base2=vp.bottom;domBase=vp.domBottom;}}}]);return BigScaler;}();function scaleBlock(block,scaler,top2){if(scaler.scale==1)return block;var bTop=scaler.toDOM(block.top,top2),bBottom=scaler.toDOM(block.bottom,top2);return new BlockInfo(block.from,block.length,bTop,bBottom-bTop,Array.isArray(block.type)?block.type.map(function(b){return scaleBlock(b,scaler,top2);}):block.type);}var _theme=/* @__PURE__ */Facet.define({combine:function combine(strs){return strs.join(" ");}});var darkTheme=/* @__PURE__ */Facet.define({combine:function combine(values){return values.indexOf(true)>-1;}});var baseThemeID=/* @__PURE__ */StyleModule.newName();var baseLightID=/* @__PURE__ */StyleModule.newName();var baseDarkID=/* @__PURE__ */StyleModule.newName();var lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(main,spec,scopes){return new StyleModule(spec,{finish:function finish(sel){return /&/.test(sel)?sel.replace(/&\w*/,function(m){if(m=="&")return main;if(!scopes||!scopes[m])throw new RangeError("Unsupported selector: ".concat(m));return scopes[m];}):main+" "+sel;}});}var baseTheme=/* @__PURE__ */buildTheme("."+baseThemeID,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace:"pre-wrap",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none",display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-placeholder":{color:"#888",display:"inline-block"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"3px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs);var observeOptions={childList:true,characterData:true,subtree:true,attributes:true,characterDataOldValue:true};var useCharData=browser.ie&&browser.ie_version<=11;var DOMObserver=/*#__PURE__*/function(){function DOMObserver(view,onChange,onScrollChanged){var _this37=this;_classCallCheck(this,DOMObserver);this.view=view;this.onChange=onChange;this.onScrollChanged=onScrollChanged;this.active=false;this.ignoreSelection=new DOMSelection();this.delayedFlush=-1;this.queue=[];this.lastFlush=0;this.scrollTargets=[];this.intersection=null;this.intersecting=false;this.gapIntersection=null;this.gaps=[];this._selectionRange=null;this.parentCheck=-1;this.dom=view.contentDOM;this.observer=new MutationObserver(function(mutations){var _iterator59=_createForOfIteratorHelper(mutations),_step59;try{for(_iterator59.s();!(_step59=_iterator59.n()).done;){var mut=_step59.value;_this37.queue.push(mut);}}catch(err){_iterator59.e(err);}finally{_iterator59.f();}_this37._selectionRange=null;if((browser.ie&&browser.ie_version<=11||browser.ios&&view.composing)&&mutations.some(function(m){return m.type=="childList"&&m.removedNodes.length||m.type=="characterData"&&m.oldValue.length>m.target.nodeValue.length;}))_this37.flushSoon();else _this37.flush();});if(useCharData)this.onCharData=function(event){_this37.queue.push({target:event.target,type:"characterData",oldValue:event.prevValue});_this37.flushSoon();};this.onSelectionChange=this.onSelectionChange.bind(this);this.start();this.onScroll=this.onScroll.bind(this);window.addEventListener("scroll",this.onScroll);if(typeof IntersectionObserver=="function"){this.intersection=new IntersectionObserver(function(entries){if(_this37.parentCheck<0)_this37.parentCheck=setTimeout(_this37.listenForScroll.bind(_this37),1e3);if(entries.length>0&&entries[entries.length-1].intersectionRatio>0!=_this37.intersecting){_this37.intersecting=!_this37.intersecting;if(_this37.intersecting!=_this37.view.inView)_this37.onScrollChanged(document.createEvent("Event"));}},{});this.intersection.observe(this.dom);this.gapIntersection=new IntersectionObserver(function(entries){if(entries.length>0&&entries[entries.length-1].intersectionRatio>0)_this37.onScrollChanged(document.createEvent("Event"));},{});}this.listenForScroll();}_createClass(DOMObserver,[{key:"onScroll",value:function onScroll(e){if(this.intersecting)this.flush();this.onScrollChanged(e);}},{key:"updateGaps",value:function updateGaps(gaps){if(this.gapIntersection&&(gaps.length!=this.gaps.length||this.gaps.some(function(g,i){return g!=gaps[i];}))){this.gapIntersection.disconnect();var _iterator60=_createForOfIteratorHelper(gaps),_step60;try{for(_iterator60.s();!(_step60=_iterator60.n()).done;){var gap=_step60.value;this.gapIntersection.observe(gap);}}catch(err){_iterator60.e(err);}finally{_iterator60.f();}this.gaps=gaps;}}},{key:"onSelectionChange",value:function onSelectionChange(event){if(this.lastFlush<Date.now()-50)this._selectionRange=null;var view=this.view,sel=this.selectionRange;if(view.state.facet(editable)?view.root.activeElement!=this.dom:!hasSelection(view.dom,sel))return;var context=sel.anchorNode&&view.docView.nearest(sel.anchorNode);if(context&&context.ignoreEvent(event))return;if(browser.ie&&browser.ie_version<=11&&!view.state.selection.main.empty&&sel.focusNode&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))this.flushSoon();else this.flush();}},{key:"selectionRange",get:function get(){if(!this._selectionRange){var root=this.view.root,sel=getSelection(root);if(browser.safari&&root.nodeType==11&&deepActiveElement()==this.view.contentDOM)sel=safariSelectionRangeHack(this.view)||sel;this._selectionRange=sel;}return this._selectionRange;}},{key:"setSelectionRange",value:function setSelectionRange(anchor,head){var _a;if(!((_a=this._selectionRange)===null||_a===void 0?void 0:_a.type))this._selectionRange={anchorNode:anchor.node,anchorOffset:anchor.offset,focusNode:head.node,focusOffset:head.offset};}},{key:"listenForScroll",value:function listenForScroll(){this.parentCheck=-1;var i=0,changed=null;for(var dom=this.dom;dom;){if(dom.nodeType==1){if(!changed&&i<this.scrollTargets.length&&this.scrollTargets[i]==dom)i++;else if(!changed)changed=this.scrollTargets.slice(0,i);if(changed)changed.push(dom);dom=dom.assignedSlot||dom.parentNode;}else if(dom.nodeType==11){dom=dom.host;}else{break;}}if(i<this.scrollTargets.length&&!changed)changed=this.scrollTargets.slice(0,i);if(changed){var _iterator61=_createForOfIteratorHelper(this.scrollTargets),_step61;try{for(_iterator61.s();!(_step61=_iterator61.n()).done;){var _dom2=_step61.value;_dom2.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator61.e(err);}finally{_iterator61.f();}var _iterator62=_createForOfIteratorHelper(this.scrollTargets=changed),_step62;try{for(_iterator62.s();!(_step62=_iterator62.n()).done;){var _dom3=_step62.value;_dom3.addEventListener("scroll",this.onScroll);}}catch(err){_iterator62.e(err);}finally{_iterator62.f();}}}},{key:"ignore",value:function ignore(f){if(!this.active)return f();try{this.stop();return f();}finally{this.start();this.clear();}}},{key:"start",value:function start(){if(this.active)return;this.observer.observe(this.dom,observeOptions);this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange);if(useCharData)this.dom.addEventListener("DOMCharacterDataModified",this.onCharData);this.active=true;}},{key:"stop",value:function stop(){if(!this.active)return;this.active=false;this.observer.disconnect();this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange);if(useCharData)this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData);}},{key:"clearSelection",value:function clearSelection(){this.ignoreSelection.set(this.selectionRange);}},{key:"clear",value:function clear(){this.observer.takeRecords();this.queue.length=0;this.clearSelection();}},{key:"flushSoon",value:function flushSoon(){var _this38=this;if(this.delayedFlush<0)this.delayedFlush=window.setTimeout(function(){_this38.delayedFlush=-1;_this38.flush();},20);}},{key:"forceFlush",value:function forceFlush(){if(this.delayedFlush>=0){window.clearTimeout(this.delayedFlush);this.delayedFlush=-1;this.flush();}}},{key:"processRecords",value:function processRecords(){var records=this.queue;var _iterator63=_createForOfIteratorHelper(this.observer.takeRecords()),_step63;try{for(_iterator63.s();!(_step63=_iterator63.n()).done;){var mut=_step63.value;records.push(mut);}}catch(err){_iterator63.e(err);}finally{_iterator63.f();}if(records.length)this.queue=[];var from=-1,to=-1,typeOver=false;var _iterator64=_createForOfIteratorHelper(records),_step64;try{for(_iterator64.s();!(_step64=_iterator64.n()).done;){var record=_step64.value;var range=this.readMutation(record);if(!range)continue;if(range.typeOver)typeOver=true;if(from==-1){from=range.from;to=range.to;}else{from=Math.min(range.from,from);to=Math.max(range.to,to);}}}catch(err){_iterator64.e(err);}finally{_iterator64.f();}return{from:from,to:to,typeOver:typeOver};}},{key:"flush",value:function flush(){if(this.delayedFlush>=0||this.view.inputState.pendingAndroidKey)return;this.lastFlush=Date.now();var _this$processRecords=this.processRecords(),from=_this$processRecords.from,to=_this$processRecords.to,typeOver=_this$processRecords.typeOver;var selection2=this.selectionRange;var newSel=!this.ignoreSelection.eq(selection2)&&hasSelection(this.dom,selection2);if(from<0&&!newSel)return;var startState=this.view.state;this.onChange(from,to,typeOver);if(this.view.state==startState)this.view.docView.reset(newSel);this.clearSelection();}},{key:"readMutation",value:function readMutation(rec){var cView=this.view.docView.nearest(rec.target);if(!cView||cView.ignoreMutation(rec))return null;cView.markDirty(rec.type=="attributes");if(rec.type=="attributes")cView.dirty|=4;if(rec.type=="childList"){var childBefore=findChild(cView,rec.previousSibling||rec.target.previousSibling,-1);var childAfter=findChild(cView,rec.nextSibling||rec.target.nextSibling,1);return{from:childBefore?cView.posAfter(childBefore):cView.posAtStart,to:childAfter?cView.posBefore(childAfter):cView.posAtEnd,typeOver:false};}else if(rec.type=="characterData"){return{from:cView.posAtStart,to:cView.posAtEnd,typeOver:rec.target.nodeValue==rec.oldValue};}else{return null;}}},{key:"destroy",value:function destroy(){this.stop();if(this.intersection)this.intersection.disconnect();if(this.gapIntersection)this.gapIntersection.disconnect();var _iterator65=_createForOfIteratorHelper(this.scrollTargets),_step65;try{for(_iterator65.s();!(_step65=_iterator65.n()).done;){var dom=_step65.value;dom.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator65.e(err);}finally{_iterator65.f();}window.removeEventListener("scroll",this.onScroll);clearTimeout(this.parentCheck);}}]);return DOMObserver;}();function findChild(cView,dom,dir){while(dom){var curView=ContentView.get(dom);if(curView&&curView.parent==cView)return curView;var parent=dom.parentNode;dom=parent!=cView.dom?parent:dir>0?dom.nextSibling:dom.previousSibling;}return null;}function safariSelectionRangeHack(view){var found=null;function read(event){event.preventDefault();event.stopImmediatePropagation();found=event.getTargetRanges()[0];}view.contentDOM.addEventListener("beforeinput",read,true);document.execCommand("indent");view.contentDOM.removeEventListener("beforeinput",read,true);if(!found)return null;var anchorNode=found.startContainer,anchorOffset=found.startOffset;var focusNode=found.endContainer,focusOffset=found.endOffset;var curAnchor=view.docView.domAtPos(view.state.selection.main.anchor);if(isEquivalentPosition(curAnchor.node,curAnchor.offset,focusNode,focusOffset)){var _ref15=[focusNode,focusOffset,anchorNode,anchorOffset];anchorNode=_ref15[0];anchorOffset=_ref15[1];focusNode=_ref15[2];focusOffset=_ref15[3];}return{anchorNode:anchorNode,anchorOffset:anchorOffset,focusNode:focusNode,focusOffset:focusOffset};}function applyDOMChange(view,start,end,typeOver){var change,newSel;var sel=view.state.selection.main;if(start>-1){var bounds=view.docView.domBoundsAround(start,end,0);if(!bounds||view.state.readOnly)return;var from=bounds.from,to=bounds.to;var selPoints=view.docView.impreciseHead||view.docView.impreciseAnchor?[]:selectionPoints(view);var reader=new DOMReader(selPoints,view);reader.readRange(bounds.startDOM,bounds.endDOM);newSel=selectionFromPoints(selPoints,from);var preferredPos=sel.from,preferredSide=null;if(view.inputState.lastKeyCode===8&&view.inputState.lastKeyTime>Date.now()-100||browser.android&&reader.text.length<to-from){preferredPos=sel.to;preferredSide="end";}var diff=findDiff(view.state.sliceDoc(from,to),reader.text,preferredPos-from,preferredSide);if(diff)change={from:from+diff.from,to:from+diff.toA,insert:view.state.toText(reader.text.slice(diff.from,diff.toB))};}else if(view.hasFocus||!view.state.facet(editable)){var domSel=view.observer.selectionRange;var _view$docView=view.docView,iHead=_view$docView.impreciseHead,iAnchor=_view$docView.impreciseAnchor;var head=iHead&&iHead.node==domSel.focusNode&&iHead.offset==domSel.focusOffset||!contains(view.contentDOM,domSel.focusNode)?view.state.selection.main.head:view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset);var anchor=iAnchor&&iAnchor.node==domSel.anchorNode&&iAnchor.offset==domSel.anchorOffset||!contains(view.contentDOM,domSel.anchorNode)?view.state.selection.main.anchor:view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset);if(head!=sel.head||anchor!=sel.anchor)newSel=EditorSelection.single(anchor,head);}if(!change&&!newSel)return;if(!change&&typeOver&&!sel.empty&&newSel&&newSel.main.empty)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,sel.to)};else if(change&&change.from>=sel.from&&change.to<=sel.to&&(change.from!=sel.from||change.to!=sel.to)&&sel.to-sel.from-(change.to-change.from)<=4)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,change.from).append(change.insert).append(view.state.doc.slice(change.to,sel.to))};if(change){var startState=view.state;if(browser.ios&&view.inputState.flushIOSKey(view))return;var _text4=change.insert.toString();if(view.state.facet(inputHandler).some(function(h){return h(view,change.from,change.to,_text4);}))return;if(view.inputState.composing>=0)view.inputState.composing++;var tr;if(change.from>=sel.from&&change.to<=sel.to&&change.to-change.from>=(sel.to-sel.from)/3&&(!newSel||newSel.main.empty&&newSel.main.from==change.from+change.insert.length)){var before=sel.from<change.from?startState.sliceDoc(sel.from,change.from):"";var after=sel.to>change.to?startState.sliceDoc(change.to,sel.to):"";tr=startState.replaceSelection(view.state.toText(before+change.insert.sliceString(0,void 0,view.state.lineBreak)+after));}else{var changes=startState.changes(change);tr={changes:changes,selection:newSel&&!startState.selection.main.eq(newSel.main)&&newSel.main.to<=changes.newLength?startState.selection.replaceRange(newSel.main):void 0};}var userEvent="input.type";if(view.composing){userEvent+=".compose";if(view.inputState.compositionFirstChange){userEvent+=".start";view.inputState.compositionFirstChange=false;}}view.dispatch(tr,{scrollIntoView:true,userEvent:userEvent});}else if(newSel&&!newSel.main.eq(sel)){var scrollIntoView6=false,_userEvent="select";if(view.inputState.lastSelectionTime>Date.now()-50){if(view.inputState.lastSelectionOrigin=="select")scrollIntoView6=true;_userEvent=view.inputState.lastSelectionOrigin;}view.dispatch({selection:newSel,scrollIntoView:scrollIntoView6,userEvent:_userEvent});}}function findDiff(a,b,preferredPos,preferredSide){var minLen=Math.min(a.length,b.length);var from=0;while(from<minLen&&a.charCodeAt(from)==b.charCodeAt(from)){from++;}if(from==minLen&&a.length==b.length)return null;var toA=a.length,toB=b.length;while(toA>0&&toB>0&&a.charCodeAt(toA-1)==b.charCodeAt(toB-1)){toA--;toB--;}if(preferredSide=="end"){var adjust=Math.max(0,from-Math.min(toA,toB));preferredPos-=toA+adjust-from;}if(toA<from&&a.length<b.length){var move=preferredPos<=from&&preferredPos>=toA?from-preferredPos:0;from-=move;toB=from+(toB-toA);toA=from;}else if(toB<from){var _move=preferredPos<=from&&preferredPos>=toB?from-preferredPos:0;from-=_move;toA=from+(toA-toB);toB=from;}return{from:from,toA:toA,toB:toB};}var DOMReader=/*#__PURE__*/function(){function DOMReader(points,view){_classCallCheck(this,DOMReader);this.points=points;this.view=view;this.text="";this.lineBreak=view.state.lineBreak;}_createClass(DOMReader,[{key:"readRange",value:function readRange(start,end){if(!start)return;var parent=start.parentNode;for(var cur2=start;;){this.findPointBefore(parent,cur2);this.readNode(cur2);var next=cur2.nextSibling;if(next==end)break;var view=ContentView.get(cur2),nextView=ContentView.get(next);if(view&&nextView?view.breakAfter:(view?view.breakAfter:isBlockElement(cur2))||isBlockElement(next)&&(cur2.nodeName!="BR"||cur2.cmIgnore))this.text+=this.lineBreak;cur2=next;}this.findPointBefore(parent,end);}},{key:"readNode",value:function readNode(node){if(node.cmIgnore)return;var view=ContentView.get(node);var fromView=view&&view.overrideDOMText;var text;if(fromView!=null)text=fromView.sliceString(0,void 0,this.lineBreak);else if(node.nodeType==3)text=node.nodeValue;else if(node.nodeName=="BR")text=node.nextSibling?this.lineBreak:"";else if(node.nodeType==1)this.readRange(node.firstChild,null);if(text!=null){this.findPointIn(node,text.length);this.text+=text;if(browser.chrome&&this.view.inputState.lastKeyCode==13&&!node.nextSibling&&/\n\n$/.test(this.text))this.text=this.text.slice(0,-1);}}},{key:"findPointBefore",value:function findPointBefore(node,next){var _iterator66=_createForOfIteratorHelper(this.points),_step66;try{for(_iterator66.s();!(_step66=_iterator66.n()).done;){var point=_step66.value;if(point.node==node&&node.childNodes[point.offset]==next)point.pos=this.text.length;}}catch(err){_iterator66.e(err);}finally{_iterator66.f();}}},{key:"findPointIn",value:function findPointIn(node,maxLen){var _iterator67=_createForOfIteratorHelper(this.points),_step67;try{for(_iterator67.s();!(_step67=_iterator67.n()).done;){var point=_step67.value;if(point.node==node)point.pos=this.text.length+Math.min(point.offset,maxLen);}}catch(err){_iterator67.e(err);}finally{_iterator67.f();}}}]);return DOMReader;}();function isBlockElement(node){return node.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(node.nodeName);}var DOMPoint=/*#__PURE__*/_createClass(function DOMPoint(node,offset){_classCallCheck(this,DOMPoint);this.node=node;this.offset=offset;this.pos=-1;});function selectionPoints(view){var result=[];if(view.root.activeElement!=view.contentDOM)return result;var _view$observer$select=view.observer.selectionRange,anchorNode=_view$observer$select.anchorNode,anchorOffset=_view$observer$select.anchorOffset,focusNode=_view$observer$select.focusNode,focusOffset=_view$observer$select.focusOffset;if(anchorNode){result.push(new DOMPoint(anchorNode,anchorOffset));if(focusNode!=anchorNode||focusOffset!=anchorOffset)result.push(new DOMPoint(focusNode,focusOffset));}return result;}function selectionFromPoints(points,base2){if(points.length==0)return null;var anchor=points[0].pos,head=points.length==2?points[1].pos:anchor;return anchor>-1&&head>-1?EditorSelection.single(anchor+base2,head+base2):null;}var EditorView=/*#__PURE__*/function(){function EditorView(){var _this39=this;var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,EditorView);this.plugins=[];this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.destroyed=false;this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.style.cssText="position: absolute; top: -10000px";this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);this._dispatch=config2.dispatch||function(tr){return _this39.update([tr]);};this.dispatch=this.dispatch.bind(this);this.root=config2.root||getRoot(config2.parent)||document;this.viewState=new ViewState(config2.state||EditorState.create());this.plugins=this.state.facet(viewPlugin).map(function(spec){return new PluginInstance(spec).update(_this39);});this.observer=new DOMObserver(this,function(from,to,typeOver){applyDOMChange(_this39,from,to,typeOver);},function(event){_this39.inputState.runScrollHandlers(_this39,event);if(_this39.observer.intersecting)_this39.measure();});this.inputState=new InputState(this);this.docView=new DocView(this);this.mountStyles();this.updateAttrs();this.updateState=0;ensureGlobalHandler();this.requestMeasure();if(config2.parent)config2.parent.appendChild(this.dom);}_createClass(EditorView,[{key:"state",get:function get(){return this.viewState.state;}},{key:"viewport",get:function get(){return this.viewState.viewport;}},{key:"visibleRanges",get:function get(){return this.viewState.visibleRanges;}},{key:"inView",get:function get(){return this.viewState.inView;}},{key:"composing",get:function get(){return this.inputState.composing>0;}},{key:"dispatch",value:function dispatch(){var _this$state;this._dispatch(arguments.length==1&&(arguments.length<=0?undefined:arguments[0])instanceof Transaction?arguments.length<=0?undefined:arguments[0]:(_this$state=this.state).update.apply(_this$state,arguments));}},{key:"update",value:function update(transactions){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");var redrawn=false,update;var state=this.state;var _iterator68=_createForOfIteratorHelper(transactions),_step68;try{for(_iterator68.s();!(_step68=_iterator68.n()).done;){var _tr=_step68.value;if(_tr.startState!=state)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");state=_tr.state;}}catch(err){_iterator68.e(err);}finally{_iterator68.f();}if(this.destroyed){this.viewState.state=state;return;}if(state.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(state);update=new ViewUpdate(this,state,transactions);var scrollTarget=null;try{this.updateState=2;var _iterator69=_createForOfIteratorHelper(transactions),_step69;try{for(_iterator69.s();!(_step69=_iterator69.n()).done;){var tr=_step69.value;if(scrollTarget)scrollTarget=scrollTarget.map(tr.changes);if(tr.scrollIntoView){var main=tr.state.selection.main;scrollTarget=new ScrollTarget(main.empty?main:EditorSelection.cursor(main.head,main.head>main.anchor?-1:1));}var _iterator70=_createForOfIteratorHelper(tr.effects),_step70;try{for(_iterator70.s();!(_step70=_iterator70.n()).done;){var e=_step70.value;if(e.is(scrollTo))scrollTarget=new ScrollTarget(e.value);else if(e.is(centerOn))scrollTarget=new ScrollTarget(e.value,true);}}catch(err){_iterator70.e(err);}finally{_iterator70.f();}}}catch(err){_iterator69.e(err);}finally{_iterator69.f();}this.viewState.update(update,scrollTarget);this.bidiCache=CachedOrder.update(this.bidiCache,update.changes);if(!update.empty){this.updatePlugins(update);this.inputState.update(update);}redrawn=this.docView.update(update);if(this.state.facet(styleModule)!=this.styleModules)this.mountStyles();this.updateAttrs();this.showAnnouncements(transactions);}finally{this.updateState=0;}if(redrawn||scrollTarget||this.viewState.mustEnforceCursorAssoc)this.requestMeasure();if(!update.empty){var _iterator71=_createForOfIteratorHelper(this.state.facet(updateListener)),_step71;try{for(_iterator71.s();!(_step71=_iterator71.n()).done;){var listener=_step71.value;listener(update);}}catch(err){_iterator71.e(err);}finally{_iterator71.f();}}}},{key:"setState",value:function setState(newState){var _this40=this;if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=newState;return;}this.updateState=2;try{var _iterator72=_createForOfIteratorHelper(this.plugins),_step72;try{for(_iterator72.s();!(_step72=_iterator72.n()).done;){var plugin=_step72.value;plugin.destroy(this);}}catch(err){_iterator72.e(err);}finally{_iterator72.f();}this.viewState=new ViewState(newState);this.plugins=newState.facet(viewPlugin).map(function(spec){return new PluginInstance(spec).update(_this40);});this.docView=new DocView(this);this.inputState.ensureHandlers(this);this.mountStyles();this.updateAttrs();this.bidiCache=[];}finally{this.updateState=0;}this.requestMeasure();}},{key:"updatePlugins",value:function updatePlugins(update){var prevSpecs=update.startState.facet(viewPlugin),specs=update.state.facet(viewPlugin);if(prevSpecs!=specs){var newPlugins=[];var _iterator73=_createForOfIteratorHelper(specs),_step73;try{for(_iterator73.s();!(_step73=_iterator73.n()).done;){var spec=_step73.value;var found=prevSpecs.indexOf(spec);if(found<0){newPlugins.push(new PluginInstance(spec));}else{var plugin=this.plugins[found];plugin.mustUpdate=update;newPlugins.push(plugin);}}}catch(err){_iterator73.e(err);}finally{_iterator73.f();}var _iterator74=_createForOfIteratorHelper(this.plugins),_step74;try{for(_iterator74.s();!(_step74=_iterator74.n()).done;){var _plugin3=_step74.value;if(_plugin3.mustUpdate!=update)_plugin3.destroy(this);}}catch(err){_iterator74.e(err);}finally{_iterator74.f();}this.plugins=newPlugins;this.inputState.ensureHandlers(this);}else{var _iterator75=_createForOfIteratorHelper(this.plugins),_step75;try{for(_iterator75.s();!(_step75=_iterator75.n()).done;){var _p=_step75.value;_p.mustUpdate=update;}}catch(err){_iterator75.e(err);}finally{_iterator75.f();}}for(var _i93=0;_i93<this.plugins.length;_i93++){this.plugins[_i93]=this.plugins[_i93].update(this);}}},{key:"measure",value:function measure(){var _this41=this;var flush=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.destroyed)return;if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.measureScheduled=-1;if(flush)this.observer.flush();var updated=null;try{for(var _i94=0;;_i94++){this.updateState=1;var oldViewport=this.viewport;var changed=this.viewState.measure(this.docView,_i94>0);if(!changed&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(_i94>5){console.warn("Viewport failed to stabilize");break;}var measuring=[];if(!(changed&4)){var _ref16=[measuring,this.measureRequests];this.measureRequests=_ref16[0];measuring=_ref16[1];}var measured=measuring.map(function(m){try{return m.read(_this41);}catch(e){logException(_this41.state,e);return BadMeasure;}});var update=new ViewUpdate(this,this.state);update.flags|=changed;if(!updated)updated=update;else updated.flags|=changed;this.updateState=2;if(!update.empty){this.updatePlugins(update);this.inputState.update(update);}this.updateAttrs();if(changed)this.docView.update(update);for(var i2=0;i2<measuring.length;i2++){if(measured[i2]!=BadMeasure){try{measuring[i2].write(measured[i2],this);}catch(e){logException(this.state,e);}}}if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget);this.viewState.scrollTarget=null;}if(this.viewport.from==oldViewport.from&&this.viewport.to==oldViewport.to&&this.measureRequests.length==0)break;}}finally{this.updateState=0;}this.measureScheduled=-1;if(updated&&!updated.empty){var _iterator76=_createForOfIteratorHelper(this.state.facet(updateListener)),_step76;try{for(_iterator76.s();!(_step76=_iterator76.n()).done;){var listener=_step76.value;listener(updated);}}catch(err){_iterator76.e(err);}finally{_iterator76.f();}}}},{key:"themeClasses",get:function get(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(_theme);}},{key:"updateAttrs",value:function updateAttrs(){var editorAttrs=combineAttrs(this.state.facet(editorAttributes),{"class":"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses});_updateAttrs(this.dom,this.editorAttrs,editorAttrs);this.editorAttrs=editorAttrs;var contentAttrs={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:!this.state.facet(editable)?"false":"true","class":"cm-content",style:"".concat(browser.tabSize,": ").concat(this.state.tabSize),role:"textbox","aria-multiline":"true"};if(this.state.readOnly)contentAttrs["aria-readonly"]="true";combineAttrs(this.state.facet(contentAttributes),contentAttrs);_updateAttrs(this.contentDOM,this.contentAttrs,contentAttrs);this.contentAttrs=contentAttrs;}},{key:"showAnnouncements",value:function showAnnouncements(trs){var first=true;var _iterator77=_createForOfIteratorHelper(trs),_step77;try{for(_iterator77.s();!(_step77=_iterator77.n()).done;){var tr=_step77.value;var _iterator78=_createForOfIteratorHelper(tr.effects),_step78;try{for(_iterator78.s();!(_step78=_iterator78.n()).done;){var effect=_step78.value;if(effect.is(EditorView.announce)){if(first)this.announceDOM.textContent="";first=false;var div=this.announceDOM.appendChild(document.createElement("div"));div.textContent=effect.value;}}}catch(err){_iterator78.e(err);}finally{_iterator78.f();}}}catch(err){_iterator77.e(err);}finally{_iterator77.f();}}},{key:"mountStyles",value:function mountStyles(){this.styleModules=this.state.facet(styleModule);StyleModule.mount(this.root,this.styleModules.concat(baseTheme).reverse());}},{key:"readMeasured",value:function readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");if(this.updateState==0&&this.measureScheduled>-1)this.measure(false);}},{key:"requestMeasure",value:function requestMeasure(request){var _this42=this;if(this.measureScheduled<0)this.measureScheduled=requestAnimationFrame(function(){return _this42.measure();});if(request){if(request.key!=null)for(var _i95=0;_i95<this.measureRequests.length;_i95++){if(this.measureRequests[_i95].key===request.key){this.measureRequests[_i95]=request;return;}}this.measureRequests.push(request);}}},{key:"pluginField",value:function pluginField(field){var result=[];var _iterator79=_createForOfIteratorHelper(this.plugins),_step79;try{for(_iterator79.s();!(_step79=_iterator79.n()).done;){var plugin=_step79.value;plugin.update(this).takeField(field,result);}}catch(err){_iterator79.e(err);}finally{_iterator79.f();}return result;}},{key:"plugin",value:function plugin(_plugin2){var _iterator80=_createForOfIteratorHelper(this.plugins),_step80;try{for(_iterator80.s();!(_step80=_iterator80.n()).done;){var inst=_step80.value;if(inst.spec==_plugin2)return inst.update(this).value;}}catch(err){_iterator80.e(err);}finally{_iterator80.f();}return null;}},{key:"blockAtHeight",value:function blockAtHeight(height,docTop){this.readMeasured();return this.viewState.blockAtHeight(height,ensureTop(docTop,this.contentDOM));}},{key:"visualLineAtHeight",value:function visualLineAtHeight(height,docTop){this.readMeasured();return this.viewState.lineAtHeight(height,ensureTop(docTop,this.contentDOM));}},{key:"viewportLines",value:function viewportLines(f,docTop){var _this$viewport=this.viewport,from=_this$viewport.from,to=_this$viewport.to;this.viewState.forEachLine(from,to,f,ensureTop(docTop,this.contentDOM));}},{key:"visualLineAt",value:function visualLineAt(pos){var docTop=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.viewState.lineAt(pos,docTop);}},{key:"contentHeight",get:function get(){return this.viewState.contentHeight;}},{key:"moveByChar",value:function moveByChar(start,forward,by){return skipAtoms(this,start,_moveByChar(this,start,forward,by));}},{key:"moveByGroup",value:function moveByGroup(start,forward){var _this43=this;return skipAtoms(this,start,_moveByChar(this,start,forward,function(initial){return byGroup(_this43,start.head,initial);}));}},{key:"moveToLineBoundary",value:function moveToLineBoundary(start,forward){var includeWrap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return _moveToLineBoundary(this,start,forward,includeWrap);}},{key:"moveVertically",value:function moveVertically(start,forward,distance){return skipAtoms(this,start,_moveVertically(this,start,forward,distance));}},{key:"scrollPosIntoView",value:function scrollPosIntoView(pos){this.dispatch({effects:scrollTo.of(EditorSelection.cursor(pos))});}},{key:"domAtPos",value:function domAtPos(pos){return this.docView.domAtPos(pos);}},{key:"posAtDOM",value:function posAtDOM(node){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.docView.posFromDOM(node,offset);}},{key:"posAtCoords",value:function posAtCoords(coords){var precise=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.readMeasured();return _posAtCoords(this,coords,precise);}},{key:"coordsAtPos",value:function coordsAtPos(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.readMeasured();var rect=this.docView.coordsAt(pos,side);if(!rect||rect.left==rect.right)return rect;var line=this.state.doc.lineAt(pos),order=this.bidiSpans(line);var span=order[BidiSpan.find(order,pos-line.from,-1,side)];return flattenRect(rect,span.dir==Direction.LTR==side>0);}},{key:"defaultCharacterWidth",get:function get(){return this.viewState.heightOracle.charWidth;}},{key:"defaultLineHeight",get:function get(){return this.viewState.heightOracle.lineHeight;}},{key:"textDirection",get:function get(){return this.viewState.heightOracle.direction;}},{key:"lineWrapping",get:function get(){return this.viewState.heightOracle.lineWrapping;}},{key:"bidiSpans",value:function bidiSpans(line){if(line.length>MaxBidiLine)return trivialOrder(line.length);var dir=this.textDirection;var _iterator81=_createForOfIteratorHelper(this.bidiCache),_step81;try{for(_iterator81.s();!(_step81=_iterator81.n()).done;){var entry=_step81.value;if(entry.from==line.from&&entry.dir==dir)return entry.order;}}catch(err){_iterator81.e(err);}finally{_iterator81.f();}var order=computeOrder(line.text,this.textDirection);this.bidiCache.push(new CachedOrder(line.from,line.to,dir,order));return order;}},{key:"hasFocus",get:function get(){var _a;return(document.hasFocus()||browser.safari&&((_a=this.inputState)===null||_a===void 0?void 0:_a.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM;}},{key:"focus",value:function focus(){var _this44=this;this.observer.ignore(function(){focusPreventScroll(_this44.contentDOM);_this44.docView.updateSelection();});}},{key:"destroy",value:function destroy(){var _iterator82=_createForOfIteratorHelper(this.plugins),_step82;try{for(_iterator82.s();!(_step82=_iterator82.n()).done;){var plugin=_step82.value;plugin.destroy(this);}}catch(err){_iterator82.e(err);}finally{_iterator82.f();}this.plugins=[];this.inputState.destroy();this.dom.remove();this.observer.destroy();if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.destroyed=true;}}],[{key:"domEventHandlers",value:function domEventHandlers(handlers6){return ViewPlugin.define(function(){return{};},{eventHandlers:handlers6});}},{key:"theme",value:function theme(spec,options){var prefix=StyleModule.newName();var result=[_theme.of(prefix),styleModule.of(buildTheme(".".concat(prefix),spec))];if(options&&options.dark)result.push(darkTheme.of(true));return result;}},{key:"baseTheme",value:function baseTheme(spec){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,spec,lightDarkIDs)));}}]);return EditorView;}();EditorView.scrollTo=scrollTo;EditorView.centerOn=centerOn;EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=/* @__PURE__ */EditorView.contentAttributes.of({"class":"cm-lineWrapping"});EditorView.announce=/* @__PURE__ */StateEffect.define();var MaxBidiLine=4096;function ensureTop(given,dom){return given==null?dom.getBoundingClientRect().top:given;}var resizeDebounce=-1;function ensureGlobalHandler(){window.addEventListener("resize",function(){if(resizeDebounce==-1)resizeDebounce=setTimeout(handleResize,50);});}function handleResize(){resizeDebounce=-1;var found=document.querySelectorAll(".cm-content");for(var _i96=0;_i96<found.length;_i96++){var docView=ContentView.get(found[_i96]);if(docView)docView.editorView.requestMeasure();}}var BadMeasure={};var CachedOrder=/*#__PURE__*/function(){function CachedOrder(from,to,dir,order){_classCallCheck(this,CachedOrder);this.from=from;this.to=to;this.dir=dir;this.order=order;}_createClass(CachedOrder,null,[{key:"update",value:function update(cache,changes){if(changes.empty)return cache;var result=[],lastDir=cache.length?cache[cache.length-1].dir:Direction.LTR;for(var _i97=Math.max(0,cache.length-10);_i97<cache.length;_i97++){var entry=cache[_i97];if(entry.dir==lastDir&&!changes.touchesRange(entry.from,entry.to))result.push(new CachedOrder(changes.mapPos(entry.from,1),changes.mapPos(entry.to,-1),entry.dir,entry.order));}return result;}}]);return CachedOrder;}();var currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(name2,platform){var parts=name2.split(/-(?!$)/);var result=parts[parts.length-1];if(result=="Space")result=" ";var alt,ctrl,shift2,meta2;for(var _i98=0;_i98<parts.length-1;++_i98){var mod=parts[_i98];if(/^(cmd|meta|m)$/i.test(mod))meta2=true;else if(/^a(lt)?$/i.test(mod))alt=true;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=true;else if(/^s(hift)?$/i.test(mod))shift2=true;else if(/^mod$/i.test(mod)){if(platform=="mac")meta2=true;else ctrl=true;}else throw new Error("Unrecognized modifier name: "+mod);}if(alt)result="Alt-"+result;if(ctrl)result="Ctrl-"+result;if(meta2)result="Meta-"+result;if(shift2)result="Shift-"+result;return result;}function modifiers(name2,event,shift2){if(event.altKey)name2="Alt-"+name2;if(event.ctrlKey)name2="Ctrl-"+name2;if(event.metaKey)name2="Meta-"+name2;if(shift2!==false&&event.shiftKey)name2="Shift-"+name2;return name2;}var handleKeyEvents=/* @__PURE__ */EditorView.domEventHandlers({keydown:function keydown(event,view){return runHandlers(getKeymap(view.state),event,view,"editor");}});var keymap=/* @__PURE__ */Facet.define({enables:handleKeyEvents});var Keymaps=/* @__PURE__ */new WeakMap();function getKeymap(state){var bindings=state.facet(keymap);var map=Keymaps.get(bindings);if(!map)Keymaps.set(bindings,map=buildKeymap(bindings.reduce(function(a,b){return a.concat(b);},[])));return map;}var storedPrefix=null;var PrefixTimeout=4e3;function buildKeymap(bindings){var platform=arguments.length>1&&arguments[1]!==undefined?arguments[1]:currentPlatform;var bound=/* @__PURE__ */Object.create(null);var isPrefix=/* @__PURE__ */Object.create(null);var checkPrefix=function checkPrefix(name2,is){var current=isPrefix[name2];if(current==null)isPrefix[name2]=is;else if(current!=is)throw new Error("Key binding "+name2+" is used both as a regular binding and as a multi-stroke prefix");};var add2=function add2(scope,key,command2,preventDefault){var scopeObj=bound[scope]||(bound[scope]=/* @__PURE__ */Object.create(null));var parts=key.split(/ (?!$)/).map(function(k){return normalizeKeyName(k,platform);});var _loop10=function _loop10(_i99){var prefix=parts.slice(0,_i99).join(" ");checkPrefix(prefix,true);if(!scopeObj[prefix])scopeObj[prefix]={preventDefault:true,commands:[function(view){var ourObj=storedPrefix={view:view,prefix:prefix,scope:scope};setTimeout(function(){if(storedPrefix==ourObj)storedPrefix=null;},PrefixTimeout);return true;}]};};for(var _i99=1;_i99<parts.length;_i99++){_loop10(_i99);}var full=parts.join(" ");checkPrefix(full,false);var binding=scopeObj[full]||(scopeObj[full]={preventDefault:false,commands:[]});binding.commands.push(command2);if(preventDefault)binding.preventDefault=true;};var _iterator83=_createForOfIteratorHelper(bindings),_step83;try{for(_iterator83.s();!(_step83=_iterator83.n()).done;){var b=_step83.value;var name2=b[platform]||b.key;if(!name2)continue;var _iterator84=_createForOfIteratorHelper(b.scope?b.scope.split(" "):["editor"]),_step84;try{for(_iterator84.s();!(_step84=_iterator84.n()).done;){var scope=_step84.value;add2(scope,name2,b.run,b.preventDefault);if(b.shift)add2(scope,"Shift-"+name2,b.shift,b.preventDefault);}}catch(err){_iterator84.e(err);}finally{_iterator84.f();}}}catch(err){_iterator83.e(err);}finally{_iterator83.f();}return bound;}function runHandlers(map,event,view,scope){var name2=keyName(event),isChar=name2.length==1&&name2!=" ";var prefix="",fallthrough=false;if(storedPrefix&&storedPrefix.view==view&&storedPrefix.scope==scope){prefix=storedPrefix.prefix+" ";if(fallthrough=modifierCodes.indexOf(event.keyCode)<0)storedPrefix=null;}var runFor=function runFor(binding){if(binding){var _iterator85=_createForOfIteratorHelper(binding.commands),_step85;try{for(_iterator85.s();!(_step85=_iterator85.n()).done;){var cmd2=_step85.value;if(cmd2(view))return true;}}catch(err){_iterator85.e(err);}finally{_iterator85.f();}if(binding.preventDefault)fallthrough=true;}return false;};var scopeObj=map[scope],baseName;if(scopeObj){if(runFor(scopeObj[prefix+modifiers(name2,event,!isChar)]))return true;if(isChar&&(event.shiftKey||event.altKey||event.metaKey)&&(baseName=base[event.keyCode])&&baseName!=name2){if(runFor(scopeObj[prefix+modifiers(baseName,event,true)]))return true;}else if(isChar&&event.shiftKey){if(runFor(scopeObj[prefix+modifiers(name2,event,true)]))return true;}}return fallthrough;}var CanHidePrimary=!browser.ios;var selectionConfig=/* @__PURE__ */Facet.define({combine:function combine(configs){return combineConfig(configs,{cursorBlinkRate:1200,drawRangeCursor:true},{cursorBlinkRate:function cursorBlinkRate(a,b){return Math.min(a,b);},drawRangeCursor:function drawRangeCursor(a,b){return a||b;}});}});function drawSelection(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[selectionConfig.of(config2),drawSelectionPlugin,hideNativeSelection];}var Piece=/*#__PURE__*/function(){function Piece(left,top2,width,height,className){_classCallCheck(this,Piece);this.left=left;this.top=top2;this.width=width;this.height=height;this.className=className;}_createClass(Piece,[{key:"draw",value:function draw(){var elt=document.createElement("div");elt.className=this.className;this.adjust(elt);return elt;}},{key:"adjust",value:function adjust(elt){elt.style.left=this.left+"px";elt.style.top=this.top+"px";if(this.width>=0)elt.style.width=this.width+"px";elt.style.height=this.height+"px";}},{key:"eq",value:function eq(p){return this.left==p.left&&this.top==p.top&&this.width==p.width&&this.height==p.height&&this.className==p.className;}}]);return Piece;}();var drawSelectionPlugin=/* @__PURE__ */ViewPlugin.fromClass(/*#__PURE__*/function(){function _class(view){_classCallCheck(this,_class);this.view=view;this.rangePieces=[];this.cursors=[];this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)};this.selectionLayer=view.scrollDOM.appendChild(document.createElement("div"));this.selectionLayer.className="cm-selectionLayer";this.selectionLayer.setAttribute("aria-hidden","true");this.cursorLayer=view.scrollDOM.appendChild(document.createElement("div"));this.cursorLayer.className="cm-cursorLayer";this.cursorLayer.setAttribute("aria-hidden","true");view.requestMeasure(this.measureReq);this.setBlinkRate();}_createClass(_class,[{key:"setBlinkRate",value:function setBlinkRate(){this.cursorLayer.style.animationDuration=this.view.state.facet(selectionConfig).cursorBlinkRate+"ms";}},{key:"update",value:function update(_update6){var confChanged=_update6.startState.facet(selectionConfig)!=_update6.state.facet(selectionConfig);if(confChanged||_update6.selectionSet||_update6.geometryChanged||_update6.viewportChanged)this.view.requestMeasure(this.measureReq);if(_update6.transactions.some(function(tr){return tr.scrollIntoView;}))this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink";if(confChanged)this.setBlinkRate();}},{key:"readPos",value:function readPos(){var _this45=this;var state=this.view.state,conf=state.facet(selectionConfig);var rangePieces=state.selection.ranges.map(function(r){return r.empty?[]:measureRange(_this45.view,r);}).reduce(function(a,b){return a.concat(b);});var cursors=[];var _iterator86=_createForOfIteratorHelper(state.selection.ranges),_step86;try{for(_iterator86.s();!(_step86=_iterator86.n()).done;){var _r2=_step86.value;var prim=_r2==state.selection.main;if(_r2.empty?!prim||CanHidePrimary:conf.drawRangeCursor){var piece=measureCursor(this.view,_r2,prim);if(piece)cursors.push(piece);}}}catch(err){_iterator86.e(err);}finally{_iterator86.f();}return{rangePieces:rangePieces,cursors:cursors};}},{key:"drawSel",value:function drawSel(_ref17){var _this46=this;var rangePieces=_ref17.rangePieces,cursors=_ref17.cursors;if(rangePieces.length!=this.rangePieces.length||rangePieces.some(function(p,i){return!p.eq(_this46.rangePieces[i]);})){this.selectionLayer.textContent="";var _iterator87=_createForOfIteratorHelper(rangePieces),_step87;try{for(_iterator87.s();!(_step87=_iterator87.n()).done;){var _p2=_step87.value;this.selectionLayer.appendChild(_p2.draw());}}catch(err){_iterator87.e(err);}finally{_iterator87.f();}this.rangePieces=rangePieces;}if(cursors.length!=this.cursors.length||cursors.some(function(c,i){return!c.eq(_this46.cursors[i]);})){var oldCursors=this.cursorLayer.children;if(oldCursors.length!==cursors.length){this.cursorLayer.textContent="";var _iterator88=_createForOfIteratorHelper(cursors),_step88;try{for(_iterator88.s();!(_step88=_iterator88.n()).done;){var c=_step88.value;this.cursorLayer.appendChild(c.draw());}}catch(err){_iterator88.e(err);}finally{_iterator88.f();}}else{cursors.forEach(function(c,idx){return c.adjust(oldCursors[idx]);});}this.cursors=cursors;}}},{key:"destroy",value:function destroy(){this.selectionLayer.remove();this.cursorLayer.remove();}}]);return _class;}());var themeSpec={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};if(CanHidePrimary)themeSpec[".cm-line"].caretColor="transparent !important";var hideNativeSelection=/* @__PURE__ */Prec.highest(/* @__PURE__ */EditorView.theme(themeSpec));function getBase(view){var rect=view.scrollDOM.getBoundingClientRect();var left=view.textDirection==Direction.LTR?rect.left:rect.right-view.scrollDOM.clientWidth;return{left:left-view.scrollDOM.scrollLeft,top:rect.top-view.scrollDOM.scrollTop};}function wrappedLine(view,pos,inside6){var range=EditorSelection.cursor(pos);return{from:Math.max(inside6.from,view.moveToLineBoundary(range,false,true).from),to:Math.min(inside6.to,view.moveToLineBoundary(range,true,true).from),type:BlockType.Text};}function blockAt(view,pos){var line=view.visualLineAt(pos);if(Array.isArray(line.type)){var _iterator89=_createForOfIteratorHelper(line.type),_step89;try{for(_iterator89.s();!(_step89=_iterator89.n()).done;){var _l2=_step89.value;if(_l2.to>pos||_l2.to==pos&&(_l2.to==line.to||_l2.type==BlockType.Text))return _l2;}}catch(err){_iterator89.e(err);}finally{_iterator89.f();}}return line;}function measureRange(view,range){if(range.to<=view.viewport.from||range.from>=view.viewport.to)return[];var from=Math.max(range.from,view.viewport.from),to=Math.min(range.to,view.viewport.to);var ltr=view.textDirection==Direction.LTR;var content2=view.contentDOM,contentRect=content2.getBoundingClientRect(),base2=getBase(view);var lineStyle=window.getComputedStyle(content2.firstChild);var leftSide=contentRect.left+parseInt(lineStyle.paddingLeft);var rightSide=contentRect.right-parseInt(lineStyle.paddingRight);var startBlock=blockAt(view,from),endBlock=blockAt(view,to);var visualStart=startBlock.type==BlockType.Text?startBlock:null;var visualEnd=endBlock.type==BlockType.Text?endBlock:null;if(view.lineWrapping){if(visualStart)visualStart=wrappedLine(view,from,visualStart);if(visualEnd)visualEnd=wrappedLine(view,to,visualEnd);}if(visualStart&&visualEnd&&visualStart.from==visualEnd.from){return pieces(drawForLine(range.from,range.to,visualStart));}else{var top2=visualStart?drawForLine(range.from,null,visualStart):drawForWidget(startBlock,false);var bottom=visualEnd?drawForLine(null,range.to,visualEnd):drawForWidget(endBlock,true);var between=[];if((visualStart||startBlock).to<(visualEnd||endBlock).from-1)between.push(piece(leftSide,top2.bottom,rightSide,bottom.top));else if(top2.bottom<bottom.top&&blockAt(view,(top2.bottom+bottom.top)/2).type==BlockType.Text)top2.bottom=bottom.top=(top2.bottom+bottom.top)/2;return pieces(top2).concat(between).concat(pieces(bottom));}function piece(left,top2,right,bottom){return new Piece(left-base2.left,top2-base2.top,right-left,bottom-top2,"cm-selectionBackground");}function pieces(_ref18){var top2=_ref18.top,bottom=_ref18.bottom,horizontal=_ref18.horizontal;var pieces2=[];for(var _i100=0;_i100<horizontal.length;_i100+=2){pieces2.push(piece(horizontal[_i100],top2,horizontal[_i100+1],bottom));}return pieces2;}function drawForLine(from2,to2,line){var top2=1e9,bottom=-1e9,horizontal=[];function addSpan(from3,fromOpen,to3,toOpen,dir){var fromCoords=view.coordsAtPos(from3,from3==line.to?-2:2);var toCoords=view.coordsAtPos(to3,to3==line.from?2:-2);top2=Math.min(fromCoords.top,toCoords.top,top2);bottom=Math.max(fromCoords.bottom,toCoords.bottom,bottom);if(dir==Direction.LTR)horizontal.push(ltr&&fromOpen?leftSide:fromCoords.left,ltr&&toOpen?rightSide:toCoords.right);else horizontal.push(!ltr&&toOpen?leftSide:toCoords.left,!ltr&&fromOpen?rightSide:fromCoords.right);}var start=from2!==null&&from2!==void 0?from2:line.from,end=to2!==null&&to2!==void 0?to2:line.to;var _iterator90=_createForOfIteratorHelper(view.visibleRanges),_step90;try{for(_iterator90.s();!(_step90=_iterator90.n()).done;){var _r3=_step90.value;if(_r3.to>start&&_r3.from<end){for(var pos=Math.max(_r3.from,start),endPos=Math.min(_r3.to,end);;){var docLine=view.state.doc.lineAt(pos);var _iterator91=_createForOfIteratorHelper(view.bidiSpans(docLine)),_step91;try{for(_iterator91.s();!(_step91=_iterator91.n()).done;){var span=_step91.value;var spanFrom=span.from+docLine.from,spanTo=span.to+docLine.from;if(spanFrom>=endPos)break;if(spanTo>pos)addSpan(Math.max(spanFrom,pos),from2==null&&spanFrom<=start,Math.min(spanTo,endPos),to2==null&&spanTo>=end,span.dir);}}catch(err){_iterator91.e(err);}finally{_iterator91.f();}pos=docLine.to+1;if(pos>=endPos)break;}}}}catch(err){_iterator90.e(err);}finally{_iterator90.f();}if(horizontal.length==0)addSpan(start,from2==null,end,to2==null,view.textDirection);return{top:top2,bottom:bottom,horizontal:horizontal};}function drawForWidget(block,top2){var y=contentRect.top+(top2?block.top:block.bottom);return{top:y,bottom:y,horizontal:[]};}}function measureCursor(view,cursor2,primary){var pos=view.coordsAtPos(cursor2.head,cursor2.assoc||1);if(!pos)return null;var base2=getBase(view);return new Piece(pos.left-base2.left,pos.top-base2.top,-1,pos.bottom-pos.top,primary?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary");}function iterMatches(doc6,re,from,to,f){re.lastIndex=0;for(var cursor2=doc6.iterRange(from,to),pos=from,m;!cursor2.next().done;pos+=cursor2.value.length){if(!cursor2.lineBreak)while(m=re.exec(cursor2.value)){f(pos+m.index,pos+m.index+m[0].length,m);}}}var MatchDecorator=/*#__PURE__*/function(){function MatchDecorator(config2){_classCallCheck(this,MatchDecorator);var regexp=config2.regexp,decoration=config2.decoration,boundary=config2.boundary;if(!regexp.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=regexp;this.getDeco=typeof decoration=="function"?decoration:function(){return decoration;};this.boundary=boundary;}_createClass(MatchDecorator,[{key:"createDeco",value:function createDeco(view){var _this47=this;var build=new RangeSetBuilder();var _iterator92=_createForOfIteratorHelper(view.visibleRanges),_step92;try{for(_iterator92.s();!(_step92=_iterator92.n()).done;){var _step92$value=_step92.value,from=_step92$value.from,to=_step92$value.to;iterMatches(view.state.doc,this.regexp,from,to,function(a,b,m){return build.add(a,b,_this47.getDeco(m,view,a));});}}catch(err){_iterator92.e(err);}finally{_iterator92.f();}return build.finish();}},{key:"updateDeco",value:function updateDeco(update,deco){var changeFrom=1e9,changeTo=-1;if(update.docChanged)update.changes.iterChanges(function(_f,_t,from,to){if(to>update.view.viewport.from&&from<update.view.viewport.to){changeFrom=Math.min(from,changeFrom);changeTo=Math.max(to,changeTo);}});if(update.viewportChanged||changeTo-changeFrom>1e3)return this.createDeco(update.view);if(changeTo>-1)return this.updateRange(update.view,deco.map(update.changes),changeFrom,changeTo);return deco;}},{key:"updateRange",value:function updateRange(view,deco,updateFrom,updateTo){var _this48=this;var _iterator93=_createForOfIteratorHelper(view.visibleRanges),_step93;try{for(_iterator93.s();!(_step93=_iterator93.n()).done;){var _r4=_step93.value;var from=Math.max(_r4.from,updateFrom),to=Math.min(_r4.to,updateTo);if(to>from){(function(){var fromLine=view.state.doc.lineAt(from),toLine=fromLine.to<to?view.state.doc.lineAt(to):fromLine;var start=Math.max(_r4.from,fromLine.from),end=Math.min(_r4.to,toLine.to);if(_this48.boundary){for(;from>fromLine.from;from--){if(_this48.boundary.test(fromLine.text[from-1-fromLine.from])){start=from;break;}}for(;to<toLine.to;to++){if(_this48.boundary.test(toLine.text[to-toLine.from])){end=to;break;}}}var ranges=[],m=void 0;if(fromLine==toLine){_this48.regexp.lastIndex=start-fromLine.from;while((m=_this48.regexp.exec(fromLine.text))&&m.index<end-fromLine.from){var pos=m.index+fromLine.from;ranges.push(_this48.getDeco(m,view,pos).range(pos,pos+m[0].length));}}else{iterMatches(view.state.doc,_this48.regexp,start,end,function(from2,to2,m2){return ranges.push(_this48.getDeco(m2,view,from2).range(from2,to2));});}deco=deco.update({filterFrom:start,filterTo:end,filter:function filter(from2,to2){return from2<start||to2>end;},add:ranges});})();}}}catch(err){_iterator93.e(err);}finally{_iterator93.f();}return deco;}}]);return MatchDecorator;}();var UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g";var Specials=/* @__PURE__ */new RegExp("[\0-\b\n-\x1F\x7F-\x9F\xAD\u061C\u200B\u200E\u200F\u2028\u2029\u202D\u202E\uFEFF\uFFF9-\uFFFC]",UnicodeRegexpSupport);var Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};var _supportsTabSize=null;function supportsTabSize(){var _a;if(_supportsTabSize==null&&typeof document!="undefined"&&document.body){var styles=document.body.style;_supportsTabSize=((_a=styles.tabSize)!==null&&_a!==void 0?_a:styles.MozTabSize)!=null;}return _supportsTabSize||false;}var specialCharConfig=/* @__PURE__ */Facet.define({combine:function combine(configs){var config2=combineConfig(configs,{render:null,specialChars:Specials,addSpecialChars:null});if(config2.replaceTabs=!supportsTabSize())config2.specialChars=new RegExp("	|"+config2.specialChars.source,UnicodeRegexpSupport);if(config2.addSpecialChars)config2.specialChars=new RegExp(config2.specialChars.source+"|"+config2.addSpecialChars.source,UnicodeRegexpSupport);return config2;}});function highlightSpecialChars(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[specialCharConfig.of(config2),specialCharPlugin()];}var _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(/*#__PURE__*/function(){function _class2(view){_classCallCheck(this,_class2);this.view=view;this.decorations=Decoration.none;this.decorationCache=/* @__PURE__ */Object.create(null);this.decorator=this.makeDecorator(view.state.facet(specialCharConfig));this.decorations=this.decorator.createDeco(view);}_createClass(_class2,[{key:"makeDecorator",value:function makeDecorator(conf){var _this49=this;return new MatchDecorator({regexp:conf.specialChars,decoration:function decoration(m,view,pos){var doc6=view.state.doc;var code=codePointAt(m[0],0);if(code==9){var line=doc6.lineAt(pos);var size=view.state.tabSize,col=_countColumn(line.text,size,pos-line.from);return Decoration.replace({widget:new TabWidget((size-col%size)*_this49.view.defaultCharacterWidth)});}return _this49.decorationCache[code]||(_this49.decorationCache[code]=Decoration.replace({widget:new SpecialCharWidget(conf,code)}));},boundary:conf.replaceTabs?void 0:/[^]/});}},{key:"update",value:function update(_update7){var conf=_update7.state.facet(specialCharConfig);if(_update7.startState.facet(specialCharConfig)!=conf){this.decorator=this.makeDecorator(conf);this.decorations=this.decorator.createDeco(_update7.view);}else{this.decorations=this.decorator.updateDeco(_update7,this.decorations);}}}]);return _class2;}(),{decorations:function decorations(v){return v.decorations;}}));}var DefaultPlaceholder="\u2022";function placeholder$1(code){if(code>=32)return DefaultPlaceholder;if(code==10)return"\u2424";return String.fromCharCode(9216+code);}var SpecialCharWidget=/*#__PURE__*/function(_WidgetType5){_inherits(SpecialCharWidget,_WidgetType5);var _super25=_createSuper(SpecialCharWidget);function SpecialCharWidget(options,code){var _this50;_classCallCheck(this,SpecialCharWidget);_this50=_super25.call(this);_this50.options=options;_this50.code=code;return _this50;}_createClass(SpecialCharWidget,[{key:"eq",value:function eq(other){return other.code==this.code;}},{key:"toDOM",value:function toDOM(view){var ph=placeholder$1(this.code);var desc=view.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16));var custom=this.options.render&&this.options.render(this.code,desc,ph);if(custom)return custom;var span=document.createElement("span");span.textContent=ph;span.title=desc;span.setAttribute("aria-label",desc);span.className="cm-specialChar";return span;}},{key:"ignoreEvent",value:function ignoreEvent(){return false;}}]);return SpecialCharWidget;}(WidgetType);var TabWidget=/*#__PURE__*/function(_WidgetType6){_inherits(TabWidget,_WidgetType6);var _super26=_createSuper(TabWidget);function TabWidget(width){var _this51;_classCallCheck(this,TabWidget);_this51=_super26.call(this);_this51.width=width;return _this51;}_createClass(TabWidget,[{key:"eq",value:function eq(other){return other.width==this.width;}},{key:"toDOM",value:function toDOM(){var span=document.createElement("span");span.textContent="	";span.className="cm-tab";span.style.width=this.width+"px";return span;}},{key:"ignoreEvent",value:function ignoreEvent(){return false;}}]);return TabWidget;}(WidgetType);function highlightActiveLine(){return activeLineHighlighter;}var lineDeco=/* @__PURE__ */Decoration.line({"class":"cm-activeLine"});var activeLineHighlighter=/* @__PURE__ */ViewPlugin.fromClass(/*#__PURE__*/function(){function _class3(view){_classCallCheck(this,_class3);this.decorations=this.getDeco(view);}_createClass(_class3,[{key:"update",value:function update(_update8){if(_update8.docChanged||_update8.selectionSet)this.decorations=this.getDeco(_update8.view);}},{key:"getDeco",value:function getDeco(view){var lastLineStart=-1,deco=[];var _iterator94=_createForOfIteratorHelper(view.state.selection.ranges),_step94;try{for(_iterator94.s();!(_step94=_iterator94.n()).done;){var _r5=_step94.value;if(!_r5.empty)return Decoration.none;var line=view.visualLineAt(_r5.head);if(line.from>lastLineStart){deco.push(lineDeco.range(line.from));lastLineStart=line.from;}}}catch(err){_iterator94.e(err);}finally{_iterator94.f();}return Decoration.set(deco);}}]);return _class3;}(),{decorations:function decorations(v){return v.decorations;}});// ../node_modules/@codemirror/history/dist/index.js
var fromHistory=/* @__PURE__ */Annotation.define();var isolateHistory=/* @__PURE__ */Annotation.define();var invertedEffects=/* @__PURE__ */Facet.define();var historyConfig=/* @__PURE__ */Facet.define({combine:function combine(configs){return combineConfig(configs,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min});}});function changeEnd(changes){var end=0;changes.iterChangedRanges(function(_,to){return end=to;});return end;}var historyField_=/* @__PURE__ */StateField.define({create:function create(){return HistoryState.empty;},update:function update(state,tr){var config2=tr.state.facet(historyConfig);var fromHist=tr.annotation(fromHistory);if(fromHist){var selection2=tr.docChanged?EditorSelection.single(changeEnd(tr.changes)):void 0;var item=HistEvent.fromTransaction(tr,selection2),from=fromHist.side;var other=from==0?state.undone:state.done;if(item)other=updateBranch(other,other.length,config2.minDepth,item);else other=_addSelection(other,tr.startState.selection);return new HistoryState(from==0?fromHist.rest:other,from==0?other:fromHist.rest);}var isolate=tr.annotation(isolateHistory);if(isolate=="full"||isolate=="before")state=state.isolate();if(tr.annotation(Transaction.addToHistory)===false)return!tr.changes.empty?state.addMapping(tr.changes.desc):state;var event=HistEvent.fromTransaction(tr);var time=tr.annotation(Transaction.time),userEvent=tr.annotation(Transaction.userEvent);if(event)state=state.addChanges(event,time,userEvent,config2.newGroupDelay,config2.minDepth);else if(tr.selection)state=state.addSelection(tr.startState.selection,time,userEvent,config2.newGroupDelay);if(isolate=="full"||isolate=="after")state=state.isolate();return state;},toJSON:function toJSON(value){return{done:value.done.map(function(e){return e.toJSON();}),undone:value.undone.map(function(e){return e.toJSON();})};},fromJSON:function fromJSON(json){return new HistoryState(json.done.map(HistEvent.fromJSON),json.undone.map(HistEvent.fromJSON));}});function history(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[historyField_,historyConfig.of(config2),EditorView.domEventHandlers({beforeinput:function beforeinput(e,view){var command2=e.inputType=="historyUndo"?undo:e.inputType=="historyRedo"?redo:null;if(!command2)return false;e.preventDefault();return command2(view);}})];}function cmd(side,selection2){return function(_ref19){var state=_ref19.state,dispatch=_ref19.dispatch;if(!selection2&&state.readOnly)return false;var historyState=state.field(historyField_,false);if(!historyState)return false;var tr=historyState.pop(side,state,selection2);if(!tr)return false;dispatch(tr);return true;};}var undo=/* @__PURE__ */cmd(0,false);var redo=/* @__PURE__ */cmd(1,false);var undoSelection=/* @__PURE__ */cmd(0,true);var redoSelection=/* @__PURE__ */cmd(1,true);var HistEvent=/*#__PURE__*/function(){function HistEvent(changes,effects,mapped,startSelection,selectionsAfter){_classCallCheck(this,HistEvent);this.changes=changes;this.effects=effects;this.mapped=mapped;this.startSelection=startSelection;this.selectionsAfter=selectionsAfter;}_createClass(HistEvent,[{key:"setSelAfter",value:function setSelAfter(after){return new HistEvent(this.changes,this.effects,this.mapped,this.startSelection,after);}},{key:"toJSON",value:function toJSON(){var _a,_b,_c;return{changes:(_a=this.changes)===null||_a===void 0?void 0:_a.toJSON(),mapped:(_b=this.mapped)===null||_b===void 0?void 0:_b.toJSON(),startSelection:(_c=this.startSelection)===null||_c===void 0?void 0:_c.toJSON(),selectionsAfter:this.selectionsAfter.map(function(s){return s.toJSON();})};}}],[{key:"fromJSON",value:function fromJSON(json){return new HistEvent(json.changes&&ChangeSet.fromJSON(json.changes),[],json.mapped&&ChangeDesc.fromJSON(json.mapped),json.startSelection&&EditorSelection.fromJSON(json.startSelection),json.selectionsAfter.map(EditorSelection.fromJSON));}},{key:"fromTransaction",value:function fromTransaction(tr,selection2){var effects=none3;var _iterator95=_createForOfIteratorHelper(tr.startState.facet(invertedEffects)),_step95;try{for(_iterator95.s();!(_step95=_iterator95.n()).done;){var invert=_step95.value;var result=invert(tr);if(result.length)effects=effects.concat(result);}}catch(err){_iterator95.e(err);}finally{_iterator95.f();}if(!effects.length&&tr.changes.empty)return null;return new HistEvent(tr.changes.invert(tr.startState.doc),effects,void 0,selection2||tr.startState.selection,none3);}},{key:"selection",value:function selection(selections){return new HistEvent(void 0,none3,void 0,void 0,selections);}}]);return HistEvent;}();function updateBranch(branch,to,maxLen,newEvent){var start=to+1>maxLen+20?to-maxLen-1:0;var newBranch=branch.slice(start,to);newBranch.push(newEvent);return newBranch;}function isAdjacent(a,b){var ranges=[],isAdjacent2=false;a.iterChangedRanges(function(f,t2){return ranges.push(f,t2);});b.iterChangedRanges(function(_f,_t,f,t2){for(var _i101=0;_i101<ranges.length;){var from=ranges[_i101++],to=ranges[_i101++];if(t2>=from&&f<=to)isAdjacent2=true;}});return isAdjacent2;}function eqSelectionShape(a,b){return a.ranges.length==b.ranges.length&&a.ranges.filter(function(r,i){return r.empty!=b.ranges[i].empty;}).length===0;}function conc(a,b){return!a.length?b:!b.length?a:a.concat(b);}var none3=[];var MaxSelectionsPerEvent=200;function _addSelection(branch,selection2){if(!branch.length){return[HistEvent.selection([selection2])];}else{var lastEvent=branch[branch.length-1];var sels=lastEvent.selectionsAfter.slice(Math.max(0,lastEvent.selectionsAfter.length-MaxSelectionsPerEvent));if(sels.length&&sels[sels.length-1].eq(selection2))return branch;sels.push(selection2);return updateBranch(branch,branch.length-1,1e9,lastEvent.setSelAfter(sels));}}function popSelection(branch){var last=branch[branch.length-1];var newBranch=branch.slice();newBranch[branch.length-1]=last.setSelAfter(last.selectionsAfter.slice(0,last.selectionsAfter.length-1));return newBranch;}function addMappingToBranch(branch,mapping){if(!branch.length)return branch;var length=branch.length,selections=none3;while(length){var event=mapEvent(branch[length-1],mapping,selections);if(event.changes&&!event.changes.empty||event.effects.length){var result=branch.slice(0,length);result[length-1]=event;return result;}else{mapping=event.mapped;length--;selections=event.selectionsAfter;}}return selections.length?[HistEvent.selection(selections)]:none3;}function mapEvent(event,mapping,extraSelections){var selections=conc(event.selectionsAfter.length?event.selectionsAfter.map(function(s){return s.map(mapping);}):none3,extraSelections);if(!event.changes)return HistEvent.selection(selections);var mappedChanges=event.changes.map(mapping),before=mapping.mapDesc(event.changes,true);var fullMapping=event.mapped?event.mapped.composeDesc(before):before;return new HistEvent(mappedChanges,StateEffect.mapEffects(event.effects,mapping),fullMapping,event.startSelection.map(before),selections);}var joinableUserEvent=/^(input\.type|delete)($|\.)/;var HistoryState=/*#__PURE__*/function(){function HistoryState(done,undone){var prevTime=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var prevUserEvent=arguments.length>3&&arguments[3]!==undefined?arguments[3]:void 0;_classCallCheck(this,HistoryState);this.done=done;this.undone=undone;this.prevTime=prevTime;this.prevUserEvent=prevUserEvent;}_createClass(HistoryState,[{key:"isolate",value:function isolate(){return this.prevTime?new HistoryState(this.done,this.undone):this;}},{key:"addChanges",value:function addChanges(event,time,userEvent,newGroupDelay,maxLen){var done=this.done,lastEvent=done[done.length-1];if(lastEvent&&lastEvent.changes&&!lastEvent.changes.empty&&event.changes&&(!userEvent||joinableUserEvent.test(userEvent))&&(!lastEvent.selectionsAfter.length&&time-this.prevTime<newGroupDelay&&isAdjacent(lastEvent.changes,event.changes)||userEvent=="input.type.compose")){done=updateBranch(done,done.length-1,maxLen,new HistEvent(event.changes.compose(lastEvent.changes),conc(event.effects,lastEvent.effects),lastEvent.mapped,lastEvent.startSelection,none3));}else{done=updateBranch(done,done.length,maxLen,event);}return new HistoryState(done,none3,time,userEvent);}},{key:"addSelection",value:function addSelection(selection2,time,userEvent,newGroupDelay){var last=this.done.length?this.done[this.done.length-1].selectionsAfter:none3;if(last.length>0&&time-this.prevTime<newGroupDelay&&userEvent==this.prevUserEvent&&userEvent&&/^select($|\.)/.test(userEvent)&&eqSelectionShape(last[last.length-1],selection2))return this;return new HistoryState(_addSelection(this.done,selection2),this.undone,time,userEvent);}},{key:"addMapping",value:function addMapping(mapping){return new HistoryState(addMappingToBranch(this.done,mapping),addMappingToBranch(this.undone,mapping),this.prevTime,this.prevUserEvent);}},{key:"pop",value:function pop(side,state,selection2){var branch=side==0?this.done:this.undone;if(branch.length==0)return null;var event=branch[branch.length-1];if(selection2&&event.selectionsAfter.length){return state.update({selection:event.selectionsAfter[event.selectionsAfter.length-1],annotations:fromHistory.of({side:side,rest:popSelection(branch)}),userEvent:side==0?"select.undo":"select.redo",scrollIntoView:true});}else if(!event.changes){return null;}else{var rest=branch.length==1?none3:branch.slice(0,branch.length-1);if(event.mapped)rest=addMappingToBranch(rest,event.mapped);return state.update({changes:event.changes,selection:event.startSelection,effects:event.effects,annotations:fromHistory.of({side:side,rest:rest}),filter:false,userEvent:side==0?"undo":"redo",scrollIntoView:true});}}}]);return HistoryState;}();HistoryState.empty=/* @__PURE__ */new HistoryState(none3,none3);var historyKeymap=[{key:"Mod-z",run:undo,preventDefault:true},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:true},{key:"Mod-u",run:undoSelection,preventDefault:true},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:true}];// ../node_modules/@codemirror/fold/node_modules/@codemirror/view/dist/index.js
function getSelection2(root){var target;if(root.nodeType==11){target=root.getSelection?root:root.ownerDocument;}else{target=root;}return target.getSelection();}function contains2(dom,node){return node?dom.contains(node.nodeType!=1?node.parentNode:node):false;}function deepActiveElement2(){var elt=document.activeElement;while(elt&&elt.shadowRoot){elt=elt.shadowRoot.activeElement;}return elt;}function hasSelection2(dom,selection2){if(!selection2.anchorNode)return false;try{return contains2(dom,selection2.anchorNode);}catch(_){return false;}}function clientRectsFor2(dom){if(dom.nodeType==3)return textRange2(dom,0,dom.nodeValue.length).getClientRects();else if(dom.nodeType==1)return dom.getClientRects();else return[];}function isEquivalentPosition2(node,off,targetNode,targetOff){return targetNode?scanFor2(node,off,targetNode,targetOff,-1)||scanFor2(node,off,targetNode,targetOff,1):false;}function domIndex2(node){for(var index=0;;index++){node=node.previousSibling;if(!node)return index;}}function scanFor2(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return true;if(off==(dir<0?0:maxOffset2(node))){if(node.nodeName=="DIV")return false;var parent=node.parentNode;if(!parent||parent.nodeType!=1)return false;off=domIndex2(node)+(dir<0?0:1);node=parent;}else if(node.nodeType==1){node=node.childNodes[off+(dir<0?-1:0)];if(node.nodeType==1&&node.contentEditable=="false")return false;off=dir<0?maxOffset2(node):0;}else{return false;}}}function maxOffset2(node){return node.nodeType==3?node.nodeValue.length:node.childNodes.length;}var Rect02={left:0,right:0,top:0,bottom:0};function flattenRect2(rect,left){var x=left?rect.left:rect.right;return{left:x,right:x,top:rect.top,bottom:rect.bottom};}function windowRect2(win){return{left:0,right:win.innerWidth,top:0,bottom:win.innerHeight};}function scrollRectIntoView2(dom,rect,side,x,y,xMargin,yMargin,ltr){var doc6=dom.ownerDocument,win=doc6.defaultView;for(var cur2=dom;cur2;){if(cur2.nodeType==1){var bounding=void 0,top2=cur2==doc6.body;if(top2){bounding=windowRect2(win);}else{if(cur2.scrollHeight<=cur2.clientHeight&&cur2.scrollWidth<=cur2.clientWidth){cur2=cur2.parentNode;continue;}var rect2=cur2.getBoundingClientRect();bounding={left:rect2.left,right:rect2.left+cur2.clientWidth,top:rect2.top,bottom:rect2.top+cur2.clientHeight};}var moveX=0,moveY=0;if(y=="nearest"){if(rect.top<bounding.top){moveY=-(bounding.top-rect.top+yMargin);if(side>0&&rect.bottom>bounding.bottom+moveY)moveY=rect.bottom-bounding.bottom+moveY+yMargin;}else if(rect.bottom>bounding.bottom){moveY=rect.bottom-bounding.bottom+yMargin;if(side<0&&rect.top-moveY<bounding.top)moveY=-(bounding.top+moveY-rect.top+yMargin);}}else{var rectHeight=rect.bottom-rect.top,boundingHeight=bounding.bottom-bounding.top;var targetTop=y=="center"&&rectHeight<=boundingHeight?rect.top+rectHeight/2-boundingHeight/2:y=="start"||y=="center"&&side<0?rect.top-yMargin:rect.bottom-boundingHeight+yMargin;moveY=targetTop-bounding.top;}if(x=="nearest"){if(rect.left<bounding.left){moveX=-(bounding.left-rect.left+xMargin);if(side>0&&rect.right>bounding.right+moveX)moveX=rect.right-bounding.right+moveX+xMargin;}else if(rect.right>bounding.right){moveX=rect.right-bounding.right+xMargin;if(side<0&&rect.left<bounding.left+moveX)moveX=-(bounding.left+moveX-rect.left+xMargin);}}else{var targetLeft=x=="center"?rect.left+(rect.right-rect.left)/2-(bounding.right-bounding.left)/2:x=="start"==ltr?rect.left-xMargin:rect.right-(bounding.right-bounding.left)+xMargin;moveX=targetLeft-bounding.left;}if(moveX||moveY){if(top2){win.scrollBy(moveX,moveY);}else{if(moveY){var start=cur2.scrollTop;cur2.scrollTop+=moveY;moveY=cur2.scrollTop-start;}if(moveX){var _start5=cur2.scrollLeft;cur2.scrollLeft+=moveX;moveX=cur2.scrollLeft-_start5;}rect={left:rect.left-moveX,top:rect.top-moveY,right:rect.right-moveX,bottom:rect.bottom-moveY};}}if(top2)break;cur2=cur2.assignedSlot||cur2.parentNode;x=y="nearest";}else if(cur2.nodeType==11){cur2=cur2.host;}else{break;}}}var DOMSelectionState=/*#__PURE__*/function(){function DOMSelectionState(){_classCallCheck(this,DOMSelectionState);this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0;}_createClass(DOMSelectionState,[{key:"eq",value:function eq(domSel){return this.anchorNode==domSel.anchorNode&&this.anchorOffset==domSel.anchorOffset&&this.focusNode==domSel.focusNode&&this.focusOffset==domSel.focusOffset;}},{key:"setRange",value:function setRange(range){this.set(range.anchorNode,range.anchorOffset,range.focusNode,range.focusOffset);}},{key:"set",value:function set(anchorNode,anchorOffset,focusNode,focusOffset){this.anchorNode=anchorNode;this.anchorOffset=anchorOffset;this.focusNode=focusNode;this.focusOffset=focusOffset;}}]);return DOMSelectionState;}();var preventScrollSupported2=null;function focusPreventScroll2(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported2)return dom.focus(preventScrollSupported2);var stack=[];for(var cur2=dom;cur2;cur2=cur2.parentNode){stack.push(cur2,cur2.scrollTop,cur2.scrollLeft);if(cur2==cur2.ownerDocument)break;}dom.focus(preventScrollSupported2==null?Object.defineProperties({},{preventScroll:{get:function get(){preventScrollSupported2={preventScroll:true};return true;},configurable:true,enumerable:true}}):void 0);if(!preventScrollSupported2){preventScrollSupported2=false;for(var _i102=0;_i102<stack.length;){var elt=stack[_i102++],top2=stack[_i102++],left=stack[_i102++];if(elt.scrollTop!=top2)elt.scrollTop=top2;if(elt.scrollLeft!=left)elt.scrollLeft=left;}}}var scratchRange2;function textRange2(node,from){var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:from;var range=scratchRange2||(scratchRange2=document.createRange());range.setEnd(node,to);range.setStart(node,from);return range;}function dispatchKey2(elt,name2,code){var options={key:name2,code:name2,keyCode:code,which:code,cancelable:true};var down=new KeyboardEvent("keydown",options);down.synthetic=true;elt.dispatchEvent(down);var up=new KeyboardEvent("keyup",options);up.synthetic=true;elt.dispatchEvent(up);return down.defaultPrevented||up.defaultPrevented;}function getRoot2(node){while(node){if(node&&(node.nodeType==9||node.nodeType==11&&node.host))return node;node=node.assignedSlot||node.parentNode;}return null;}function clearAttributes(node){while(node.attributes.length){node.removeAttributeNode(node.attributes[0]);}}var DOMPos2=/*#__PURE__*/function(){function DOMPos2(node,offset){var precise=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_classCallCheck(this,DOMPos2);this.node=node;this.offset=offset;this.precise=precise;}_createClass(DOMPos2,null,[{key:"before",value:function before(dom,precise){return new DOMPos2(dom.parentNode,domIndex2(dom),precise);}},{key:"after",value:function after(dom,precise){return new DOMPos2(dom.parentNode,domIndex2(dom)+1,precise);}}]);return DOMPos2;}();var noChildren=[];var ContentView2=/*#__PURE__*/function(){function ContentView2(){_classCallCheck(this,ContentView2);this.parent=null;this.dom=null;this.dirty=2;}_createClass(ContentView2,[{key:"editorView",get:function get(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"posAtStart",get:function get(){return this.parent?this.parent.posBefore(this):0;}},{key:"posAtEnd",get:function get(){return this.posAtStart+this.length;}},{key:"posBefore",value:function posBefore(view){var pos=this.posAtStart;var _iterator96=_createForOfIteratorHelper(this.children),_step96;try{for(_iterator96.s();!(_step96=_iterator96.n()).done;){var child=_step96.value;if(child==view)return pos;pos+=child.length+child.breakAfter;}}catch(err){_iterator96.e(err);}finally{_iterator96.f();}throw new RangeError("Invalid child in posBefore");}},{key:"posAfter",value:function posAfter(view){return this.posBefore(view)+view.length;}},{key:"coordsAt",value:function coordsAt(_pos,_side){return null;}},{key:"sync",value:function sync(track){if(this.dirty&2){var parent=this.dom;var pos=parent.firstChild;var _iterator97=_createForOfIteratorHelper(this.children),_step97;try{for(_iterator97.s();!(_step97=_iterator97.n()).done;){var child=_step97.value;if(child.dirty){if(!child.dom&&pos){var contentView=ContentView2.get(pos);if(!contentView||!contentView.parent&&contentView.constructor==child.constructor)child.reuseDOM(pos);}child.sync(track);child.dirty=0;}if(track&&!track.written&&track.node==parent&&pos!=child.dom)track.written=true;if(child.dom.parentNode==parent){while(pos&&pos!=child.dom){pos=rm2(pos);}pos=child.dom.nextSibling;}else{parent.insertBefore(child.dom,pos);}}}catch(err){_iterator97.e(err);}finally{_iterator97.f();}if(pos&&track&&track.node==parent)track.written=true;while(pos){pos=rm2(pos);}}else if(this.dirty&1){var _iterator98=_createForOfIteratorHelper(this.children),_step98;try{for(_iterator98.s();!(_step98=_iterator98.n()).done;){var _child2=_step98.value;if(_child2.dirty){_child2.sync(track);_child2.dirty=0;}}}catch(err){_iterator98.e(err);}finally{_iterator98.f();}}}},{key:"reuseDOM",value:function reuseDOM(_dom){}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){var after;if(node==this.dom){after=this.dom.childNodes[offset];}else{var bias=maxOffset2(node)==0?0:offset==0?-1:1;for(;;){var parent=node.parentNode;if(parent==this.dom)break;if(bias==0&&parent.firstChild!=parent.lastChild){if(node==parent.firstChild)bias=-1;else bias=1;}node=parent;}if(bias<0)after=node;else after=node.nextSibling;}if(after==this.dom.firstChild)return 0;while(after&&!ContentView2.get(after)){after=after.nextSibling;}if(!after)return this.length;for(var _i103=0,pos=0;;_i103++){var child=this.children[_i103];if(child.dom==after)return pos;pos+=child.length+child.breakAfter;}}},{key:"domBoundsAround",value:function domBoundsAround(from,to){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var fromI=-1,fromStart=-1,toI=-1,toEnd=-1;for(var _i104=0,pos=offset,prevEnd=offset;_i104<this.children.length;_i104++){var child=this.children[_i104],end=pos+child.length;if(pos<from&&end>to)return child.domBoundsAround(from,to,pos);if(end>=from&&fromI==-1){fromI=_i104;fromStart=pos;}if(pos>to&&child.dom.parentNode==this.dom){toI=_i104;toEnd=prevEnd;break;}prevEnd=end;pos=end+child.breakAfter;}return{from:fromStart,to:toEnd<0?offset+this.length:toEnd,startDOM:(fromI?this.children[fromI-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:toI<this.children.length&&toI>=0?this.children[toI].dom:null};}},{key:"markDirty",value:function markDirty(){var andParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.dirty|=2;this.markParentsDirty(andParent);}},{key:"markParentsDirty",value:function markParentsDirty(childList){for(var parent=this.parent;parent;parent=parent.parent){if(childList)parent.dirty|=2;if(parent.dirty&1)return;parent.dirty|=1;childList=false;}}},{key:"setParent",value:function setParent(parent){if(this.parent!=parent){this.parent=parent;if(this.dirty)this.markParentsDirty(true);}}},{key:"setDOM",value:function setDOM(dom){if(this.dom)this.dom.cmView=null;this.dom=dom;dom.cmView=this;}},{key:"rootView",get:function get(){for(var v=this;;){var parent=v.parent;if(!parent)return v;v=parent;}}},{key:"replaceChildren",value:function replaceChildren(from,to){var _this$children2;var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:noChildren;this.markDirty();for(var _i105=from;_i105<to;_i105++){var child=this.children[_i105];if(child.parent==this)child.destroy();}(_this$children2=this.children).splice.apply(_this$children2,[from,to-from].concat(_toConsumableArray(children)));for(var _i106=0;_i106<children.length;_i106++){children[_i106].setParent(this);}}},{key:"ignoreMutation",value:function ignoreMutation(_rec){return false;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return false;}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;return new ChildCursor2(this.children,pos,this.children.length);}},{key:"childPos",value:function childPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return this.childCursor().findPos(pos,bias);}},{key:"toString",value:function toString(){var name2=this.constructor.name.replace("View","");return name2+(this.children.length?"("+this.children.join()+")":this.length?"["+(name2=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"");}},{key:"isEditable",get:function get(){return true;}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){return false;}},{key:"become",value:function become(other){return false;}},{key:"getSide",value:function getSide(){return 0;}},{key:"destroy",value:function destroy(){this.parent=null;}}],[{key:"get",value:function get(node){return node.cmView;}}]);return ContentView2;}();ContentView2.prototype.breakAfter=0;function rm2(dom){var next=dom.nextSibling;dom.parentNode.removeChild(dom);return next;}var ChildCursor2=/*#__PURE__*/function(){function ChildCursor2(children,pos,i){_classCallCheck(this,ChildCursor2);this.children=children;this.pos=pos;this.i=i;this.off=0;}_createClass(ChildCursor2,[{key:"findPos",value:function findPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;for(;;){if(pos>this.pos||pos==this.pos&&(bias>0||this.i==0||this.children[this.i-1].breakAfter)){this.off=pos-this.pos;return this;}var next=this.children[--this.i];this.pos-=next.length+next.breakAfter;}}}]);return ChildCursor2;}();function replaceRange(parent,fromI,fromOff,toI,toOff,insert2,breakAtStart,openStart,openEnd){var children=parent.children;var before=children.length?children[fromI]:null;var last=insert2.length?insert2[insert2.length-1]:null;var breakAtEnd=last?last.breakAfter:breakAtStart;if(fromI==toI&&before&&!breakAtStart&&!breakAtEnd&&insert2.length<2&&before.merge(fromOff,toOff,insert2.length?last:null,fromOff==0,openStart,openEnd))return;if(toI<children.length){var after=children[toI];if(after&&toOff<after.length){if(fromI==toI){after=after.split(toOff);toOff=0;}if(!breakAtEnd&&last&&after.merge(0,toOff,last,true,0,openEnd)){insert2[insert2.length-1]=after;}else{if(toOff)after.merge(0,toOff,null,false,0,openEnd);insert2.push(after);}}else if(after===null||after===void 0?void 0:after.breakAfter){if(last)last.breakAfter=1;else breakAtStart=1;}toI++;}if(before){before.breakAfter=breakAtStart;if(fromOff>0){if(!breakAtStart&&insert2.length&&before.merge(fromOff,before.length,insert2[0],false,openStart,0)){before.breakAfter=insert2.shift().breakAfter;}else if(fromOff<before.length||before.children.length&&before.children[before.children.length-1].length==0){before.merge(fromOff,before.length,null,false,openStart,0);}fromI++;}}while(fromI<toI&&insert2.length){if(children[toI-1].become(insert2[insert2.length-1])){toI--;insert2.pop();openEnd=insert2.length?0:openStart;}else if(children[fromI].become(insert2[0])){fromI++;insert2.shift();openStart=insert2.length?0:openEnd;}else{break;}}if(!insert2.length&&fromI&&toI<children.length&&!children[fromI-1].breakAfter&&children[toI].merge(0,0,children[fromI-1],false,openStart,openEnd))fromI--;if(fromI<toI||insert2.length)parent.replaceChildren(fromI,toI,insert2);}function mergeChildrenInto(parent,from,to,insert2,openStart,openEnd){var cur2=parent.childCursor();var _cur2$findPos3=cur2.findPos(to,1),toI=_cur2$findPos3.i,toOff=_cur2$findPos3.off;var _cur2$findPos4=cur2.findPos(from,-1),fromI=_cur2$findPos4.i,fromOff=_cur2$findPos4.off;var dLen=from-to;var _iterator99=_createForOfIteratorHelper(insert2),_step99;try{for(_iterator99.s();!(_step99=_iterator99.n()).done;){var view=_step99.value;dLen+=view.length;}}catch(err){_iterator99.e(err);}finally{_iterator99.f();}parent.length+=dLen;replaceRange(parent,fromI,fromOff,toI,toOff,insert2,0,openStart,openEnd);}var _ref20=typeof navigator!="undefined"?[navigator,document]:[{userAgent:"",vendor:"",platform:""},{documentElement:{style:{}}}],_ref21=_slicedToArray(_ref20,2),nav2=_ref21[0],doc2=_ref21[1];var ie_edge2=/* @__PURE__ */ /Edge\/(\d+)/.exec(nav2.userAgent);var ie_upto102=/* @__PURE__ */ /MSIE \d/.test(nav2.userAgent);var ie_11up2=/* @__PURE__ */ /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav2.userAgent);var ie3=!!(ie_upto102||ie_11up2||ie_edge2);var gecko3=!ie3&&/* @__PURE__ */ /gecko\/(\d+)/i.test(nav2.userAgent);var chrome3=!ie3&&/* @__PURE__ */ /Chrome\/(\d+)/.exec(nav2.userAgent);var webkit2=("webkitFontSmoothing"in doc2.documentElement.style);var safari3=!ie3&&/* @__PURE__ */ /Apple Computer/.test(nav2.vendor);var ios2=safari3&&(/* @__PURE__ */ /Mobile\/\w+/.test(nav2.userAgent)||nav2.maxTouchPoints>2);var browser2={mac:ios2||/* @__PURE__ */ /Mac/.test(nav2.platform),windows:/* @__PURE__ */ /Win/.test(nav2.platform),linux:/* @__PURE__ */ /Linux|X11/.test(nav2.platform),ie:ie3,ie_version:ie_upto102?doc2.documentMode||6:ie_11up2?+ie_11up2[1]:ie_edge2?+ie_edge2[1]:0,gecko:gecko3,gecko_version:gecko3?+(/* @__PURE__ */ /Firefox\/(\d+)/.exec(nav2.userAgent)||[0,0])[1]:0,chrome:!!chrome3,chrome_version:chrome3?+chrome3[1]:0,ios:ios2,android:/* @__PURE__ */ /Android\b/.test(nav2.userAgent),webkit:webkit2,safari:safari3,webkit_version:webkit2?+(/* @__PURE__ */ /\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc2.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var MaxJoinLen2=256;var TextView2=/*#__PURE__*/function(_ContentView5){_inherits(TextView2,_ContentView5);var _super27=_createSuper(TextView2);function TextView2(text){var _this52;_classCallCheck(this,TextView2);_this52=_super27.call(this);_this52.text=text;return _this52;}_createClass(TextView2,[{key:"length",get:function get(){return this.text.length;}},{key:"createDOM",value:function createDOM(textDOM){this.setDOM(textDOM||document.createTextNode(this.text));}},{key:"sync",value:function sync(track){if(!this.dom)this.createDOM();if(this.dom.nodeValue!=this.text){if(track&&track.node==this.dom)track.written=true;this.dom.nodeValue=this.text;}}},{key:"reuseDOM",value:function reuseDOM(dom){if(dom.nodeType==3)this.createDOM(dom);}},{key:"merge",value:function merge(from,to,source){if(source&&(!(source instanceof TextView2)||this.length-(to-from)+source.length>MaxJoinLen2))return false;this.text=this.text.slice(0,from)+(source?source.text:"")+this.text.slice(to);this.markDirty();return true;}},{key:"split",value:function split(from){var result=new TextView2(this.text.slice(from));this.text=this.text.slice(0,from);this.markDirty();return result;}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return node==this.dom?offset:offset?this.text.length:0;}},{key:"domAtPos",value:function domAtPos(pos){return new DOMPos2(this.dom,pos);}},{key:"domBoundsAround",value:function domBoundsAround(_from,_to,offset){return{from:offset,to:offset+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling};}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords2(this.dom,pos,side);}}]);return TextView2;}(ContentView2);var MarkView2=/*#__PURE__*/function(_ContentView6){_inherits(MarkView2,_ContentView6);var _super28=_createSuper(MarkView2);function MarkView2(mark){var _this53;var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,MarkView2);_this53=_super28.call(this);_this53.mark=mark;_this53.children=children;_this53.length=length;var _iterator100=_createForOfIteratorHelper(children),_step100;try{for(_iterator100.s();!(_step100=_iterator100.n()).done;){var ch=_step100.value;ch.setParent(_assertThisInitialized(_this53));}}catch(err){_iterator100.e(err);}finally{_iterator100.f();}return _this53;}_createClass(MarkView2,[{key:"setAttrs",value:function setAttrs(dom){clearAttributes(dom);if(this.mark["class"])dom.className=this.mark["class"];if(this.mark.attrs)for(var name2 in this.mark.attrs){dom.setAttribute(name2,this.mark.attrs[name2]);}return dom;}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName==this.mark.tagName.toUpperCase()){this.setDOM(node);this.dirty|=4|2;}}},{key:"sync",value:function sync(track){if(!this.dom)this.setDOM(this.setAttrs(document.createElement(this.mark.tagName)));else if(this.dirty&4)this.setAttrs(this.dom);_get(_getPrototypeOf(MarkView2.prototype),"sync",this).call(this,track);}},{key:"merge",value:function merge(from,to,source,_hasStart,openStart,openEnd){if(source&&(!(source instanceof MarkView2&&source.mark.eq(this.mark))||from&&openStart<=0||to<this.length&&openEnd<=0))return false;mergeChildrenInto(this,from,to,source?source.children:[],openStart-1,openEnd-1);this.markDirty();return true;}},{key:"split",value:function split(from){var result=[],off=0,detachFrom=-1,i=0;var _iterator101=_createForOfIteratorHelper(this.children),_step101;try{for(_iterator101.s();!(_step101=_iterator101.n()).done;){var elt=_step101.value;var end=off+elt.length;if(end>from)result.push(off<from?elt.split(from-off):elt);if(detachFrom<0&&off>=from)detachFrom=i;off=end;i++;}}catch(err){_iterator101.e(err);}finally{_iterator101.f();}var length=this.length-from;this.length=from;if(detachFrom>-1){this.children.length=detachFrom;this.markDirty();}return new MarkView2(this.mark,result,length);}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos2(this.dom,this.children,pos);}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren2(this,pos,side);}}]);return MarkView2;}(ContentView2);function textCoords2(text,pos,side){var length=text.nodeValue.length;if(pos>length)pos=length;var from=pos,to=pos,flatten2=0;if(pos==0&&side<0||pos==length&&side>=0){if(!(browser2.chrome||browser2.gecko)){if(pos){from--;flatten2=1;}else{to++;flatten2=-1;}}}else{if(side<0)from--;else to++;}var rects=textRange2(text,from,to).getClientRects();if(!rects.length)return Rect02;var rect=rects[(flatten2?flatten2<0:side>=0)?0:rects.length-1];if(browser2.safari&&!flatten2&&rect.width==0)rect=Array.prototype.find.call(rects,function(r){return r.width;})||rect;return flatten2?flattenRect2(rect,flatten2<0):rect||null;}var WidgetView2=/*#__PURE__*/function(_ContentView7){_inherits(WidgetView2,_ContentView7);var _super29=_createSuper(WidgetView2);function WidgetView2(widget,length,side){var _this54;_classCallCheck(this,WidgetView2);_this54=_super29.call(this);_this54.widget=widget;_this54.length=length;_this54.side=side;return _this54;}_createClass(WidgetView2,[{key:"split",value:function split(from){var result=WidgetView2.create(this.widget,this.length-from,this.side);this.length-=from;return result;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"getSide",value:function getSide(){return this.side;}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source&&(!(source instanceof WidgetView2)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"become",value:function become(other){if(other.length==this.length&&other instanceof WidgetView2&&other.side==this.side){if(this.widget.constructor==other.widget.constructor){if(!this.widget.eq(other.widget))this.markDirty(true);this.widget=other.widget;return true;}}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}},{key:"overrideDOMText",get:function get(){if(this.length==0)return Text.empty;var top2=this;while(top2.parent){top2=top2.parent;}var view=top2.editorView,text=view&&view.state.doc,start=this.posAtStart;return text?text.slice(start,start+this.length):Text.empty;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos2.before(this.dom):DOMPos2.after(this.dom,pos==this.length);}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){var rects=this.dom.getClientRects(),rect=null;if(!rects.length)return Rect02;for(var _i107=pos>0?rects.length-1:0;;_i107+=pos>0?-1:1){rect=rects[_i107];if(pos>0?_i107==0:_i107==rects.length-1||rect.top<rect.bottom)break;}return pos==0&&side>0||pos==this.length&&side<=0?rect:flattenRect2(rect,pos==0);}},{key:"isEditable",get:function get(){return false;}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(WidgetView2.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom);}}],[{key:"create",value:function create(widget,length,side){return new(widget.customView||WidgetView2)(widget,length,side);}}]);return WidgetView2;}(ContentView2);var CompositionView2=/*#__PURE__*/function(_WidgetView2){_inherits(CompositionView2,_WidgetView2);var _super30=_createSuper(CompositionView2);function CompositionView2(){_classCallCheck(this,CompositionView2);return _super30.apply(this,arguments);}_createClass(CompositionView2,[{key:"domAtPos",value:function domAtPos(pos){return new DOMPos2(this.widget.text,pos);}},{key:"sync",value:function sync(){this.setDOM(this.widget.toDOM());}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return!offset?0:node.nodeType==3?Math.min(offset,this.length):this.length;}},{key:"ignoreMutation",value:function ignoreMutation(){return false;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords2(this.widget.text,pos,side);}},{key:"isEditable",get:function get(){return true;}}]);return CompositionView2;}(WidgetView2);var ZeroWidthSpace=browser2.android?"\u200B\u200B":"\u200B";var WidgetBufferView2=/*#__PURE__*/function(_ContentView8){_inherits(WidgetBufferView2,_ContentView8);var _super31=_createSuper(WidgetBufferView2);function WidgetBufferView2(side){var _this55;_classCallCheck(this,WidgetBufferView2);_this55=_super31.call(this);_this55.side=side;return _this55;}_createClass(WidgetBufferView2,[{key:"length",get:function get(){return 0;}},{key:"merge",value:function merge(){return false;}},{key:"become",value:function become(other){return other instanceof WidgetBufferView2&&other.side==this.side;}},{key:"split",value:function split(){return new WidgetBufferView2(this.side);}},{key:"sync",value:function sync(){if(!this.dom)this.setDOM(document.createTextNode(ZeroWidthSpace));else if(this.dirty&&this.dom.nodeValue!=ZeroWidthSpace)this.dom.nodeValue=ZeroWidthSpace;}},{key:"getSide",value:function getSide(){return this.side;}},{key:"domAtPos",value:function domAtPos(pos){return DOMPos2.before(this.dom);}},{key:"localPosFromDOM",value:function localPosFromDOM(){return 0;}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos){var rects=clientRectsFor2(this.dom);return rects[rects.length-1]||null;}},{key:"overrideDOMText",get:function get(){return Text.of([this.dom.nodeValue.replace(/\u200b/g,"")]);}}]);return WidgetBufferView2;}(ContentView2);TextView2.prototype.children=WidgetView2.prototype.children=WidgetBufferView2.prototype.children=noChildren;function inlineDOMAtPos2(dom,children,pos){var i=0;for(var off=0;i<children.length;i++){var child=children[i],end=off+child.length;if(end==off&&child.getSide()<=0)continue;if(pos>off&&pos<end&&child.dom.parentNode==dom)return child.domAtPos(pos-off);if(pos<=off)break;off=end;}for(;i>0;i--){var before=children[i-1].dom;if(before.parentNode==dom)return DOMPos2.after(before);}return new DOMPos2(dom,0);}function joinInlineInto2(parent,view,open){var last,children=parent.children;if(open>0&&view instanceof MarkView2&&children.length&&(last=children[children.length-1])instanceof MarkView2&&last.mark.eq(view.mark)){joinInlineInto2(last,view.children[0],open-1);}else{children.push(view);view.setParent(parent);}parent.length+=view.length;}function coordsInChildren2(view,pos,side){for(var off=0,_i108=0;_i108<view.children.length;_i108++){var child=view.children[_i108],end=off+child.length,next=void 0;if((side<=0||end==view.length||child.getSide()>0?end>=pos:end>pos)&&(pos<end||_i108+1==view.children.length||(next=view.children[_i108+1]).length||next.getSide()>0)){var flatten2=0;if(end==off){if(child.getSide()<=0)continue;flatten2=side=-child.getSide();}var rect=child.coordsAt(pos-off,side);return flatten2&&rect?flattenRect2(rect,side<0):rect;}off=end;}var last=view.dom.lastChild;if(!last)return view.dom.getBoundingClientRect();var rects=clientRectsFor2(last);return rects[rects.length-1]||null;}function combineAttrs2(source,target){for(var name2 in source){if(name2=="class"&&target["class"])target["class"]+=" "+source["class"];else if(name2=="style"&&target.style)target.style+=";"+source.style;else target[name2]=source[name2];}return target;}function attrsEq2(a,b){if(a==b)return true;if(!a||!b)return false;var keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length!=keysB.length)return false;for(var _i109=0,_keysA2=keysA;_i109<_keysA2.length;_i109++){var key=_keysA2[_i109];if(keysB.indexOf(key)==-1||a[key]!==b[key])return false;}return true;}function updateAttrs2(dom,prev,attrs){if(prev){for(var name2 in prev){if(!(attrs&&name2 in attrs))dom.removeAttribute(name2);}}if(attrs){for(var _name2 in attrs){if(!(prev&&prev[_name2]==attrs[_name2]))dom.setAttribute(_name2,attrs[_name2]);}}}var WidgetType2=/*#__PURE__*/function(){function WidgetType2(){_classCallCheck(this,WidgetType2);}_createClass(WidgetType2,[{key:"eq",value:function eq(_widget){return false;}},{key:"updateDOM",value:function updateDOM(_dom){return false;}},{key:"compare",value:function compare(other){return this==other||this.constructor==other.constructor&&this.eq(other);}},{key:"estimatedHeight",get:function get(){return-1;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return true;}},{key:"customView",get:function get(){return null;}},{key:"destroy",value:function destroy(_dom){}}]);return WidgetType2;}();var BlockType2=/* @__PURE__ */function(BlockType6){BlockType6[BlockType6["Text"]=0]="Text";BlockType6[BlockType6["WidgetBefore"]=1]="WidgetBefore";BlockType6[BlockType6["WidgetAfter"]=2]="WidgetAfter";BlockType6[BlockType6["WidgetRange"]=3]="WidgetRange";return BlockType6;}(BlockType2||(BlockType2={}));var Decoration2=/*#__PURE__*/function(_RangeValue2){_inherits(Decoration2,_RangeValue2);var _super32=_createSuper(Decoration2);function Decoration2(startSide,endSide,widget,spec){var _this56;_classCallCheck(this,Decoration2);_this56=_super32.call(this);_this56.startSide=startSide;_this56.endSide=endSide;_this56.widget=widget;_this56.spec=spec;return _this56;}_createClass(Decoration2,[{key:"heightRelevant",get:function get(){return false;}},{key:"hasHeight",value:function hasHeight(){return this.widget?this.widget.estimatedHeight>-1:false;}}],[{key:"mark",value:function mark(spec){return new MarkDecoration2(spec);}},{key:"widget",value:function widget(spec){var side=spec.side||0,block=!!spec.block;side+=block?side>0?3e8:-4e8:side>0?1e8:-1e8;return new PointDecoration2(spec,side,side,block,spec.widget||null,false);}},{key:"replace",value:function replace(spec){var block=!!spec.block;var _getInclusive3=getInclusive2(spec,block),start=_getInclusive3.start,end=_getInclusive3.end;var startSide=block?start?-3e8:-1:4e8;var endSide=block?end?2e8:1:-5e8;return new PointDecoration2(spec,startSide,endSide,block,spec.widget||null,true);}},{key:"line",value:function line(spec){return new LineDecoration2(spec);}},{key:"set",value:function set(of){var sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return RangeSet.of(of,sort);}}]);return Decoration2;}(RangeValue);Decoration2.none=RangeSet.empty;var MarkDecoration2=/*#__PURE__*/function(_Decoration4){_inherits(MarkDecoration2,_Decoration4);var _super33=_createSuper(MarkDecoration2);function MarkDecoration2(spec){var _this57;_classCallCheck(this,MarkDecoration2);var _getInclusive4=getInclusive2(spec),start=_getInclusive4.start,end=_getInclusive4.end;_this57=_super33.call(this,start?-1:4e8,end?1:-5e8,null,spec);_this57.tagName=spec.tagName||"span";_this57["class"]=spec["class"]||"";_this57.attrs=spec.attributes||null;return _this57;}_createClass(MarkDecoration2,[{key:"eq",value:function eq(other){return this==other||other instanceof MarkDecoration2&&this.tagName==other.tagName&&this["class"]==other["class"]&&attrsEq2(this.attrs,other.attrs);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(from>=to)throw new RangeError("Mark decorations may not be empty");return _get(_getPrototypeOf(MarkDecoration2.prototype),"range",this).call(this,from,to);}}]);return MarkDecoration2;}(Decoration2);MarkDecoration2.prototype.point=false;var LineDecoration2=/*#__PURE__*/function(_Decoration5){_inherits(LineDecoration2,_Decoration5);var _super34=_createSuper(LineDecoration2);function LineDecoration2(spec){_classCallCheck(this,LineDecoration2);return _super34.call(this,-2e8,-2e8,null,spec);}_createClass(LineDecoration2,[{key:"eq",value:function eq(other){return other instanceof LineDecoration2&&attrsEq2(this.spec.attributes,other.spec.attributes);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(to!=from)throw new RangeError("Line decoration ranges must be zero-length");return _get(_getPrototypeOf(LineDecoration2.prototype),"range",this).call(this,from,to);}}]);return LineDecoration2;}(Decoration2);LineDecoration2.prototype.mapMode=MapMode.TrackBefore;LineDecoration2.prototype.point=true;var PointDecoration2=/*#__PURE__*/function(_Decoration6){_inherits(PointDecoration2,_Decoration6);var _super35=_createSuper(PointDecoration2);function PointDecoration2(spec,startSide,endSide,block,widget,isReplace){var _this58;_classCallCheck(this,PointDecoration2);_this58=_super35.call(this,startSide,endSide,widget,spec);_this58.block=block;_this58.isReplace=isReplace;_this58.mapMode=!block?MapMode.TrackDel:startSide<=0?MapMode.TrackBefore:MapMode.TrackAfter;return _this58;}_createClass(PointDecoration2,[{key:"type",get:function get(){return this.startSide<this.endSide?BlockType2.WidgetRange:this.startSide<=0?BlockType2.WidgetBefore:BlockType2.WidgetAfter;}},{key:"heightRelevant",get:function get(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5;}},{key:"eq",value:function eq(other){return other instanceof PointDecoration2&&widgetsEq2(this.widget,other.widget)&&this.block==other.block&&this.startSide==other.startSide&&this.endSide==other.endSide;}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(this.isReplace&&(from>to||from==to&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&to!=from)throw new RangeError("Widget decorations can only have zero-length ranges");return _get(_getPrototypeOf(PointDecoration2.prototype),"range",this).call(this,from,to);}}]);return PointDecoration2;}(Decoration2);PointDecoration2.prototype.point=true;function getInclusive2(spec){var block=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var start=spec.inclusiveStart,end=spec.inclusiveEnd;if(start==null)start=spec.inclusive;if(end==null)end=spec.inclusive;return{start:start!==null&&start!==void 0?start:block,end:end!==null&&end!==void 0?end:block};}function widgetsEq2(a,b){return a==b||!!(a&&b&&a.compare(b));}function addRange2(from,to,ranges){var margin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var last=ranges.length-1;if(last>=0&&ranges[last]+margin>=from)ranges[last]=Math.max(ranges[last],to);else ranges.push(from,to);}var LineView2=/*#__PURE__*/function(_ContentView9){_inherits(LineView2,_ContentView9);var _super36=_createSuper(LineView2);function LineView2(){var _this59;_classCallCheck(this,LineView2);_this59=_super36.apply(this,arguments);_this59.children=[];_this59.length=0;_this59.prevAttrs=void 0;_this59.attrs=null;_this59.breakAfter=0;return _this59;}_createClass(LineView2,[{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source){if(!(source instanceof LineView2))return false;if(!this.dom)source.transferDOM(this);}if(hasStart)this.setDeco(source?source.attrs:null);mergeChildrenInto(this,from,to,source?source.children:[],openStart,openEnd);return true;}},{key:"split",value:function split(at){var end=new LineView2();end.breakAfter=this.breakAfter;if(this.length==0)return end;var _this$childPos2=this.childPos(at),i=_this$childPos2.i,off=_this$childPos2.off;if(off){end.append(this.children[i].split(off),0);this.children[i].merge(off,this.children[i].length,null,false,0,0);i++;}for(var j=i;j<this.children.length;j++){end.append(this.children[j],0);}while(i>0&&this.children[i-1].length==0){this.children[--i].destroy();}this.children.length=i;this.markDirty();this.length=at;return end;}},{key:"transferDOM",value:function transferDOM(other){if(!this.dom)return;other.setDOM(this.dom);other.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs;this.prevAttrs=void 0;this.dom=null;}},{key:"setDeco",value:function setDeco(attrs){if(!attrsEq2(this.attrs,attrs)){if(this.dom){this.prevAttrs=this.attrs;this.markDirty();}this.attrs=attrs;}}},{key:"append",value:function append(child,openStart){joinInlineInto2(this,child,openStart);}},{key:"addLineDeco",value:function addLineDeco(deco){var attrs=deco.spec.attributes,cls=deco.spec["class"];if(attrs)this.attrs=combineAttrs2(attrs,this.attrs||{});if(cls)this.attrs=combineAttrs2({"class":cls},this.attrs||{});}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos2(this.dom,this.children,pos);}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName=="DIV"){this.setDOM(node);this.dirty|=4|2;}}},{key:"sync",value:function sync(track){var _a;if(!this.dom){this.setDOM(document.createElement("div"));this.dom.className="cm-line";this.prevAttrs=this.attrs?null:void 0;}else if(this.dirty&4){clearAttributes(this.dom);this.dom.className="cm-line";this.prevAttrs=this.attrs?null:void 0;}if(this.prevAttrs!==void 0){updateAttrs2(this.dom,this.prevAttrs,this.attrs);this.dom.classList.add("cm-line");this.prevAttrs=void 0;}_get(_getPrototypeOf(LineView2.prototype),"sync",this).call(this,track);var last=this.dom.lastChild;while(last&&ContentView2.get(last)instanceof MarkView2){last=last.lastChild;}if(!last||last.nodeName!="BR"&&((_a=ContentView2.get(last))===null||_a===void 0?void 0:_a.isEditable)==false&&(!browser2.ios||!this.children.some(function(ch){return ch instanceof TextView2;}))){var hack=document.createElement("BR");hack.cmIgnore=true;this.dom.appendChild(hack);}}},{key:"measureTextSize",value:function measureTextSize(){if(this.children.length==0||this.length>20)return null;var totalWidth=0;var _iterator102=_createForOfIteratorHelper(this.children),_step102;try{for(_iterator102.s();!(_step102=_iterator102.n()).done;){var child=_step102.value;if(!(child instanceof TextView2))return null;var rects=clientRectsFor2(child.dom);if(rects.length!=1)return null;totalWidth+=rects[0].width;}}catch(err){_iterator102.e(err);}finally{_iterator102.f();}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:totalWidth/this.length};}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren2(this,pos,side);}},{key:"become",value:function become(_other){return false;}},{key:"type",get:function get(){return BlockType2.Text;}}],[{key:"find",value:function find(docView,pos){for(var _i110=0,off=0;_i110<docView.children.length;_i110++){var block=docView.children[_i110],end=off+block.length;if(end>=pos){if(block instanceof LineView2)return block;if(end>pos)break;}off=end+block.breakAfter;}return null;}}]);return LineView2;}(ContentView2);var BlockWidgetView2=/*#__PURE__*/function(_ContentView10){_inherits(BlockWidgetView2,_ContentView10);var _super37=_createSuper(BlockWidgetView2);function BlockWidgetView2(widget,length,type){var _this60;_classCallCheck(this,BlockWidgetView2);_this60=_super37.call(this);_this60.widget=widget;_this60.length=length;_this60.type=type;_this60.breakAfter=0;return _this60;}_createClass(BlockWidgetView2,[{key:"merge",value:function merge(from,to,source,_takeDeco,openStart,openEnd){if(source&&(!(source instanceof BlockWidgetView2)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos2.before(this.dom):DOMPos2.after(this.dom,pos==this.length);}},{key:"split",value:function split(at){var len=this.length-at;this.length=at;var end=new BlockWidgetView2(this.widget,len,this.type);end.breakAfter=this.breakAfter;return end;}},{key:"children",get:function get(){return noChildren;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"overrideDOMText",get:function get(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty;}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"become",value:function become(other){if(other instanceof BlockWidgetView2&&other.type==this.type&&other.widget.constructor==this.widget.constructor){if(!other.widget.eq(this.widget))this.markDirty(true);this.widget=other.widget;this.length=other.length;this.breakAfter=other.breakAfter;return true;}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(BlockWidgetView2.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom);}}]);return BlockWidgetView2;}(ContentView2);var ContentBuilder2=/*#__PURE__*/function(){function ContentBuilder2(doc6,pos,end,disallowBlockEffectsBelow){_classCallCheck(this,ContentBuilder2);this.doc=doc6;this.pos=pos;this.end=end;this.disallowBlockEffectsBelow=disallowBlockEffectsBelow;this.content=[];this.curLine=null;this.breakAtStart=0;this.pendingBuffer=0;this.atCursorPos=true;this.openStart=-1;this.openEnd=-1;this.text="";this.textOff=0;this.cursor=doc6.iter();this.skip=pos;}_createClass(ContentBuilder2,[{key:"posCovered",value:function posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;var last=this.content[this.content.length-1];return!last.breakAfter&&!(last instanceof BlockWidgetView2&&last.type==BlockType2.WidgetBefore);}},{key:"getLine",value:function getLine(){if(!this.curLine){this.content.push(this.curLine=new LineView2());this.atCursorPos=true;}return this.curLine;}},{key:"flushBuffer",value:function flushBuffer(active){if(this.pendingBuffer){this.curLine.append(wrapMarks2(new WidgetBufferView2(-1),active),active.length);this.pendingBuffer=0;}}},{key:"addBlockWidget",value:function addBlockWidget(view){this.flushBuffer([]);this.curLine=null;this.content.push(view);}},{key:"finish",value:function finish(openEnd){if(!openEnd)this.flushBuffer([]);else this.pendingBuffer=0;if(!this.posCovered())this.getLine();}},{key:"buildText",value:function buildText(length,active,openStart){while(length>0){if(this.textOff==this.text.length){var _this$cursor$next3=this.cursor.next(this.skip),value=_this$cursor$next3.value,lineBreak=_this$cursor$next3.lineBreak,done=_this$cursor$next3.done;this.skip=0;if(done)throw new Error("Ran out of text content when drawing inline views");if(lineBreak){if(!this.posCovered())this.getLine();if(this.content.length)this.content[this.content.length-1].breakAfter=1;else this.breakAtStart=1;this.flushBuffer([]);this.curLine=null;length--;continue;}else{this.text=value;this.textOff=0;}}var take=Math.min(this.text.length-this.textOff,length,512);this.flushBuffer(active.slice(0,openStart));this.getLine().append(wrapMarks2(new TextView2(this.text.slice(this.textOff,this.textOff+take)),active),openStart);this.atCursorPos=true;this.textOff+=take;length-=take;openStart=0;}}},{key:"span",value:function span(from,to,active,openStart){this.buildText(to-from,active,openStart);this.pos=to;if(this.openStart<0)this.openStart=openStart;}},{key:"point",value:function point(from,to,deco,active,openStart){var len=to-from;if(deco instanceof PointDecoration2){if(deco.block){var type=deco.type;if(type==BlockType2.WidgetAfter&&!this.posCovered())this.getLine();this.addBlockWidget(new BlockWidgetView2(deco.widget||new NullWidget2("div"),len,type));}else{var view=WidgetView2.create(deco.widget||new NullWidget2("span"),len,deco.startSide);var cursorBefore=this.atCursorPos&&!view.isEditable&&openStart<=active.length&&(from<to||deco.startSide>0);var cursorAfter=!view.isEditable&&(from<to||deco.startSide<=0);var line=this.getLine();if(this.pendingBuffer==2&&!cursorBefore)this.pendingBuffer=0;this.flushBuffer(active);if(cursorBefore){line.append(wrapMarks2(new WidgetBufferView2(1),active),openStart);openStart=active.length+Math.max(0,openStart-active.length);}line.append(wrapMarks2(view,active),openStart);this.atCursorPos=cursorAfter;this.pendingBuffer=!cursorAfter?0:from<to?1:2;}}else if(this.doc.lineAt(this.pos).from==this.pos){this.getLine().addLineDeco(deco);}if(len){if(this.textOff+len<=this.text.length){this.textOff+=len;}else{this.skip+=len-(this.text.length-this.textOff);this.text="";this.textOff=0;}this.pos=to;}if(this.openStart<0)this.openStart=openStart;}},{key:"filterPoint",value:function filterPoint(from,to,value,index){if(index>=this.disallowBlockEffectsBelow||!(value instanceof PointDecoration2))return true;if(value.block)throw new RangeError("Block decorations may not be specified via plugins");return to<=this.doc.lineAt(this.pos).to;}}],[{key:"build",value:function build(text,from,to,decorations6,pluginDecorationLength){var builder=new ContentBuilder2(text,from,to,pluginDecorationLength);builder.openEnd=RangeSet.spans(decorations6,from,to,builder);if(builder.openStart<0)builder.openStart=builder.openEnd;builder.finish(builder.openEnd);return builder;}}]);return ContentBuilder2;}();function wrapMarks2(view,active){var _iterator103=_createForOfIteratorHelper(active),_step103;try{for(_iterator103.s();!(_step103=_iterator103.n()).done;){var mark=_step103.value;view=new MarkView2(mark,[view],view.length);}}catch(err){_iterator103.e(err);}finally{_iterator103.f();}return view;}var NullWidget2=/*#__PURE__*/function(_WidgetType7){_inherits(NullWidget2,_WidgetType7);var _super38=_createSuper(NullWidget2);function NullWidget2(tag){var _this61;_classCallCheck(this,NullWidget2);_this61=_super38.call(this);_this61.tag=tag;return _this61;}_createClass(NullWidget2,[{key:"eq",value:function eq(other){return other.tag==this.tag;}},{key:"toDOM",value:function toDOM(){return document.createElement(this.tag);}},{key:"updateDOM",value:function updateDOM(elt){return elt.nodeName.toLowerCase()==this.tag;}}]);return NullWidget2;}(WidgetType2);var none4=[];var clickAddsSelectionRange2=/* @__PURE__ */Facet.define();var dragMovesSelection$12=/* @__PURE__ */Facet.define();var mouseSelectionStyle2=/* @__PURE__ */Facet.define();var exceptionSink2=/* @__PURE__ */Facet.define();var updateListener2=/* @__PURE__ */Facet.define();var inputHandler2=/* @__PURE__ */Facet.define();var scrollTo2=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});var centerOn2=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});var ScrollTarget2=/*#__PURE__*/function(){function ScrollTarget2(range){var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"nearest";var x=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"nearest";var yMargin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;var xMargin=arguments.length>4&&arguments[4]!==undefined?arguments[4]:5;_classCallCheck(this,ScrollTarget2);this.range=range;this.y=y;this.x=x;this.yMargin=yMargin;this.xMargin=xMargin;}_createClass(ScrollTarget2,[{key:"map",value:function map(changes){return changes.empty?this:new ScrollTarget2(this.range.map(changes),this.y,this.x,this.yMargin,this.xMargin);}}]);return ScrollTarget2;}();var _scrollIntoView=/* @__PURE__ */StateEffect.define({map:function map(t2,ch){return t2.map(ch);}});function logException2(state,exception,context){var handler=state.facet(exceptionSink2);if(handler.length)handler[0](exception);else if(window.onerror)window.onerror(String(exception),context,void 0,void 0,exception);else if(context)console.error(context+":",exception);else console.error(exception);}var editable2=/* @__PURE__ */Facet.define({combine:function combine(values){return values.length?values[0]:true;}});var PluginFieldProvider2=/*#__PURE__*/_createClass(function PluginFieldProvider2(field,get){_classCallCheck(this,PluginFieldProvider2);this.field=field;this.get=get;});var PluginField2=/*#__PURE__*/function(){function PluginField2(){_classCallCheck(this,PluginField2);}_createClass(PluginField2,[{key:"from",value:function from(get){return new PluginFieldProvider2(this,get);}}],[{key:"define",value:function define(){return new PluginField2();}}]);return PluginField2;}();PluginField2.decorations=/* @__PURE__ */PluginField2.define();PluginField2.atomicRanges=/* @__PURE__ */PluginField2.define();PluginField2.scrollMargins=/* @__PURE__ */PluginField2.define();var nextPluginID2=0;var viewPlugin2=/* @__PURE__ */Facet.define();var ViewPlugin2=/*#__PURE__*/function(){function ViewPlugin2(id,create,fields){_classCallCheck(this,ViewPlugin2);this.id=id;this.create=create;this.fields=fields;this.extension=viewPlugin2.of(this);}_createClass(ViewPlugin2,null,[{key:"define",value:function define(create,spec){var _ref22=spec||{},eventHandlers=_ref22.eventHandlers,provide=_ref22.provide,decorations6=_ref22.decorations;var fields=[];if(provide){var _iterator104=_createForOfIteratorHelper(Array.isArray(provide)?provide:[provide]),_step104;try{for(_iterator104.s();!(_step104=_iterator104.n()).done;){var provider=_step104.value;fields.push(provider);}}catch(err){_iterator104.e(err);}finally{_iterator104.f();}}if(eventHandlers)fields.push(domEventHandlers2.from(function(value){return{plugin:value,handlers:eventHandlers};}));if(decorations6)fields.push(PluginField2.decorations.from(decorations6));return new ViewPlugin2(nextPluginID2++,create,fields);}},{key:"fromClass",value:function fromClass(cls,spec){return ViewPlugin2.define(function(view){return new cls(view);},spec);}}]);return ViewPlugin2;}();var domEventHandlers2=/* @__PURE__ */PluginField2.define();var PluginInstance2=/*#__PURE__*/function(){function PluginInstance2(spec){_classCallCheck(this,PluginInstance2);this.spec=spec;this.mustUpdate=null;this.value=null;}_createClass(PluginInstance2,[{key:"takeField",value:function takeField(type,target){if(this.spec){var _iterator105=_createForOfIteratorHelper(this.spec.fields),_step105;try{for(_iterator105.s();!(_step105=_iterator105.n()).done;){var _step105$value=_step105.value,field=_step105$value.field,get=_step105$value.get;if(field==type)target.push(get(this.value));}}catch(err){_iterator105.e(err);}finally{_iterator105.f();}}}},{key:"update",value:function update(view){if(!this.value){if(this.spec){try{this.value=this.spec.create(view);}catch(e){logException2(view.state,e,"CodeMirror plugin crashed");this.deactivate();}}}else if(this.mustUpdate){var update=this.mustUpdate;this.mustUpdate=null;if(this.value.update){try{this.value.update(update);}catch(e){logException2(update.state,e,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy();}catch(_){}this.deactivate();}}}return this;}},{key:"destroy",value:function destroy(view){var _a;if((_a=this.value)===null||_a===void 0?void 0:_a.destroy){try{this.value.destroy();}catch(e){logException2(view.state,e,"CodeMirror plugin crashed");}}}},{key:"deactivate",value:function deactivate(){this.spec=this.value=null;}}]);return PluginInstance2;}();var editorAttributes2=/* @__PURE__ */Facet.define();var contentAttributes2=/* @__PURE__ */Facet.define();var decorations2=/* @__PURE__ */Facet.define();var styleModule2=/* @__PURE__ */Facet.define();var ChangedRange2=/*#__PURE__*/function(){function ChangedRange2(fromA,toA,fromB,toB){_classCallCheck(this,ChangedRange2);this.fromA=fromA;this.toA=toA;this.fromB=fromB;this.toB=toB;}_createClass(ChangedRange2,[{key:"join",value:function join(other){return new ChangedRange2(Math.min(this.fromA,other.fromA),Math.max(this.toA,other.toA),Math.min(this.fromB,other.fromB),Math.max(this.toB,other.toB));}},{key:"addToSet",value:function addToSet(set){var i=set.length,me=this;for(;i>0;i--){var range=set[i-1];if(range.fromA>me.toA)continue;if(range.toA<me.fromA)break;me=me.join(range);set.splice(i-1,1);}set.splice(i,0,me);return set;}}],[{key:"extendWithRanges",value:function extendWithRanges(diff,ranges){if(ranges.length==0)return diff;var result=[];for(var dI=0,rI=0,posA=0,posB=0;;dI++){var next=dI==diff.length?null:diff[dI],off=posA-posB;var end=next?next.fromB:1e9;while(rI<ranges.length&&ranges[rI]<end){var from=ranges[rI],to=ranges[rI+1];var fromB=Math.max(posB,from),toB=Math.min(end,to);if(fromB<=toB)new ChangedRange2(fromB+off,toB+off,fromB,toB).addToSet(result);if(to>end)break;else rI+=2;}if(!next)return result;new ChangedRange2(next.fromA,next.toA,next.fromB,next.toB).addToSet(result);posA=next.toA;posB=next.toB;}}}]);return ChangedRange2;}();var ViewUpdate2=/*#__PURE__*/function(){function ViewUpdate2(view,state){var transactions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:none4;_classCallCheck(this,ViewUpdate2);this.view=view;this.state=state;this.transactions=transactions;this.flags=0;this.startState=view.state;this.changes=ChangeSet.empty(this.startState.doc.length);var _iterator106=_createForOfIteratorHelper(transactions),_step106;try{for(_iterator106.s();!(_step106=_iterator106.n()).done;){var tr=_step106.value;this.changes=this.changes.compose(tr.changes);}}catch(err){_iterator106.e(err);}finally{_iterator106.f();}var changedRanges=[];this.changes.iterChangedRanges(function(fromA,toA,fromB,toB){return changedRanges.push(new ChangedRange2(fromA,toA,fromB,toB));});this.changedRanges=changedRanges;var focus=view.hasFocus;if(focus!=view.inputState.notifiedFocused){view.inputState.notifiedFocused=focus;this.flags|=1;}}_createClass(ViewUpdate2,[{key:"viewportChanged",get:function get(){return(this.flags&4)>0;}},{key:"heightChanged",get:function get(){return(this.flags&2)>0;}},{key:"geometryChanged",get:function get(){return this.docChanged||(this.flags&(8|2))>0;}},{key:"focusChanged",get:function get(){return(this.flags&1)>0;}},{key:"docChanged",get:function get(){return!this.changes.empty;}},{key:"selectionSet",get:function get(){return this.transactions.some(function(tr){return tr.selection;});}},{key:"empty",get:function get(){return this.flags==0&&this.transactions.length==0;}}]);return ViewUpdate2;}();var Direction2=/* @__PURE__ */function(Direction6){Direction6[Direction6["LTR"]=0]="LTR";Direction6[Direction6["RTL"]=1]="RTL";return Direction6;}(Direction2||(Direction2={}));var LTR2=Direction2.LTR;var RTL2=Direction2.RTL;function dec2(str){var result=[];for(var _i111=0;_i111<str.length;_i111++){result.push(1<<+str[_i111]);}return result;}var LowTypes2=/* @__PURE__ */dec2("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");var ArabicTypes2=/* @__PURE__ */dec2("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");var Brackets2=/* @__PURE__ */Object.create(null);var BracketStack2=[];for(var _i112=0,_arr3=["()","[]","{}"];_i112<_arr3.length;_i112++){var _p3=_arr3[_i112];var _l3=/* @__PURE__ */_p3.charCodeAt(0),_r6=/* @__PURE__ */_p3.charCodeAt(1);Brackets2[_l3]=_r6;Brackets2[_r6]=-_l3;}function charType2(ch){return ch<=247?LowTypes2[ch]:1424<=ch&&ch<=1524?2:1536<=ch&&ch<=1785?ArabicTypes2[ch-1536]:1774<=ch&&ch<=2220?4:8192<=ch&&ch<=8203?256:ch==8204?256:1;}var BidiRE2=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var BidiSpan2=/*#__PURE__*/function(){function BidiSpan2(from,to,level){_classCallCheck(this,BidiSpan2);this.from=from;this.to=to;this.level=level;}_createClass(BidiSpan2,[{key:"dir",get:function get(){return this.level%2?RTL2:LTR2;}},{key:"side",value:function side(end,dir){return this.dir==dir==end?this.to:this.from;}}],[{key:"find",value:function find(order,index,level,assoc){var maybe=-1;for(var _i113=0;_i113<order.length;_i113++){var span=order[_i113];if(span.from<=index&&span.to>=index){if(span.level==level)return _i113;if(maybe<0||(assoc!=0?assoc<0?span.from<index:span.to>index:order[maybe].level>span.level))maybe=_i113;}}if(maybe<0)throw new RangeError("Index out of range");return maybe;}}]);return BidiSpan2;}();var types2=[];function computeOrder2(line,direction){var len=line.length,outerType=direction==LTR2?1:2,oppositeType=direction==LTR2?2:1;if(!line||outerType==1&&!BidiRE2.test(line))return trivialOrder2(len);for(var _i114=0,prev=outerType,prevStrong=outerType;_i114<len;_i114++){var type=charType2(line.charCodeAt(_i114));if(type==512)type=prev;else if(type==8&&prevStrong==4)type=16;types2[_i114]=type==4?2:type;if(type&7)prevStrong=type;prev=type;}for(var _i115=0,_prev2=outerType,_prevStrong2=outerType;_i115<len;_i115++){var _type4=types2[_i115];if(_type4==128){if(_i115<len-1&&_prev2==types2[_i115+1]&&_prev2&24)_type4=types2[_i115]=_prev2;else types2[_i115]=256;}else if(_type4==64){var end=_i115+1;while(end<len&&types2[end]==64){end++;}var replace=_i115&&_prev2==8||end<len&&types2[end]==8?_prevStrong2==1?1:8:256;for(var j=_i115;j<end;j++){types2[j]=replace;}_i115=end-1;}else if(_type4==8&&_prevStrong2==1){types2[_i115]=1;}_prev2=_type4;if(_type4&7)_prevStrong2=_type4;}for(var _i116=0,sI=0,context=0,ch,br,_type5;_i116<len;_i116++){if(br=Brackets2[ch=line.charCodeAt(_i116)]){if(br<0){for(var sJ=sI-3;sJ>=0;sJ-=3){if(BracketStack2[sJ+1]==-br){var flags=BracketStack2[sJ+2];var type2=flags&2?outerType:!(flags&4)?0:flags&1?oppositeType:outerType;if(type2)types2[_i116]=types2[BracketStack2[sJ]]=type2;sI=sJ;break;}}}else if(BracketStack2.length==189){break;}else{BracketStack2[sI++]=_i116;BracketStack2[sI++]=ch;BracketStack2[sI++]=context;}}else if((_type5=types2[_i116])==2||_type5==1){var embed=_type5==outerType;context=embed?0:1;for(var _sJ2=sI-3;_sJ2>=0;_sJ2-=3){var cur2=BracketStack2[_sJ2+2];if(cur2&2)break;if(embed){BracketStack2[_sJ2+2]|=2;}else{if(cur2&4)break;BracketStack2[_sJ2+2]|=4;}}}}for(var _i117=0;_i117<len;_i117++){if(types2[_i117]==256){var _end5=_i117+1;while(_end5<len&&types2[_end5]==256){_end5++;}var beforeL=(_i117?types2[_i117-1]:outerType)==1;var afterL=(_end5<len?types2[_end5]:outerType)==1;var _replace2=beforeL==afterL?beforeL?1:2:outerType;for(var _j3=_i117;_j3<_end5;_j3++){types2[_j3]=_replace2;}_i117=_end5-1;}}var order=[];if(outerType==1){for(var _i118=0;_i118<len;){var start=_i118,rtl=types2[_i118++]!=1;while(_i118<len&&rtl==(types2[_i118]!=1)){_i118++;}if(rtl){for(var _j4=_i118;_j4>start;){var _end6=_j4,_l4=types2[--_j4]!=2;while(_j4>start&&_l4==(types2[_j4-1]!=2)){_j4--;}order.push(new BidiSpan2(_j4,_end6,_l4?2:1));}}else{order.push(new BidiSpan2(start,_i118,0));}}}else{for(var _i119=0;_i119<len;){var _start6=_i119,_rtl2=types2[_i119++]==2;while(_i119<len&&_rtl2==(types2[_i119]==2)){_i119++;}order.push(new BidiSpan2(_start6,_i119,_rtl2?1:2));}}return order;}function trivialOrder2(length){return[new BidiSpan2(0,length,0)];}var movedOver2="";function moveVisually2(line,order,dir,start,forward){var _a;var startIndex=start.head-line.from,spanI=-1;if(startIndex==0){if(!forward||!line.length)return null;if(order[0].level!=dir){startIndex=order[0].side(false,dir);spanI=0;}}else if(startIndex==line.length){if(forward)return null;var last=order[order.length-1];if(last.level!=dir){startIndex=last.side(true,dir);spanI=order.length-1;}}if(spanI<0)spanI=BidiSpan2.find(order,startIndex,(_a=start.bidiLevel)!==null&&_a!==void 0?_a:-1,start.assoc);var span=order[spanI];if(startIndex==span.side(forward,dir)){span=order[spanI+=forward?1:-1];startIndex=span.side(!forward,dir);}var indexForward=forward==(span.dir==dir);var nextIndex=findClusterBreak(line.text,startIndex,indexForward);movedOver2=line.text.slice(Math.min(startIndex,nextIndex),Math.max(startIndex,nextIndex));if(nextIndex!=span.side(forward,dir))return EditorSelection.cursor(nextIndex+line.from,indexForward?-1:1,span.level);var nextSpan=spanI==(forward?order.length-1:0)?null:order[spanI+(forward?1:-1)];if(!nextSpan&&span.level!=dir)return EditorSelection.cursor(forward?line.to:line.from,forward?-1:1,dir);if(nextSpan&&nextSpan.level<span.level)return EditorSelection.cursor(nextSpan.side(!forward,dir)+line.from,forward?1:-1,nextSpan.level);return EditorSelection.cursor(nextIndex+line.from,forward?-1:1,span.level);}var DOMReader2=/*#__PURE__*/function(){function DOMReader2(points,view){_classCallCheck(this,DOMReader2);this.points=points;this.view=view;this.text="";this.lineBreak=view.state.lineBreak;}_createClass(DOMReader2,[{key:"readRange",value:function readRange(start,end){if(!start)return this;var parent=start.parentNode;for(var cur2=start;;){this.findPointBefore(parent,cur2);this.readNode(cur2);var next=cur2.nextSibling;if(next==end)break;var view=ContentView2.get(cur2),nextView=ContentView2.get(next);if(view&&nextView?view.breakAfter:(view?view.breakAfter:isBlockElement2(cur2))||isBlockElement2(next)&&(cur2.nodeName!="BR"||cur2.cmIgnore))this.text+=this.lineBreak;cur2=next;}this.findPointBefore(parent,end);return this;}},{key:"readTextNode",value:function readTextNode(node){var _a,_b;var text=node.nodeValue;if(/^\u200b/.test(text)&&((_a=node.previousSibling)===null||_a===void 0?void 0:_a.contentEditable)=="false")text=text.slice(1);if(/\u200b$/.test(text)&&((_b=node.nextSibling)===null||_b===void 0?void 0:_b.contentEditable)=="false")text=text.slice(0,text.length-1);return text;}},{key:"readNode",value:function readNode(node){if(node.cmIgnore)return;var view=ContentView2.get(node);var fromView=view&&view.overrideDOMText;var text;if(fromView!=null)text=fromView.sliceString(0,void 0,this.lineBreak);else if(node.nodeType==3)text=this.readTextNode(node);else if(node.nodeName=="BR")text=node.nextSibling?this.lineBreak:"";else if(node.nodeType==1)this.readRange(node.firstChild,null);if(text!=null){this.findPointIn(node,text.length);this.text+=text;if(browser2.chrome&&this.view.inputState.lastKeyCode==13&&!node.nextSibling&&/\n\n$/.test(this.text))this.text=this.text.slice(0,-1);}}},{key:"findPointBefore",value:function findPointBefore(node,next){var _iterator107=_createForOfIteratorHelper(this.points),_step107;try{for(_iterator107.s();!(_step107=_iterator107.n()).done;){var point=_step107.value;if(point.node==node&&node.childNodes[point.offset]==next)point.pos=this.text.length;}}catch(err){_iterator107.e(err);}finally{_iterator107.f();}}},{key:"findPointIn",value:function findPointIn(node,maxLen){var _iterator108=_createForOfIteratorHelper(this.points),_step108;try{for(_iterator108.s();!(_step108=_iterator108.n()).done;){var point=_step108.value;if(point.node==node)point.pos=this.text.length+Math.min(point.offset,maxLen);}}catch(err){_iterator108.e(err);}finally{_iterator108.f();}}}]);return DOMReader2;}();function isBlockElement2(node){return node.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(node.nodeName);}var DOMPoint2=/*#__PURE__*/_createClass(function DOMPoint2(node,offset){_classCallCheck(this,DOMPoint2);this.node=node;this.offset=offset;this.pos=-1;});var DocView2=/*#__PURE__*/function(_ContentView11){_inherits(DocView2,_ContentView11);var _super39=_createSuper(DocView2);function DocView2(view){var _this62;_classCallCheck(this,DocView2);_this62=_super39.call(this);_this62.view=view;_this62.compositionDeco=Decoration2.none;_this62.decorations=[];_this62.pluginDecorationLength=0;_this62.minWidth=0;_this62.minWidthFrom=0;_this62.minWidthTo=0;_this62.impreciseAnchor=null;_this62.impreciseHead=null;_this62.forceSelection=false;_this62.lastUpdate=Date.now();_this62.setDOM(view.contentDOM);_this62.children=[new LineView2()];_this62.children[0].setParent(_assertThisInitialized(_this62));_this62.updateDeco();_this62.updateInner([new ChangedRange2(0,0,0,view.state.doc.length)],0);return _this62;}_createClass(DocView2,[{key:"root",get:function get(){return this.view.root;}},{key:"editorView",get:function get(){return this.view;}},{key:"length",get:function get(){return this.view.state.doc.length;}},{key:"update",value:function update(_update9){var _this63=this;var changedRanges=_update9.changedRanges;if(this.minWidth>0&&changedRanges.length){if(!changedRanges.every(function(_ref23){var fromA=_ref23.fromA,toA=_ref23.toA;return toA<_this63.minWidthFrom||fromA>_this63.minWidthTo;})){this.minWidth=this.minWidthFrom=this.minWidthTo=0;}else{this.minWidthFrom=_update9.changes.mapPos(this.minWidthFrom,1);this.minWidthTo=_update9.changes.mapPos(this.minWidthTo,1);}}if(this.view.inputState.composing<0)this.compositionDeco=Decoration2.none;else if(_update9.transactions.length||this.dirty)this.compositionDeco=computeCompositionDeco2(this.view,_update9.changes);if((browser2.ie||browser2.chrome)&&!this.compositionDeco.size&&_update9&&_update9.state.doc.lines!=_update9.startState.doc.lines)this.forceSelection=true;var prevDeco=this.decorations,deco=this.updateDeco();var decoDiff=findChangedDeco2(prevDeco,deco,_update9.changes);changedRanges=ChangedRange2.extendWithRanges(changedRanges,decoDiff);if(this.dirty==0&&changedRanges.length==0){return false;}else{this.updateInner(changedRanges,_update9.startState.doc.length);if(_update9.transactions.length)this.lastUpdate=Date.now();return true;}}},{key:"updateInner",value:function updateInner(changes,oldLength){var _this64=this;this.view.viewState.mustMeasureContent=true;this.updateChildren(changes,oldLength);var observer=this.view.observer;observer.ignore(function(){_this64.dom.style.height=_this64.view.viewState.contentHeight+"px";_this64.dom.style.minWidth=_this64.minWidth?_this64.minWidth+"px":"";var track=browser2.chrome||browser2.ios?{node:observer.selectionRange.focusNode,written:false}:void 0;_this64.sync(track);_this64.dirty=0;if(track&&(track.written||observer.selectionRange.focusNode!=track.node))_this64.forceSelection=true;_this64.dom.style.height="";});var gaps=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length){var _iterator109=_createForOfIteratorHelper(this.children),_step109;try{for(_iterator109.s();!(_step109=_iterator109.n()).done;){var child=_step109.value;if(child instanceof BlockWidgetView2&&child.widget instanceof BlockGapWidget2)gaps.push(child.dom);}}catch(err){_iterator109.e(err);}finally{_iterator109.f();}}observer.updateGaps(gaps);}},{key:"updateChildren",value:function updateChildren(changes,oldLength){var cursor2=this.childCursor(oldLength);for(var _i120=changes.length-1;;_i120--){var next=_i120>=0?changes[_i120]:null;if(!next)break;var fromA=next.fromA,toA=next.toA,fromB=next.fromB,toB=next.toB;var _ContentBuilder2$buil=ContentBuilder2.build(this.view.state.doc,fromB,toB,this.decorations,this.pluginDecorationLength),content2=_ContentBuilder2$buil.content,breakAtStart=_ContentBuilder2$buil.breakAtStart,openStart=_ContentBuilder2$buil.openStart,openEnd=_ContentBuilder2$buil.openEnd;var _cursor2$findPos3=cursor2.findPos(toA,1),toI=_cursor2$findPos3.i,toOff=_cursor2$findPos3.off;var _cursor2$findPos4=cursor2.findPos(fromA,-1),fromI=_cursor2$findPos4.i,fromOff=_cursor2$findPos4.off;replaceRange(this,fromI,fromOff,toI,toOff,content2,breakAtStart,openStart,openEnd);}}},{key:"updateSelection",value:function updateSelection(){var _this65=this;var mustRead=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var fromPointer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(mustRead)this.view.observer.readSelectionRange();if(!(fromPointer||this.mayControlSelection())||browser2.ios&&this.view.inputState.rapidCompositionStart)return;var force=this.forceSelection;this.forceSelection=false;var main=this.view.state.selection.main;var anchor=this.domAtPos(main.anchor);var head=main.empty?anchor:this.domAtPos(main.head);if(browser2.gecko&&main.empty&&betweenUneditable2(anchor)){var dummy=document.createTextNode("");this.view.observer.ignore(function(){return anchor.node.insertBefore(dummy,anchor.node.childNodes[anchor.offset]||null);});anchor=head=new DOMPos2(dummy,0);force=true;}var domSel=this.view.observer.selectionRange;if(force||!domSel.focusNode||!isEquivalentPosition2(anchor.node,anchor.offset,domSel.anchorNode,domSel.anchorOffset)||!isEquivalentPosition2(head.node,head.offset,domSel.focusNode,domSel.focusOffset)){this.view.observer.ignore(function(){if(browser2.android&&browser2.chrome&&_this65.dom.contains(domSel.focusNode)&&inUneditable2(domSel.focusNode,_this65.dom)){_this65.dom.blur();_this65.dom.focus({preventScroll:true});}var rawSel=getSelection2(_this65.root);if(main.empty){if(browser2.gecko){var nextTo=nextToUneditable2(anchor.node,anchor.offset);if(nextTo&&nextTo!=(1|2)){var _text5=nearbyTextNode2(anchor.node,anchor.offset,nextTo==1?1:-1);if(_text5)anchor=new DOMPos2(_text5,nextTo==1?0:_text5.nodeValue.length);}}rawSel.collapse(anchor.node,anchor.offset);if(main.bidiLevel!=null&&domSel.cursorBidiLevel!=null)domSel.cursorBidiLevel=main.bidiLevel;}else if(rawSel.extend){rawSel.collapse(anchor.node,anchor.offset);rawSel.extend(head.node,head.offset);}else{var range=document.createRange();if(main.anchor>main.head){var _ref24=[head,anchor];anchor=_ref24[0];head=_ref24[1];}range.setEnd(head.node,head.offset);range.setStart(anchor.node,anchor.offset);rawSel.removeAllRanges();rawSel.addRange(range);}});this.view.observer.setSelectionRange(anchor,head);}this.impreciseAnchor=anchor.precise?null:new DOMPos2(domSel.anchorNode,domSel.anchorOffset);this.impreciseHead=head.precise?null:new DOMPos2(domSel.focusNode,domSel.focusOffset);}},{key:"enforceCursorAssoc",value:function enforceCursorAssoc(){if(this.compositionDeco.size)return;var cursor2=this.view.state.selection.main;var sel=getSelection2(this.root);if(!cursor2.empty||!cursor2.assoc||!sel.modify)return;var line=LineView2.find(this,cursor2.head);if(!line)return;var lineStart=line.posAtStart;if(cursor2.head==lineStart||cursor2.head==lineStart+line.length)return;var before=this.coordsAt(cursor2.head,-1),after=this.coordsAt(cursor2.head,1);if(!before||!after||before.bottom>after.top)return;var dom=this.domAtPos(cursor2.head+cursor2.assoc);sel.collapse(dom.node,dom.offset);sel.modify("move",cursor2.assoc<0?"forward":"backward","lineboundary");}},{key:"mayControlSelection",value:function mayControlSelection(){return this.view.state.facet(editable2)?this.root.activeElement==this.dom:hasSelection2(this.dom,this.view.observer.selectionRange);}},{key:"nearest",value:function nearest(dom){for(var cur2=dom;cur2;){var domView=ContentView2.get(cur2);if(domView&&domView.rootView==this)return domView;cur2=cur2.parentNode;}return null;}},{key:"posFromDOM",value:function posFromDOM(node,offset){var view=this.nearest(node);if(!view)throw new RangeError("Trying to find position for a DOM position outside of the document");return view.localPosFromDOM(node,offset)+view.posAtStart;}},{key:"domAtPos",value:function domAtPos(pos){var _this$childCursor$fin2=this.childCursor().findPos(pos,-1),i=_this$childCursor$fin2.i,off=_this$childCursor$fin2.off;for(;i<this.children.length-1;){var child=this.children[i];if(off<child.length||child instanceof LineView2)break;i++;off=0;}return this.children[i].domAtPos(off);}},{key:"coordsAt",value:function coordsAt(pos,side){for(var off=this.length,_i121=this.children.length-1;;_i121--){var child=this.children[_i121],start=off-child.breakAfter-child.length;if(pos>start||pos==start&&child.type!=BlockType2.WidgetBefore&&child.type!=BlockType2.WidgetAfter&&(!_i121||side==2||this.children[_i121-1].breakAfter||this.children[_i121-1].type==BlockType2.WidgetBefore&&side>-2))return child.coordsAt(pos-start,side);off=start;}}},{key:"measureVisibleLineHeights",value:function measureVisibleLineHeights(){var result=[],_this$view$viewState$2=this.view.viewState.viewport,from=_this$view$viewState$2.from,to=_this$view$viewState$2.to;var contentWidth=this.view.contentDOM.clientWidth;var isWider=contentWidth>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;var widest=-1;for(var pos=0,_i122=0;_i122<this.children.length;_i122++){var child=this.children[_i122],end=pos+child.length;if(end>to)break;if(pos>=from){var childRect=child.dom.getBoundingClientRect();result.push(childRect.height);if(isWider){var last=child.dom.lastChild;var rects=last?clientRectsFor2(last):[];if(rects.length){var rect=rects[rects.length-1];var width=this.view.textDirection==Direction2.LTR?rect.right-childRect.left:childRect.right-rect.left;if(width>widest){widest=width;this.minWidth=contentWidth;this.minWidthFrom=pos;this.minWidthTo=end;}}}}pos=end+child.breakAfter;}return result;}},{key:"measureTextSize",value:function measureTextSize(){var _this66=this;var _iterator110=_createForOfIteratorHelper(this.children),_step110;try{for(_iterator110.s();!(_step110=_iterator110.n()).done;){var child=_step110.value;if(child instanceof LineView2){var measure=child.measureTextSize();if(measure)return measure;}}}catch(err){_iterator110.e(err);}finally{_iterator110.f();}var dummy=document.createElement("div"),lineHeight,charWidth;dummy.className="cm-line";dummy.textContent="abc def ghi jkl mno pqr stu";this.view.observer.ignore(function(){_this66.dom.appendChild(dummy);var rect=clientRectsFor2(dummy.firstChild)[0];lineHeight=dummy.getBoundingClientRect().height;charWidth=rect?rect.width/27:7;dummy.remove();});return{lineHeight:lineHeight,charWidth:charWidth};}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;var i=this.children.length;if(i)pos-=this.children[--i].length;return new ChildCursor2(this.children,pos,i);}},{key:"computeBlockGapDeco",value:function computeBlockGapDeco(){var deco=[],vs=this.view.viewState;for(var pos=0,_i123=0;;_i123++){var next=_i123==vs.viewports.length?null:vs.viewports[_i123];var end=next?next.from-1:this.length;if(end>pos){var height=vs.lineBlockAt(end).bottom-vs.lineBlockAt(pos).top;deco.push(Decoration2.replace({widget:new BlockGapWidget2(height),block:true,inclusive:true}).range(pos,end));}if(!next)break;pos=next.to+1;}return Decoration2.set(deco);}},{key:"updateDeco",value:function updateDeco(){var pluginDecorations=this.view.pluginField(PluginField2.decorations);this.pluginDecorationLength=pluginDecorations.length;return this.decorations=[].concat(_toConsumableArray(pluginDecorations),_toConsumableArray(this.view.state.facet(decorations2)),[this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]);}},{key:"scrollIntoView",value:function scrollIntoView(target){var range=target.range;var rect=this.coordsAt(range.head,range.empty?range.assoc:range.head>range.anchor?-1:1),other;if(!rect)return;if(!range.empty&&(other=this.coordsAt(range.anchor,range.anchor>range.head?-1:1)))rect={left:Math.min(rect.left,other.left),top:Math.min(rect.top,other.top),right:Math.max(rect.right,other.right),bottom:Math.max(rect.bottom,other.bottom)};var mLeft=0,mRight=0,mTop=0,mBottom=0;var _iterator111=_createForOfIteratorHelper(this.view.pluginField(PluginField2.scrollMargins)),_step111;try{for(_iterator111.s();!(_step111=_iterator111.n()).done;){var margins=_step111.value;if(margins){var left=margins.left,right=margins.right,top2=margins.top,bottom=margins.bottom;if(left!=null)mLeft=Math.max(mLeft,left);if(right!=null)mRight=Math.max(mRight,right);if(top2!=null)mTop=Math.max(mTop,top2);if(bottom!=null)mBottom=Math.max(mBottom,bottom);}}}catch(err){_iterator111.e(err);}finally{_iterator111.f();}var targetRect={left:rect.left-mLeft,top:rect.top-mTop,right:rect.right+mRight,bottom:rect.bottom+mBottom};scrollRectIntoView2(this.view.scrollDOM,targetRect,range.head<range.anchor?-1:1,target.x,target.y,target.xMargin,target.yMargin,this.view.textDirection==Direction2.LTR);}}]);return DocView2;}(ContentView2);function betweenUneditable2(pos){return pos.node.nodeType==1&&pos.node.firstChild&&(pos.offset==0||pos.node.childNodes[pos.offset-1].contentEditable=="false")&&(pos.offset==pos.node.childNodes.length||pos.node.childNodes[pos.offset].contentEditable=="false");}var BlockGapWidget2=/*#__PURE__*/function(_WidgetType8){_inherits(BlockGapWidget2,_WidgetType8);var _super40=_createSuper(BlockGapWidget2);function BlockGapWidget2(height){var _this67;_classCallCheck(this,BlockGapWidget2);_this67=_super40.call(this);_this67.height=height;return _this67;}_createClass(BlockGapWidget2,[{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");this.updateDOM(elt);return elt;}},{key:"eq",value:function eq(other){return other.height==this.height;}},{key:"updateDOM",value:function updateDOM(elt){elt.style.height=this.height+"px";return true;}},{key:"estimatedHeight",get:function get(){return this.height;}}]);return BlockGapWidget2;}(WidgetType2);function compositionSurroundingNode(view){var sel=view.observer.selectionRange;var textNode=sel.focusNode&&nearbyTextNode2(sel.focusNode,sel.focusOffset,0);if(!textNode)return null;var cView=view.docView.nearest(textNode);if(!cView)return null;if(cView instanceof LineView2){var topNode=textNode;while(topNode.parentNode!=cView.dom){topNode=topNode.parentNode;}var prev=topNode.previousSibling;while(prev&&!ContentView2.get(prev)){prev=prev.previousSibling;}var pos=prev?ContentView2.get(prev).posAtEnd:cView.posAtStart;return{from:pos,to:pos,node:topNode,text:textNode};}else{for(;;){var _cView=cView,parent=_cView.parent;if(!parent)return null;if(parent instanceof LineView2)break;cView=parent;}var from=cView.posAtStart;return{from:from,to:from+cView.length,node:cView.dom,text:textNode};}}function computeCompositionDeco2(view,changes){var surrounding=compositionSurroundingNode(view);if(!surrounding)return Decoration2.none;var from=surrounding.from,to=surrounding.to,node=surrounding.node,textNode=surrounding.text;var newFrom=changes.mapPos(from,1),newTo=Math.max(newFrom,changes.mapPos(to,-1));var state=view.state,text=node.nodeType==3?node.nodeValue:new DOMReader2([],view).readRange(node.firstChild,null).text;if(newTo-newFrom<text.length){if(state.sliceDoc(newFrom,Math.min(state.doc.length,newFrom+text.length))==text)newTo=newFrom+text.length;else if(state.sliceDoc(Math.max(0,newTo-text.length),newTo)==text)newFrom=newTo-text.length;else return Decoration2.none;}else if(state.sliceDoc(newFrom,newTo)!=text){return Decoration2.none;}return Decoration2.set(Decoration2.replace({widget:new CompositionWidget2(node,textNode)}).range(newFrom,newTo));}var CompositionWidget2=/*#__PURE__*/function(_WidgetType9){_inherits(CompositionWidget2,_WidgetType9);var _super41=_createSuper(CompositionWidget2);function CompositionWidget2(top2,text){var _this68;_classCallCheck(this,CompositionWidget2);_this68=_super41.call(this);_this68.top=top2;_this68.text=text;return _this68;}_createClass(CompositionWidget2,[{key:"eq",value:function eq(other){return this.top==other.top&&this.text==other.text;}},{key:"toDOM",value:function toDOM(){return this.top;}},{key:"ignoreEvent",value:function ignoreEvent(){return false;}},{key:"customView",get:function get(){return CompositionView2;}}]);return CompositionWidget2;}(WidgetType2);function nearbyTextNode2(node,offset,side){for(;;){if(node.nodeType==3)return node;if(node.nodeType==1&&offset>0&&side<=0){node=node.childNodes[offset-1];offset=maxOffset2(node);}else if(node.nodeType==1&&offset<node.childNodes.length&&side>=0){node=node.childNodes[offset];offset=0;}else{return null;}}}function nextToUneditable2(node,offset){if(node.nodeType!=1)return 0;return(offset&&node.childNodes[offset-1].contentEditable=="false"?1:0)|(offset<node.childNodes.length&&node.childNodes[offset].contentEditable=="false"?2:0);}var DecorationComparator$12=/*#__PURE__*/function(){function DecorationComparator$12(){_classCallCheck(this,DecorationComparator$12);this.changes=[];}_createClass(DecorationComparator$12,[{key:"compareRange",value:function compareRange(from,to){addRange2(from,to,this.changes);}},{key:"comparePoint",value:function comparePoint(from,to){addRange2(from,to,this.changes);}}]);return DecorationComparator$12;}();function findChangedDeco2(a,b,diff){var comp=new DecorationComparator$12();RangeSet.compare(a,b,diff,comp);return comp.changes;}function inUneditable2(node,inside6){for(var cur2=node;cur2&&cur2!=inside6;cur2=cur2.assignedSlot||cur2.parentNode){if(cur2.nodeType==1&&cur2.contentEditable=="false"){return true;}}return false;}function groupAt2(state,pos){var bias=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var categorize=state.charCategorizer(pos);var line=state.doc.lineAt(pos),linePos=pos-line.from;if(line.length==0)return EditorSelection.cursor(pos);if(linePos==0)bias=1;else if(linePos==line.length)bias=-1;var from=linePos,to=linePos;if(bias<0)from=findClusterBreak(line.text,linePos,false);else to=findClusterBreak(line.text,linePos);var cat=categorize(line.text.slice(from,to));while(from>0){var prev=findClusterBreak(line.text,from,false);if(categorize(line.text.slice(prev,from))!=cat)break;from=prev;}while(to<line.length){var next=findClusterBreak(line.text,to);if(categorize(line.text.slice(to,next))!=cat)break;to=next;}return EditorSelection.range(from+line.from,to+line.from);}function getdx2(x,rect){return rect.left>x?rect.left-x:Math.max(0,x-rect.right);}function getdy2(y,rect){return rect.top>y?rect.top-y:Math.max(0,y-rect.bottom);}function yOverlap2(a,b){return a.top<b.bottom-1&&a.bottom>b.top+1;}function upTop2(rect,top2){return top2<rect.top?{top:top2,left:rect.left,right:rect.right,bottom:rect.bottom}:rect;}function upBot2(rect,bottom){return bottom>rect.bottom?{top:rect.top,left:rect.left,right:rect.right,bottom:bottom}:rect;}function domPosAtCoords2(parent,x,y){var closest,closestRect,closestX,closestY;var above,below,aboveRect,belowRect;for(var child=parent.firstChild;child;child=child.nextSibling){var rects=clientRectsFor2(child);for(var _i124=0;_i124<rects.length;_i124++){var rect=rects[_i124];if(closestRect&&yOverlap2(closestRect,rect))rect=upTop2(upBot2(rect,closestRect.bottom),closestRect.top);var dx=getdx2(x,rect),dy=getdy2(y,rect);if(dx==0&&dy==0)return child.nodeType==3?domPosInText2(child,x,y):domPosAtCoords2(child,x,y);if(!closest||closestY>dy||closestY==dy&&closestX>dx){closest=child;closestRect=rect;closestX=dx;closestY=dy;}if(dx==0){if(y>rect.bottom&&(!aboveRect||aboveRect.bottom<rect.bottom)){above=child;aboveRect=rect;}else if(y<rect.top&&(!belowRect||belowRect.top>rect.top)){below=child;belowRect=rect;}}else if(aboveRect&&yOverlap2(aboveRect,rect)){aboveRect=upBot2(aboveRect,rect.bottom);}else if(belowRect&&yOverlap2(belowRect,rect)){belowRect=upTop2(belowRect,rect.top);}}}if(aboveRect&&aboveRect.bottom>=y){closest=above;closestRect=aboveRect;}else if(belowRect&&belowRect.top<=y){closest=below;closestRect=belowRect;}if(!closest)return{node:parent,offset:0};var clipX=Math.max(closestRect.left,Math.min(closestRect.right,x));if(closest.nodeType==3)return domPosInText2(closest,clipX,y);if(!closestX&&closest.contentEditable=="true")return domPosAtCoords2(closest,clipX,y);var offset=Array.prototype.indexOf.call(parent.childNodes,closest)+(x>=(closestRect.left+closestRect.right)/2?1:0);return{node:parent,offset:offset};}function domPosInText2(node,x,y){var len=node.nodeValue.length;var closestOffset=-1,closestDY=1e9,generalSide=0;for(var _i125=0;_i125<len;_i125++){var rects=textRange2(node,_i125,_i125+1).getClientRects();for(var j=0;j<rects.length;j++){var rect=rects[j];if(rect.top==rect.bottom)continue;if(!generalSide)generalSide=x-rect.left;var dy=(rect.top>y?rect.top-y:y-rect.bottom)-1;if(rect.left-1<=x&&rect.right+1>=x&&dy<closestDY){var right=x>=(rect.left+rect.right)/2,after=right;if(browser2.chrome||browser2.gecko){var rectBefore=textRange2(node,_i125).getBoundingClientRect();if(rectBefore.left==rect.right)after=!right;}if(dy<=0)return{node:node,offset:_i125+(after?1:0)};closestOffset=_i125+(after?1:0);closestDY=dy;}}}return{node:node,offset:closestOffset>-1?closestOffset:generalSide>0?node.nodeValue.length:0};}function posAtCoords2(view,_ref25,precise){var x=_ref25.x,y=_ref25.y;var bias=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var _a;var content2=view.contentDOM.getBoundingClientRect(),docTop=content2.top+view.viewState.paddingTop;var block,docHeight=view.viewState.docHeight;var yOffset=y-docTop;if(yOffset<0)return 0;if(yOffset>docHeight)return view.state.doc.length;for(var halfLine=view.defaultLineHeight/2,bounced=false;;){block=view.elementAtHeight(yOffset);if(block.type==BlockType2.Text)break;for(;;){yOffset=bias>0?block.bottom+halfLine:block.top-halfLine;if(yOffset>=0&&yOffset<=docHeight)break;if(bounced)return precise?null:0;bounced=true;bias=-bias;}}y=docTop+yOffset;var lineStart=block.from;if(lineStart<view.viewport.from)return view.viewport.from==0?0:precise?null:posAtCoordsImprecise2(view,content2,block,x,y);if(lineStart>view.viewport.to)return view.viewport.to==view.state.doc.length?view.state.doc.length:precise?null:posAtCoordsImprecise2(view,content2,block,x,y);var doc6=view.dom.ownerDocument;var root=view.root.elementFromPoint?view.root:doc6;var element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null;if(!element){x=Math.max(content2.left+1,Math.min(content2.right-1,x));element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null;}var node,offset=-1;if(element&&((_a=view.docView.nearest(element))===null||_a===void 0?void 0:_a.isEditable)!=false){if(doc6.caretPositionFromPoint){var pos=doc6.caretPositionFromPoint(x,y);if(pos){node=pos.offsetNode;offset=pos.offset;}}else if(doc6.caretRangeFromPoint){var range=doc6.caretRangeFromPoint(x,y);if(range){node=range.startContainer;offset=range.startOffset;if(browser2.safari&&isSuspiciousCaretResult2(node,offset,x))node=void 0;}}}if(!node||!view.docView.dom.contains(node)){var line=LineView2.find(view.docView,lineStart);if(!line)return yOffset>block.top+block.height/2?block.to:block.from;var _domPosAtCoords2=domPosAtCoords2(line.dom,x,y);node=_domPosAtCoords2.node;offset=_domPosAtCoords2.offset;}return view.docView.posFromDOM(node,offset);}function posAtCoordsImprecise2(view,contentRect,block,x,y){var into=Math.round((x-contentRect.left)*view.defaultCharacterWidth);if(view.lineWrapping&&block.height>view.defaultLineHeight*1.5){var line=Math.floor((y-block.top)/view.defaultLineHeight);into+=line*view.viewState.heightOracle.lineLength;}var content2=view.state.sliceDoc(block.from,block.to);return block.from+findColumn(content2,into,view.state.tabSize);}function isSuspiciousCaretResult2(node,offset,x){var len;if(node.nodeType!=3||offset!=(len=node.nodeValue.length))return false;for(var next=node.nextSibling;next;next=next.nextSibling){if(next.nodeType!=1||next.nodeName!="BR")return false;}return textRange2(node,len-1,len).getBoundingClientRect().left>x;}function moveToLineBoundary2(view,start,forward,includeWrap){var line=view.state.doc.lineAt(start.head);var coords=!includeWrap||!view.lineWrapping?null:view.coordsAtPos(start.assoc<0&&start.head>line.from?start.head-1:start.head);if(coords){var editorRect=view.dom.getBoundingClientRect();var pos=view.posAtCoords({x:forward==(view.textDirection==Direction2.LTR)?editorRect.right-1:editorRect.left+1,y:(coords.top+coords.bottom)/2});if(pos!=null)return EditorSelection.cursor(pos,forward?-1:1);}var lineView=LineView2.find(view.docView,start.head);var end=lineView?forward?lineView.posAtEnd:lineView.posAtStart:forward?line.to:line.from;return EditorSelection.cursor(end,forward?-1:1);}function moveByChar2(view,start,forward,by){var line=view.state.doc.lineAt(start.head),spans=view.bidiSpans(line);for(var cur2=start,check=null;;){var next=moveVisually2(line,spans,view.textDirection,cur2,forward),_char3=movedOver2;if(!next){if(line.number==(forward?view.state.doc.lines:1))return cur2;_char3="\n";line=view.state.doc.line(line.number+(forward?1:-1));spans=view.bidiSpans(line);next=EditorSelection.cursor(forward?line.from:line.to);}if(!check){if(!by)return next;check=by(_char3);}else if(!check(_char3)){return cur2;}cur2=next;}}function byGroup2(view,pos,start){var categorize=view.state.charCategorizer(pos);var cat=categorize(start);return function(next){var nextCat=categorize(next);if(cat==CharCategory.Space)cat=nextCat;return cat==nextCat;};}function moveVertically2(view,start,forward,distance){var startPos=start.head,dir=forward?1:-1;if(startPos==(forward?view.state.doc.length:0))return EditorSelection.cursor(startPos,start.assoc);var goal=start.goalColumn,startY;var rect=view.contentDOM.getBoundingClientRect();var startCoords=view.coordsAtPos(startPos),docTop=view.documentTop;if(startCoords){if(goal==null)goal=startCoords.left-rect.left;startY=dir<0?startCoords.top:startCoords.bottom;}else{var line=view.viewState.lineBlockAt(startPos-docTop);if(goal==null)goal=Math.min(rect.right-rect.left,view.defaultCharacterWidth*(startPos-line.from));startY=(dir<0?line.top:line.bottom)+docTop;}var resolvedGoal=rect.left+goal;var dist=distance!==null&&distance!==void 0?distance:view.defaultLineHeight>>1;for(var extra=0;;extra+=10){var curY=startY+(dist+extra)*dir;var pos=posAtCoords2(view,{x:resolvedGoal,y:curY},false,dir);if(curY<rect.top||curY>rect.bottom||(dir<0?pos<startPos:pos>startPos))return EditorSelection.cursor(pos,start.assoc,void 0,goal);}}function skipAtoms2(view,oldPos,pos){var atoms=view.pluginField(PluginField2.atomicRanges);for(;;){var moved=false;var _iterator112=_createForOfIteratorHelper(atoms),_step112;try{for(_iterator112.s();!(_step112=_iterator112.n()).done;){var set=_step112.value;set.between(pos.from-1,pos.from+1,function(from,to,value){if(pos.from>from&&pos.from<to){pos=oldPos.from>pos.from?EditorSelection.cursor(from,1):EditorSelection.cursor(to,-1);moved=true;}});}}catch(err){_iterator112.e(err);}finally{_iterator112.f();}if(!moved)return pos;}}var InputState2=/*#__PURE__*/function(){function InputState2(view){var _this69=this;_classCallCheck(this,InputState2);this.lastKeyCode=0;this.lastKeyTime=0;this.pendingIOSKey=void 0;this.lastSelectionOrigin=null;this.lastSelectionTime=0;this.lastEscPress=0;this.lastContextMenu=0;this.scrollHandlers=[];this.registeredEvents=[];this.customHandlers=[];this.composing=-1;this.compositionFirstChange=null;this.compositionEndedAt=0;this.rapidCompositionStart=false;this.mouseSelection=null;var _loop11=function _loop11(type){var handler=handlers2[type];view.contentDOM.addEventListener(type,function(event){if(type=="keydown"&&_this69.keydown(view,event))return;if(!eventBelongsToEditor2(view,event)||_this69.ignoreDuringComposition(event))return;if(_this69.mustFlushObserver(event))view.observer.forceFlush();if(_this69.runCustomHandlers(type,view,event))event.preventDefault();else handler(view,event);});_this69.registeredEvents.push(type);};for(var type in handlers2){_loop11(type);}this.notifiedFocused=view.hasFocus;this.ensureHandlers(view);if(browser2.safari)view.contentDOM.addEventListener("input",function(){return null;});}_createClass(InputState2,[{key:"setSelectionOrigin",value:function setSelectionOrigin(origin){this.lastSelectionOrigin=origin;this.lastSelectionTime=Date.now();}},{key:"ensureHandlers",value:function ensureHandlers(view){var _this70=this;var handlers6=this.customHandlers=view.pluginField(domEventHandlers2);var _iterator113=_createForOfIteratorHelper(handlers6),_step113;try{for(_iterator113.s();!(_step113=_iterator113.n()).done;){var set=_step113.value;var _loop12=function _loop12(type){if(_this70.registeredEvents.indexOf(type)<0&&type!="scroll"){_this70.registeredEvents.push(type);view.contentDOM.addEventListener(type,function(event){if(!eventBelongsToEditor2(view,event))return;if(_this70.runCustomHandlers(type,view,event))event.preventDefault();});}};for(var type in set.handlers){_loop12(type);}}}catch(err){_iterator113.e(err);}finally{_iterator113.f();}}},{key:"runCustomHandlers",value:function runCustomHandlers(type,view,event){var _iterator114=_createForOfIteratorHelper(this.customHandlers),_step114;try{for(_iterator114.s();!(_step114=_iterator114.n()).done;){var set=_step114.value;var handler=set.handlers[type];if(handler){try{if(handler.call(set.plugin,event,view)||event.defaultPrevented)return true;}catch(e){logException2(view.state,e);}}}}catch(err){_iterator114.e(err);}finally{_iterator114.f();}return false;}},{key:"runScrollHandlers",value:function runScrollHandlers(view,event){var _iterator115=_createForOfIteratorHelper(this.customHandlers),_step115;try{for(_iterator115.s();!(_step115=_iterator115.n()).done;){var set=_step115.value;var handler=set.handlers.scroll;if(handler){try{handler.call(set.plugin,event,view);}catch(e){logException2(view.state,e);}}}}catch(err){_iterator115.e(err);}finally{_iterator115.f();}}},{key:"keydown",value:function keydown(view,event){var _this71=this;this.lastKeyCode=event.keyCode;this.lastKeyTime=Date.now();if(this.screenKeyEvent(view,event))return true;if(browser2.android&&browser2.chrome&&!event.synthetic&&(event.keyCode==13||event.keyCode==8)){view.observer.delayAndroidKey(event.key,event.keyCode);return true;}var pending;if(browser2.ios&&(pending=PendingKeys2.find(function(key){return key.keyCode==event.keyCode;}))&&!(event.ctrlKey||event.altKey||event.metaKey)&&!event.synthetic){this.pendingIOSKey=pending;setTimeout(function(){return _this71.flushIOSKey(view);},250);return true;}return false;}},{key:"flushIOSKey",value:function flushIOSKey(view){var key=this.pendingIOSKey;if(!key)return false;this.pendingIOSKey=void 0;return dispatchKey2(view.contentDOM,key.key,key.keyCode);}},{key:"ignoreDuringComposition",value:function ignoreDuringComposition(event){if(!/^key/.test(event.type))return false;if(this.composing>0)return true;if(browser2.safari&&Date.now()-this.compositionEndedAt<500){this.compositionEndedAt=0;return true;}return false;}},{key:"screenKeyEvent",value:function screenKeyEvent(view,event){var protectedTab=event.keyCode==9&&Date.now()<this.lastEscPress+2e3;if(event.keyCode==27)this.lastEscPress=Date.now();else if(modifierCodes2.indexOf(event.keyCode)<0)this.lastEscPress=0;return protectedTab;}},{key:"mustFlushObserver",value:function mustFlushObserver(event){return event.type=="keydown"&&event.keyCode!=229||event.type=="compositionend"&&!browser2.ios;}},{key:"startMouseSelection",value:function startMouseSelection(mouseSelection){if(this.mouseSelection)this.mouseSelection.destroy();this.mouseSelection=mouseSelection;}},{key:"update",value:function update(_update10){if(this.mouseSelection)this.mouseSelection.update(_update10);if(_update10.transactions.length)this.lastKeyCode=this.lastSelectionTime=0;}},{key:"destroy",value:function destroy(){if(this.mouseSelection)this.mouseSelection.destroy();}}]);return InputState2;}();var PendingKeys2=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}];var modifierCodes2=[16,17,18,20,91,92,224,225];var MouseSelection2=/*#__PURE__*/function(){function MouseSelection2(view,startEvent,style,mustSelect){_classCallCheck(this,MouseSelection2);this.view=view;this.style=style;this.mustSelect=mustSelect;this.lastEvent=startEvent;var doc6=view.contentDOM.ownerDocument;doc6.addEventListener("mousemove",this.move=this.move.bind(this));doc6.addEventListener("mouseup",this.up=this.up.bind(this));this.extend=startEvent.shiftKey;this.multiple=view.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange2(view,startEvent);this.dragMove=dragMovesSelection2(view,startEvent);this.dragging=isInPrimarySelection2(view,startEvent)&&getClickType2(startEvent)==1?null:false;if(this.dragging===false){startEvent.preventDefault();this.select(startEvent);}}_createClass(MouseSelection2,[{key:"move",value:function move(event){if(event.buttons==0)return this.destroy();if(this.dragging!==false)return;this.select(this.lastEvent=event);}},{key:"up",value:function up(event){if(this.dragging==null)this.select(this.lastEvent);if(!this.dragging)event.preventDefault();this.destroy();}},{key:"destroy",value:function destroy(){var doc6=this.view.contentDOM.ownerDocument;doc6.removeEventListener("mousemove",this.move);doc6.removeEventListener("mouseup",this.up);this.view.inputState.mouseSelection=null;}},{key:"select",value:function select(event){var selection2=this.style.get(event,this.extend,this.multiple);if(this.mustSelect||!selection2.eq(this.view.state.selection)||selection2.main.assoc!=this.view.state.selection.main.assoc)this.view.dispatch({selection:selection2,userEvent:"select.pointer",scrollIntoView:true});this.mustSelect=false;}},{key:"update",value:function update(_update11){var _this72=this;if(_update11.docChanged&&this.dragging)this.dragging=this.dragging.map(_update11.changes);if(this.style.update(_update11))setTimeout(function(){return _this72.select(_this72.lastEvent);},20);}}]);return MouseSelection2;}();function addsSelectionRange2(view,event){var facet=view.state.facet(clickAddsSelectionRange2);return facet.length?facet[0](event):browser2.mac?event.metaKey:event.ctrlKey;}function dragMovesSelection2(view,event){var facet=view.state.facet(dragMovesSelection$12);return facet.length?facet[0](event):browser2.mac?!event.altKey:!event.ctrlKey;}function isInPrimarySelection2(view,event){var main=view.state.selection.main;if(main.empty)return false;var sel=getSelection2(view.root);if(sel.rangeCount==0)return true;var rects=sel.getRangeAt(0).getClientRects();for(var _i126=0;_i126<rects.length;_i126++){var rect=rects[_i126];if(rect.left<=event.clientX&&rect.right>=event.clientX&&rect.top<=event.clientY&&rect.bottom>=event.clientY)return true;}return false;}function eventBelongsToEditor2(view,event){if(!event.bubbles)return true;if(event.defaultPrevented)return false;for(var node=event.target,cView;node!=view.contentDOM;node=node.parentNode){if(!node||node.nodeType==11||(cView=ContentView2.get(node))&&cView.ignoreEvent(event))return false;}return true;}var handlers2=/* @__PURE__ */Object.create(null);var brokenClipboardAPI2=browser2.ie&&browser2.ie_version<15||browser2.ios&&browser2.webkit_version<604;function capturePaste2(view){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.focus();setTimeout(function(){view.focus();target.remove();doPaste2(view,target.value);},50);}function doPaste2(view,input){var state=view.state,changes,i=1,text=state.toText(input);var byLine=text.lines==state.selection.ranges.length;var linewise=lastLinewiseCopy2!=null&&state.selection.ranges.every(function(r){return r.empty;})&&lastLinewiseCopy2==text.toString();if(linewise){var lastLine=-1;changes=state.changeByRange(function(range){var line=state.doc.lineAt(range.from);if(line.from==lastLine)return{range:range};lastLine=line.from;var insert2=state.toText((byLine?text.line(i++).text:input)+state.lineBreak);return{changes:{from:line.from,insert:insert2},range:EditorSelection.cursor(range.from+insert2.length)};});}else if(byLine){changes=state.changeByRange(function(range){var line=text.line(i++);return{changes:{from:range.from,to:range.to,insert:line.text},range:EditorSelection.cursor(range.from+line.length)};});}else{changes=state.replaceSelection(text);}view.dispatch(changes,{userEvent:"input.paste",scrollIntoView:true});}handlers2.keydown=function(view,event){view.inputState.setSelectionOrigin("select");};var lastTouch2=0;handlers2.touchstart=function(view,e){lastTouch2=Date.now();view.inputState.setSelectionOrigin("select.pointer");};handlers2.touchmove=function(view){view.inputState.setSelectionOrigin("select.pointer");};handlers2.mousedown=function(view,event){view.observer.flush();if(lastTouch2>Date.now()-2e3&&getClickType2(event)==1)return;var style=null;var _iterator116=_createForOfIteratorHelper(view.state.facet(mouseSelectionStyle2)),_step116;try{for(_iterator116.s();!(_step116=_iterator116.n()).done;){var makeStyle=_step116.value;style=makeStyle(view,event);if(style)break;}}catch(err){_iterator116.e(err);}finally{_iterator116.f();}if(!style&&event.button==0)style=basicMouseSelection2(view,event);if(style){var mustFocus=view.root.activeElement!=view.contentDOM;if(mustFocus)view.observer.ignore(function(){return focusPreventScroll2(view.contentDOM);});view.inputState.startMouseSelection(new MouseSelection2(view,event,style,mustFocus));}};function rangeForClick2(view,pos,bias,type){if(type==1){return EditorSelection.cursor(pos,bias);}else if(type==2){return groupAt2(view.state,pos,bias);}else{var visual=LineView2.find(view.docView,pos),line=view.state.doc.lineAt(visual?visual.posAtEnd:pos);var from=visual?visual.posAtStart:line.from,to=visual?visual.posAtEnd:line.to;if(to<view.state.doc.length&&to==line.to)to++;return EditorSelection.range(from,to);}}var insideY2=function insideY2(y,rect){return y>=rect.top&&y<=rect.bottom;};var inside2=function inside2(x,y,rect){return insideY2(y,rect)&&x>=rect.left&&x<=rect.right;};function findPositionSide2(view,pos,x,y){var line=LineView2.find(view.docView,pos);if(!line)return 1;var off=pos-line.posAtStart;if(off==0)return 1;if(off==line.length)return-1;var before=line.coordsAt(off,-1);if(before&&inside2(x,y,before))return-1;var after=line.coordsAt(off,1);if(after&&inside2(x,y,after))return 1;return before&&insideY2(y,before)?-1:1;}function queryPos2(view,event){var pos=view.posAtCoords({x:event.clientX,y:event.clientY},false);return{pos:pos,bias:findPositionSide2(view,pos,event.clientX,event.clientY)};}var BadMouseDetail2=browser2.ie&&browser2.ie_version<=11;var lastMouseDown2=null;var lastMouseDownCount2=0;var lastMouseDownTime2=0;function getClickType2(event){if(!BadMouseDetail2)return event.detail;var last=lastMouseDown2,lastTime=lastMouseDownTime2;lastMouseDown2=event;lastMouseDownTime2=Date.now();return lastMouseDownCount2=!last||lastTime>Date.now()-400&&Math.abs(last.clientX-event.clientX)<2&&Math.abs(last.clientY-event.clientY)<2?(lastMouseDownCount2+1)%3:1;}function basicMouseSelection2(view,event){var start=queryPos2(view,event),type=getClickType2(event);var startSel=view.state.selection;var last=start,lastEvent=event;return{update:function update(_update12){if(_update12.docChanged){if(start)start.pos=_update12.changes.mapPos(start.pos);startSel=startSel.map(_update12.changes);lastEvent=null;}},get:function get(event2,extend2,multiple){var cur2;if(lastEvent&&event2.clientX==lastEvent.clientX&&event2.clientY==lastEvent.clientY)cur2=last;else{cur2=last=queryPos2(view,event2);lastEvent=event2;}if(!cur2||!start)return startSel;var range=rangeForClick2(view,cur2.pos,cur2.bias,type);if(start.pos!=cur2.pos&&!extend2){var startRange=rangeForClick2(view,start.pos,start.bias,type);var from=Math.min(startRange.from,range.from),to=Math.max(startRange.to,range.to);range=from<range.from?EditorSelection.range(from,to):EditorSelection.range(to,from);}if(extend2)return startSel.replaceRange(startSel.main.extend(range.from,range.to));else if(multiple)return startSel.addRange(range);else return EditorSelection.create([range]);}};}handlers2.dragstart=function(view,event){var main=view.state.selection.main;var mouseSelection=view.inputState.mouseSelection;if(mouseSelection)mouseSelection.dragging=main;if(event.dataTransfer){event.dataTransfer.setData("Text",view.state.sliceDoc(main.from,main.to));event.dataTransfer.effectAllowed="copyMove";}};function dropText2(view,event,text,direct){if(!text)return;var dropPos=view.posAtCoords({x:event.clientX,y:event.clientY},false);event.preventDefault();var mouseSelection=view.inputState.mouseSelection;var del=direct&&mouseSelection&&mouseSelection.dragging&&mouseSelection.dragMove?{from:mouseSelection.dragging.from,to:mouseSelection.dragging.to}:null;var ins={from:dropPos,insert:text};var changes=view.state.changes(del?[del,ins]:ins);view.focus();view.dispatch({changes:changes,selection:{anchor:changes.mapPos(dropPos,-1),head:changes.mapPos(dropPos,1)},userEvent:del?"move.drop":"input.drop"});}handlers2.drop=function(view,event){if(!event.dataTransfer)return;if(view.state.readOnly)return event.preventDefault();var files=event.dataTransfer.files;if(files&&files.length){(function(){event.preventDefault();var text=Array(files.length),read=0;var finishFile=function finishFile(){if(++read==files.length)dropText2(view,event,text.filter(function(s){return s!=null;}).join(view.state.lineBreak),false);};var _loop13=function _loop13(_i127){var reader=new FileReader();reader.onerror=finishFile;reader.onload=function(){if(!/[\x00-\x08\x0e-\x1f]{2}/.test(reader.result))text[_i127]=reader.result;finishFile();};reader.readAsText(files[_i127]);};for(var _i127=0;_i127<files.length;_i127++){_loop13(_i127);}})();}else{dropText2(view,event,event.dataTransfer.getData("Text"),true);}};handlers2.paste=function(view,event){if(view.state.readOnly)return event.preventDefault();view.observer.flush();var data=brokenClipboardAPI2?null:event.clipboardData;if(data){doPaste2(view,data.getData("text/plain"));event.preventDefault();}else{capturePaste2(view);}};function captureCopy2(view,text){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.value=text;target.focus();target.selectionEnd=text.length;target.selectionStart=0;setTimeout(function(){target.remove();view.focus();},50);}function copiedRange2(state){var content2=[],ranges=[],linewise=false;var _iterator117=_createForOfIteratorHelper(state.selection.ranges),_step117;try{for(_iterator117.s();!(_step117=_iterator117.n()).done;){var range=_step117.value;if(!range.empty){content2.push(state.sliceDoc(range.from,range.to));ranges.push(range);}}}catch(err){_iterator117.e(err);}finally{_iterator117.f();}if(!content2.length){var upto=-1;var _iterator118=_createForOfIteratorHelper(state.selection.ranges),_step118;try{for(_iterator118.s();!(_step118=_iterator118.n()).done;){var from=_step118.value.from;var line=state.doc.lineAt(from);if(line.number>upto){content2.push(line.text);ranges.push({from:line.from,to:Math.min(state.doc.length,line.to+1)});}upto=line.number;}}catch(err){_iterator118.e(err);}finally{_iterator118.f();}linewise=true;}return{text:content2.join(state.lineBreak),ranges:ranges,linewise:linewise};}var lastLinewiseCopy2=null;handlers2.copy=handlers2.cut=function(view,event){var _copiedRange2=copiedRange2(view.state),text=_copiedRange2.text,ranges=_copiedRange2.ranges,linewise=_copiedRange2.linewise;if(!text&&!linewise)return;lastLinewiseCopy2=linewise?text:null;var data=brokenClipboardAPI2?null:event.clipboardData;if(data){event.preventDefault();data.clearData();data.setData("text/plain",text);}else{captureCopy2(view,text);}if(event.type=="cut"&&!view.state.readOnly)view.dispatch({changes:ranges,scrollIntoView:true,userEvent:"delete.cut"});};handlers2.focus=handlers2.blur=function(view){setTimeout(function(){if(view.hasFocus!=view.inputState.notifiedFocused)view.update([]);},10);};handlers2.beforeprint=function(view){view.viewState.printing=true;view.requestMeasure();setTimeout(function(){view.viewState.printing=false;view.requestMeasure();},2e3);};function forceClearComposition2(view,rapid){if(view.docView.compositionDeco.size){view.inputState.rapidCompositionStart=rapid;try{view.update([]);}finally{view.inputState.rapidCompositionStart=false;}}}handlers2.compositionstart=handlers2.compositionupdate=function(view){if(view.inputState.compositionFirstChange==null)view.inputState.compositionFirstChange=true;if(view.inputState.composing<0){view.inputState.composing=0;if(view.docView.compositionDeco.size){view.observer.flush();forceClearComposition2(view,true);}}};handlers2.compositionend=function(view){view.inputState.composing=-1;view.inputState.compositionEndedAt=Date.now();view.inputState.compositionFirstChange=null;setTimeout(function(){if(view.inputState.composing<0)forceClearComposition2(view,false);},50);};handlers2.contextmenu=function(view){view.inputState.lastContextMenu=Date.now();};handlers2.beforeinput=function(view,event){var _a;var pending;if(browser2.chrome&&browser2.android&&(pending=PendingKeys2.find(function(key){return key.inputType==event.inputType;}))){view.observer.delayAndroidKey(pending.key,pending.keyCode);if(pending.key=="Backspace"||pending.key=="Delete"){var startViewHeight=((_a=window.visualViewport)===null||_a===void 0?void 0:_a.height)||0;setTimeout(function(){var _a2;if((((_a2=window.visualViewport)===null||_a2===void 0?void 0:_a2.height)||0)>startViewHeight+10&&view.hasFocus){view.contentDOM.blur();view.focus();}},100);}}};var wrappingWhiteSpace2=["pre-wrap","normal","pre-line","break-spaces"];var HeightOracle2=/*#__PURE__*/function(){function HeightOracle2(){_classCallCheck(this,HeightOracle2);this.doc=Text.empty;this.lineWrapping=false;this.direction=Direction2.LTR;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.lineLength=30;this.heightChanged=false;}_createClass(HeightOracle2,[{key:"heightForGap",value:function heightForGap(from,to){var lines=this.doc.lineAt(to).number-this.doc.lineAt(from).number+1;if(this.lineWrapping)lines+=Math.ceil((to-from-lines*this.lineLength*0.5)/this.lineLength);return this.lineHeight*lines;}},{key:"heightForLine",value:function heightForLine(length){if(!this.lineWrapping)return this.lineHeight;var lines=1+Math.max(0,Math.ceil((length-this.lineLength)/(this.lineLength-5)));return lines*this.lineHeight;}},{key:"setDoc",value:function setDoc(doc6){this.doc=doc6;return this;}},{key:"mustRefreshForStyle",value:function mustRefreshForStyle(whiteSpace,direction){return wrappingWhiteSpace2.indexOf(whiteSpace)>-1!=this.lineWrapping||this.direction!=direction;}},{key:"mustRefreshForHeights",value:function mustRefreshForHeights(lineHeights){var newHeight=false;for(var _i128=0;_i128<lineHeights.length;_i128++){var h=lineHeights[_i128];if(h<0){_i128++;}else if(!this.heightSamples[Math.floor(h*10)]){newHeight=true;this.heightSamples[Math.floor(h*10)]=true;}}return newHeight;}},{key:"refresh",value:function refresh(whiteSpace,direction,lineHeight,charWidth,lineLength,knownHeights){var lineWrapping=wrappingWhiteSpace2.indexOf(whiteSpace)>-1;var changed=Math.round(lineHeight)!=Math.round(this.lineHeight)||this.lineWrapping!=lineWrapping||this.direction!=direction;this.lineWrapping=lineWrapping;this.direction=direction;this.lineHeight=lineHeight;this.charWidth=charWidth;this.lineLength=lineLength;if(changed){this.heightSamples={};for(var _i129=0;_i129<knownHeights.length;_i129++){var h=knownHeights[_i129];if(h<0)_i129++;else this.heightSamples[Math.floor(h*10)]=true;}}return changed;}}]);return HeightOracle2;}();var MeasuredHeights2=/*#__PURE__*/function(){function MeasuredHeights2(from,heights){_classCallCheck(this,MeasuredHeights2);this.from=from;this.heights=heights;this.index=0;}_createClass(MeasuredHeights2,[{key:"more",get:function get(){return this.index<this.heights.length;}}]);return MeasuredHeights2;}();var BlockInfo2=/*#__PURE__*/function(){function BlockInfo2(from,length,top2,height,type){_classCallCheck(this,BlockInfo2);this.from=from;this.length=length;this.top=top2;this.height=height;this.type=type;}_createClass(BlockInfo2,[{key:"to",get:function get(){return this.from+this.length;}},{key:"bottom",get:function get(){return this.top+this.height;}},{key:"join",value:function join(other){var detail=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(other.type)?other.type:[other]);return new BlockInfo2(this.from,this.length+other.length,this.top,this.height+other.height,detail);}},{key:"moveY",value:function moveY(offset){return!offset?this:new BlockInfo2(this.from,this.length,this.top+offset,this.height,Array.isArray(this.type)?this.type.map(function(b){return b.moveY(offset);}):this.type);}}]);return BlockInfo2;}();var QueryType2=/* @__PURE__ */function(QueryType7){QueryType7[QueryType7["ByPos"]=0]="ByPos";QueryType7[QueryType7["ByHeight"]=1]="ByHeight";QueryType7[QueryType7["ByPosNoHeight"]=2]="ByPosNoHeight";return QueryType7;}(QueryType2||(QueryType2={}));var Epsilon2=1e-3;var HeightMap2=/*#__PURE__*/function(){function HeightMap2(length,height){var flags=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;_classCallCheck(this,HeightMap2);this.length=length;this.height=height;this.flags=flags;}_createClass(HeightMap2,[{key:"outdated",get:function get(){return(this.flags&2)>0;},set:function set(value){this.flags=(value?2:0)|this.flags&~2;}},{key:"setHeight",value:function setHeight(oracle,height){if(this.height!=height){if(Math.abs(this.height-height)>Epsilon2)oracle.heightChanged=true;this.height=height;}}},{key:"replace",value:function replace(_from,_to,nodes){return HeightMap2.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(_to,result){result.push(this);}},{key:"decomposeRight",value:function decomposeRight(_from,result){result.push(this);}},{key:"applyChanges",value:function applyChanges(decorations6,oldDoc,oracle,changes){var me=this;for(var _i130=changes.length-1;_i130>=0;_i130--){var _changes$_i2=changes[_i130],fromA=_changes$_i2.fromA,toA=_changes$_i2.toA,fromB=_changes$_i2.fromB,toB=_changes$_i2.toB;var start=me.lineAt(fromA,QueryType2.ByPosNoHeight,oldDoc,0,0);var end=start.to>=toA?start:me.lineAt(toA,QueryType2.ByPosNoHeight,oldDoc,0,0);toB+=end.to-toA;toA=end.to;while(_i130>0&&start.from<=changes[_i130-1].toA){fromA=changes[_i130-1].fromA;fromB=changes[_i130-1].fromB;_i130--;if(fromA<start.from)start=me.lineAt(fromA,QueryType2.ByPosNoHeight,oldDoc,0,0);}fromB+=start.from-fromA;fromA=start.from;var nodes=NodeBuilder2.build(oracle,decorations6,fromB,toB);me=me.replace(fromA,toA,nodes);}return me.updateHeight(oracle,0);}}],[{key:"empty",value:function empty(){return new HeightMapText2(0,0);}},{key:"of",value:function of(nodes){if(nodes.length==1)return nodes[0];var i=0,j=nodes.length,before=0,after=0;for(;;){if(i==j){if(before>after*2){var split=nodes[i-1];if(split["break"])nodes.splice(--i,1,split.left,null,split.right);else nodes.splice(--i,1,split.left,split.right);j+=1+split["break"];before-=split.size;}else if(after>before*2){var _split2=nodes[j];if(_split2["break"])nodes.splice(j,1,_split2.left,null,_split2.right);else nodes.splice(j,1,_split2.left,_split2.right);j+=2+_split2["break"];after-=_split2.size;}else{break;}}else if(before<after){var next=nodes[i++];if(next)before+=next.size;}else{var _next3=nodes[--j];if(_next3)after+=_next3.size;}}var brk=0;if(nodes[i-1]==null){brk=1;i--;}else if(nodes[i]==null){brk=1;j++;}return new HeightMapBranch2(HeightMap2.of(nodes.slice(0,i)),brk,HeightMap2.of(nodes.slice(j)));}}]);return HeightMap2;}();HeightMap2.prototype.size=1;var HeightMapBlock2=/*#__PURE__*/function(_HeightMap4){_inherits(HeightMapBlock2,_HeightMap4);var _super42=_createSuper(HeightMapBlock2);function HeightMapBlock2(length,height,type){var _this73;_classCallCheck(this,HeightMapBlock2);_this73=_super42.call(this,length,height);_this73.type=type;return _this73;}_createClass(HeightMapBlock2,[{key:"blockAt",value:function blockAt(_height,_doc,top2,offset){return new BlockInfo2(offset,this.length,top2,this.height,this.type);}},{key:"lineAt",value:function lineAt(_value,_type,doc6,top2,offset){return this.blockAt(0,doc6,top2,offset);}},{key:"forEachLine",value:function forEachLine(_from,_to,doc6,top2,offset,f){f(this.blockAt(0,doc6,top2,offset));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var _force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);this.outdated=false;return this;}},{key:"toString",value:function toString(){return"block(".concat(this.length,")");}}]);return HeightMapBlock2;}(HeightMap2);var HeightMapText2=/*#__PURE__*/function(_HeightMapBlock2){_inherits(HeightMapText2,_HeightMapBlock2);var _super43=_createSuper(HeightMapText2);function HeightMapText2(length,height){var _this74;_classCallCheck(this,HeightMapText2);_this74=_super43.call(this,length,height,BlockType2.Text);_this74.collapsed=0;_this74.widgetHeight=0;return _this74;}_createClass(HeightMapText2,[{key:"replace",value:function replace(_from,_to,nodes){var node=nodes[0];if(nodes.length==1&&(node instanceof HeightMapText2||node instanceof HeightMapGap2&&node.flags&4)&&Math.abs(this.length-node.length)<10){if(node instanceof HeightMapGap2)node=new HeightMapText2(node.length,this.height);else node.height=this.height;if(!this.outdated)node.outdated=false;return node;}else{return HeightMap2.of(nodes);}}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);else if(force||this.outdated)this.setHeight(oracle,Math.max(this.widgetHeight,oracle.heightForLine(this.length-this.collapsed)));this.outdated=false;return this;}},{key:"toString",value:function toString(){return"line(".concat(this.length).concat(this.collapsed?-this.collapsed:"").concat(this.widgetHeight?":"+this.widgetHeight:"",")");}}]);return HeightMapText2;}(HeightMapBlock2);var HeightMapGap2=/*#__PURE__*/function(_HeightMap5){_inherits(HeightMapGap2,_HeightMap5);var _super44=_createSuper(HeightMapGap2);function HeightMapGap2(length){_classCallCheck(this,HeightMapGap2);return _super44.call(this,length,0);}_createClass(HeightMapGap2,[{key:"lines",value:function lines(doc6,offset){var firstLine=doc6.lineAt(offset).number,lastLine=doc6.lineAt(offset+this.length).number;return{firstLine:firstLine,lastLine:lastLine,lineHeight:this.height/(lastLine-firstLine+1)};}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var _this$lines4=this.lines(doc6,offset),firstLine=_this$lines4.firstLine,lastLine=_this$lines4.lastLine,lineHeight=_this$lines4.lineHeight;var line=Math.max(0,Math.min(lastLine-firstLine,Math.floor((height-top2)/lineHeight)));var _doc6$line2=doc6.line(firstLine+line),from=_doc6$line2.from,length=_doc6$line2.length;return new BlockInfo2(from,length,top2+lineHeight*line,lineHeight,BlockType2.Text);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){if(type==QueryType2.ByHeight)return this.blockAt(value,doc6,top2,offset);if(type==QueryType2.ByPosNoHeight){var _doc6$lineAt3=doc6.lineAt(value),from2=_doc6$lineAt3.from,to=_doc6$lineAt3.to;return new BlockInfo2(from2,to-from2,0,0,BlockType2.Text);}var _this$lines5=this.lines(doc6,offset),firstLine=_this$lines5.firstLine,lineHeight=_this$lines5.lineHeight;var _doc6$lineAt4=doc6.lineAt(value),from=_doc6$lineAt4.from,length=_doc6$lineAt4.length,number2=_doc6$lineAt4.number;return new BlockInfo2(from,length,top2+lineHeight*(number2-firstLine),lineHeight,BlockType2.Text);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var _this$lines6=this.lines(doc6,offset),firstLine=_this$lines6.firstLine,lineHeight=_this$lines6.lineHeight;for(var pos=Math.max(from,offset),end=Math.min(offset+this.length,to);pos<=end;){var line=doc6.lineAt(pos);if(pos==from)top2+=lineHeight*(line.number-firstLine);f(new BlockInfo2(line.from,line.length,top2,lineHeight,BlockType2.Text));top2+=lineHeight;pos=line.to+1;}}},{key:"replace",value:function replace(from,to,nodes){var after=this.length-to;if(after>0){var last=nodes[nodes.length-1];if(last instanceof HeightMapGap2)nodes[nodes.length-1]=new HeightMapGap2(last.length+after);else nodes.push(null,new HeightMapGap2(after-1));}if(from>0){var first=nodes[0];if(first instanceof HeightMapGap2)nodes[0]=new HeightMapGap2(from+first.length);else nodes.unshift(new HeightMapGap2(from-1),null);}return HeightMap2.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){result.push(new HeightMapGap2(to-1),null);}},{key:"decomposeRight",value:function decomposeRight(from,result){result.push(null,new HeightMapGap2(this.length-from-1));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var end=offset+this.length;if(measured&&measured.from<=offset+this.length&&measured.more){var nodes=[],pos=Math.max(offset,measured.from),singleHeight=-1;var wasChanged=oracle.heightChanged;if(measured.from>offset)nodes.push(new HeightMapGap2(measured.from-offset-1).updateHeight(oracle,offset));while(pos<=end&&measured.more){var len=oracle.doc.lineAt(pos).length;if(nodes.length)nodes.push(null);var height=measured.heights[measured.index++];if(singleHeight==-1)singleHeight=height;else if(Math.abs(height-singleHeight)>=Epsilon2)singleHeight=-2;var line=new HeightMapText2(len,height);line.outdated=false;nodes.push(line);pos+=len+1;}if(pos<=end)nodes.push(null,new HeightMapGap2(end-pos).updateHeight(oracle,pos));var result=HeightMap2.of(nodes);oracle.heightChanged=wasChanged||singleHeight<0||Math.abs(result.height-this.height)>=Epsilon2||Math.abs(singleHeight-this.lines(oracle.doc,offset).lineHeight)>=Epsilon2;return result;}else if(force||this.outdated){this.setHeight(oracle,oracle.heightForGap(offset,offset+this.length));this.outdated=false;}return this;}},{key:"toString",value:function toString(){return"gap(".concat(this.length,")");}}]);return HeightMapGap2;}(HeightMap2);var HeightMapBranch2=/*#__PURE__*/function(_HeightMap6){_inherits(HeightMapBranch2,_HeightMap6);var _super45=_createSuper(HeightMapBranch2);function HeightMapBranch2(left,brk,right){var _this75;_classCallCheck(this,HeightMapBranch2);_this75=_super45.call(this,left.length+brk+right.length,left.height+right.height,brk|(left.outdated||right.outdated?2:0));_this75.left=left;_this75.right=right;_this75.size=left.size+right.size;return _this75;}_createClass(HeightMapBranch2,[{key:"break",get:function get(){return this.flags&1;}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var mid=top2+this.left.height;return height<mid?this.left.blockAt(height,doc6,top2,offset):this.right.blockAt(height,doc6,mid,offset+this.left.length+this["break"]);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];var left=type==QueryType2.ByHeight?value<rightTop:value<rightOffset;var base2=left?this.left.lineAt(value,type,doc6,top2,offset):this.right.lineAt(value,type,doc6,rightTop,rightOffset);if(this["break"]||(left?base2.to<rightOffset:base2.from>rightOffset))return base2;var subQuery=type==QueryType2.ByPosNoHeight?QueryType2.ByPosNoHeight:QueryType2.ByPos;if(left)return base2.join(this.right.lineAt(rightOffset,subQuery,doc6,rightTop,rightOffset));else return this.left.lineAt(rightOffset,subQuery,doc6,top2,offset).join(base2);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];if(this["break"]){if(from<rightOffset)this.left.forEachLine(from,to,doc6,top2,offset,f);if(to>=rightOffset)this.right.forEachLine(from,to,doc6,rightTop,rightOffset,f);}else{var mid=this.lineAt(rightOffset,QueryType2.ByPos,doc6,top2,offset);if(from<mid.from)this.left.forEachLine(from,mid.from-1,doc6,top2,offset,f);if(mid.to>=from&&mid.from<=to)f(mid);if(to>mid.to)this.right.forEachLine(mid.to+1,to,doc6,rightTop,rightOffset,f);}}},{key:"replace",value:function replace(from,to,nodes){var rightStart=this.left.length+this["break"];if(to<rightStart)return this.balanced(this.left.replace(from,to,nodes),this.right);if(from>this.left.length)return this.balanced(this.left,this.right.replace(from-rightStart,to-rightStart,nodes));var result=[];if(from>0)this.decomposeLeft(from,result);var left=result.length;var _iterator119=_createForOfIteratorHelper(nodes),_step119;try{for(_iterator119.s();!(_step119=_iterator119.n()).done;){var node=_step119.value;result.push(node);}}catch(err){_iterator119.e(err);}finally{_iterator119.f();}if(from>0)mergeGaps2(result,left-1);if(to<this.length){var right=result.length;this.decomposeRight(to,result);mergeGaps2(result,right);}return HeightMap2.of(result);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){var left=this.left.length;if(to<=left)return this.left.decomposeLeft(to,result);result.push(this.left);if(this["break"]){left++;if(to>=left)result.push(null);}if(to>left)this.right.decomposeLeft(to-left,result);}},{key:"decomposeRight",value:function decomposeRight(from,result){var left=this.left.length,right=left+this["break"];if(from>=right)return this.right.decomposeRight(from-right,result);if(from<left)this.left.decomposeRight(from,result);if(this["break"]&&from<right)result.push(null);result.push(this.right);}},{key:"balanced",value:function balanced(left,right){if(left.size>2*right.size||right.size>2*left.size)return HeightMap2.of(this["break"]?[left,null,right]:[left,right]);this.left=left;this.right=right;this.height=left.height+right.height;this.outdated=left.outdated||right.outdated;this.size=left.size+right.size;this.length=left.length+this["break"]+right.length;return this;}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var left=this.left,right=this.right,rightStart=offset+left.length+this["break"],rebalance=null;if(measured&&measured.from<=offset+left.length&&measured.more)rebalance=left=left.updateHeight(oracle,offset,force,measured);else left.updateHeight(oracle,offset,force);if(measured&&measured.from<=rightStart+right.length&&measured.more)rebalance=right=right.updateHeight(oracle,rightStart,force,measured);else right.updateHeight(oracle,rightStart,force);if(rebalance)return this.balanced(left,right);this.height=this.left.height+this.right.height;this.outdated=false;return this;}},{key:"toString",value:function toString(){return this.left+(this["break"]?" ":"-")+this.right;}}]);return HeightMapBranch2;}(HeightMap2);function mergeGaps2(nodes,around){var before,after;if(nodes[around]==null&&(before=nodes[around-1])instanceof HeightMapGap2&&(after=nodes[around+1])instanceof HeightMapGap2)nodes.splice(around-1,3,new HeightMapGap2(before.length+1+after.length));}var relevantWidgetHeight2=5;var NodeBuilder2=/*#__PURE__*/function(){function NodeBuilder2(pos,oracle){_classCallCheck(this,NodeBuilder2);this.pos=pos;this.oracle=oracle;this.nodes=[];this.lineStart=-1;this.lineEnd=-1;this.covering=null;this.writtenTo=pos;}_createClass(NodeBuilder2,[{key:"isCovered",get:function get(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering;}},{key:"span",value:function span(_from,to){if(this.lineStart>-1){var end=Math.min(to,this.lineEnd),last=this.nodes[this.nodes.length-1];if(last instanceof HeightMapText2)last.length+=end-this.pos;else if(end>this.pos||!this.isCovered)this.nodes.push(new HeightMapText2(end-this.pos,-1));this.writtenTo=end;if(to>end){this.nodes.push(null);this.writtenTo++;this.lineStart=-1;}}this.pos=to;}},{key:"point",value:function point(from,to,deco){if(from<to||deco.heightRelevant){var height=deco.widget?deco.widget.estimatedHeight:0;if(height<0)height=this.oracle.lineHeight;var len=to-from;if(deco.block){this.addBlock(new HeightMapBlock2(len,height,deco.type));}else if(len||height>=relevantWidgetHeight2){this.addLineDeco(height,len);}}else if(to>from){this.span(from,to);}if(this.lineEnd>-1&&this.lineEnd<this.pos)this.lineEnd=this.oracle.doc.lineAt(this.pos).to;}},{key:"enterLine",value:function enterLine(){if(this.lineStart>-1)return;var _this$oracle$doc$line2=this.oracle.doc.lineAt(this.pos),from=_this$oracle$doc$line2.from,to=_this$oracle$doc$line2.to;this.lineStart=from;this.lineEnd=to;if(this.writtenTo<from){if(this.writtenTo<from-1||this.nodes[this.nodes.length-1]==null)this.nodes.push(this.blankContent(this.writtenTo,from-1));this.nodes.push(null);}if(this.pos>from)this.nodes.push(new HeightMapText2(this.pos-from,-1));this.writtenTo=this.pos;}},{key:"blankContent",value:function blankContent(from,to){var gap=new HeightMapGap2(to-from);if(this.oracle.doc.lineAt(from).to==to)gap.flags|=4;return gap;}},{key:"ensureLine",value:function ensureLine(){this.enterLine();var last=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(last instanceof HeightMapText2)return last;var line=new HeightMapText2(0,-1);this.nodes.push(line);return line;}},{key:"addBlock",value:function addBlock(block){this.enterLine();if(block.type==BlockType2.WidgetAfter&&!this.isCovered)this.ensureLine();this.nodes.push(block);this.writtenTo=this.pos=this.pos+block.length;if(block.type!=BlockType2.WidgetBefore)this.covering=block;}},{key:"addLineDeco",value:function addLineDeco(height,length){var line=this.ensureLine();line.length+=length;line.collapsed+=length;line.widgetHeight=Math.max(line.widgetHeight,height);this.writtenTo=this.pos=this.pos+length;}},{key:"finish",value:function finish(from){var last=this.nodes.length==0?null:this.nodes[this.nodes.length-1];if(this.lineStart>-1&&!(last instanceof HeightMapText2)&&!this.isCovered)this.nodes.push(new HeightMapText2(0,-1));else if(this.writtenTo<this.pos||last==null)this.nodes.push(this.blankContent(this.writtenTo,this.pos));var pos=from;var _iterator120=_createForOfIteratorHelper(this.nodes),_step120;try{for(_iterator120.s();!(_step120=_iterator120.n()).done;){var node=_step120.value;if(node instanceof HeightMapText2)node.updateHeight(this.oracle,pos);pos+=node?node.length:1;}}catch(err){_iterator120.e(err);}finally{_iterator120.f();}return this.nodes;}}],[{key:"build",value:function build(oracle,decorations6,from,to){var builder=new NodeBuilder2(from,oracle);RangeSet.spans(decorations6,from,to,builder,0);return builder.finish(from);}}]);return NodeBuilder2;}();function heightRelevantDecoChanges2(a,b,diff){var comp=new DecorationComparator2();RangeSet.compare(a,b,diff,comp,0);return comp.changes;}var DecorationComparator2=/*#__PURE__*/function(){function DecorationComparator2(){_classCallCheck(this,DecorationComparator2);this.changes=[];}_createClass(DecorationComparator2,[{key:"compareRange",value:function compareRange(){}},{key:"comparePoint",value:function comparePoint(from,to,a,b){if(from<to||a&&a.heightRelevant||b&&b.heightRelevant)addRange2(from,to,this.changes,5);}}]);return DecorationComparator2;}();function visiblePixelRange2(dom,paddingTop){var rect=dom.getBoundingClientRect();var left=Math.max(0,rect.left),right=Math.min(innerWidth,rect.right);var top2=Math.max(0,rect.top),bottom=Math.min(innerHeight,rect.bottom);var body=dom.ownerDocument.body;for(var parent=dom.parentNode;parent&&parent!=body;){if(parent.nodeType==1){var elt=parent;var style=window.getComputedStyle(elt);if((elt.scrollHeight>elt.clientHeight||elt.scrollWidth>elt.clientWidth)&&style.overflow!="visible"){var parentRect=elt.getBoundingClientRect();left=Math.max(left,parentRect.left);right=Math.min(right,parentRect.right);top2=Math.max(top2,parentRect.top);bottom=Math.min(bottom,parentRect.bottom);}parent=style.position=="absolute"||style.position=="fixed"?elt.offsetParent:elt.parentNode;}else if(parent.nodeType==11){parent=parent.host;}else{break;}}return{left:left-rect.left,right:Math.max(left,right)-rect.left,top:top2-(rect.top+paddingTop),bottom:Math.max(top2,bottom)-(rect.top+paddingTop)};}var LineGap2=/*#__PURE__*/function(){function LineGap2(from,to,size){_classCallCheck(this,LineGap2);this.from=from;this.to=to;this.size=size;}_createClass(LineGap2,[{key:"draw",value:function draw(wrapping){return Decoration2.replace({widget:new LineGapWidget2(this.size,wrapping)}).range(this.from,this.to);}}],[{key:"same",value:function same(a,b){if(a.length!=b.length)return false;for(var _i131=0;_i131<a.length;_i131++){var gA=a[_i131],gB=b[_i131];if(gA.from!=gB.from||gA.to!=gB.to||gA.size!=gB.size)return false;}return true;}}]);return LineGap2;}();var LineGapWidget2=/*#__PURE__*/function(_WidgetType10){_inherits(LineGapWidget2,_WidgetType10);var _super46=_createSuper(LineGapWidget2);function LineGapWidget2(size,vertical){var _this76;_classCallCheck(this,LineGapWidget2);_this76=_super46.call(this);_this76.size=size;_this76.vertical=vertical;return _this76;}_createClass(LineGapWidget2,[{key:"eq",value:function eq(other){return other.size==this.size&&other.vertical==this.vertical;}},{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");if(this.vertical){elt.style.height=this.size+"px";}else{elt.style.width=this.size+"px";elt.style.height="2px";elt.style.display="inline-block";}return elt;}},{key:"estimatedHeight",get:function get(){return this.vertical?this.size:-1;}}]);return LineGapWidget2;}(WidgetType2);var ViewState2=/*#__PURE__*/function(){function ViewState2(state){_classCallCheck(this,ViewState2);this.state=state;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=true;this.paddingTop=0;this.paddingBottom=0;this.contentDOMWidth=0;this.contentDOMHeight=0;this.editorHeight=0;this.editorWidth=0;this.heightOracle=new HeightOracle2();this.scaler=IdScaler2;this.scrollTarget=null;this.printing=false;this.mustMeasureContent=true;this.visibleRanges=[];this.mustEnforceCursorAssoc=false;this.heightMap=HeightMap2.empty().applyChanges(state.facet(decorations2),Text.empty,this.heightOracle.setDoc(state.doc),[new ChangedRange2(0,0,0,state.doc.length)]);this.viewport=this.getViewport(0,null);this.updateViewportLines();this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Decoration2.set(this.lineGaps.map(function(gap){return gap.draw(false);}));this.computeVisibleRanges();}_createClass(ViewState2,[{key:"updateForViewport",value:function updateForViewport(){var _this77=this;var viewports=[this.viewport],main=this.state.selection.main;var _loop14=function _loop14(_i132){var pos=_i132?main.head:main.anchor;if(!viewports.some(function(_ref26){var from=_ref26.from,to=_ref26.to;return pos>=from&&pos<=to;})){var _this77$lineBlockAt=_this77.lineBlockAt(pos),from=_this77$lineBlockAt.from,to=_this77$lineBlockAt.to;viewports.push(new Viewport2(from,to));}};for(var _i132=0;_i132<=1;_i132++){_loop14(_i132);}this.viewports=viewports.sort(function(a,b){return a.from-b.from;});this.scaler=this.heightMap.height<=7e6?IdScaler2:new BigScaler2(this.heightOracle.doc,this.heightMap,this.viewports);}},{key:"updateViewportLines",value:function updateViewportLines(){var _this78=this;this.viewportLines=[];this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,function(block){_this78.viewportLines.push(_this78.scaler.scale==1?block:scaleBlock2(block,_this78.scaler));});}},{key:"update",value:function update(_update13){var scrollTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var prev=this.state;this.state=_update13.state;var newDeco=this.state.facet(decorations2);var contentChanges=_update13.changedRanges;var heightChanges=ChangedRange2.extendWithRanges(contentChanges,heightRelevantDecoChanges2(_update13.startState.facet(decorations2),newDeco,_update13?_update13.changes:ChangeSet.empty(this.state.doc.length)));var prevHeight=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(newDeco,prev.doc,this.heightOracle.setDoc(this.state.doc),heightChanges);if(this.heightMap.height!=prevHeight)_update13.flags|=2;var viewport=heightChanges.length?this.mapViewport(this.viewport,_update13.changes):this.viewport;if(scrollTarget&&(scrollTarget.range.head<viewport.from||scrollTarget.range.head>viewport.to)||!this.viewportIsAppropriate(viewport))viewport=this.getViewport(0,scrollTarget);var updateLines=!_update13.changes.empty||_update13.flags&2||viewport.from!=this.viewport.from||viewport.to!=this.viewport.to;this.viewport=viewport;this.updateForViewport();if(updateLines)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,_update13.changes)));_update13.flags|=this.computeVisibleRanges();if(scrollTarget)this.scrollTarget=scrollTarget;if(!this.mustEnforceCursorAssoc&&_update13.selectionSet&&_update13.view.lineWrapping&&_update13.state.selection.main.empty&&_update13.state.selection.main.assoc)this.mustEnforceCursorAssoc=true;}},{key:"measure",value:function measure(view){var dom=view.contentDOM,style=window.getComputedStyle(dom);var oracle=this.heightOracle;var whiteSpace=style.whiteSpace,direction=style.direction=="rtl"?Direction2.RTL:Direction2.LTR;var refresh=this.heightOracle.mustRefreshForStyle(whiteSpace,direction);var measureContent=refresh||this.mustMeasureContent||this.contentDOMHeight!=dom.clientHeight;var result=0,bias=0;if(measureContent){this.mustMeasureContent=false;this.contentDOMHeight=dom.clientHeight;var paddingTop=parseInt(style.paddingTop)||0,paddingBottom=parseInt(style.paddingBottom)||0;if(this.paddingTop!=paddingTop||this.paddingBottom!=paddingBottom){result|=8;this.paddingTop=paddingTop;this.paddingBottom=paddingBottom;}}var pixelViewport=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:visiblePixelRange2(dom,this.paddingTop);var dTop=pixelViewport.top-this.pixelViewport.top,dBottom=pixelViewport.bottom-this.pixelViewport.bottom;this.pixelViewport=pixelViewport;var inView=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(inView!=this.inView){this.inView=inView;if(inView)measureContent=true;}if(!this.inView)return 0;var contentWidth=dom.clientWidth;if(this.contentDOMWidth!=contentWidth||this.editorHeight!=view.scrollDOM.clientHeight||this.editorWidth!=view.scrollDOM.clientWidth){this.contentDOMWidth=contentWidth;this.editorHeight=view.scrollDOM.clientHeight;this.editorWidth=view.scrollDOM.clientWidth;result|=8;}if(measureContent){var lineHeights=view.docView.measureVisibleLineHeights();if(oracle.mustRefreshForHeights(lineHeights))refresh=true;if(refresh||oracle.lineWrapping&&Math.abs(contentWidth-this.contentDOMWidth)>oracle.charWidth){var _view$docView$measure=view.docView.measureTextSize(),lineHeight=_view$docView$measure.lineHeight,charWidth=_view$docView$measure.charWidth;refresh=oracle.refresh(whiteSpace,direction,lineHeight,charWidth,contentWidth/charWidth,lineHeights);if(refresh){view.docView.minWidth=0;result|=8;}}if(dTop>0&&dBottom>0)bias=Math.max(dTop,dBottom);else if(dTop<0&&dBottom<0)bias=Math.min(dTop,dBottom);oracle.heightChanged=false;this.heightMap=this.heightMap.updateHeight(oracle,0,refresh,new MeasuredHeights2(this.viewport.from,lineHeights));if(oracle.heightChanged)result|=2;}var viewportChange=!this.viewportIsAppropriate(this.viewport,bias)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);if(viewportChange)this.viewport=this.getViewport(bias,this.scrollTarget);this.updateForViewport();if(result&2||viewportChange)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(refresh?[]:this.lineGaps));result|=this.computeVisibleRanges();if(this.mustEnforceCursorAssoc){this.mustEnforceCursorAssoc=false;view.docView.enforceCursorAssoc();}return result;}},{key:"visibleTop",get:function get(){return this.scaler.fromDOM(this.pixelViewport.top);}},{key:"visibleBottom",get:function get(){return this.scaler.fromDOM(this.pixelViewport.bottom);}},{key:"getViewport",value:function getViewport(bias,scrollTarget){var marginTop=0.5-Math.max(-0.5,Math.min(0.5,bias/1e3/2));var map=this.heightMap,doc6=this.state.doc,visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;var viewport=new Viewport2(map.lineAt(visibleTop-marginTop*1e3,QueryType2.ByHeight,doc6,0,0).from,map.lineAt(visibleBottom+(1-marginTop)*1e3,QueryType2.ByHeight,doc6,0,0).to);if(scrollTarget){var head=scrollTarget.range.head,viewHeight=this.editorHeight;if(head<viewport.from||head>viewport.to){var block=map.lineAt(head,QueryType2.ByPos,doc6,0,0),topPos;if(scrollTarget.y=="center")topPos=(block.top+block.bottom)/2-viewHeight/2;else if(scrollTarget.y=="start"||scrollTarget.y=="nearest"&&head<viewport.from)topPos=block.top;else topPos=block.bottom-viewHeight;viewport=new Viewport2(map.lineAt(topPos-1e3/2,QueryType2.ByHeight,doc6,0,0).from,map.lineAt(topPos+viewHeight+1e3/2,QueryType2.ByHeight,doc6,0,0).to);}}return viewport;}},{key:"mapViewport",value:function mapViewport(viewport,changes){var from=changes.mapPos(viewport.from,-1),to=changes.mapPos(viewport.to,1);return new Viewport2(this.heightMap.lineAt(from,QueryType2.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(to,QueryType2.ByPos,this.state.doc,0,0).to);}},{key:"viewportIsAppropriate",value:function viewportIsAppropriate(_ref27){var from=_ref27.from,to=_ref27.to;var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(!this.inView)return true;var _this$heightMap$lineA3=this.heightMap.lineAt(from,QueryType2.ByPos,this.state.doc,0,0),top2=_this$heightMap$lineA3.top;var _this$heightMap$lineA4=this.heightMap.lineAt(to,QueryType2.ByPos,this.state.doc,0,0),bottom=_this$heightMap$lineA4.bottom;var visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;return(from==0||top2<=visibleTop-Math.max(10,Math.min(-bias,250)))&&(to==this.state.doc.length||bottom>=visibleBottom+Math.max(10,Math.min(bias,250)))&&top2>visibleTop-2*1e3&&bottom<visibleBottom+2*1e3;}},{key:"mapLineGaps",value:function mapLineGaps(gaps,changes){if(!gaps.length||changes.empty)return gaps;var mapped=[];var _iterator121=_createForOfIteratorHelper(gaps),_step121;try{for(_iterator121.s();!(_step121=_iterator121.n()).done;){var gap=_step121.value;if(!changes.touchesRange(gap.from,gap.to))mapped.push(new LineGap2(changes.mapPos(gap.from),changes.mapPos(gap.to),gap.size));}}catch(err){_iterator121.e(err);}finally{_iterator121.f();}return mapped;}},{key:"ensureLineGaps",value:function ensureLineGaps(current){var _this79=this;var gaps=[];if(this.heightOracle.direction!=Direction2.LTR)return gaps;var _iterator122=_createForOfIteratorHelper(this.viewportLines),_step122;try{var _loop15=function _loop15(){var line=_step122.value;if(line.length<4e3)return"continue";var structure=lineStructure2(line.from,line.to,_this79.state);if(structure.total<4e3)return"continue";var viewFrom=void 0,viewTo=void 0;if(_this79.heightOracle.lineWrapping){var marginHeight=2e3/_this79.heightOracle.lineLength*_this79.heightOracle.lineHeight;viewFrom=findPosition2(structure,(_this79.visibleTop-line.top-marginHeight)/line.height);viewTo=findPosition2(structure,(_this79.visibleBottom-line.top+marginHeight)/line.height);}else{var totalWidth=structure.total*_this79.heightOracle.charWidth;var marginWidth=2e3*_this79.heightOracle.charWidth;viewFrom=findPosition2(structure,(_this79.pixelViewport.left-marginWidth)/totalWidth);viewTo=findPosition2(structure,(_this79.pixelViewport.right+marginWidth)/totalWidth);}var outside=[];if(viewFrom>line.from)outside.push({from:line.from,to:viewFrom});if(viewTo<line.to)outside.push({from:viewTo,to:line.to});var sel=_this79.state.selection.main;if(sel.from>=line.from&&sel.from<=line.to)cutRange2(outside,sel.from-10,sel.from+10);if(!sel.empty&&sel.to>=line.from&&sel.to<=line.to)cutRange2(outside,sel.to-10,sel.to+10);var _loop16=function _loop16(){var _outside2$_i=_outside2[_i133],from=_outside2$_i.from,to=_outside2$_i.to;if(to-from>1e3){gaps.push(find2(current,function(gap){return gap.from>=line.from&&gap.to<=line.to&&Math.abs(gap.from-from)<1e3&&Math.abs(gap.to-to)<1e3;})||new LineGap2(from,to,_this79.gapSize(line,from,to,structure)));}};for(var _i133=0,_outside2=outside;_i133<_outside2.length;_i133++){_loop16();}};for(_iterator122.s();!(_step122=_iterator122.n()).done;){var _ret=_loop15();if(_ret==="continue")continue;}}catch(err){_iterator122.e(err);}finally{_iterator122.f();}return gaps;}},{key:"gapSize",value:function gapSize(line,from,to,structure){var fraction=findFraction2(structure,to)-findFraction2(structure,from);if(this.heightOracle.lineWrapping){return line.height*fraction;}else{return structure.total*this.heightOracle.charWidth*fraction;}}},{key:"updateLineGaps",value:function updateLineGaps(gaps){var _this80=this;if(!LineGap2.same(gaps,this.lineGaps)){this.lineGaps=gaps;this.lineGapDeco=Decoration2.set(gaps.map(function(gap){return gap.draw(_this80.heightOracle.lineWrapping);}));}}},{key:"computeVisibleRanges",value:function computeVisibleRanges(){var deco=this.state.facet(decorations2);if(this.lineGaps.length)deco=deco.concat(this.lineGapDeco);var ranges=[];RangeSet.spans(deco,this.viewport.from,this.viewport.to,{span:function span(from,to){ranges.push({from:from,to:to});},point:function point(){}},20);var changed=ranges.length!=this.visibleRanges.length||this.visibleRanges.some(function(r,i){return r.from!=ranges[i].from||r.to!=ranges[i].to;});this.visibleRanges=ranges;return changed?4:0;}},{key:"lineBlockAt",value:function lineBlockAt(pos){return pos>=this.viewport.from&&pos<=this.viewport.to&&this.viewportLines.find(function(b){return b.from<=pos&&b.to>=pos;})||scaleBlock2(this.heightMap.lineAt(pos,QueryType2.ByPos,this.state.doc,0,0),this.scaler);}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){return scaleBlock2(this.heightMap.lineAt(this.scaler.fromDOM(height),QueryType2.ByHeight,this.state.doc,0,0),this.scaler);}},{key:"elementAtHeight",value:function elementAtHeight(height){return scaleBlock2(this.heightMap.blockAt(this.scaler.fromDOM(height),this.state.doc,0,0),this.scaler);}},{key:"docHeight",get:function get(){return this.scaler.toDOM(this.heightMap.height);}},{key:"contentHeight",get:function get(){return this.docHeight+this.paddingTop+this.paddingBottom;}}]);return ViewState2;}();var Viewport2=/*#__PURE__*/_createClass(function Viewport2(from,to){_classCallCheck(this,Viewport2);this.from=from;this.to=to;});function lineStructure2(from,to,state){var ranges=[],pos=from,total=0;RangeSet.spans(state.facet(decorations2),from,to,{span:function span(){},point:function point(from2,to2){if(from2>pos){ranges.push({from:pos,to:from2});total+=from2-pos;}pos=to2;}},20);if(pos<to){ranges.push({from:pos,to:to});total+=to-pos;}return{total:total,ranges:ranges};}function findPosition2(_ref28,ratio){var total=_ref28.total,ranges=_ref28.ranges;if(ratio<=0)return ranges[0].from;if(ratio>=1)return ranges[ranges.length-1].to;var dist=Math.floor(total*ratio);for(var _i134=0;;_i134++){var _ranges$_i2=ranges[_i134],from=_ranges$_i2.from,to=_ranges$_i2.to,size=to-from;if(dist<=size)return from+dist;dist-=size;}}function findFraction2(structure,pos){var counted=0;var _iterator123=_createForOfIteratorHelper(structure.ranges),_step123;try{for(_iterator123.s();!(_step123=_iterator123.n()).done;){var _step123$value=_step123.value,from=_step123$value.from,to=_step123$value.to;if(pos<=to){counted+=pos-from;break;}counted+=to-from;}}catch(err){_iterator123.e(err);}finally{_iterator123.f();}return counted/structure.total;}function cutRange2(ranges,from,to){for(var _i135=0;_i135<ranges.length;_i135++){var _r7=ranges[_i135];if(_r7.from<to&&_r7.to>from){var pieces=[];if(_r7.from<from)pieces.push({from:_r7.from,to:from});if(_r7.to>to)pieces.push({from:to,to:_r7.to});ranges.splice.apply(ranges,[_i135,1].concat(pieces));_i135+=pieces.length-1;}}}function find2(array,f){var _iterator124=_createForOfIteratorHelper(array),_step124;try{for(_iterator124.s();!(_step124=_iterator124.n()).done;){var val=_step124.value;if(f(val))return val;}}catch(err){_iterator124.e(err);}finally{_iterator124.f();}return void 0;}var IdScaler2={toDOM:function toDOM(n){return n;},fromDOM:function fromDOM(n){return n;},scale:1};var BigScaler2=/*#__PURE__*/function(){function BigScaler2(doc6,heightMap,viewports){_classCallCheck(this,BigScaler2);var vpHeight=0,base2=0,domBase=0;this.viewports=viewports.map(function(_ref29){var from=_ref29.from,to=_ref29.to;var top2=heightMap.lineAt(from,QueryType2.ByPos,doc6,0,0).top;var bottom=heightMap.lineAt(to,QueryType2.ByPos,doc6,0,0).bottom;vpHeight+=bottom-top2;return{from:from,to:to,top:top2,bottom:bottom,domTop:0,domBottom:0};});this.scale=(7e6-vpHeight)/(heightMap.height-vpHeight);var _iterator125=_createForOfIteratorHelper(this.viewports),_step125;try{for(_iterator125.s();!(_step125=_iterator125.n()).done;){var obj=_step125.value;obj.domTop=domBase+(obj.top-base2)*this.scale;domBase=obj.domBottom=obj.domTop+(obj.bottom-obj.top);base2=obj.bottom;}}catch(err){_iterator125.e(err);}finally{_iterator125.f();}}_createClass(BigScaler2,[{key:"toDOM",value:function toDOM(n){for(var _i136=0,base2=0,domBase=0;;_i136++){var vp=_i136<this.viewports.length?this.viewports[_i136]:null;if(!vp||n<vp.top)return domBase+(n-base2)*this.scale;if(n<=vp.bottom)return vp.domTop+(n-vp.top);base2=vp.bottom;domBase=vp.domBottom;}}},{key:"fromDOM",value:function fromDOM(n){for(var _i137=0,base2=0,domBase=0;;_i137++){var vp=_i137<this.viewports.length?this.viewports[_i137]:null;if(!vp||n<vp.domTop)return base2+(n-domBase)/this.scale;if(n<=vp.domBottom)return vp.top+(n-vp.domTop);base2=vp.bottom;domBase=vp.domBottom;}}}]);return BigScaler2;}();function scaleBlock2(block,scaler){if(scaler.scale==1)return block;var bTop=scaler.toDOM(block.top),bBottom=scaler.toDOM(block.bottom);return new BlockInfo2(block.from,block.length,bTop,bBottom-bTop,Array.isArray(block.type)?block.type.map(function(b){return scaleBlock2(b,scaler);}):block.type);}var theme2=/* @__PURE__ */Facet.define({combine:function combine(strs){return strs.join(" ");}});var darkTheme2=/* @__PURE__ */Facet.define({combine:function combine(values){return values.indexOf(true)>-1;}});var baseThemeID2=/* @__PURE__ */StyleModule.newName();var baseLightID2=/* @__PURE__ */StyleModule.newName();var baseDarkID2=/* @__PURE__ */StyleModule.newName();var lightDarkIDs2={"&light":"."+baseLightID2,"&dark":"."+baseDarkID2};function buildTheme2(main,spec,scopes){return new StyleModule(spec,{finish:function finish(sel){return /&/.test(sel)?sel.replace(/&\w*/,function(m){if(m=="&")return main;if(!scopes||!scopes[m])throw new RangeError("Unsupported selector: ".concat(m));return scopes[m];}):main+" "+sel;}});}var baseTheme2=/* @__PURE__ */buildTheme2("."+baseThemeID2,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs2);var observeOptions2={childList:true,characterData:true,subtree:true,attributes:true,characterDataOldValue:true};var useCharData2=browser2.ie&&browser2.ie_version<=11;var DOMObserver2=/*#__PURE__*/function(){function DOMObserver2(view,onChange,onScrollChanged){var _this81=this;_classCallCheck(this,DOMObserver2);this.view=view;this.onChange=onChange;this.onScrollChanged=onScrollChanged;this.active=false;this.selectionRange=new DOMSelectionState();this.selectionChanged=false;this.delayedFlush=-1;this.resizeTimeout=-1;this.queue=[];this.delayedAndroidKey=null;this.scrollTargets=[];this.intersection=null;this.resize=null;this.intersecting=false;this.gapIntersection=null;this.gaps=[];this.parentCheck=-1;this.dom=view.contentDOM;this.observer=new MutationObserver(function(mutations){var _iterator126=_createForOfIteratorHelper(mutations),_step126;try{for(_iterator126.s();!(_step126=_iterator126.n()).done;){var mut=_step126.value;_this81.queue.push(mut);}}catch(err){_iterator126.e(err);}finally{_iterator126.f();}if((browser2.ie&&browser2.ie_version<=11||browser2.ios&&view.composing)&&mutations.some(function(m){return m.type=="childList"&&m.removedNodes.length||m.type=="characterData"&&m.oldValue.length>m.target.nodeValue.length;}))_this81.flushSoon();else _this81.flush();});if(useCharData2)this.onCharData=function(event){_this81.queue.push({target:event.target,type:"characterData",oldValue:event.prevValue});_this81.flushSoon();};this.onSelectionChange=this.onSelectionChange.bind(this);if(typeof ResizeObserver=="function"){this.resize=new ResizeObserver(function(){if(_this81.view.docView.lastUpdate<Date.now()-75&&_this81.resizeTimeout<0)_this81.resizeTimeout=setTimeout(function(){_this81.resizeTimeout=-1;_this81.view.requestMeasure();},50);});this.resize.observe(view.scrollDOM);}this.start();this.onScroll=this.onScroll.bind(this);window.addEventListener("scroll",this.onScroll);if(typeof IntersectionObserver=="function"){this.intersection=new IntersectionObserver(function(entries){if(_this81.parentCheck<0)_this81.parentCheck=setTimeout(_this81.listenForScroll.bind(_this81),1e3);if(entries.length>0&&entries[entries.length-1].intersectionRatio>0!=_this81.intersecting){_this81.intersecting=!_this81.intersecting;if(_this81.intersecting!=_this81.view.inView)_this81.onScrollChanged(document.createEvent("Event"));}},{});this.intersection.observe(this.dom);this.gapIntersection=new IntersectionObserver(function(entries){if(entries.length>0&&entries[entries.length-1].intersectionRatio>0)_this81.onScrollChanged(document.createEvent("Event"));},{});}this.listenForScroll();this.readSelectionRange();this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange);}_createClass(DOMObserver2,[{key:"onScroll",value:function onScroll(e){if(this.intersecting)this.flush(false);this.onScrollChanged(e);}},{key:"updateGaps",value:function updateGaps(gaps){if(this.gapIntersection&&(gaps.length!=this.gaps.length||this.gaps.some(function(g,i){return g!=gaps[i];}))){this.gapIntersection.disconnect();var _iterator127=_createForOfIteratorHelper(gaps),_step127;try{for(_iterator127.s();!(_step127=_iterator127.n()).done;){var gap=_step127.value;this.gapIntersection.observe(gap);}}catch(err){_iterator127.e(err);}finally{_iterator127.f();}this.gaps=gaps;}}},{key:"onSelectionChange",value:function onSelectionChange(event){if(!this.readSelectionRange()||this.delayedAndroidKey)return;var view=this.view,sel=this.selectionRange;if(view.state.facet(editable2)?view.root.activeElement!=this.dom:!hasSelection2(view.dom,sel))return;var context=sel.anchorNode&&view.docView.nearest(sel.anchorNode);if(context&&context.ignoreEvent(event))return;if((browser2.ie&&browser2.ie_version<=11||browser2.android&&browser2.chrome)&&!view.state.selection.main.empty&&sel.focusNode&&isEquivalentPosition2(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))this.flushSoon();else this.flush(false);}},{key:"readSelectionRange",value:function readSelectionRange(){var root=this.view.root,domSel=getSelection2(root);var range=browser2.safari&&root.nodeType==11&&deepActiveElement2()==this.view.contentDOM&&safariSelectionRangeHack2(this.view)||domSel;if(this.selectionRange.eq(range))return false;this.selectionRange.setRange(range);return this.selectionChanged=true;}},{key:"setSelectionRange",value:function setSelectionRange(anchor,head){this.selectionRange.set(anchor.node,anchor.offset,head.node,head.offset);this.selectionChanged=false;}},{key:"listenForScroll",value:function listenForScroll(){this.parentCheck=-1;var i=0,changed=null;for(var dom=this.dom;dom;){if(dom.nodeType==1){if(!changed&&i<this.scrollTargets.length&&this.scrollTargets[i]==dom)i++;else if(!changed)changed=this.scrollTargets.slice(0,i);if(changed)changed.push(dom);dom=dom.assignedSlot||dom.parentNode;}else if(dom.nodeType==11){dom=dom.host;}else{break;}}if(i<this.scrollTargets.length&&!changed)changed=this.scrollTargets.slice(0,i);if(changed){var _iterator128=_createForOfIteratorHelper(this.scrollTargets),_step128;try{for(_iterator128.s();!(_step128=_iterator128.n()).done;){var _dom4=_step128.value;_dom4.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator128.e(err);}finally{_iterator128.f();}var _iterator129=_createForOfIteratorHelper(this.scrollTargets=changed),_step129;try{for(_iterator129.s();!(_step129=_iterator129.n()).done;){var _dom5=_step129.value;_dom5.addEventListener("scroll",this.onScroll);}}catch(err){_iterator129.e(err);}finally{_iterator129.f();}}}},{key:"ignore",value:function ignore(f){if(!this.active)return f();try{this.stop();return f();}finally{this.start();this.clear();}}},{key:"start",value:function start(){if(this.active)return;this.observer.observe(this.dom,observeOptions2);if(useCharData2)this.dom.addEventListener("DOMCharacterDataModified",this.onCharData);this.active=true;}},{key:"stop",value:function stop(){if(!this.active)return;this.active=false;this.observer.disconnect();if(useCharData2)this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData);}},{key:"clear",value:function clear(){this.observer.takeRecords();this.queue.length=0;this.selectionChanged=false;}},{key:"delayAndroidKey",value:function delayAndroidKey(key,keyCode){var _this82=this;if(!this.delayedAndroidKey)requestAnimationFrame(function(){var key2=_this82.delayedAndroidKey;_this82.delayedAndroidKey=null;var startState=_this82.view.state;if(dispatchKey2(_this82.view.contentDOM,key2.key,key2.keyCode))_this82.processRecords();else _this82.flush();if(_this82.view.state==startState)_this82.view.update([]);});if(!this.delayedAndroidKey||key=="Enter")this.delayedAndroidKey={key:key,keyCode:keyCode};}},{key:"flushSoon",value:function flushSoon(){var _this83=this;if(this.delayedFlush<0)this.delayedFlush=window.setTimeout(function(){_this83.delayedFlush=-1;_this83.flush();},20);}},{key:"forceFlush",value:function forceFlush(){if(this.delayedFlush>=0){window.clearTimeout(this.delayedFlush);this.delayedFlush=-1;this.flush();}}},{key:"processRecords",value:function processRecords(){var records=this.queue;var _iterator130=_createForOfIteratorHelper(this.observer.takeRecords()),_step130;try{for(_iterator130.s();!(_step130=_iterator130.n()).done;){var mut=_step130.value;records.push(mut);}}catch(err){_iterator130.e(err);}finally{_iterator130.f();}if(records.length)this.queue=[];var from=-1,to=-1,typeOver=false;var _iterator131=_createForOfIteratorHelper(records),_step131;try{for(_iterator131.s();!(_step131=_iterator131.n()).done;){var record=_step131.value;var range=this.readMutation(record);if(!range)continue;if(range.typeOver)typeOver=true;if(from==-1){from=range.from;to=range.to;}else{from=Math.min(range.from,from);to=Math.max(range.to,to);}}}catch(err){_iterator131.e(err);}finally{_iterator131.f();}return{from:from,to:to,typeOver:typeOver};}},{key:"flush",value:function flush(){var readSelection=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.delayedFlush>=0||this.delayedAndroidKey)return;if(readSelection)this.readSelectionRange();var _this$processRecords2=this.processRecords(),from=_this$processRecords2.from,to=_this$processRecords2.to,typeOver=_this$processRecords2.typeOver;var newSel=this.selectionChanged&&hasSelection2(this.dom,this.selectionRange);if(from<0&&!newSel)return;this.selectionChanged=false;var startState=this.view.state;this.onChange(from,to,typeOver);if(this.view.state==startState)this.view.update([]);}},{key:"readMutation",value:function readMutation(rec){var cView=this.view.docView.nearest(rec.target);if(!cView||cView.ignoreMutation(rec))return null;cView.markDirty(rec.type=="attributes");if(rec.type=="attributes")cView.dirty|=4;if(rec.type=="childList"){var childBefore=findChild2(cView,rec.previousSibling||rec.target.previousSibling,-1);var childAfter=findChild2(cView,rec.nextSibling||rec.target.nextSibling,1);return{from:childBefore?cView.posAfter(childBefore):cView.posAtStart,to:childAfter?cView.posBefore(childAfter):cView.posAtEnd,typeOver:false};}else if(rec.type=="characterData"){return{from:cView.posAtStart,to:cView.posAtEnd,typeOver:rec.target.nodeValue==rec.oldValue};}else{return null;}}},{key:"destroy",value:function destroy(){var _a,_b,_c;this.stop();(_a=this.intersection)===null||_a===void 0?void 0:_a.disconnect();(_b=this.gapIntersection)===null||_b===void 0?void 0:_b.disconnect();(_c=this.resize)===null||_c===void 0?void 0:_c.disconnect();var _iterator132=_createForOfIteratorHelper(this.scrollTargets),_step132;try{for(_iterator132.s();!(_step132=_iterator132.n()).done;){var dom=_step132.value;dom.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator132.e(err);}finally{_iterator132.f();}window.removeEventListener("scroll",this.onScroll);this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange);clearTimeout(this.parentCheck);clearTimeout(this.resizeTimeout);}}]);return DOMObserver2;}();function findChild2(cView,dom,dir){while(dom){var curView=ContentView2.get(dom);if(curView&&curView.parent==cView)return curView;var parent=dom.parentNode;dom=parent!=cView.dom?parent:dir>0?dom.nextSibling:dom.previousSibling;}return null;}function safariSelectionRangeHack2(view){var found=null;function read(event){event.preventDefault();event.stopImmediatePropagation();found=event.getTargetRanges()[0];}view.contentDOM.addEventListener("beforeinput",read,true);document.execCommand("indent");view.contentDOM.removeEventListener("beforeinput",read,true);if(!found)return null;var anchorNode=found.startContainer,anchorOffset=found.startOffset;var focusNode=found.endContainer,focusOffset=found.endOffset;var curAnchor=view.docView.domAtPos(view.state.selection.main.anchor);if(isEquivalentPosition2(curAnchor.node,curAnchor.offset,focusNode,focusOffset)){var _ref30=[focusNode,focusOffset,anchorNode,anchorOffset];anchorNode=_ref30[0];anchorOffset=_ref30[1];focusNode=_ref30[2];focusOffset=_ref30[3];}return{anchorNode:anchorNode,anchorOffset:anchorOffset,focusNode:focusNode,focusOffset:focusOffset};}function applyDOMChange2(view,start,end,typeOver){var change,newSel;var sel=view.state.selection.main;if(start>-1){var bounds=view.docView.domBoundsAround(start,end,0);if(!bounds||view.state.readOnly)return;var from=bounds.from,to=bounds.to;var selPoints=view.docView.impreciseHead||view.docView.impreciseAnchor?[]:selectionPoints2(view);var reader=new DOMReader2(selPoints,view);reader.readRange(bounds.startDOM,bounds.endDOM);newSel=selectionFromPoints2(selPoints,from);var preferredPos=sel.from,preferredSide=null;if(view.inputState.lastKeyCode===8&&view.inputState.lastKeyTime>Date.now()-100||browser2.android&&reader.text.length<to-from){preferredPos=sel.to;preferredSide="end";}var diff=findDiff2(view.state.sliceDoc(from,to),reader.text,preferredPos-from,preferredSide);if(diff)change={from:from+diff.from,to:from+diff.toA,insert:view.state.toText(reader.text.slice(diff.from,diff.toB))};}else if(view.hasFocus||!view.state.facet(editable2)){var domSel=view.observer.selectionRange;var _view$docView2=view.docView,iHead=_view$docView2.impreciseHead,iAnchor=_view$docView2.impreciseAnchor;var head=iHead&&iHead.node==domSel.focusNode&&iHead.offset==domSel.focusOffset||!contains2(view.contentDOM,domSel.focusNode)?view.state.selection.main.head:view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset);var anchor=iAnchor&&iAnchor.node==domSel.anchorNode&&iAnchor.offset==domSel.anchorOffset||!contains2(view.contentDOM,domSel.anchorNode)?view.state.selection.main.anchor:view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset);if(head!=sel.head||anchor!=sel.anchor)newSel=EditorSelection.single(anchor,head);}if(!change&&!newSel)return;if(!change&&typeOver&&!sel.empty&&newSel&&newSel.main.empty)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,sel.to)};else if(change&&change.from>=sel.from&&change.to<=sel.to&&(change.from!=sel.from||change.to!=sel.to)&&sel.to-sel.from-(change.to-change.from)<=4)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,change.from).append(change.insert).append(view.state.doc.slice(change.to,sel.to))};if(change){var startState=view.state;if(browser2.ios&&view.inputState.flushIOSKey(view))return;if(browser2.android&&(change.from==sel.from&&change.to==sel.to&&change.insert.length==1&&change.insert.lines==2&&dispatchKey2(view.contentDOM,"Enter",13)||change.from==sel.from-1&&change.to==sel.to&&change.insert.length==0&&dispatchKey2(view.contentDOM,"Backspace",8)||change.from==sel.from&&change.to==sel.to+1&&change.insert.length==0&&dispatchKey2(view.contentDOM,"Delete",46)))return;var _text6=change.insert.toString();if(view.state.facet(inputHandler2).some(function(h){return h(view,change.from,change.to,_text6);}))return;if(view.inputState.composing>=0)view.inputState.composing++;var tr;if(change.from>=sel.from&&change.to<=sel.to&&change.to-change.from>=(sel.to-sel.from)/3&&(!newSel||newSel.main.empty&&newSel.main.from==change.from+change.insert.length)&&view.inputState.composing<0){var before=sel.from<change.from?startState.sliceDoc(sel.from,change.from):"";var after=sel.to>change.to?startState.sliceDoc(change.to,sel.to):"";tr=startState.replaceSelection(view.state.toText(before+change.insert.sliceString(0,void 0,view.state.lineBreak)+after));}else{var changes=startState.changes(change);var mainSel=newSel&&!startState.selection.main.eq(newSel.main)&&newSel.main.to<=changes.newLength?newSel.main:void 0;if(startState.selection.ranges.length>1&&view.inputState.composing>=0&&change.to<=sel.to&&change.to>=sel.to-10){var replaced=view.state.sliceDoc(change.from,change.to);var compositionRange=compositionSurroundingNode(view)||view.state.doc.lineAt(sel.head);var offset=sel.to-change.to,size=sel.to-sel.from;tr=startState.changeByRange(function(range){if(range.from==sel.from&&range.to==sel.to)return{changes:changes,range:mainSel||range.map(changes)};var to=range.to-offset,from=to-replaced.length;if(range.to-range.from!=size||view.state.sliceDoc(from,to)!=replaced||compositionRange&&range.to>=compositionRange.from&&range.from<=compositionRange.to)return{range:range};var rangeChanges=startState.changes({from:from,to:to,insert:change.insert}),selOff=range.to-sel.to;return{changes:rangeChanges,range:!mainSel?range.map(rangeChanges):EditorSelection.range(Math.max(0,mainSel.anchor+selOff),Math.max(0,mainSel.head+selOff))};});}else{tr={changes:changes,selection:mainSel&&startState.selection.replaceRange(mainSel)};}}var userEvent="input.type";if(view.composing){userEvent+=".compose";if(view.inputState.compositionFirstChange){userEvent+=".start";view.inputState.compositionFirstChange=false;}}view.dispatch(tr,{scrollIntoView:true,userEvent:userEvent});}else if(newSel&&!newSel.main.eq(sel)){var scrollIntoView6=false,_userEvent2="select";if(view.inputState.lastSelectionTime>Date.now()-50){if(view.inputState.lastSelectionOrigin=="select")scrollIntoView6=true;_userEvent2=view.inputState.lastSelectionOrigin;}view.dispatch({selection:newSel,scrollIntoView:scrollIntoView6,userEvent:_userEvent2});}}function findDiff2(a,b,preferredPos,preferredSide){var minLen=Math.min(a.length,b.length);var from=0;while(from<minLen&&a.charCodeAt(from)==b.charCodeAt(from)){from++;}if(from==minLen&&a.length==b.length)return null;var toA=a.length,toB=b.length;while(toA>0&&toB>0&&a.charCodeAt(toA-1)==b.charCodeAt(toB-1)){toA--;toB--;}if(preferredSide=="end"){var adjust=Math.max(0,from-Math.min(toA,toB));preferredPos-=toA+adjust-from;}if(toA<from&&a.length<b.length){var move=preferredPos<=from&&preferredPos>=toA?from-preferredPos:0;from-=move;toB=from+(toB-toA);toA=from;}else if(toB<from){var _move2=preferredPos<=from&&preferredPos>=toB?from-preferredPos:0;from-=_move2;toA=from+(toA-toB);toB=from;}return{from:from,toA:toA,toB:toB};}function selectionPoints2(view){var result=[];if(view.root.activeElement!=view.contentDOM)return result;var _view$observer$select2=view.observer.selectionRange,anchorNode=_view$observer$select2.anchorNode,anchorOffset=_view$observer$select2.anchorOffset,focusNode=_view$observer$select2.focusNode,focusOffset=_view$observer$select2.focusOffset;if(anchorNode){result.push(new DOMPoint2(anchorNode,anchorOffset));if(focusNode!=anchorNode||focusOffset!=anchorOffset)result.push(new DOMPoint2(focusNode,focusOffset));}return result;}function selectionFromPoints2(points,base2){if(points.length==0)return null;var anchor=points[0].pos,head=points.length==2?points[1].pos:anchor;return anchor>-1&&head>-1?EditorSelection.single(anchor+base2,head+base2):null;}var EditorView2=/*#__PURE__*/function(){function EditorView2(){var _this84=this;var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,EditorView2);this.plugins=[];this.pluginMap=/* @__PURE__ */new Map();this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.destroyed=false;this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.style.cssText="position: absolute; top: -10000px";this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);this._dispatch=config2.dispatch||function(tr){return _this84.update([tr]);};this.dispatch=this.dispatch.bind(this);this.root=config2.root||getRoot2(config2.parent)||document;this.viewState=new ViewState2(config2.state||EditorState.create());this.plugins=this.state.facet(viewPlugin2).map(function(spec){return new PluginInstance2(spec);});var _iterator133=_createForOfIteratorHelper(this.plugins),_step133;try{for(_iterator133.s();!(_step133=_iterator133.n()).done;){var plugin=_step133.value;plugin.update(this);}}catch(err){_iterator133.e(err);}finally{_iterator133.f();}this.observer=new DOMObserver2(this,function(from,to,typeOver){applyDOMChange2(_this84,from,to,typeOver);},function(event){_this84.inputState.runScrollHandlers(_this84,event);if(_this84.observer.intersecting)_this84.measure();});this.inputState=new InputState2(this);this.docView=new DocView2(this);this.mountStyles();this.updateAttrs();this.updateState=0;ensureGlobalHandler2();this.requestMeasure();if(config2.parent)config2.parent.appendChild(this.dom);}_createClass(EditorView2,[{key:"state",get:function get(){return this.viewState.state;}},{key:"viewport",get:function get(){return this.viewState.viewport;}},{key:"visibleRanges",get:function get(){return this.viewState.visibleRanges;}},{key:"inView",get:function get(){return this.viewState.inView;}},{key:"composing",get:function get(){return this.inputState.composing>0;}},{key:"dispatch",value:function dispatch(){var _this$state2;this._dispatch(arguments.length==1&&(arguments.length<=0?undefined:arguments[0])instanceof Transaction?arguments.length<=0?undefined:arguments[0]:(_this$state2=this.state).update.apply(_this$state2,arguments));}},{key:"update",value:function update(transactions){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");var redrawn=false,update;var state=this.state;var _iterator134=_createForOfIteratorHelper(transactions),_step134;try{for(_iterator134.s();!(_step134=_iterator134.n()).done;){var _tr2=_step134.value;if(_tr2.startState!=state)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");state=_tr2.state;}}catch(err){_iterator134.e(err);}finally{_iterator134.f();}if(this.destroyed){this.viewState.state=state;return;}if(state.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(state);update=new ViewUpdate2(this,state,transactions);var scrollTarget=this.viewState.scrollTarget;try{this.updateState=2;var _iterator135=_createForOfIteratorHelper(transactions),_step135;try{for(_iterator135.s();!(_step135=_iterator135.n()).done;){var tr=_step135.value;if(scrollTarget)scrollTarget=scrollTarget.map(tr.changes);if(tr.scrollIntoView){var main=tr.state.selection.main;scrollTarget=new ScrollTarget2(main.empty?main:EditorSelection.cursor(main.head,main.head>main.anchor?-1:1));}var _iterator136=_createForOfIteratorHelper(tr.effects),_step136;try{for(_iterator136.s();!(_step136=_iterator136.n()).done;){var e=_step136.value;if(e.is(scrollTo2))scrollTarget=new ScrollTarget2(e.value);else if(e.is(centerOn2))scrollTarget=new ScrollTarget2(e.value,"center");else if(e.is(_scrollIntoView))scrollTarget=e.value;}}catch(err){_iterator136.e(err);}finally{_iterator136.f();}}}catch(err){_iterator135.e(err);}finally{_iterator135.f();}this.viewState.update(update,scrollTarget);this.bidiCache=CachedOrder2.update(this.bidiCache,update.changes);if(!update.empty){this.updatePlugins(update);this.inputState.update(update);}redrawn=this.docView.update(update);if(this.state.facet(styleModule2)!=this.styleModules)this.mountStyles();this.updateAttrs();this.showAnnouncements(transactions);this.docView.updateSelection(redrawn,transactions.some(function(tr){return tr.isUserEvent("select.pointer");}));}finally{this.updateState=0;}if(redrawn||scrollTarget||this.viewState.mustEnforceCursorAssoc)this.requestMeasure();if(!update.empty){var _iterator137=_createForOfIteratorHelper(this.state.facet(updateListener2)),_step137;try{for(_iterator137.s();!(_step137=_iterator137.n()).done;){var listener=_step137.value;listener(update);}}catch(err){_iterator137.e(err);}finally{_iterator137.f();}}}},{key:"setState",value:function setState(newState){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=newState;return;}this.updateState=2;var hadFocus=this.hasFocus;try{var _iterator138=_createForOfIteratorHelper(this.plugins),_step138;try{for(_iterator138.s();!(_step138=_iterator138.n()).done;){var plugin=_step138.value;plugin.destroy(this);}}catch(err){_iterator138.e(err);}finally{_iterator138.f();}this.viewState=new ViewState2(newState);this.plugins=newState.facet(viewPlugin2).map(function(spec){return new PluginInstance2(spec);});this.pluginMap.clear();var _iterator139=_createForOfIteratorHelper(this.plugins),_step139;try{for(_iterator139.s();!(_step139=_iterator139.n()).done;){var _plugin5=_step139.value;_plugin5.update(this);}}catch(err){_iterator139.e(err);}finally{_iterator139.f();}this.docView=new DocView2(this);this.inputState.ensureHandlers(this);this.mountStyles();this.updateAttrs();this.bidiCache=[];}finally{this.updateState=0;}if(hadFocus)this.focus();this.requestMeasure();}},{key:"updatePlugins",value:function updatePlugins(update){var prevSpecs=update.startState.facet(viewPlugin2),specs=update.state.facet(viewPlugin2);if(prevSpecs!=specs){var newPlugins=[];var _iterator140=_createForOfIteratorHelper(specs),_step140;try{for(_iterator140.s();!(_step140=_iterator140.n()).done;){var spec=_step140.value;var found=prevSpecs.indexOf(spec);if(found<0){newPlugins.push(new PluginInstance2(spec));}else{var plugin=this.plugins[found];plugin.mustUpdate=update;newPlugins.push(plugin);}}}catch(err){_iterator140.e(err);}finally{_iterator140.f();}var _iterator141=_createForOfIteratorHelper(this.plugins),_step141;try{for(_iterator141.s();!(_step141=_iterator141.n()).done;){var _plugin6=_step141.value;if(_plugin6.mustUpdate!=update)_plugin6.destroy(this);}}catch(err){_iterator141.e(err);}finally{_iterator141.f();}this.plugins=newPlugins;this.pluginMap.clear();this.inputState.ensureHandlers(this);}else{var _iterator142=_createForOfIteratorHelper(this.plugins),_step142;try{for(_iterator142.s();!(_step142=_iterator142.n()).done;){var _p4=_step142.value;_p4.mustUpdate=update;}}catch(err){_iterator142.e(err);}finally{_iterator142.f();}}for(var _i138=0;_i138<this.plugins.length;_i138++){this.plugins[_i138].update(this);}}},{key:"measure",value:function measure(){var _this85=this;var flush=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.destroyed)return;if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.measureScheduled=0;if(flush)this.observer.flush();var updated=null;try{for(var _i139=0;;_i139++){this.updateState=1;var oldViewport=this.viewport;var changed=this.viewState.measure(this);if(!changed&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(_i139>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break;}var measuring=[];if(!(changed&4)){var _ref31=[measuring,this.measureRequests];this.measureRequests=_ref31[0];measuring=_ref31[1];}var measured=measuring.map(function(m){try{return m.read(_this85);}catch(e){logException2(_this85.state,e);return BadMeasure2;}});var update=new ViewUpdate2(this,this.state),redrawn=false,scrolled=false;update.flags|=changed;if(!updated)updated=update;else updated.flags|=changed;this.updateState=2;if(!update.empty){this.updatePlugins(update);this.inputState.update(update);this.updateAttrs();redrawn=this.docView.update(update);}for(var i2=0;i2<measuring.length;i2++){if(measured[i2]!=BadMeasure2){try{var m=measuring[i2];if(m.write)m.write(measured[i2],this);}catch(e){logException2(this.state,e);}}}if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget);this.viewState.scrollTarget=null;scrolled=true;}if(redrawn)this.docView.updateSelection(true);if(this.viewport.from==oldViewport.from&&this.viewport.to==oldViewport.to&&!scrolled&&this.measureRequests.length==0)break;}}finally{this.updateState=0;this.measureScheduled=-1;}if(updated&&!updated.empty){var _iterator143=_createForOfIteratorHelper(this.state.facet(updateListener2)),_step143;try{for(_iterator143.s();!(_step143=_iterator143.n()).done;){var listener=_step143.value;listener(updated);}}catch(err){_iterator143.e(err);}finally{_iterator143.f();}}}},{key:"themeClasses",get:function get(){return baseThemeID2+" "+(this.state.facet(darkTheme2)?baseDarkID2:baseLightID2)+" "+this.state.facet(theme2);}},{key:"updateAttrs",value:function updateAttrs(){var _this86=this;var editorAttrs=attrsFromFacet(this,editorAttributes2,{"class":"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses});var contentAttrs={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:!this.state.facet(editable2)?"false":"true","class":"cm-content",style:"".concat(browser2.tabSize,": ").concat(this.state.tabSize),role:"textbox","aria-multiline":"true"};if(this.state.readOnly)contentAttrs["aria-readonly"]="true";attrsFromFacet(this,contentAttributes2,contentAttrs);this.observer.ignore(function(){updateAttrs2(_this86.contentDOM,_this86.contentAttrs,contentAttrs);updateAttrs2(_this86.dom,_this86.editorAttrs,editorAttrs);});this.editorAttrs=editorAttrs;this.contentAttrs=contentAttrs;}},{key:"showAnnouncements",value:function showAnnouncements(trs){var first=true;var _iterator144=_createForOfIteratorHelper(trs),_step144;try{for(_iterator144.s();!(_step144=_iterator144.n()).done;){var tr=_step144.value;var _iterator145=_createForOfIteratorHelper(tr.effects),_step145;try{for(_iterator145.s();!(_step145=_iterator145.n()).done;){var effect=_step145.value;if(effect.is(EditorView2.announce)){if(first)this.announceDOM.textContent="";first=false;var div=this.announceDOM.appendChild(document.createElement("div"));div.textContent=effect.value;}}}catch(err){_iterator145.e(err);}finally{_iterator145.f();}}}catch(err){_iterator144.e(err);}finally{_iterator144.f();}}},{key:"mountStyles",value:function mountStyles(){this.styleModules=this.state.facet(styleModule2);StyleModule.mount(this.root,this.styleModules.concat(baseTheme2).reverse());}},{key:"readMeasured",value:function readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");if(this.updateState==0&&this.measureScheduled>-1)this.measure(false);}},{key:"requestMeasure",value:function requestMeasure(request){var _this87=this;if(this.measureScheduled<0)this.measureScheduled=requestAnimationFrame(function(){return _this87.measure();});if(request){if(request.key!=null)for(var _i140=0;_i140<this.measureRequests.length;_i140++){if(this.measureRequests[_i140].key===request.key){this.measureRequests[_i140]=request;return;}}this.measureRequests.push(request);}}},{key:"pluginField",value:function pluginField(field){var result=[];var _iterator146=_createForOfIteratorHelper(this.plugins),_step146;try{for(_iterator146.s();!(_step146=_iterator146.n()).done;){var plugin=_step146.value;plugin.update(this).takeField(field,result);}}catch(err){_iterator146.e(err);}finally{_iterator146.f();}return result;}},{key:"plugin",value:function plugin(_plugin4){var known=this.pluginMap.get(_plugin4);if(known===void 0||known&&known.spec!=_plugin4)this.pluginMap.set(_plugin4,known=this.plugins.find(function(p){return p.spec==_plugin4;})||null);return known&&known.update(this).value;}},{key:"documentTop",get:function get(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop;}},{key:"documentPadding",get:function get(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom};}},{key:"blockAtHeight",value:function blockAtHeight(height,docTop){var top2=ensureTop2(docTop,this);return this.elementAtHeight(height-top2).moveY(top2);}},{key:"elementAtHeight",value:function elementAtHeight(height){this.readMeasured();return this.viewState.elementAtHeight(height);}},{key:"visualLineAtHeight",value:function visualLineAtHeight(height,docTop){var top2=ensureTop2(docTop,this);return this.lineBlockAtHeight(height-top2).moveY(top2);}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){this.readMeasured();return this.viewState.lineBlockAtHeight(height);}},{key:"viewportLines",value:function viewportLines(f,docTop){var top2=ensureTop2(docTop,this);var _iterator147=_createForOfIteratorHelper(this.viewportLineBlocks),_step147;try{for(_iterator147.s();!(_step147=_iterator147.n()).done;){var line=_step147.value;f(line.moveY(top2));}}catch(err){_iterator147.e(err);}finally{_iterator147.f();}}},{key:"viewportLineBlocks",get:function get(){return this.viewState.viewportLines;}},{key:"visualLineAt",value:function visualLineAt(pos){var docTop=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.lineBlockAt(pos).moveY(docTop+this.viewState.paddingTop);}},{key:"lineBlockAt",value:function lineBlockAt(pos){return this.viewState.lineBlockAt(pos);}},{key:"contentHeight",get:function get(){return this.viewState.contentHeight;}},{key:"moveByChar",value:function moveByChar(start,forward,by){return skipAtoms2(this,start,moveByChar2(this,start,forward,by));}},{key:"moveByGroup",value:function moveByGroup(start,forward){var _this88=this;return skipAtoms2(this,start,moveByChar2(this,start,forward,function(initial){return byGroup2(_this88,start.head,initial);}));}},{key:"moveToLineBoundary",value:function moveToLineBoundary(start,forward){var includeWrap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return moveToLineBoundary2(this,start,forward,includeWrap);}},{key:"moveVertically",value:function moveVertically(start,forward,distance){return skipAtoms2(this,start,moveVertically2(this,start,forward,distance));}},{key:"scrollPosIntoView",value:function scrollPosIntoView(pos){this.dispatch({effects:scrollTo2.of(EditorSelection.cursor(pos))});}},{key:"domAtPos",value:function domAtPos(pos){return this.docView.domAtPos(pos);}},{key:"posAtDOM",value:function posAtDOM(node){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.docView.posFromDOM(node,offset);}},{key:"posAtCoords",value:function posAtCoords(coords){var precise=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.readMeasured();return posAtCoords2(this,coords,precise);}},{key:"coordsAtPos",value:function coordsAtPos(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.readMeasured();var rect=this.docView.coordsAt(pos,side);if(!rect||rect.left==rect.right)return rect;var line=this.state.doc.lineAt(pos),order=this.bidiSpans(line);var span=order[BidiSpan2.find(order,pos-line.from,-1,side)];return flattenRect2(rect,span.dir==Direction2.LTR==side>0);}},{key:"defaultCharacterWidth",get:function get(){return this.viewState.heightOracle.charWidth;}},{key:"defaultLineHeight",get:function get(){return this.viewState.heightOracle.lineHeight;}},{key:"textDirection",get:function get(){return this.viewState.heightOracle.direction;}},{key:"lineWrapping",get:function get(){return this.viewState.heightOracle.lineWrapping;}},{key:"bidiSpans",value:function bidiSpans(line){if(line.length>MaxBidiLine2)return trivialOrder2(line.length);var dir=this.textDirection;var _iterator148=_createForOfIteratorHelper(this.bidiCache),_step148;try{for(_iterator148.s();!(_step148=_iterator148.n()).done;){var entry=_step148.value;if(entry.from==line.from&&entry.dir==dir)return entry.order;}}catch(err){_iterator148.e(err);}finally{_iterator148.f();}var order=computeOrder2(line.text,this.textDirection);this.bidiCache.push(new CachedOrder2(line.from,line.to,dir,order));return order;}},{key:"hasFocus",get:function get(){var _a;return(document.hasFocus()||browser2.safari&&((_a=this.inputState)===null||_a===void 0?void 0:_a.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM;}},{key:"focus",value:function focus(){var _this89=this;this.observer.ignore(function(){focusPreventScroll2(_this89.contentDOM);_this89.docView.updateSelection();});}},{key:"destroy",value:function destroy(){var _iterator149=_createForOfIteratorHelper(this.plugins),_step149;try{for(_iterator149.s();!(_step149=_iterator149.n()).done;){var plugin=_step149.value;plugin.destroy(this);}}catch(err){_iterator149.e(err);}finally{_iterator149.f();}this.plugins=[];this.inputState.destroy();this.dom.remove();this.observer.destroy();if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.destroyed=true;}}],[{key:"scrollIntoView",value:function scrollIntoView(pos){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return _scrollIntoView.of(new ScrollTarget2(typeof pos=="number"?EditorSelection.cursor(pos):pos,options.y,options.x,options.yMargin,options.xMargin));}},{key:"domEventHandlers",value:function domEventHandlers(handlers6){return ViewPlugin2.define(function(){return{};},{eventHandlers:handlers6});}},{key:"theme",value:function theme(spec,options){var prefix=StyleModule.newName();var result=[theme2.of(prefix),styleModule2.of(buildTheme2(".".concat(prefix),spec))];if(options&&options.dark)result.push(darkTheme2.of(true));return result;}},{key:"baseTheme",value:function baseTheme(spec){return Prec.lowest(styleModule2.of(buildTheme2("."+baseThemeID2,spec,lightDarkIDs2)));}}]);return EditorView2;}();EditorView2.scrollTo=scrollTo2;EditorView2.centerOn=centerOn2;EditorView2.styleModule=styleModule2;EditorView2.inputHandler=inputHandler2;EditorView2.exceptionSink=exceptionSink2;EditorView2.updateListener=updateListener2;EditorView2.editable=editable2;EditorView2.mouseSelectionStyle=mouseSelectionStyle2;EditorView2.dragMovesSelection=dragMovesSelection$12;EditorView2.clickAddsSelectionRange=clickAddsSelectionRange2;EditorView2.decorations=decorations2;EditorView2.darkTheme=darkTheme2;EditorView2.contentAttributes=contentAttributes2;EditorView2.editorAttributes=editorAttributes2;EditorView2.lineWrapping=/* @__PURE__ */EditorView2.contentAttributes.of({"class":"cm-lineWrapping"});EditorView2.announce=/* @__PURE__ */StateEffect.define();var MaxBidiLine2=4096;function ensureTop2(given,view){return(given==null?view.contentDOM.getBoundingClientRect().top:given)+view.viewState.paddingTop;}var resizeDebounce2=-1;function ensureGlobalHandler2(){window.addEventListener("resize",function(){if(resizeDebounce2==-1)resizeDebounce2=setTimeout(handleResize2,50);});}function handleResize2(){resizeDebounce2=-1;var found=document.querySelectorAll(".cm-content");for(var _i141=0;_i141<found.length;_i141++){var docView=ContentView2.get(found[_i141]);if(docView)docView.editorView.requestMeasure();}}var BadMeasure2={};var CachedOrder2=/*#__PURE__*/function(){function CachedOrder2(from,to,dir,order){_classCallCheck(this,CachedOrder2);this.from=from;this.to=to;this.dir=dir;this.order=order;}_createClass(CachedOrder2,null,[{key:"update",value:function update(cache,changes){if(changes.empty)return cache;var result=[],lastDir=cache.length?cache[cache.length-1].dir:Direction2.LTR;for(var _i142=Math.max(0,cache.length-10);_i142<cache.length;_i142++){var entry=cache[_i142];if(entry.dir==lastDir&&!changes.touchesRange(entry.from,entry.to))result.push(new CachedOrder2(changes.mapPos(entry.from,1),changes.mapPos(entry.to,-1),entry.dir,entry.order));}return result;}}]);return CachedOrder2;}();function attrsFromFacet(view,facet,base2){for(var sources=view.state.facet(facet),_i143=sources.length-1;_i143>=0;_i143--){var source=sources[_i143],value=typeof source=="function"?source(view):source;if(value)combineAttrs2(value,base2);}return base2;}var currentPlatform2=browser2.mac?"mac":browser2.windows?"win":browser2.linux?"linux":"key";var CanHidePrimary2=!browser2.ios;var themeSpec2={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};if(CanHidePrimary2)themeSpec2[".cm-line"].caretColor="transparent !important";var UnicodeRegexpSupport2=/x/.unicode!=null?"gu":"g";// ../node_modules/@lezer/common/dist/index.js
var DefaultBufferLength=1024;var nextPropID=0;var Range2=/*#__PURE__*/_createClass(function Range2(from,to){_classCallCheck(this,Range2);this.from=from;this.to=to;});var NodeProp=/*#__PURE__*/function(){function NodeProp(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,NodeProp);this.id=nextPropID++;this.perNode=!!config2.perNode;this.deserialize=config2.deserialize||function(){throw new Error("This node type doesn't define a deserialize function");};}_createClass(NodeProp,[{key:"add",value:function add(match){var _this90=this;if(this.perNode)throw new RangeError("Can't add per-node props to node types");if(typeof match!="function")match=NodeType.match(match);return function(type){var result=match(type);return result===void 0?null:[_this90,result];};}}]);return NodeProp;}();NodeProp.closedBy=new NodeProp({deserialize:function deserialize(str){return str.split(" ");}});NodeProp.openedBy=new NodeProp({deserialize:function deserialize(str){return str.split(" ");}});NodeProp.group=new NodeProp({deserialize:function deserialize(str){return str.split(" ");}});NodeProp.contextHash=new NodeProp({perNode:true});NodeProp.lookAhead=new NodeProp({perNode:true});NodeProp.mounted=new NodeProp({perNode:true});var noProps=/* @__PURE__ */Object.create(null);var NodeType=/*#__PURE__*/function(){function NodeType(name2,props,id){var flags=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;_classCallCheck(this,NodeType);this.name=name2;this.props=props;this.id=id;this.flags=flags;}_createClass(NodeType,[{key:"prop",value:function prop(_prop){return this.props[_prop.id];}},{key:"isTop",get:function get(){return(this.flags&1)>0;}},{key:"isSkipped",get:function get(){return(this.flags&2)>0;}},{key:"isError",get:function get(){return(this.flags&4)>0;}},{key:"isAnonymous",get:function get(){return(this.flags&8)>0;}},{key:"is",value:function is(name2){if(typeof name2=="string"){if(this.name==name2)return true;var group=this.prop(NodeProp.group);return group?group.indexOf(name2)>-1:false;}return this.id==name2;}}],[{key:"define",value:function define(spec){var props=spec.props&&spec.props.length?/* @__PURE__ */Object.create(null):noProps;var flags=(spec.top?1:0)|(spec.skipped?2:0)|(spec.error?4:0)|(spec.name==null?8:0);var type=new NodeType(spec.name||"",props,spec.id,flags);if(spec.props){var _iterator150=_createForOfIteratorHelper(spec.props),_step150;try{for(_iterator150.s();!(_step150=_iterator150.n()).done;){var src=_step150.value;if(!Array.isArray(src))src=src(type);if(src){if(src[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");props[src[0].id]=src[1];}}}catch(err){_iterator150.e(err);}finally{_iterator150.f();}}return type;}},{key:"match",value:function match(map){var direct=/* @__PURE__ */Object.create(null);for(var prop in map){var _iterator151=_createForOfIteratorHelper(prop.split(" ")),_step151;try{for(_iterator151.s();!(_step151=_iterator151.n()).done;){var name2=_step151.value;direct[name2]=map[prop];}}catch(err){_iterator151.e(err);}finally{_iterator151.f();}}return function(node){for(var groups=node.prop(NodeProp.group),_i144=-1;_i144<(groups?groups.length:0);_i144++){var found=direct[_i144<0?node.name:groups[_i144]];if(found)return found;}};}}]);return NodeType;}();NodeType.none=new NodeType("",/* @__PURE__ */Object.create(null),0,8);var NodeSet=/*#__PURE__*/function(){function NodeSet(types6){_classCallCheck(this,NodeSet);this.types=types6;for(var _i145=0;_i145<types6.length;_i145++){if(types6[_i145].id!=_i145)throw new RangeError("Node type ids should correspond to array positions when creating a node set");}}_createClass(NodeSet,[{key:"extend",value:function extend(){var newTypes=[];for(var _len3=arguments.length,props=new Array(_len3),_key3=0;_key3<_len3;_key3++){props[_key3]=arguments[_key3];}var _iterator152=_createForOfIteratorHelper(this.types),_step152;try{for(_iterator152.s();!(_step152=_iterator152.n()).done;){var type=_step152.value;var newProps=null;var _iterator153=_createForOfIteratorHelper(props),_step153;try{for(_iterator153.s();!(_step153=_iterator153.n()).done;){var source=_step153.value;var add2=source(type);if(add2){if(!newProps)newProps=Object.assign({},type.props);newProps[add2[0].id]=add2[1];}}}catch(err){_iterator153.e(err);}finally{_iterator153.f();}newTypes.push(newProps?new NodeType(type.name,newProps,type.id,type.flags):type);}}catch(err){_iterator152.e(err);}finally{_iterator152.f();}return new NodeSet(newTypes);}}]);return NodeSet;}();var CachedNode=/* @__PURE__ */new WeakMap();var CachedInnerNode=/* @__PURE__ */new WeakMap();var Tree=/*#__PURE__*/function(){function Tree(type,children,positions,length,props){_classCallCheck(this,Tree);this.type=type;this.children=children;this.positions=positions;this.length=length;this.props=null;if(props&&props.length){this.props=/* @__PURE__ */Object.create(null);var _iterator154=_createForOfIteratorHelper(props),_step154;try{for(_iterator154.s();!(_step154=_iterator154.n()).done;){var _step154$value=_slicedToArray(_step154.value,2),prop=_step154$value[0],value=_step154$value[1];this.props[typeof prop=="number"?prop:prop.id]=value;}}catch(err){_iterator154.e(err);}finally{_iterator154.f();}}}_createClass(Tree,[{key:"toString",value:function toString(){var mounted=this.prop(NodeProp.mounted);if(mounted&&!mounted.overlay)return mounted.tree.toString();var children="";var _iterator155=_createForOfIteratorHelper(this.children),_step155;try{for(_iterator155.s();!(_step155=_iterator155.n()).done;){var ch=_step155.value;var str=ch.toString();if(str){if(children)children+=",";children+=str;}}}catch(err){_iterator155.e(err);}finally{_iterator155.f();}return!this.type.name?children:(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(children.length?"("+children+")":"");}},{key:"cursor",value:function cursor(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var scope=pos!=null&&CachedNode.get(this)||this.topNode;var cursor2=new TreeCursor(scope);if(pos!=null){cursor2.moveTo(pos,side);CachedNode.set(this,cursor2._tree);}return cursor2;}},{key:"fullCursor",value:function fullCursor(){return new TreeCursor(this.topNode,1);}},{key:"topNode",get:function get(){return new TreeNode(this,0,0,null);}},{key:"resolve",value:function resolve(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var node=resolveNode(CachedNode.get(this)||this.topNode,pos,side,false);CachedNode.set(this,node);return node;}},{key:"resolveInner",value:function resolveInner(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var node=resolveNode(CachedInnerNode.get(this)||this.topNode,pos,side,true);CachedInnerNode.set(this,node);return node;}},{key:"iterate",value:function iterate(spec){var enter=spec.enter,leave=spec.leave,_spec$from=spec.from,from=_spec$from===void 0?0:_spec$from,_spec$to2=spec.to,to=_spec$to2===void 0?this.length:_spec$to2;for(var c=this.cursor(),get=function get(){return c.node;};;){var mustLeave=false;if(c.from<=to&&c.to>=from&&(c.type.isAnonymous||enter(c.type,c.from,c.to,get)!==false)){if(c.firstChild())continue;if(!c.type.isAnonymous)mustLeave=true;}for(;;){if(mustLeave&&leave)leave(c.type,c.from,c.to,get);mustLeave=c.type.isAnonymous;if(c.nextSibling())break;if(!c.parent())return;mustLeave=true;}}}},{key:"prop",value:function prop(_prop2){return!_prop2.perNode?this.type.prop(_prop2):this.props?this.props[_prop2.id]:void 0;}},{key:"propValues",get:function get(){var result=[];if(this.props)for(var id in this.props){result.push([+id,this.props[id]]);}return result;}},{key:"balance",value:function balance(){var _this91=this;var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,function(children,positions,length){return new Tree(_this91.type,children,positions,length,_this91.propValues);},config2.makeTree||function(children,positions,length){return new Tree(NodeType.none,children,positions,length);});}}],[{key:"build",value:function build(data){return buildTree(data);}}]);return Tree;}();Tree.empty=new Tree(NodeType.none,[],[],0);var FlatBufferCursor=/*#__PURE__*/function(){function FlatBufferCursor(buffer,index){_classCallCheck(this,FlatBufferCursor);this.buffer=buffer;this.index=index;}_createClass(FlatBufferCursor,[{key:"id",get:function get(){return this.buffer[this.index-4];}},{key:"start",get:function get(){return this.buffer[this.index-3];}},{key:"end",get:function get(){return this.buffer[this.index-2];}},{key:"size",get:function get(){return this.buffer[this.index-1];}},{key:"pos",get:function get(){return this.index;}},{key:"next",value:function next(){this.index-=4;}},{key:"fork",value:function fork(){return new FlatBufferCursor(this.buffer,this.index);}}]);return FlatBufferCursor;}();var TreeBuffer=/*#__PURE__*/function(){function TreeBuffer(buffer,length,set){_classCallCheck(this,TreeBuffer);this.buffer=buffer;this.length=length;this.set=set;}_createClass(TreeBuffer,[{key:"type",get:function get(){return NodeType.none;}},{key:"toString",value:function toString(){var result=[];for(var index=0;index<this.buffer.length;){result.push(this.childString(index));index=this.buffer[index+3];}return result.join(",");}},{key:"childString",value:function childString(index){var id=this.buffer[index],endIndex=this.buffer[index+3];var type=this.set.types[id],result=type.name;if(/\W/.test(result)&&!type.isError)result=JSON.stringify(result);index+=4;if(endIndex==index)return result;var children=[];while(index<endIndex){children.push(this.childString(index));index=this.buffer[index+3];}return result+"("+children.join(",")+")";}},{key:"findChild",value:function findChild(startIndex,endIndex,dir,pos,side){var buffer=this.buffer,pick=-1;for(var _i146=startIndex;_i146!=endIndex;_i146=buffer[_i146+3]){if(checkSide(side,pos,buffer[_i146+1],buffer[_i146+2])){pick=_i146;if(dir>0)break;}}return pick;}},{key:"slice",value:function slice(startI,endI,from,to){var b=this.buffer;var copy=new Uint16Array(endI-startI);for(var _i147=startI,j=0;_i147<endI;){copy[j++]=b[_i147++];copy[j++]=b[_i147++]-from;copy[j++]=b[_i147++]-from;copy[j++]=b[_i147++]-startI;}return new TreeBuffer(copy,to-from,this.set);}}]);return TreeBuffer;}();function checkSide(side,pos,from,to){switch(side){case-2:return from<pos;case-1:return to>=pos&&from<pos;case 0:return from<pos&&to>pos;case 1:return from<=pos&&to>pos;case 2:return to>pos;case 4:return true;}}function _enterUnfinishedNodesBefore(node,pos){var scan=node.childBefore(pos);while(scan){var last=scan.lastChild;if(!last||last.to!=scan.to)break;if(last.type.isError&&last.from==last.to){node=scan;scan=last.prevSibling;}else{scan=last;}}return node;}function resolveNode(node,pos,side,overlays){var _a;while(node.from==node.to||(side<1?node.from>=pos:node.from>pos)||(side>-1?node.to<=pos:node.to<pos)){var parent=!overlays&&node instanceof TreeNode&&node.index<0?null:node.parent;if(!parent)return node;node=parent;}if(overlays)for(var scan=node,_parent2=scan.parent;_parent2;scan=_parent2,_parent2=scan.parent){if(scan instanceof TreeNode&&scan.index<0&&((_a=_parent2.enter(pos,side,true))===null||_a===void 0?void 0:_a.from)!=scan.from)node=_parent2;}for(;;){var inner=node.enter(pos,side,overlays);if(!inner)return node;node=inner;}}var TreeNode=/*#__PURE__*/function(){function TreeNode(node,_from,index,_parent){_classCallCheck(this,TreeNode);this.node=node;this._from=_from;this.index=index;this._parent=_parent;}_createClass(TreeNode,[{key:"type",get:function get(){return this.node.type;}},{key:"name",get:function get(){return this.node.type.name;}},{key:"from",get:function get(){return this._from;}},{key:"to",get:function get(){return this._from+this.node.length;}},{key:"nextChild",value:function nextChild(i,dir,pos,side){var mode=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;for(var parent=this;;){for(var _parent$node=parent.node,children=_parent$node.children,positions=_parent$node.positions,e=dir>0?children.length:-1;i!=e;i+=dir){var next=children[i],start=positions[i]+parent._from;if(!checkSide(side,pos,start,start+next.length))continue;if(next instanceof TreeBuffer){if(mode&2)continue;var index=next.findChild(0,next.buffer.length,dir,pos-start,side);if(index>-1)return new BufferNode(new BufferContext(parent,next,i,start),null,index);}else if(mode&1||!next.type.isAnonymous||hasChild(next)){var mounted=void 0;if(!(mode&1)&&next.props&&(mounted=next.prop(NodeProp.mounted))&&!mounted.overlay)return new TreeNode(mounted.tree,start,i,parent);var inner=new TreeNode(next,start,i,parent);return mode&1||!inner.type.isAnonymous?inner:inner.nextChild(dir<0?next.children.length-1:0,dir,pos,side);}}if(mode&1||!parent.type.isAnonymous)return null;if(parent.index>=0)i=parent.index+dir;else i=dir<0?-1:parent._parent.node.children.length;parent=parent._parent;if(!parent)return null;}}},{key:"firstChild",get:function get(){return this.nextChild(0,1,0,4);}},{key:"lastChild",get:function get(){return this.nextChild(this.node.children.length-1,-1,0,4);}},{key:"childAfter",value:function childAfter(pos){return this.nextChild(0,1,pos,2);}},{key:"childBefore",value:function childBefore(pos){return this.nextChild(this.node.children.length-1,-1,pos,-2);}},{key:"enter",value:function enter(pos,side){var overlays=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var buffers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var mounted;if(overlays&&(mounted=this.node.prop(NodeProp.mounted))&&mounted.overlay){var rPos=pos-this.from;var _iterator156=_createForOfIteratorHelper(mounted.overlay),_step156;try{for(_iterator156.s();!(_step156=_iterator156.n()).done;){var _step156$value=_step156.value,from=_step156$value.from,to=_step156$value.to;if((side>0?from<=rPos:from<rPos)&&(side<0?to>=rPos:to>rPos))return new TreeNode(mounted.tree,mounted.overlay[0].from+this.from,-1,this);}}catch(err){_iterator156.e(err);}finally{_iterator156.f();}}return this.nextChild(0,1,pos,side,buffers?0:2);}},{key:"nextSignificantParent",value:function nextSignificantParent(){var val=this;while(val.type.isAnonymous&&val._parent){val=val._parent;}return val;}},{key:"parent",get:function get(){return this._parent?this._parent.nextSignificantParent():null;}},{key:"nextSibling",get:function get(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null;}},{key:"prevSibling",get:function get(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null;}},{key:"cursor",get:function get(){return new TreeCursor(this);}},{key:"tree",get:function get(){return this.node;}},{key:"toTree",value:function toTree(){return this.node;}},{key:"resolve",value:function resolve(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return resolveNode(this,pos,side,false);}},{key:"resolveInner",value:function resolveInner(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return resolveNode(this,pos,side,true);}},{key:"enterUnfinishedNodesBefore",value:function enterUnfinishedNodesBefore(pos){return _enterUnfinishedNodesBefore(this,pos);}},{key:"getChild",value:function getChild(type){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var after=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var r=_getChildren(this,type,before,after);return r.length?r[0]:null;}},{key:"getChildren",value:function getChildren(type){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var after=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return _getChildren(this,type,before,after);}},{key:"toString",value:function toString(){return this.node.toString();}}]);return TreeNode;}();function _getChildren(node,type,before,after){var cur2=node.cursor,result=[];if(!cur2.firstChild())return result;if(before!=null){while(!cur2.type.is(before)){if(!cur2.nextSibling())return result;}}for(;;){if(after!=null&&cur2.type.is(after))return result;if(cur2.type.is(type))result.push(cur2.node);if(!cur2.nextSibling())return after==null?result:[];}}var BufferContext=/*#__PURE__*/_createClass(function BufferContext(parent,buffer,index,start){_classCallCheck(this,BufferContext);this.parent=parent;this.buffer=buffer;this.index=index;this.start=start;});var BufferNode=/*#__PURE__*/function(){function BufferNode(context,_parent,index){_classCallCheck(this,BufferNode);this.context=context;this._parent=_parent;this.index=index;this.type=context.buffer.set.types[context.buffer.buffer[index]];}_createClass(BufferNode,[{key:"name",get:function get(){return this.type.name;}},{key:"from",get:function get(){return this.context.start+this.context.buffer.buffer[this.index+1];}},{key:"to",get:function get(){return this.context.start+this.context.buffer.buffer[this.index+2];}},{key:"child",value:function child(dir,pos,side){var buffer=this.context.buffer;var index=buffer.findChild(this.index+4,buffer.buffer[this.index+3],dir,pos-this.context.start,side);return index<0?null:new BufferNode(this.context,this,index);}},{key:"firstChild",get:function get(){return this.child(1,0,4);}},{key:"lastChild",get:function get(){return this.child(-1,0,4);}},{key:"childAfter",value:function childAfter(pos){return this.child(1,pos,2);}},{key:"childBefore",value:function childBefore(pos){return this.child(-1,pos,-2);}},{key:"enter",value:function enter(pos,side,overlays){var buffers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(!buffers)return null;var buffer=this.context.buffer;var index=buffer.findChild(this.index+4,buffer.buffer[this.index+3],side>0?1:-1,pos-this.context.start,side);return index<0?null:new BufferNode(this.context,this,index);}},{key:"parent",get:function get(){return this._parent||this.context.parent.nextSignificantParent();}},{key:"externalSibling",value:function externalSibling(dir){return this._parent?null:this.context.parent.nextChild(this.context.index+dir,dir,0,4);}},{key:"nextSibling",get:function get(){var buffer=this.context.buffer;var after=buffer.buffer[this.index+3];if(after<(this._parent?buffer.buffer[this._parent.index+3]:buffer.buffer.length))return new BufferNode(this.context,this._parent,after);return this.externalSibling(1);}},{key:"prevSibling",get:function get(){var buffer=this.context.buffer;var parentStart=this._parent?this._parent.index+4:0;if(this.index==parentStart)return this.externalSibling(-1);return new BufferNode(this.context,this._parent,buffer.findChild(parentStart,this.index,-1,0,4));}},{key:"cursor",get:function get(){return new TreeCursor(this);}},{key:"tree",get:function get(){return null;}},{key:"toTree",value:function toTree(){var children=[],positions=[];var buffer=this.context.buffer;var startI=this.index+4,endI=buffer.buffer[this.index+3];if(endI>startI){var from=buffer.buffer[this.index+1],to=buffer.buffer[this.index+2];children.push(buffer.slice(startI,endI,from,to));positions.push(0);}return new Tree(this.type,children,positions,this.to-this.from);}},{key:"resolve",value:function resolve(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return resolveNode(this,pos,side,false);}},{key:"resolveInner",value:function resolveInner(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return resolveNode(this,pos,side,true);}},{key:"enterUnfinishedNodesBefore",value:function enterUnfinishedNodesBefore(pos){return _enterUnfinishedNodesBefore(this,pos);}},{key:"toString",value:function toString(){return this.context.buffer.childString(this.index);}},{key:"getChild",value:function getChild(type){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var after=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var r=_getChildren(this,type,before,after);return r.length?r[0]:null;}},{key:"getChildren",value:function getChildren(type){var before=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var after=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;return _getChildren(this,type,before,after);}}]);return BufferNode;}();var TreeCursor=/*#__PURE__*/function(){function TreeCursor(node){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_classCallCheck(this,TreeCursor);this.mode=mode;this.buffer=null;this.stack=[];this.index=0;this.bufferNode=null;if(node instanceof TreeNode){this.yieldNode(node);}else{this._tree=node.context.parent;this.buffer=node.context;for(var n=node._parent;n;n=n._parent){this.stack.unshift(n.index);}this.bufferNode=node;this.yieldBuf(node.index);}}_createClass(TreeCursor,[{key:"name",get:function get(){return this.type.name;}},{key:"yieldNode",value:function yieldNode(node){if(!node)return false;this._tree=node;this.type=node.type;this.from=node.from;this.to=node.to;return true;}},{key:"yieldBuf",value:function yieldBuf(index,type){this.index=index;var _this$buffer=this.buffer,start=_this$buffer.start,buffer=_this$buffer.buffer;this.type=type||buffer.set.types[buffer.buffer[index]];this.from=start+buffer.buffer[index+1];this.to=start+buffer.buffer[index+2];return true;}},{key:"yield",value:function _yield(node){if(!node)return false;if(node instanceof TreeNode){this.buffer=null;return this.yieldNode(node);}this.buffer=node.context;return this.yieldBuf(node.index,node.type);}},{key:"toString",value:function toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString();}},{key:"enterChild",value:function enterChild(dir,pos,side){if(!this.buffer)return this["yield"](this._tree.nextChild(dir<0?this._tree.node.children.length-1:0,dir,pos,side,this.mode));var buffer=this.buffer.buffer;var index=buffer.findChild(this.index+4,buffer.buffer[this.index+3],dir,pos-this.buffer.start,side);if(index<0)return false;this.stack.push(this.index);return this.yieldBuf(index);}},{key:"firstChild",value:function firstChild(){return this.enterChild(1,0,4);}},{key:"lastChild",value:function lastChild(){return this.enterChild(-1,0,4);}},{key:"childAfter",value:function childAfter(pos){return this.enterChild(1,pos,2);}},{key:"childBefore",value:function childBefore(pos){return this.enterChild(-1,pos,-2);}},{key:"enter",value:function enter(pos,side){var overlays=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var buffers=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;if(!this.buffer)return this["yield"](this._tree.enter(pos,side,overlays&&!(this.mode&1),buffers));return buffers?this.enterChild(1,pos,side):false;}},{key:"parent",value:function parent(){if(!this.buffer)return this.yieldNode(this.mode&1?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());var parent=this.mode&1?this.buffer.parent:this.buffer.parent.nextSignificantParent();this.buffer=null;return this.yieldNode(parent);}},{key:"sibling",value:function sibling(dir){if(!this.buffer)return!this._tree._parent?false:this["yield"](this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+dir,dir,0,4,this.mode));var buffer=this.buffer.buffer,d=this.stack.length-1;if(dir<0){var parentStart=d<0?0:this.stack[d]+4;if(this.index!=parentStart)return this.yieldBuf(buffer.findChild(parentStart,this.index,-1,0,4));}else{var after=buffer.buffer[this.index+3];if(after<(d<0?buffer.buffer.length:buffer.buffer[this.stack[d]+3]))return this.yieldBuf(after);}return d<0?this["yield"](this.buffer.parent.nextChild(this.buffer.index+dir,dir,0,4,this.mode)):false;}},{key:"nextSibling",value:function nextSibling(){return this.sibling(1);}},{key:"prevSibling",value:function prevSibling(){return this.sibling(-1);}},{key:"atLastNode",value:function atLastNode(dir){var index,parent,buffer=this.buffer;if(buffer){if(dir>0){if(this.index<buffer.buffer.buffer.length)return false;}else{for(var _i148=0;_i148<this.index;_i148++){if(buffer.buffer.buffer[_i148+3]<this.index)return false;}}index=buffer.index;parent=buffer.parent;}else{var _this$_tree=this._tree;index=_this$_tree.index;parent=_this$_tree._parent;}for(;parent;_parent3=parent,index=_parent3.index,parent=_parent3._parent,_parent3){var _parent3;if(index>-1)for(var _i149=index+dir,e=dir<0?-1:parent.node.children.length;_i149!=e;_i149+=dir){var child=parent.node.children[_i149];if(this.mode&1||child instanceof TreeBuffer||!child.type.isAnonymous||hasChild(child))return false;}}return true;}},{key:"move",value:function move(dir,enter){if(enter&&this.enterChild(dir,0,4))return true;for(;;){if(this.sibling(dir))return true;if(this.atLastNode(dir)||!this.parent())return false;}}},{key:"next",value:function next(){var enter=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;return this.move(1,enter);}},{key:"prev",value:function prev(){var enter=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;return this.move(-1,enter);}},{key:"moveTo",value:function moveTo(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;while(this.from==this.to||(side<1?this.from>=pos:this.from>pos)||(side>-1?this.to<=pos:this.to<pos)){if(!this.parent())break;}while(this.enterChild(1,pos,side)){}return this;}},{key:"node",get:function get(){if(!this.buffer)return this._tree;var cache=this.bufferNode,result=null,depth=0;if(cache&&cache.context==this.buffer){scan:for(var index=this.index,d=this.stack.length;d>=0;){for(var c=cache;c;c=c._parent){if(c.index==index){if(index==this.index)return c;result=c;depth=d+1;break scan;}}index=this.stack[--d];}}for(var _i150=depth;_i150<this.stack.length;_i150++){result=new BufferNode(this.buffer,result,this.stack[_i150]);}return this.bufferNode=new BufferNode(this.buffer,result,this.index);}},{key:"tree",get:function get(){return this.buffer?null:this._tree.node;}}]);return TreeCursor;}();function hasChild(tree){return tree.children.some(function(ch){return ch instanceof TreeBuffer||!ch.type.isAnonymous||hasChild(ch);});}function buildTree(data){var _a;var buffer=data.buffer,nodeSet2=data.nodeSet,_data$maxBufferLength=data.maxBufferLength,maxBufferLength=_data$maxBufferLength===void 0?DefaultBufferLength:_data$maxBufferLength,_data$reused=data.reused,reused=_data$reused===void 0?[]:_data$reused,_data$minRepeatType=data.minRepeatType,minRepeatType=_data$minRepeatType===void 0?nodeSet2.types.length:_data$minRepeatType;var cursor2=Array.isArray(buffer)?new FlatBufferCursor(buffer,buffer.length):buffer;var types6=nodeSet2.types;var contextHash=0,lookAhead=0;function takeNode(parentStart,minPos,children2,positions2,inRepeat){var id=cursor2.id,start=cursor2.start,end=cursor2.end,size=cursor2.size;var lookAheadAtStart=lookAhead;while(size<0){cursor2.next();if(size==-1){var node2=reused[id];children2.push(node2);positions2.push(start-parentStart);return;}else if(size==-3){contextHash=id;return;}else if(size==-4){lookAhead=id;return;}else{throw new RangeError("Unrecognized record size: ".concat(size));}}var type=types6[id],node,buffer2;var startPos=start-parentStart;if(end-start<=maxBufferLength&&(buffer2=findBufferSize(cursor2.pos-minPos,inRepeat))){var data2=new Uint16Array(buffer2.size-buffer2.skip);var endPos=cursor2.pos-buffer2.size,index=data2.length;while(cursor2.pos>endPos){index=copyToBuffer(buffer2.start,data2,index);}node=new TreeBuffer(data2,end-buffer2.start,nodeSet2);startPos=buffer2.start-parentStart;}else{var _endPos=cursor2.pos-size;cursor2.next();var localChildren=[],localPositions=[];var localInRepeat=id>=minRepeatType?id:-1;var lastGroup=0,lastEnd=end;while(cursor2.pos>_endPos){if(localInRepeat>=0&&cursor2.id==localInRepeat&&cursor2.size>=0){if(cursor2.end<=lastEnd-maxBufferLength){makeRepeatLeaf(localChildren,localPositions,start,lastGroup,cursor2.end,lastEnd,localInRepeat,lookAheadAtStart);lastGroup=localChildren.length;lastEnd=cursor2.end;}cursor2.next();}else{takeNode(start,_endPos,localChildren,localPositions,localInRepeat);}}if(localInRepeat>=0&&lastGroup>0&&lastGroup<localChildren.length)makeRepeatLeaf(localChildren,localPositions,start,lastGroup,start,lastEnd,localInRepeat,lookAheadAtStart);localChildren.reverse();localPositions.reverse();if(localInRepeat>-1&&lastGroup>0){var make=makeBalanced(type);node=balanceRange(type,localChildren,localPositions,0,localChildren.length,0,end-start,make,make);}else{node=makeTree(type,localChildren,localPositions,end-start,lookAheadAtStart-end);}}children2.push(node);positions2.push(startPos);}function makeBalanced(type){return function(children2,positions2,length2){var lookAhead2=0,lastI=children2.length-1,last,lookAheadProp;if(lastI>=0&&(last=children2[lastI])instanceof Tree){if(!lastI&&last.type==type&&last.length==length2)return last;if(lookAheadProp=last.prop(NodeProp.lookAhead))lookAhead2=positions2[lastI]+last.length+lookAheadProp;}return makeTree(type,children2,positions2,length2,lookAhead2);};}function makeRepeatLeaf(children2,positions2,base2,i,from,to,type,lookAhead2){var localChildren=[],localPositions=[];while(children2.length>i){localChildren.push(children2.pop());localPositions.push(positions2.pop()+base2-from);}children2.push(makeTree(nodeSet2.types[type],localChildren,localPositions,to-from,lookAhead2-to));positions2.push(from-base2);}function makeTree(type,children2,positions2,length2){var lookAhead2=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var props=arguments.length>5?arguments[5]:undefined;if(contextHash){var pair=[NodeProp.contextHash,contextHash];props=props?[pair].concat(props):[pair];}if(lookAhead2>25){var _pair=[NodeProp.lookAhead,lookAhead2];props=props?[_pair].concat(props):[_pair];}return new Tree(type,children2,positions2,length2,props);}function findBufferSize(maxSize,inRepeat){var fork=cursor2.fork();var size=0,start=0,skip=0,minStart=fork.end-maxBufferLength;var result={size:0,start:0,skip:0};scan:for(var minPos=fork.pos-maxSize;fork.pos>minPos;){var nodeSize2=fork.size;if(fork.id==inRepeat&&nodeSize2>=0){result.size=size;result.start=start;result.skip=skip;skip+=4;size+=4;fork.next();continue;}var startPos=fork.pos-nodeSize2;if(nodeSize2<0||startPos<minPos||fork.start<minStart)break;var localSkipped=fork.id>=minRepeatType?4:0;var nodeStart2=fork.start;fork.next();while(fork.pos>startPos){if(fork.size<0){if(fork.size==-3)localSkipped+=4;else break scan;}else if(fork.id>=minRepeatType){localSkipped+=4;}fork.next();}start=nodeStart2;size+=nodeSize2;skip+=localSkipped;}if(inRepeat<0||size==maxSize){result.size=size;result.start=start;result.skip=skip;}return result.size>4?result:void 0;}function copyToBuffer(bufferStart,buffer2,index){var id=cursor2.id,start=cursor2.start,end=cursor2.end,size=cursor2.size;cursor2.next();if(size>=0&&id<minRepeatType){var startIndex=index;if(size>4){var endPos=cursor2.pos-(size-4);while(cursor2.pos>endPos){index=copyToBuffer(bufferStart,buffer2,index);}}buffer2[--index]=startIndex;buffer2[--index]=end-bufferStart;buffer2[--index]=start-bufferStart;buffer2[--index]=id;}else if(size==-3){contextHash=id;}else if(size==-4){lookAhead=id;}return index;}var children=[],positions=[];while(cursor2.pos>0){takeNode(data.start||0,data.bufferStart||0,children,positions,-1);}var length=(_a=data.length)!==null&&_a!==void 0?_a:children.length?positions[0]+children[0].length:0;return new Tree(types6[data.topID],children.reverse(),positions.reverse(),length);}var nodeSizeCache=/* @__PURE__ */new WeakMap();function nodeSize(balanceType,node){if(!balanceType.isAnonymous||node instanceof TreeBuffer||node.type!=balanceType)return 1;var size=nodeSizeCache.get(node);if(size==null){size=1;var _iterator157=_createForOfIteratorHelper(node.children),_step157;try{for(_iterator157.s();!(_step157=_iterator157.n()).done;){var child=_step157.value;if(child.type!=balanceType||!(child instanceof Tree)){size=1;break;}size+=nodeSize(balanceType,child);}}catch(err){_iterator157.e(err);}finally{_iterator157.f();}nodeSizeCache.set(node,size);}return size;}function balanceRange(balanceType,children,positions,from,to,start,length,mkTop,mkTree){var total=0;for(var _i151=from;_i151<to;_i151++){total+=nodeSize(balanceType,children[_i151]);}var maxChild=Math.ceil(total*1.5/8);var localChildren=[],localPositions=[];function divide(children2,positions2,from2,to2,offset){for(var _i152=from2;_i152<to2;){var groupFrom=_i152,groupStart=positions2[_i152],groupSize=nodeSize(balanceType,children2[_i152]);_i152++;for(;_i152<to2;_i152++){var nextSize=nodeSize(balanceType,children2[_i152]);if(groupSize+nextSize>=maxChild)break;groupSize+=nextSize;}if(_i152==groupFrom+1){if(groupSize>maxChild){var only=children2[groupFrom];divide(only.children,only.positions,0,only.children.length,positions2[groupFrom]+offset);continue;}localChildren.push(children2[groupFrom]);}else{var length2=positions2[_i152-1]+children2[_i152-1].length-groupStart;localChildren.push(balanceRange(balanceType,children2,positions2,groupFrom,_i152,groupStart,length2,null,mkTree));}localPositions.push(groupStart+offset-start);}}divide(children,positions,from,to,0);return(mkTop||mkTree)(localChildren,localPositions,length);}var TreeFragment=/*#__PURE__*/function(){function TreeFragment(from,to,tree,offset){var openStart=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var openEnd=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;_classCallCheck(this,TreeFragment);this.from=from;this.to=to;this.tree=tree;this.offset=offset;this.open=(openStart?1:0)|(openEnd?2:0);}_createClass(TreeFragment,[{key:"openStart",get:function get(){return(this.open&1)>0;}},{key:"openEnd",get:function get(){return(this.open&2)>0;}}],[{key:"addTree",value:function addTree(tree){var fragments=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var partial=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var result=[new TreeFragment(0,tree.length,tree,0,false,partial)];var _iterator158=_createForOfIteratorHelper(fragments),_step158;try{for(_iterator158.s();!(_step158=_iterator158.n()).done;){var f=_step158.value;if(f.to>tree.length)result.push(f);}}catch(err){_iterator158.e(err);}finally{_iterator158.f();}return result;}},{key:"applyChanges",value:function applyChanges(fragments,changes){var minGap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:128;if(!changes.length)return fragments;var result=[];var fI=1,nextF=fragments.length?fragments[0]:null;for(var cI=0,pos=0,off=0;;cI++){var nextC=cI<changes.length?changes[cI]:null;var nextPos=nextC?nextC.fromA:1e9;if(nextPos-pos>=minGap)while(nextF&&nextF.from<nextPos){var cut=nextF;if(pos>=cut.from||nextPos<=cut.to||off){var fFrom=Math.max(cut.from,pos)-off,fTo=Math.min(cut.to,nextPos)-off;cut=fFrom>=fTo?null:new TreeFragment(fFrom,fTo,cut.tree,cut.offset+off,cI>0,!!nextC);}if(cut)result.push(cut);if(nextF.to>nextPos)break;nextF=fI<fragments.length?fragments[fI++]:null;}if(!nextC)break;pos=nextC.toA;off=nextC.toA-nextC.toB;}return result;}}]);return TreeFragment;}();var Parser=/*#__PURE__*/function(){function Parser(){_classCallCheck(this,Parser);}_createClass(Parser,[{key:"startParse",value:function startParse(input,fragments,ranges){if(typeof input=="string")input=new StringInput(input);ranges=!ranges?[new Range2(0,input.length)]:ranges.length?ranges.map(function(r){return new Range2(r.from,r.to);}):[new Range2(0,0)];return this.createParse(input,fragments||[],ranges);}},{key:"parse",value:function parse(input,fragments,ranges){var parse=this.startParse(input,fragments,ranges);for(;;){var done=parse.advance();if(done)return done;}}}]);return Parser;}();var StringInput=/*#__PURE__*/function(){function StringInput(string2){_classCallCheck(this,StringInput);this.string=string2;}_createClass(StringInput,[{key:"length",get:function get(){return this.string.length;}},{key:"chunk",value:function chunk(from){return this.string.slice(from);}},{key:"lineChunks",get:function get(){return false;}},{key:"read",value:function read(from,to){return this.string.slice(from,to);}}]);return StringInput;}();var stoppedInner=new NodeProp({perNode:true});// ../node_modules/@codemirror/language/dist/index.js
var languageDataProp=/* @__PURE__ */new NodeProp();function defineLanguageFacet(baseData){return Facet.define({combine:baseData?function(values){return values.concat(baseData);}:void 0});}var Language=/*#__PURE__*/function(){function Language(data,parser,topNode){var extraExtensions=arguments.length>3&&arguments[3]!==undefined?arguments[3]:[];_classCallCheck(this,Language);this.data=data;this.topNode=topNode;if(!EditorState.prototype.hasOwnProperty("tree"))Object.defineProperty(EditorState.prototype,"tree",{get:function get(){return syntaxTree(this);}});this.parser=parser;this.extension=[language.of(this),EditorState.languageData.of(function(state,pos,side){return state.facet(languageDataFacetAt(state,pos,side));})].concat(extraExtensions);}_createClass(Language,[{key:"isActiveAt",value:function isActiveAt(state,pos){var side=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;return languageDataFacetAt(state,pos,side)==this.data;}},{key:"findRegions",value:function findRegions(state){var _this92=this;var lang=state.facet(language);if((lang===null||lang===void 0?void 0:lang.data)==this.data)return[{from:0,to:state.doc.length}];if(!lang||!lang.allowsNesting)return[];var result=[];var explore=function explore(tree,from){if(tree.prop(languageDataProp)==_this92.data){result.push({from:from,to:from+tree.length});return;}var mount=tree.prop(NodeProp.mounted);if(mount){if(mount.tree.prop(languageDataProp)==_this92.data){if(mount.overlay){var _iterator159=_createForOfIteratorHelper(mount.overlay),_step159;try{for(_iterator159.s();!(_step159=_iterator159.n()).done;){var _r8=_step159.value;result.push({from:_r8.from+from,to:_r8.to+from});}}catch(err){_iterator159.e(err);}finally{_iterator159.f();}}else result.push({from:from,to:from+tree.length});return;}else if(mount.overlay){var size=result.length;explore(mount.tree,mount.overlay[0].from+from);if(result.length>size)return;}}for(var _i153=0;_i153<tree.children.length;_i153++){var ch=tree.children[_i153];if(ch instanceof Tree)explore(ch,tree.positions[_i153]+from);}};explore(syntaxTree(state),0);return result;}},{key:"allowsNesting",get:function get(){return true;}}]);return Language;}();Language.setState=/* @__PURE__ */StateEffect.define();function languageDataFacetAt(state,pos,side){var topLang=state.facet(language);if(!topLang)return null;var facet=topLang.data;if(topLang.allowsNesting){for(var node=syntaxTree(state).topNode;node;node=node.enter(pos,side,true,false)){facet=node.type.prop(languageDataProp)||facet;}}return facet;}function syntaxTree(state){var field=state.field(Language.state,false);return field?field.tree:Tree.empty;}var DocInput=/*#__PURE__*/function(){function DocInput(doc6){var length=arguments.length>1&&arguments[1]!==undefined?arguments[1]:doc6.length;_classCallCheck(this,DocInput);this.doc=doc6;this.length=length;this.cursorPos=0;this.string="";this.cursor=doc6.iter();}_createClass(DocInput,[{key:"syncTo",value:function syncTo(pos){this.string=this.cursor.next(pos-this.cursorPos).value;this.cursorPos=pos+this.string.length;return this.cursorPos-this.string.length;}},{key:"chunk",value:function chunk(pos){this.syncTo(pos);return this.string;}},{key:"lineChunks",get:function get(){return true;}},{key:"read",value:function read(from,to){var stringStart=this.cursorPos-this.string.length;if(from<stringStart||to>=this.cursorPos)return this.doc.sliceString(from,to);else return this.string.slice(from-stringStart,to-stringStart);}}]);return DocInput;}();var currentContext=null;var ParseContext=/*#__PURE__*/function(){function ParseContext(parser,state){var fragments=arguments.length>2&&arguments[2]!==undefined?arguments[2]:[];var tree=arguments.length>3?arguments[3]:undefined;var treeLen=arguments.length>4?arguments[4]:undefined;var viewport=arguments.length>5?arguments[5]:undefined;var skipped=arguments.length>6?arguments[6]:undefined;var scheduleOn=arguments.length>7?arguments[7]:undefined;_classCallCheck(this,ParseContext);this.parser=parser;this.state=state;this.fragments=fragments;this.tree=tree;this.treeLen=treeLen;this.viewport=viewport;this.skipped=skipped;this.scheduleOn=scheduleOn;this.parse=null;this.tempSkipped=[];}_createClass(ParseContext,[{key:"startParse",value:function startParse(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments);}},{key:"work",value:function work(time,upto){var _this93=this;if(upto!=null&&upto>=this.state.doc.length)upto=void 0;if(this.tree!=Tree.empty&&this.isDone(upto!==null&&upto!==void 0?upto:this.state.doc.length)){this.takeTree();return true;}return this.withContext(function(){var _a;var endTime=Date.now()+time;if(!_this93.parse)_this93.parse=_this93.startParse();if(upto!=null&&(_this93.parse.stoppedAt==null||_this93.parse.stoppedAt>upto)&&upto<_this93.state.doc.length)_this93.parse.stopAt(upto);for(;;){var done=_this93.parse.advance();if(done){_this93.fragments=_this93.withoutTempSkipped(TreeFragment.addTree(done,_this93.fragments,_this93.parse.stoppedAt!=null));_this93.treeLen=(_a=_this93.parse.stoppedAt)!==null&&_a!==void 0?_a:_this93.state.doc.length;_this93.tree=done;_this93.parse=null;if(_this93.treeLen<(upto!==null&&upto!==void 0?upto:_this93.state.doc.length))_this93.parse=_this93.startParse();else return true;}if(Date.now()>endTime)return false;}});}},{key:"takeTree",value:function takeTree(){var _this94=this;var pos,tree;if(this.parse&&(pos=this.parse.parsedPos)>=this.treeLen){if(this.parse.stoppedAt==null||this.parse.stoppedAt>pos)this.parse.stopAt(pos);this.withContext(function(){while(!(tree=_this94.parse.advance())){}});this.treeLen=pos;this.tree=tree;this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,true));this.parse=null;}}},{key:"withContext",value:function withContext(f){var prev=currentContext;currentContext=this;try{return f();}finally{currentContext=prev;}}},{key:"withoutTempSkipped",value:function withoutTempSkipped(fragments){for(var _r9;_r9=this.tempSkipped.pop();){fragments=cutFragments(fragments,_r9.from,_r9.to);}return fragments;}},{key:"changes",value:function changes(_changes,newState){var fragments=this.fragments,tree=this.tree,treeLen=this.treeLen,viewport=this.viewport,skipped=this.skipped;this.takeTree();if(!_changes.empty){var ranges=[];_changes.iterChangedRanges(function(fromA,toA,fromB,toB){return ranges.push({fromA:fromA,toA:toA,fromB:fromB,toB:toB});});fragments=TreeFragment.applyChanges(fragments,ranges);tree=Tree.empty;treeLen=0;viewport={from:_changes.mapPos(viewport.from,-1),to:_changes.mapPos(viewport.to,1)};if(this.skipped.length){skipped=[];var _iterator160=_createForOfIteratorHelper(this.skipped),_step160;try{for(_iterator160.s();!(_step160=_iterator160.n()).done;){var _r10=_step160.value;var from=_changes.mapPos(_r10.from,1),to=_changes.mapPos(_r10.to,-1);if(from<to)skipped.push({from:from,to:to});}}catch(err){_iterator160.e(err);}finally{_iterator160.f();}}}return new ParseContext(this.parser,newState,fragments,tree,treeLen,viewport,skipped,this.scheduleOn);}},{key:"updateViewport",value:function updateViewport(viewport){if(this.viewport.from==viewport.from&&this.viewport.to==viewport.to)return false;this.viewport=viewport;var startLen=this.skipped.length;for(var _i154=0;_i154<this.skipped.length;_i154++){var _this$skipped$_i=this.skipped[_i154],from=_this$skipped$_i.from,to=_this$skipped$_i.to;if(from<viewport.to&&to>viewport.from){this.fragments=cutFragments(this.fragments,from,to);this.skipped.splice(_i154--,1);}}if(this.skipped.length>=startLen)return false;this.reset();return true;}},{key:"reset",value:function reset(){if(this.parse){this.takeTree();this.parse=null;}}},{key:"skipUntilInView",value:function skipUntilInView(from,to){this.skipped.push({from:from,to:to});}},{key:"isDone",value:function isDone(upto){upto=Math.min(upto,this.state.doc.length);var frags=this.fragments;return this.treeLen>=upto&&frags.length&&frags[0].from==0&&frags[0].to>=upto;}}],[{key:"getSkippingParser",value:function getSkippingParser(until){return new(/*#__PURE__*/function(_Parser){_inherits(_class4,_Parser);var _super47=_createSuper(_class4);function _class4(){_classCallCheck(this,_class4);return _super47.apply(this,arguments);}_createClass(_class4,[{key:"createParse",value:function createParse(input,fragments,ranges){var from=ranges[0].from,to=ranges[ranges.length-1].to;var parser={parsedPos:from,advance:function advance(){var cx=currentContext;if(cx){var _iterator161=_createForOfIteratorHelper(ranges),_step161;try{for(_iterator161.s();!(_step161=_iterator161.n()).done;){var _r11=_step161.value;cx.tempSkipped.push(_r11);}}catch(err){_iterator161.e(err);}finally{_iterator161.f();}if(until)cx.scheduleOn=cx.scheduleOn?Promise.all([cx.scheduleOn,until]):until;}this.parsedPos=to;return new Tree(NodeType.none,[],[],to-from);},stoppedAt:null,stopAt:function stopAt(){}};return parser;}}]);return _class4;}(Parser))();}},{key:"get",value:function get(){return currentContext;}}]);return ParseContext;}();function cutFragments(fragments,from,to){return TreeFragment.applyChanges(fragments,[{fromA:from,toA:to,fromB:from,toB:to}]);}var LanguageState=/*#__PURE__*/function(){function LanguageState(context){_classCallCheck(this,LanguageState);this.context=context;this.tree=context.tree;}_createClass(LanguageState,[{key:"apply",value:function apply(tr){if(!tr.docChanged)return this;var newCx=this.context.changes(tr.changes,tr.state);var upto=this.context.treeLen==tr.startState.doc.length?void 0:Math.max(tr.changes.mapPos(this.context.treeLen),newCx.viewport.to);if(!newCx.work(20,upto))newCx.takeTree();return new LanguageState(newCx);}}],[{key:"init",value:function init(state){var vpTo=Math.min(3e3,state.doc.length);var parseState=new ParseContext(state.facet(language).parser,state,[],Tree.empty,0,{from:0,to:vpTo},[],null);if(!parseState.work(20,vpTo))parseState.takeTree();return new LanguageState(parseState);}}]);return LanguageState;}();Language.state=/* @__PURE__ */StateField.define({create:LanguageState.init,update:function update(value,tr){var _iterator162=_createForOfIteratorHelper(tr.effects),_step162;try{for(_iterator162.s();!(_step162=_iterator162.n()).done;){var e=_step162.value;if(e.is(Language.setState))return e.value;}}catch(err){_iterator162.e(err);}finally{_iterator162.f();}if(tr.startState.facet(language)!=tr.state.facet(language))return LanguageState.init(tr.state);return value.apply(tr);}});var requestIdle=function requestIdle(callback){var timeout=setTimeout(function(){return callback();},500);return function(){return clearTimeout(timeout);};};if(typeof requestIdleCallback!="undefined")requestIdle=function requestIdle(callback){var idle=-1,timeout=setTimeout(function(){idle=requestIdleCallback(callback,{timeout:500-100});},100);return function(){return idle<0?clearTimeout(timeout):cancelIdleCallback(idle);};};var parseWorker=/* @__PURE__ */ViewPlugin.fromClass(/*#__PURE__*/function(){function ParseWorker(view){_classCallCheck(this,ParseWorker);this.view=view;this.working=null;this.workScheduled=0;this.chunkEnd=-1;this.chunkBudget=-1;this.work=this.work.bind(this);this.scheduleWork();}_createClass(ParseWorker,[{key:"update",value:function update(_update14){var cx=this.view.state.field(Language.state).context;if(cx.updateViewport(_update14.view.viewport)||this.view.viewport.to>cx.treeLen)this.scheduleWork();if(_update14.docChanged){if(this.view.hasFocus)this.chunkBudget+=50;this.scheduleWork();}this.checkAsyncSchedule(cx);}},{key:"scheduleWork",value:function scheduleWork(){if(this.working)return;var state=this.view.state,field=state.field(Language.state);if(field.tree!=field.context.tree||!field.context.isDone(state.doc.length))this.working=requestIdle(this.work);}},{key:"work",value:function work(deadline){this.working=null;var now=Date.now();if(this.chunkEnd<now&&(this.chunkEnd<0||this.view.hasFocus)){this.chunkEnd=now+3e4;this.chunkBudget=3e3;}if(this.chunkBudget<=0)return;var _this$view=this.view,state=_this$view.state,vpTo=_this$view.viewport.to,field=state.field(Language.state);if(field.tree==field.context.tree&&field.context.isDone(vpTo+1e5))return;var time=Math.min(this.chunkBudget,100,deadline?Math.max(25,deadline.timeRemaining()-5):1e9);var viewportFirst=field.context.treeLen<vpTo&&state.doc.length>vpTo+1e3;var done=field.context.work(time,vpTo+(viewportFirst?0:1e5));this.chunkBudget-=Date.now()-now;if(done||this.chunkBudget<=0){field.context.takeTree();this.view.dispatch({effects:Language.setState.of(new LanguageState(field.context))});}if(this.chunkBudget>0&&!(done&&!viewportFirst))this.scheduleWork();this.checkAsyncSchedule(field.context);}},{key:"checkAsyncSchedule",value:function checkAsyncSchedule(cx){var _this95=this;if(cx.scheduleOn){this.workScheduled++;cx.scheduleOn.then(function(){return _this95.scheduleWork();})["catch"](function(err){return logException(_this95.view.state,err);}).then(function(){return _this95.workScheduled--;});cx.scheduleOn=null;}}},{key:"destroy",value:function destroy(){if(this.working)this.working();}},{key:"isWorking",value:function isWorking(){return this.working||this.workScheduled>0;}}]);return ParseWorker;}(),{eventHandlers:{focus:function focus(){this.scheduleWork();}}});var language=/* @__PURE__ */Facet.define({combine:function combine(languages){return languages.length?languages[0]:null;},enables:[Language.state,parseWorker]});var indentService=/* @__PURE__ */Facet.define();var indentUnit=/* @__PURE__ */Facet.define({combine:function combine(values){if(!values.length)return"  ";if(!/^(?: +|\t+)$/.test(values[0]))throw new Error("Invalid indent unit: "+JSON.stringify(values[0]));return values[0];}});function getIndentUnit(state){var unit=state.facet(indentUnit);return unit.charCodeAt(0)==9?state.tabSize*unit.length:unit.length;}function indentString(state,cols){var result="",ts=state.tabSize;if(state.facet(indentUnit).charCodeAt(0)==9)while(cols>=ts){result+="	";cols-=ts;}for(var _i155=0;_i155<cols;_i155++){result+=" ";}return result;}function getIndentation(context,pos){if(context instanceof EditorState)context=new IndentContext(context);var _iterator163=_createForOfIteratorHelper(context.state.facet(indentService)),_step163;try{for(_iterator163.s();!(_step163=_iterator163.n()).done;){var service=_step163.value;var result=service(context,pos);if(result!=null)return result;}}catch(err){_iterator163.e(err);}finally{_iterator163.f();}var tree=syntaxTree(context.state);return tree?syntaxIndentation(context,tree,pos):null;}var IndentContext=/*#__PURE__*/function(){function IndentContext(state){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,IndentContext);this.state=state;this.options=options;this.unit=getIndentUnit(state);}_createClass(IndentContext,[{key:"lineAt",value:function lineAt(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var line=this.state.doc.lineAt(pos);var simulateBreak=this.options.simulateBreak;if(simulateBreak!=null&&simulateBreak>=line.from&&simulateBreak<=line.to){if(bias<0?simulateBreak<pos:simulateBreak<=pos)return{text:line.text.slice(simulateBreak-line.from),from:simulateBreak};else return{text:line.text.slice(0,simulateBreak-line.from),from:line.from};}return line;}},{key:"textAfterPos",value:function textAfterPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(this.options.simulateDoubleBreak&&pos==this.options.simulateBreak)return"";var _this$lineAt=this.lineAt(pos,bias),text=_this$lineAt.text,from=_this$lineAt.from;return text.slice(pos-from,Math.min(text.length,pos+100-from));}},{key:"column",value:function column(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var _this$lineAt2=this.lineAt(pos,bias),text=_this$lineAt2.text,from=_this$lineAt2.from;var result=this.countColumn(text,pos-from);var override=this.options.overrideIndentation?this.options.overrideIndentation(from):-1;if(override>-1)result+=override-this.countColumn(text,text.search(/\S|$/));return result;}},{key:"countColumn",value:function countColumn(line){var pos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:line.length;return _countColumn(line,this.state.tabSize,pos);}},{key:"lineIndent",value:function lineIndent(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;var _this$lineAt3=this.lineAt(pos,bias),text=_this$lineAt3.text,from=_this$lineAt3.from;var override=this.options.overrideIndentation;if(override){var overriden=override(from);if(overriden>-1)return overriden;}return this.countColumn(text,text.search(/\S|$/));}},{key:"simulatedBreak",get:function get(){return this.options.simulateBreak||null;}}]);return IndentContext;}();var indentNodeProp=/* @__PURE__ */new NodeProp();function syntaxIndentation(cx,ast,pos){return indentFrom(ast.resolveInner(pos).enterUnfinishedNodesBefore(pos),pos,cx);}function ignoreClosed(cx){return cx.pos==cx.options.simulateBreak&&cx.options.simulateDoubleBreak;}function indentStrategy(tree){var strategy=tree.type.prop(indentNodeProp);if(strategy)return strategy;var first=tree.firstChild,close;if(first&&(close=first.type.prop(NodeProp.closedBy))){var last=tree.lastChild,closed=last&&close.indexOf(last.name)>-1;return function(cx){return delimitedStrategy(cx,true,1,void 0,closed&&!ignoreClosed(cx)?last.from:void 0);};}return tree.parent==null?topIndent:null;}function indentFrom(node,pos,base2){for(;node;node=node.parent){var strategy=indentStrategy(node);if(strategy)return strategy(new TreeIndentContext(base2,pos,node));}return null;}function topIndent(){return 0;}var TreeIndentContext=/*#__PURE__*/function(_IndentContext){_inherits(TreeIndentContext,_IndentContext);var _super48=_createSuper(TreeIndentContext);function TreeIndentContext(base2,pos,node){var _this96;_classCallCheck(this,TreeIndentContext);_this96=_super48.call(this,base2.state,base2.options);_this96.base=base2;_this96.pos=pos;_this96.node=node;return _this96;}_createClass(TreeIndentContext,[{key:"textAfter",get:function get(){return this.textAfterPos(this.pos);}},{key:"baseIndent",get:function get(){var line=this.state.doc.lineAt(this.node.from);for(;;){var atBreak=this.node.resolve(line.from);while(atBreak.parent&&atBreak.parent.from==atBreak.from){atBreak=atBreak.parent;}if(isParent(atBreak,this.node))break;line=this.state.doc.lineAt(atBreak.from);}return this.lineIndent(line.from);}},{key:"continue",value:function _continue(){var parent=this.node.parent;return parent?indentFrom(parent,this.pos,this.base):0;}}]);return TreeIndentContext;}(IndentContext);function isParent(parent,of){for(var cur2=of;cur2;cur2=cur2.parent){if(parent==cur2)return true;}return false;}function bracketedAligned(context){var tree=context.node;var openToken=tree.childAfter(tree.from),last=tree.lastChild;if(!openToken)return null;var sim=context.options.simulateBreak;var openLine=context.state.doc.lineAt(openToken.from);var lineEnd=sim==null||sim<=openLine.from?openLine.to:Math.min(openLine.to,sim);for(var pos=openToken.to;;){var next=tree.childAfter(pos);if(!next||next==last)return null;if(!next.type.isSkipped)return next.from<lineEnd?openToken:null;pos=next.to;}}function delimitedStrategy(context,align,units,closing2,closedAt){var after=context.textAfter,space=after.match(/^\s*/)[0].length;var closed=closing2&&after.slice(space,space+closing2.length)==closing2||closedAt==context.pos+space;var aligned=align?bracketedAligned(context):null;if(aligned)return closed?context.column(aligned.from):context.column(aligned.to);return context.baseIndent+(closed?0:context.unit*units);}var DontIndentBeyond=200;function indentOnInput(){return EditorState.transactionFilter.of(function(tr){if(!tr.docChanged||!tr.isUserEvent("input.type"))return tr;var rules=tr.startState.languageDataAt("indentOnInput",tr.startState.selection.main.head);if(!rules.length)return tr;var doc6=tr.newDoc,head=tr.newSelection.main.head,line=doc6.lineAt(head);if(head>line.from+DontIndentBeyond)return tr;var lineStart=doc6.sliceString(line.from,head);if(!rules.some(function(r){return r.test(lineStart);}))return tr;var state=tr.state,last=-1,changes=[];var _iterator164=_createForOfIteratorHelper(state.selection.ranges),_step164;try{for(_iterator164.s();!(_step164=_iterator164.n()).done;){var head2=_step164.value.head;var line2=state.doc.lineAt(head2);if(line2.from==last)continue;last=line2.from;var indent=getIndentation(state,line2.from);if(indent==null)continue;var cur2=/^\s*/.exec(line2.text)[0];var norm=indentString(state,indent);if(cur2!=norm)changes.push({from:line2.from,to:line2.from+cur2.length,insert:norm});}}catch(err){_iterator164.e(err);}finally{_iterator164.f();}return changes.length?[tr,{changes:changes,sequential:true}]:tr;});}var foldService=/* @__PURE__ */Facet.define();var foldNodeProp=/* @__PURE__ */new NodeProp();function syntaxFolding(state,start,end){var tree=syntaxTree(state);if(tree.length==0)return null;var inner=tree.resolveInner(end);var found=null;for(var cur2=inner;cur2;cur2=cur2.parent){if(cur2.to<=end||cur2.from>end)continue;if(found&&cur2.from<start)break;var prop=cur2.type.prop(foldNodeProp);if(prop){var value=prop(cur2,state);if(value&&value.from<=end&&value.from>=start&&value.to>end)found=value;}}return found;}function foldable(state,lineStart,lineEnd){var _iterator165=_createForOfIteratorHelper(state.facet(foldService)),_step165;try{for(_iterator165.s();!(_step165=_iterator165.n()).done;){var service=_step165.value;var result=service(state,lineStart,lineEnd);if(result)return result;}}catch(err){_iterator165.e(err);}finally{_iterator165.f();}return syntaxFolding(state,lineStart,lineEnd);}// ../node_modules/@codemirror/gutter/node_modules/@codemirror/view/dist/index.js
function getSelection3(root){var target;if(root.nodeType==11){target=root.getSelection?root:root.ownerDocument;}else{target=root;}return target.getSelection();}function contains3(dom,node){return node?dom.contains(node.nodeType!=1?node.parentNode:node):false;}function deepActiveElement3(){var elt=document.activeElement;while(elt&&elt.shadowRoot){elt=elt.shadowRoot.activeElement;}return elt;}function hasSelection3(dom,selection2){if(!selection2.anchorNode)return false;try{return contains3(dom,selection2.anchorNode);}catch(_){return false;}}function clientRectsFor3(dom){if(dom.nodeType==3)return textRange3(dom,0,dom.nodeValue.length).getClientRects();else if(dom.nodeType==1)return dom.getClientRects();else return[];}function isEquivalentPosition3(node,off,targetNode,targetOff){return targetNode?scanFor3(node,off,targetNode,targetOff,-1)||scanFor3(node,off,targetNode,targetOff,1):false;}function domIndex3(node){for(var index=0;;index++){node=node.previousSibling;if(!node)return index;}}function scanFor3(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return true;if(off==(dir<0?0:maxOffset3(node))){if(node.nodeName=="DIV")return false;var parent=node.parentNode;if(!parent||parent.nodeType!=1)return false;off=domIndex3(node)+(dir<0?0:1);node=parent;}else if(node.nodeType==1){node=node.childNodes[off+(dir<0?-1:0)];if(node.nodeType==1&&node.contentEditable=="false")return false;off=dir<0?maxOffset3(node):0;}else{return false;}}}function maxOffset3(node){return node.nodeType==3?node.nodeValue.length:node.childNodes.length;}var Rect03={left:0,right:0,top:0,bottom:0};function flattenRect3(rect,left){var x=left?rect.left:rect.right;return{left:x,right:x,top:rect.top,bottom:rect.bottom};}function windowRect3(win){return{left:0,right:win.innerWidth,top:0,bottom:win.innerHeight};}function scrollRectIntoView3(dom,rect,side,x,y,xMargin,yMargin,ltr){var doc6=dom.ownerDocument,win=doc6.defaultView;for(var cur2=dom;cur2;){if(cur2.nodeType==1){var bounding=void 0,top2=cur2==doc6.body;if(top2){bounding=windowRect3(win);}else{if(cur2.scrollHeight<=cur2.clientHeight&&cur2.scrollWidth<=cur2.clientWidth){cur2=cur2.parentNode;continue;}var rect2=cur2.getBoundingClientRect();bounding={left:rect2.left,right:rect2.left+cur2.clientWidth,top:rect2.top,bottom:rect2.top+cur2.clientHeight};}var moveX=0,moveY=0;if(y=="nearest"){if(rect.top<bounding.top){moveY=-(bounding.top-rect.top+yMargin);if(side>0&&rect.bottom>bounding.bottom+moveY)moveY=rect.bottom-bounding.bottom+moveY+yMargin;}else if(rect.bottom>bounding.bottom){moveY=rect.bottom-bounding.bottom+yMargin;if(side<0&&rect.top-moveY<bounding.top)moveY=-(bounding.top+moveY-rect.top+yMargin);}}else{var rectHeight=rect.bottom-rect.top,boundingHeight=bounding.bottom-bounding.top;var targetTop=y=="center"&&rectHeight<=boundingHeight?rect.top+rectHeight/2-boundingHeight/2:y=="start"||y=="center"&&side<0?rect.top-yMargin:rect.bottom-boundingHeight+yMargin;moveY=targetTop-bounding.top;}if(x=="nearest"){if(rect.left<bounding.left){moveX=-(bounding.left-rect.left+xMargin);if(side>0&&rect.right>bounding.right+moveX)moveX=rect.right-bounding.right+moveX+xMargin;}else if(rect.right>bounding.right){moveX=rect.right-bounding.right+xMargin;if(side<0&&rect.left<bounding.left+moveX)moveX=-(bounding.left+moveX-rect.left+xMargin);}}else{var targetLeft=x=="center"?rect.left+(rect.right-rect.left)/2-(bounding.right-bounding.left)/2:x=="start"==ltr?rect.left-xMargin:rect.right-(bounding.right-bounding.left)+xMargin;moveX=targetLeft-bounding.left;}if(moveX||moveY){if(top2){win.scrollBy(moveX,moveY);}else{if(moveY){var start=cur2.scrollTop;cur2.scrollTop+=moveY;moveY=cur2.scrollTop-start;}if(moveX){var _start7=cur2.scrollLeft;cur2.scrollLeft+=moveX;moveX=cur2.scrollLeft-_start7;}rect={left:rect.left-moveX,top:rect.top-moveY,right:rect.right-moveX,bottom:rect.bottom-moveY};}}if(top2)break;cur2=cur2.assignedSlot||cur2.parentNode;x=y="nearest";}else if(cur2.nodeType==11){cur2=cur2.host;}else{break;}}}var DOMSelectionState2=/*#__PURE__*/function(){function DOMSelectionState2(){_classCallCheck(this,DOMSelectionState2);this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0;}_createClass(DOMSelectionState2,[{key:"eq",value:function eq(domSel){return this.anchorNode==domSel.anchorNode&&this.anchorOffset==domSel.anchorOffset&&this.focusNode==domSel.focusNode&&this.focusOffset==domSel.focusOffset;}},{key:"setRange",value:function setRange(range){this.set(range.anchorNode,range.anchorOffset,range.focusNode,range.focusOffset);}},{key:"set",value:function set(anchorNode,anchorOffset,focusNode,focusOffset){this.anchorNode=anchorNode;this.anchorOffset=anchorOffset;this.focusNode=focusNode;this.focusOffset=focusOffset;}}]);return DOMSelectionState2;}();var preventScrollSupported3=null;function focusPreventScroll3(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported3)return dom.focus(preventScrollSupported3);var stack=[];for(var cur2=dom;cur2;cur2=cur2.parentNode){stack.push(cur2,cur2.scrollTop,cur2.scrollLeft);if(cur2==cur2.ownerDocument)break;}dom.focus(preventScrollSupported3==null?Object.defineProperties({},{preventScroll:{get:function get(){preventScrollSupported3={preventScroll:true};return true;},configurable:true,enumerable:true}}):void 0);if(!preventScrollSupported3){preventScrollSupported3=false;for(var _i156=0;_i156<stack.length;){var elt=stack[_i156++],top2=stack[_i156++],left=stack[_i156++];if(elt.scrollTop!=top2)elt.scrollTop=top2;if(elt.scrollLeft!=left)elt.scrollLeft=left;}}}var scratchRange3;function textRange3(node,from){var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:from;var range=scratchRange3||(scratchRange3=document.createRange());range.setEnd(node,to);range.setStart(node,from);return range;}function dispatchKey3(elt,name2,code){var options={key:name2,code:name2,keyCode:code,which:code,cancelable:true};var down=new KeyboardEvent("keydown",options);down.synthetic=true;elt.dispatchEvent(down);var up=new KeyboardEvent("keyup",options);up.synthetic=true;elt.dispatchEvent(up);return down.defaultPrevented||up.defaultPrevented;}function getRoot3(node){while(node){if(node&&(node.nodeType==9||node.nodeType==11&&node.host))return node;node=node.assignedSlot||node.parentNode;}return null;}function clearAttributes2(node){while(node.attributes.length){node.removeAttributeNode(node.attributes[0]);}}var DOMPos3=/*#__PURE__*/function(){function DOMPos3(node,offset){var precise=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_classCallCheck(this,DOMPos3);this.node=node;this.offset=offset;this.precise=precise;}_createClass(DOMPos3,null,[{key:"before",value:function before(dom,precise){return new DOMPos3(dom.parentNode,domIndex3(dom),precise);}},{key:"after",value:function after(dom,precise){return new DOMPos3(dom.parentNode,domIndex3(dom)+1,precise);}}]);return DOMPos3;}();var noChildren2=[];var ContentView3=/*#__PURE__*/function(){function ContentView3(){_classCallCheck(this,ContentView3);this.parent=null;this.dom=null;this.dirty=2;}_createClass(ContentView3,[{key:"editorView",get:function get(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"posAtStart",get:function get(){return this.parent?this.parent.posBefore(this):0;}},{key:"posAtEnd",get:function get(){return this.posAtStart+this.length;}},{key:"posBefore",value:function posBefore(view){var pos=this.posAtStart;var _iterator166=_createForOfIteratorHelper(this.children),_step166;try{for(_iterator166.s();!(_step166=_iterator166.n()).done;){var child=_step166.value;if(child==view)return pos;pos+=child.length+child.breakAfter;}}catch(err){_iterator166.e(err);}finally{_iterator166.f();}throw new RangeError("Invalid child in posBefore");}},{key:"posAfter",value:function posAfter(view){return this.posBefore(view)+view.length;}},{key:"coordsAt",value:function coordsAt(_pos,_side){return null;}},{key:"sync",value:function sync(track){if(this.dirty&2){var parent=this.dom;var pos=parent.firstChild;var _iterator167=_createForOfIteratorHelper(this.children),_step167;try{for(_iterator167.s();!(_step167=_iterator167.n()).done;){var child=_step167.value;if(child.dirty){if(!child.dom&&pos){var contentView=ContentView3.get(pos);if(!contentView||!contentView.parent&&contentView.constructor==child.constructor)child.reuseDOM(pos);}child.sync(track);child.dirty=0;}if(track&&!track.written&&track.node==parent&&pos!=child.dom)track.written=true;if(child.dom.parentNode==parent){while(pos&&pos!=child.dom){pos=rm3(pos);}pos=child.dom.nextSibling;}else{parent.insertBefore(child.dom,pos);}}}catch(err){_iterator167.e(err);}finally{_iterator167.f();}if(pos&&track&&track.node==parent)track.written=true;while(pos){pos=rm3(pos);}}else if(this.dirty&1){var _iterator168=_createForOfIteratorHelper(this.children),_step168;try{for(_iterator168.s();!(_step168=_iterator168.n()).done;){var _child3=_step168.value;if(_child3.dirty){_child3.sync(track);_child3.dirty=0;}}}catch(err){_iterator168.e(err);}finally{_iterator168.f();}}}},{key:"reuseDOM",value:function reuseDOM(_dom){}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){var after;if(node==this.dom){after=this.dom.childNodes[offset];}else{var bias=maxOffset3(node)==0?0:offset==0?-1:1;for(;;){var parent=node.parentNode;if(parent==this.dom)break;if(bias==0&&parent.firstChild!=parent.lastChild){if(node==parent.firstChild)bias=-1;else bias=1;}node=parent;}if(bias<0)after=node;else after=node.nextSibling;}if(after==this.dom.firstChild)return 0;while(after&&!ContentView3.get(after)){after=after.nextSibling;}if(!after)return this.length;for(var _i157=0,pos=0;;_i157++){var child=this.children[_i157];if(child.dom==after)return pos;pos+=child.length+child.breakAfter;}}},{key:"domBoundsAround",value:function domBoundsAround(from,to){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var fromI=-1,fromStart=-1,toI=-1,toEnd=-1;for(var _i158=0,pos=offset,prevEnd=offset;_i158<this.children.length;_i158++){var child=this.children[_i158],end=pos+child.length;if(pos<from&&end>to)return child.domBoundsAround(from,to,pos);if(end>=from&&fromI==-1){fromI=_i158;fromStart=pos;}if(pos>to&&child.dom.parentNode==this.dom){toI=_i158;toEnd=prevEnd;break;}prevEnd=end;pos=end+child.breakAfter;}return{from:fromStart,to:toEnd<0?offset+this.length:toEnd,startDOM:(fromI?this.children[fromI-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:toI<this.children.length&&toI>=0?this.children[toI].dom:null};}},{key:"markDirty",value:function markDirty(){var andParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.dirty|=2;this.markParentsDirty(andParent);}},{key:"markParentsDirty",value:function markParentsDirty(childList){for(var parent=this.parent;parent;parent=parent.parent){if(childList)parent.dirty|=2;if(parent.dirty&1)return;parent.dirty|=1;childList=false;}}},{key:"setParent",value:function setParent(parent){if(this.parent!=parent){this.parent=parent;if(this.dirty)this.markParentsDirty(true);}}},{key:"setDOM",value:function setDOM(dom){if(this.dom)this.dom.cmView=null;this.dom=dom;dom.cmView=this;}},{key:"rootView",get:function get(){for(var v=this;;){var parent=v.parent;if(!parent)return v;v=parent;}}},{key:"replaceChildren",value:function replaceChildren(from,to){var _this$children3;var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:noChildren2;this.markDirty();for(var _i159=from;_i159<to;_i159++){var child=this.children[_i159];if(child.parent==this)child.destroy();}(_this$children3=this.children).splice.apply(_this$children3,[from,to-from].concat(_toConsumableArray(children)));for(var _i160=0;_i160<children.length;_i160++){children[_i160].setParent(this);}}},{key:"ignoreMutation",value:function ignoreMutation(_rec){return false;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return false;}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;return new ChildCursor3(this.children,pos,this.children.length);}},{key:"childPos",value:function childPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return this.childCursor().findPos(pos,bias);}},{key:"toString",value:function toString(){var name2=this.constructor.name.replace("View","");return name2+(this.children.length?"("+this.children.join()+")":this.length?"["+(name2=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"");}},{key:"isEditable",get:function get(){return true;}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){return false;}},{key:"become",value:function become(other){return false;}},{key:"getSide",value:function getSide(){return 0;}},{key:"destroy",value:function destroy(){this.parent=null;}}],[{key:"get",value:function get(node){return node.cmView;}}]);return ContentView3;}();ContentView3.prototype.breakAfter=0;function rm3(dom){var next=dom.nextSibling;dom.parentNode.removeChild(dom);return next;}var ChildCursor3=/*#__PURE__*/function(){function ChildCursor3(children,pos,i){_classCallCheck(this,ChildCursor3);this.children=children;this.pos=pos;this.i=i;this.off=0;}_createClass(ChildCursor3,[{key:"findPos",value:function findPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;for(;;){if(pos>this.pos||pos==this.pos&&(bias>0||this.i==0||this.children[this.i-1].breakAfter)){this.off=pos-this.pos;return this;}var next=this.children[--this.i];this.pos-=next.length+next.breakAfter;}}}]);return ChildCursor3;}();function replaceRange2(parent,fromI,fromOff,toI,toOff,insert2,breakAtStart,openStart,openEnd){var children=parent.children;var before=children.length?children[fromI]:null;var last=insert2.length?insert2[insert2.length-1]:null;var breakAtEnd=last?last.breakAfter:breakAtStart;if(fromI==toI&&before&&!breakAtStart&&!breakAtEnd&&insert2.length<2&&before.merge(fromOff,toOff,insert2.length?last:null,fromOff==0,openStart,openEnd))return;if(toI<children.length){var after=children[toI];if(after&&toOff<after.length){if(fromI==toI){after=after.split(toOff);toOff=0;}if(!breakAtEnd&&last&&after.merge(0,toOff,last,true,0,openEnd)){insert2[insert2.length-1]=after;}else{if(toOff)after.merge(0,toOff,null,false,0,openEnd);insert2.push(after);}}else if(after===null||after===void 0?void 0:after.breakAfter){if(last)last.breakAfter=1;else breakAtStart=1;}toI++;}if(before){before.breakAfter=breakAtStart;if(fromOff>0){if(!breakAtStart&&insert2.length&&before.merge(fromOff,before.length,insert2[0],false,openStart,0)){before.breakAfter=insert2.shift().breakAfter;}else if(fromOff<before.length||before.children.length&&before.children[before.children.length-1].length==0){before.merge(fromOff,before.length,null,false,openStart,0);}fromI++;}}while(fromI<toI&&insert2.length){if(children[toI-1].become(insert2[insert2.length-1])){toI--;insert2.pop();openEnd=insert2.length?0:openStart;}else if(children[fromI].become(insert2[0])){fromI++;insert2.shift();openStart=insert2.length?0:openEnd;}else{break;}}if(!insert2.length&&fromI&&toI<children.length&&!children[fromI-1].breakAfter&&children[toI].merge(0,0,children[fromI-1],false,openStart,openEnd))fromI--;if(fromI<toI||insert2.length)parent.replaceChildren(fromI,toI,insert2);}function mergeChildrenInto2(parent,from,to,insert2,openStart,openEnd){var cur2=parent.childCursor();var _cur2$findPos5=cur2.findPos(to,1),toI=_cur2$findPos5.i,toOff=_cur2$findPos5.off;var _cur2$findPos6=cur2.findPos(from,-1),fromI=_cur2$findPos6.i,fromOff=_cur2$findPos6.off;var dLen=from-to;var _iterator169=_createForOfIteratorHelper(insert2),_step169;try{for(_iterator169.s();!(_step169=_iterator169.n()).done;){var view=_step169.value;dLen+=view.length;}}catch(err){_iterator169.e(err);}finally{_iterator169.f();}parent.length+=dLen;replaceRange2(parent,fromI,fromOff,toI,toOff,insert2,0,openStart,openEnd);}var _ref32=typeof navigator!="undefined"?[navigator,document]:[{userAgent:"",vendor:"",platform:""},{documentElement:{style:{}}}],_ref33=_slicedToArray(_ref32,2),nav3=_ref33[0],doc3=_ref33[1];var ie_edge3=/* @__PURE__ */ /Edge\/(\d+)/.exec(nav3.userAgent);var ie_upto103=/* @__PURE__ */ /MSIE \d/.test(nav3.userAgent);var ie_11up3=/* @__PURE__ */ /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav3.userAgent);var ie4=!!(ie_upto103||ie_11up3||ie_edge3);var gecko4=!ie4&&/* @__PURE__ */ /gecko\/(\d+)/i.test(nav3.userAgent);var chrome4=!ie4&&/* @__PURE__ */ /Chrome\/(\d+)/.exec(nav3.userAgent);var webkit3=("webkitFontSmoothing"in doc3.documentElement.style);var safari4=!ie4&&/* @__PURE__ */ /Apple Computer/.test(nav3.vendor);var ios3=safari4&&(/* @__PURE__ */ /Mobile\/\w+/.test(nav3.userAgent)||nav3.maxTouchPoints>2);var browser3={mac:ios3||/* @__PURE__ */ /Mac/.test(nav3.platform),windows:/* @__PURE__ */ /Win/.test(nav3.platform),linux:/* @__PURE__ */ /Linux|X11/.test(nav3.platform),ie:ie4,ie_version:ie_upto103?doc3.documentMode||6:ie_11up3?+ie_11up3[1]:ie_edge3?+ie_edge3[1]:0,gecko:gecko4,gecko_version:gecko4?+(/* @__PURE__ */ /Firefox\/(\d+)/.exec(nav3.userAgent)||[0,0])[1]:0,chrome:!!chrome4,chrome_version:chrome4?+chrome4[1]:0,ios:ios3,android:/* @__PURE__ */ /Android\b/.test(nav3.userAgent),webkit:webkit3,safari:safari4,webkit_version:webkit3?+(/* @__PURE__ */ /\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc3.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var MaxJoinLen3=256;var TextView3=/*#__PURE__*/function(_ContentView12){_inherits(TextView3,_ContentView12);var _super49=_createSuper(TextView3);function TextView3(text){var _this97;_classCallCheck(this,TextView3);_this97=_super49.call(this);_this97.text=text;return _this97;}_createClass(TextView3,[{key:"length",get:function get(){return this.text.length;}},{key:"createDOM",value:function createDOM(textDOM){this.setDOM(textDOM||document.createTextNode(this.text));}},{key:"sync",value:function sync(track){if(!this.dom)this.createDOM();if(this.dom.nodeValue!=this.text){if(track&&track.node==this.dom)track.written=true;this.dom.nodeValue=this.text;}}},{key:"reuseDOM",value:function reuseDOM(dom){if(dom.nodeType==3)this.createDOM(dom);}},{key:"merge",value:function merge(from,to,source){if(source&&(!(source instanceof TextView3)||this.length-(to-from)+source.length>MaxJoinLen3))return false;this.text=this.text.slice(0,from)+(source?source.text:"")+this.text.slice(to);this.markDirty();return true;}},{key:"split",value:function split(from){var result=new TextView3(this.text.slice(from));this.text=this.text.slice(0,from);this.markDirty();return result;}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return node==this.dom?offset:offset?this.text.length:0;}},{key:"domAtPos",value:function domAtPos(pos){return new DOMPos3(this.dom,pos);}},{key:"domBoundsAround",value:function domBoundsAround(_from,_to,offset){return{from:offset,to:offset+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling};}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords3(this.dom,pos,side);}}]);return TextView3;}(ContentView3);var MarkView3=/*#__PURE__*/function(_ContentView13){_inherits(MarkView3,_ContentView13);var _super50=_createSuper(MarkView3);function MarkView3(mark){var _this98;var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,MarkView3);_this98=_super50.call(this);_this98.mark=mark;_this98.children=children;_this98.length=length;var _iterator170=_createForOfIteratorHelper(children),_step170;try{for(_iterator170.s();!(_step170=_iterator170.n()).done;){var ch=_step170.value;ch.setParent(_assertThisInitialized(_this98));}}catch(err){_iterator170.e(err);}finally{_iterator170.f();}return _this98;}_createClass(MarkView3,[{key:"setAttrs",value:function setAttrs(dom){clearAttributes2(dom);if(this.mark["class"])dom.className=this.mark["class"];if(this.mark.attrs)for(var name2 in this.mark.attrs){dom.setAttribute(name2,this.mark.attrs[name2]);}return dom;}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName==this.mark.tagName.toUpperCase()){this.setDOM(node);this.dirty|=4|2;}}},{key:"sync",value:function sync(track){if(!this.dom)this.setDOM(this.setAttrs(document.createElement(this.mark.tagName)));else if(this.dirty&4)this.setAttrs(this.dom);_get(_getPrototypeOf(MarkView3.prototype),"sync",this).call(this,track);}},{key:"merge",value:function merge(from,to,source,_hasStart,openStart,openEnd){if(source&&(!(source instanceof MarkView3&&source.mark.eq(this.mark))||from&&openStart<=0||to<this.length&&openEnd<=0))return false;mergeChildrenInto2(this,from,to,source?source.children:[],openStart-1,openEnd-1);this.markDirty();return true;}},{key:"split",value:function split(from){var result=[],off=0,detachFrom=-1,i=0;var _iterator171=_createForOfIteratorHelper(this.children),_step171;try{for(_iterator171.s();!(_step171=_iterator171.n()).done;){var elt=_step171.value;var end=off+elt.length;if(end>from)result.push(off<from?elt.split(from-off):elt);if(detachFrom<0&&off>=from)detachFrom=i;off=end;i++;}}catch(err){_iterator171.e(err);}finally{_iterator171.f();}var length=this.length-from;this.length=from;if(detachFrom>-1){this.children.length=detachFrom;this.markDirty();}return new MarkView3(this.mark,result,length);}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos3(this.dom,this.children,pos);}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren3(this,pos,side);}}]);return MarkView3;}(ContentView3);function textCoords3(text,pos,side){var length=text.nodeValue.length;if(pos>length)pos=length;var from=pos,to=pos,flatten2=0;if(pos==0&&side<0||pos==length&&side>=0){if(!(browser3.chrome||browser3.gecko)){if(pos){from--;flatten2=1;}else{to++;flatten2=-1;}}}else{if(side<0)from--;else to++;}var rects=textRange3(text,from,to).getClientRects();if(!rects.length)return Rect03;var rect=rects[(flatten2?flatten2<0:side>=0)?0:rects.length-1];if(browser3.safari&&!flatten2&&rect.width==0)rect=Array.prototype.find.call(rects,function(r){return r.width;})||rect;return flatten2?flattenRect3(rect,flatten2<0):rect||null;}var WidgetView3=/*#__PURE__*/function(_ContentView14){_inherits(WidgetView3,_ContentView14);var _super51=_createSuper(WidgetView3);function WidgetView3(widget,length,side){var _this99;_classCallCheck(this,WidgetView3);_this99=_super51.call(this);_this99.widget=widget;_this99.length=length;_this99.side=side;return _this99;}_createClass(WidgetView3,[{key:"split",value:function split(from){var result=WidgetView3.create(this.widget,this.length-from,this.side);this.length-=from;return result;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"getSide",value:function getSide(){return this.side;}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source&&(!(source instanceof WidgetView3)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"become",value:function become(other){if(other.length==this.length&&other instanceof WidgetView3&&other.side==this.side){if(this.widget.constructor==other.widget.constructor){if(!this.widget.eq(other.widget))this.markDirty(true);this.widget=other.widget;return true;}}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}},{key:"overrideDOMText",get:function get(){if(this.length==0)return Text.empty;var top2=this;while(top2.parent){top2=top2.parent;}var view=top2.editorView,text=view&&view.state.doc,start=this.posAtStart;return text?text.slice(start,start+this.length):Text.empty;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos3.before(this.dom):DOMPos3.after(this.dom,pos==this.length);}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){var rects=this.dom.getClientRects(),rect=null;if(!rects.length)return Rect03;for(var _i161=pos>0?rects.length-1:0;;_i161+=pos>0?-1:1){rect=rects[_i161];if(pos>0?_i161==0:_i161==rects.length-1||rect.top<rect.bottom)break;}return pos==0&&side>0||pos==this.length&&side<=0?rect:flattenRect3(rect,pos==0);}},{key:"isEditable",get:function get(){return false;}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(WidgetView3.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom);}}],[{key:"create",value:function create(widget,length,side){return new(widget.customView||WidgetView3)(widget,length,side);}}]);return WidgetView3;}(ContentView3);var CompositionView3=/*#__PURE__*/function(_WidgetView3){_inherits(CompositionView3,_WidgetView3);var _super52=_createSuper(CompositionView3);function CompositionView3(){_classCallCheck(this,CompositionView3);return _super52.apply(this,arguments);}_createClass(CompositionView3,[{key:"domAtPos",value:function domAtPos(pos){return new DOMPos3(this.widget.text,pos);}},{key:"sync",value:function sync(){this.setDOM(this.widget.toDOM());}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return!offset?0:node.nodeType==3?Math.min(offset,this.length):this.length;}},{key:"ignoreMutation",value:function ignoreMutation(){return false;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords3(this.widget.text,pos,side);}},{key:"isEditable",get:function get(){return true;}}]);return CompositionView3;}(WidgetView3);var ZeroWidthSpace2=browser3.android?"\u200B\u200B":"\u200B";var WidgetBufferView3=/*#__PURE__*/function(_ContentView15){_inherits(WidgetBufferView3,_ContentView15);var _super53=_createSuper(WidgetBufferView3);function WidgetBufferView3(side){var _this100;_classCallCheck(this,WidgetBufferView3);_this100=_super53.call(this);_this100.side=side;return _this100;}_createClass(WidgetBufferView3,[{key:"length",get:function get(){return 0;}},{key:"merge",value:function merge(){return false;}},{key:"become",value:function become(other){return other instanceof WidgetBufferView3&&other.side==this.side;}},{key:"split",value:function split(){return new WidgetBufferView3(this.side);}},{key:"sync",value:function sync(){if(!this.dom)this.setDOM(document.createTextNode(ZeroWidthSpace2));else if(this.dirty&&this.dom.nodeValue!=ZeroWidthSpace2)this.dom.nodeValue=ZeroWidthSpace2;}},{key:"getSide",value:function getSide(){return this.side;}},{key:"domAtPos",value:function domAtPos(pos){return DOMPos3.before(this.dom);}},{key:"localPosFromDOM",value:function localPosFromDOM(){return 0;}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos){var rects=clientRectsFor3(this.dom);return rects[rects.length-1]||null;}},{key:"overrideDOMText",get:function get(){return Text.of([this.dom.nodeValue.replace(/\u200b/g,"")]);}}]);return WidgetBufferView3;}(ContentView3);TextView3.prototype.children=WidgetView3.prototype.children=WidgetBufferView3.prototype.children=noChildren2;function inlineDOMAtPos3(dom,children,pos){var i=0;for(var off=0;i<children.length;i++){var child=children[i],end=off+child.length;if(end==off&&child.getSide()<=0)continue;if(pos>off&&pos<end&&child.dom.parentNode==dom)return child.domAtPos(pos-off);if(pos<=off)break;off=end;}for(;i>0;i--){var before=children[i-1].dom;if(before.parentNode==dom)return DOMPos3.after(before);}return new DOMPos3(dom,0);}function joinInlineInto3(parent,view,open){var last,children=parent.children;if(open>0&&view instanceof MarkView3&&children.length&&(last=children[children.length-1])instanceof MarkView3&&last.mark.eq(view.mark)){joinInlineInto3(last,view.children[0],open-1);}else{children.push(view);view.setParent(parent);}parent.length+=view.length;}function coordsInChildren3(view,pos,side){for(var off=0,_i162=0;_i162<view.children.length;_i162++){var child=view.children[_i162],end=off+child.length,next=void 0;if((side<=0||end==view.length||child.getSide()>0?end>=pos:end>pos)&&(pos<end||_i162+1==view.children.length||(next=view.children[_i162+1]).length||next.getSide()>0)){var flatten2=0;if(end==off){if(child.getSide()<=0)continue;flatten2=side=-child.getSide();}var rect=child.coordsAt(pos-off,side);return flatten2&&rect?flattenRect3(rect,side<0):rect;}off=end;}var last=view.dom.lastChild;if(!last)return view.dom.getBoundingClientRect();var rects=clientRectsFor3(last);return rects[rects.length-1]||null;}function combineAttrs3(source,target){for(var name2 in source){if(name2=="class"&&target["class"])target["class"]+=" "+source["class"];else if(name2=="style"&&target.style)target.style+=";"+source.style;else target[name2]=source[name2];}return target;}function attrsEq3(a,b){if(a==b)return true;if(!a||!b)return false;var keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length!=keysB.length)return false;for(var _i163=0,_keysA3=keysA;_i163<_keysA3.length;_i163++){var key=_keysA3[_i163];if(keysB.indexOf(key)==-1||a[key]!==b[key])return false;}return true;}function updateAttrs3(dom,prev,attrs){if(prev){for(var name2 in prev){if(!(attrs&&name2 in attrs))dom.removeAttribute(name2);}}if(attrs){for(var _name3 in attrs){if(!(prev&&prev[_name3]==attrs[_name3]))dom.setAttribute(_name3,attrs[_name3]);}}}var WidgetType3=/*#__PURE__*/function(){function WidgetType3(){_classCallCheck(this,WidgetType3);}_createClass(WidgetType3,[{key:"eq",value:function eq(_widget){return false;}},{key:"updateDOM",value:function updateDOM(_dom){return false;}},{key:"compare",value:function compare(other){return this==other||this.constructor==other.constructor&&this.eq(other);}},{key:"estimatedHeight",get:function get(){return-1;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return true;}},{key:"customView",get:function get(){return null;}},{key:"destroy",value:function destroy(_dom){}}]);return WidgetType3;}();var BlockType3=/* @__PURE__ */function(BlockType6){BlockType6[BlockType6["Text"]=0]="Text";BlockType6[BlockType6["WidgetBefore"]=1]="WidgetBefore";BlockType6[BlockType6["WidgetAfter"]=2]="WidgetAfter";BlockType6[BlockType6["WidgetRange"]=3]="WidgetRange";return BlockType6;}(BlockType3||(BlockType3={}));var Decoration3=/*#__PURE__*/function(_RangeValue3){_inherits(Decoration3,_RangeValue3);var _super54=_createSuper(Decoration3);function Decoration3(startSide,endSide,widget,spec){var _this101;_classCallCheck(this,Decoration3);_this101=_super54.call(this);_this101.startSide=startSide;_this101.endSide=endSide;_this101.widget=widget;_this101.spec=spec;return _this101;}_createClass(Decoration3,[{key:"heightRelevant",get:function get(){return false;}},{key:"hasHeight",value:function hasHeight(){return this.widget?this.widget.estimatedHeight>-1:false;}}],[{key:"mark",value:function mark(spec){return new MarkDecoration3(spec);}},{key:"widget",value:function widget(spec){var side=spec.side||0,block=!!spec.block;side+=block?side>0?3e8:-4e8:side>0?1e8:-1e8;return new PointDecoration3(spec,side,side,block,spec.widget||null,false);}},{key:"replace",value:function replace(spec){var block=!!spec.block;var _getInclusive5=getInclusive3(spec,block),start=_getInclusive5.start,end=_getInclusive5.end;var startSide=block?start?-3e8:-1:4e8;var endSide=block?end?2e8:1:-5e8;return new PointDecoration3(spec,startSide,endSide,block,spec.widget||null,true);}},{key:"line",value:function line(spec){return new LineDecoration3(spec);}},{key:"set",value:function set(of){var sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return RangeSet.of(of,sort);}}]);return Decoration3;}(RangeValue);Decoration3.none=RangeSet.empty;var MarkDecoration3=/*#__PURE__*/function(_Decoration7){_inherits(MarkDecoration3,_Decoration7);var _super55=_createSuper(MarkDecoration3);function MarkDecoration3(spec){var _this102;_classCallCheck(this,MarkDecoration3);var _getInclusive6=getInclusive3(spec),start=_getInclusive6.start,end=_getInclusive6.end;_this102=_super55.call(this,start?-1:4e8,end?1:-5e8,null,spec);_this102.tagName=spec.tagName||"span";_this102["class"]=spec["class"]||"";_this102.attrs=spec.attributes||null;return _this102;}_createClass(MarkDecoration3,[{key:"eq",value:function eq(other){return this==other||other instanceof MarkDecoration3&&this.tagName==other.tagName&&this["class"]==other["class"]&&attrsEq3(this.attrs,other.attrs);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(from>=to)throw new RangeError("Mark decorations may not be empty");return _get(_getPrototypeOf(MarkDecoration3.prototype),"range",this).call(this,from,to);}}]);return MarkDecoration3;}(Decoration3);MarkDecoration3.prototype.point=false;var LineDecoration3=/*#__PURE__*/function(_Decoration8){_inherits(LineDecoration3,_Decoration8);var _super56=_createSuper(LineDecoration3);function LineDecoration3(spec){_classCallCheck(this,LineDecoration3);return _super56.call(this,-2e8,-2e8,null,spec);}_createClass(LineDecoration3,[{key:"eq",value:function eq(other){return other instanceof LineDecoration3&&attrsEq3(this.spec.attributes,other.spec.attributes);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(to!=from)throw new RangeError("Line decoration ranges must be zero-length");return _get(_getPrototypeOf(LineDecoration3.prototype),"range",this).call(this,from,to);}}]);return LineDecoration3;}(Decoration3);LineDecoration3.prototype.mapMode=MapMode.TrackBefore;LineDecoration3.prototype.point=true;var PointDecoration3=/*#__PURE__*/function(_Decoration9){_inherits(PointDecoration3,_Decoration9);var _super57=_createSuper(PointDecoration3);function PointDecoration3(spec,startSide,endSide,block,widget,isReplace){var _this103;_classCallCheck(this,PointDecoration3);_this103=_super57.call(this,startSide,endSide,widget,spec);_this103.block=block;_this103.isReplace=isReplace;_this103.mapMode=!block?MapMode.TrackDel:startSide<=0?MapMode.TrackBefore:MapMode.TrackAfter;return _this103;}_createClass(PointDecoration3,[{key:"type",get:function get(){return this.startSide<this.endSide?BlockType3.WidgetRange:this.startSide<=0?BlockType3.WidgetBefore:BlockType3.WidgetAfter;}},{key:"heightRelevant",get:function get(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5;}},{key:"eq",value:function eq(other){return other instanceof PointDecoration3&&widgetsEq3(this.widget,other.widget)&&this.block==other.block&&this.startSide==other.startSide&&this.endSide==other.endSide;}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(this.isReplace&&(from>to||from==to&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&to!=from)throw new RangeError("Widget decorations can only have zero-length ranges");return _get(_getPrototypeOf(PointDecoration3.prototype),"range",this).call(this,from,to);}}]);return PointDecoration3;}(Decoration3);PointDecoration3.prototype.point=true;function getInclusive3(spec){var block=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var start=spec.inclusiveStart,end=spec.inclusiveEnd;if(start==null)start=spec.inclusive;if(end==null)end=spec.inclusive;return{start:start!==null&&start!==void 0?start:block,end:end!==null&&end!==void 0?end:block};}function widgetsEq3(a,b){return a==b||!!(a&&b&&a.compare(b));}function addRange3(from,to,ranges){var margin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var last=ranges.length-1;if(last>=0&&ranges[last]+margin>=from)ranges[last]=Math.max(ranges[last],to);else ranges.push(from,to);}var LineView3=/*#__PURE__*/function(_ContentView16){_inherits(LineView3,_ContentView16);var _super58=_createSuper(LineView3);function LineView3(){var _this104;_classCallCheck(this,LineView3);_this104=_super58.apply(this,arguments);_this104.children=[];_this104.length=0;_this104.prevAttrs=void 0;_this104.attrs=null;_this104.breakAfter=0;return _this104;}_createClass(LineView3,[{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source){if(!(source instanceof LineView3))return false;if(!this.dom)source.transferDOM(this);}if(hasStart)this.setDeco(source?source.attrs:null);mergeChildrenInto2(this,from,to,source?source.children:[],openStart,openEnd);return true;}},{key:"split",value:function split(at){var end=new LineView3();end.breakAfter=this.breakAfter;if(this.length==0)return end;var _this$childPos3=this.childPos(at),i=_this$childPos3.i,off=_this$childPos3.off;if(off){end.append(this.children[i].split(off),0);this.children[i].merge(off,this.children[i].length,null,false,0,0);i++;}for(var j=i;j<this.children.length;j++){end.append(this.children[j],0);}while(i>0&&this.children[i-1].length==0){this.children[--i].destroy();}this.children.length=i;this.markDirty();this.length=at;return end;}},{key:"transferDOM",value:function transferDOM(other){if(!this.dom)return;other.setDOM(this.dom);other.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs;this.prevAttrs=void 0;this.dom=null;}},{key:"setDeco",value:function setDeco(attrs){if(!attrsEq3(this.attrs,attrs)){if(this.dom){this.prevAttrs=this.attrs;this.markDirty();}this.attrs=attrs;}}},{key:"append",value:function append(child,openStart){joinInlineInto3(this,child,openStart);}},{key:"addLineDeco",value:function addLineDeco(deco){var attrs=deco.spec.attributes,cls=deco.spec["class"];if(attrs)this.attrs=combineAttrs3(attrs,this.attrs||{});if(cls)this.attrs=combineAttrs3({"class":cls},this.attrs||{});}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos3(this.dom,this.children,pos);}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName=="DIV"){this.setDOM(node);this.dirty|=4|2;}}},{key:"sync",value:function sync(track){var _a;if(!this.dom){this.setDOM(document.createElement("div"));this.dom.className="cm-line";this.prevAttrs=this.attrs?null:void 0;}else if(this.dirty&4){clearAttributes2(this.dom);this.dom.className="cm-line";this.prevAttrs=this.attrs?null:void 0;}if(this.prevAttrs!==void 0){updateAttrs3(this.dom,this.prevAttrs,this.attrs);this.dom.classList.add("cm-line");this.prevAttrs=void 0;}_get(_getPrototypeOf(LineView3.prototype),"sync",this).call(this,track);var last=this.dom.lastChild;while(last&&ContentView3.get(last)instanceof MarkView3){last=last.lastChild;}if(!last||last.nodeName!="BR"&&((_a=ContentView3.get(last))===null||_a===void 0?void 0:_a.isEditable)==false&&(!browser3.ios||!this.children.some(function(ch){return ch instanceof TextView3;}))){var hack=document.createElement("BR");hack.cmIgnore=true;this.dom.appendChild(hack);}}},{key:"measureTextSize",value:function measureTextSize(){if(this.children.length==0||this.length>20)return null;var totalWidth=0;var _iterator172=_createForOfIteratorHelper(this.children),_step172;try{for(_iterator172.s();!(_step172=_iterator172.n()).done;){var child=_step172.value;if(!(child instanceof TextView3))return null;var rects=clientRectsFor3(child.dom);if(rects.length!=1)return null;totalWidth+=rects[0].width;}}catch(err){_iterator172.e(err);}finally{_iterator172.f();}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:totalWidth/this.length};}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren3(this,pos,side);}},{key:"become",value:function become(_other){return false;}},{key:"type",get:function get(){return BlockType3.Text;}}],[{key:"find",value:function find(docView,pos){for(var _i164=0,off=0;_i164<docView.children.length;_i164++){var block=docView.children[_i164],end=off+block.length;if(end>=pos){if(block instanceof LineView3)return block;if(end>pos)break;}off=end+block.breakAfter;}return null;}}]);return LineView3;}(ContentView3);var BlockWidgetView3=/*#__PURE__*/function(_ContentView17){_inherits(BlockWidgetView3,_ContentView17);var _super59=_createSuper(BlockWidgetView3);function BlockWidgetView3(widget,length,type){var _this105;_classCallCheck(this,BlockWidgetView3);_this105=_super59.call(this);_this105.widget=widget;_this105.length=length;_this105.type=type;_this105.breakAfter=0;return _this105;}_createClass(BlockWidgetView3,[{key:"merge",value:function merge(from,to,source,_takeDeco,openStart,openEnd){if(source&&(!(source instanceof BlockWidgetView3)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos3.before(this.dom):DOMPos3.after(this.dom,pos==this.length);}},{key:"split",value:function split(at){var len=this.length-at;this.length=at;var end=new BlockWidgetView3(this.widget,len,this.type);end.breakAfter=this.breakAfter;return end;}},{key:"children",get:function get(){return noChildren2;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"overrideDOMText",get:function get(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty;}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"become",value:function become(other){if(other instanceof BlockWidgetView3&&other.type==this.type&&other.widget.constructor==this.widget.constructor){if(!other.widget.eq(this.widget))this.markDirty(true);this.widget=other.widget;this.length=other.length;this.breakAfter=other.breakAfter;return true;}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(BlockWidgetView3.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom);}}]);return BlockWidgetView3;}(ContentView3);var ContentBuilder3=/*#__PURE__*/function(){function ContentBuilder3(doc6,pos,end,disallowBlockEffectsBelow){_classCallCheck(this,ContentBuilder3);this.doc=doc6;this.pos=pos;this.end=end;this.disallowBlockEffectsBelow=disallowBlockEffectsBelow;this.content=[];this.curLine=null;this.breakAtStart=0;this.pendingBuffer=0;this.atCursorPos=true;this.openStart=-1;this.openEnd=-1;this.text="";this.textOff=0;this.cursor=doc6.iter();this.skip=pos;}_createClass(ContentBuilder3,[{key:"posCovered",value:function posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;var last=this.content[this.content.length-1];return!last.breakAfter&&!(last instanceof BlockWidgetView3&&last.type==BlockType3.WidgetBefore);}},{key:"getLine",value:function getLine(){if(!this.curLine){this.content.push(this.curLine=new LineView3());this.atCursorPos=true;}return this.curLine;}},{key:"flushBuffer",value:function flushBuffer(active){if(this.pendingBuffer){this.curLine.append(wrapMarks3(new WidgetBufferView3(-1),active),active.length);this.pendingBuffer=0;}}},{key:"addBlockWidget",value:function addBlockWidget(view){this.flushBuffer([]);this.curLine=null;this.content.push(view);}},{key:"finish",value:function finish(openEnd){if(!openEnd)this.flushBuffer([]);else this.pendingBuffer=0;if(!this.posCovered())this.getLine();}},{key:"buildText",value:function buildText(length,active,openStart){while(length>0){if(this.textOff==this.text.length){var _this$cursor$next4=this.cursor.next(this.skip),value=_this$cursor$next4.value,lineBreak=_this$cursor$next4.lineBreak,done=_this$cursor$next4.done;this.skip=0;if(done)throw new Error("Ran out of text content when drawing inline views");if(lineBreak){if(!this.posCovered())this.getLine();if(this.content.length)this.content[this.content.length-1].breakAfter=1;else this.breakAtStart=1;this.flushBuffer([]);this.curLine=null;length--;continue;}else{this.text=value;this.textOff=0;}}var take=Math.min(this.text.length-this.textOff,length,512);this.flushBuffer(active.slice(0,openStart));this.getLine().append(wrapMarks3(new TextView3(this.text.slice(this.textOff,this.textOff+take)),active),openStart);this.atCursorPos=true;this.textOff+=take;length-=take;openStart=0;}}},{key:"span",value:function span(from,to,active,openStart){this.buildText(to-from,active,openStart);this.pos=to;if(this.openStart<0)this.openStart=openStart;}},{key:"point",value:function point(from,to,deco,active,openStart){var len=to-from;if(deco instanceof PointDecoration3){if(deco.block){var type=deco.type;if(type==BlockType3.WidgetAfter&&!this.posCovered())this.getLine();this.addBlockWidget(new BlockWidgetView3(deco.widget||new NullWidget3("div"),len,type));}else{var view=WidgetView3.create(deco.widget||new NullWidget3("span"),len,deco.startSide);var cursorBefore=this.atCursorPos&&!view.isEditable&&openStart<=active.length&&(from<to||deco.startSide>0);var cursorAfter=!view.isEditable&&(from<to||deco.startSide<=0);var line=this.getLine();if(this.pendingBuffer==2&&!cursorBefore)this.pendingBuffer=0;this.flushBuffer(active);if(cursorBefore){line.append(wrapMarks3(new WidgetBufferView3(1),active),openStart);openStart=active.length+Math.max(0,openStart-active.length);}line.append(wrapMarks3(view,active),openStart);this.atCursorPos=cursorAfter;this.pendingBuffer=!cursorAfter?0:from<to?1:2;}}else if(this.doc.lineAt(this.pos).from==this.pos){this.getLine().addLineDeco(deco);}if(len){if(this.textOff+len<=this.text.length){this.textOff+=len;}else{this.skip+=len-(this.text.length-this.textOff);this.text="";this.textOff=0;}this.pos=to;}if(this.openStart<0)this.openStart=openStart;}},{key:"filterPoint",value:function filterPoint(from,to,value,index){if(index>=this.disallowBlockEffectsBelow||!(value instanceof PointDecoration3))return true;if(value.block)throw new RangeError("Block decorations may not be specified via plugins");return to<=this.doc.lineAt(this.pos).to;}}],[{key:"build",value:function build(text,from,to,decorations6,pluginDecorationLength){var builder=new ContentBuilder3(text,from,to,pluginDecorationLength);builder.openEnd=RangeSet.spans(decorations6,from,to,builder);if(builder.openStart<0)builder.openStart=builder.openEnd;builder.finish(builder.openEnd);return builder;}}]);return ContentBuilder3;}();function wrapMarks3(view,active){var _iterator173=_createForOfIteratorHelper(active),_step173;try{for(_iterator173.s();!(_step173=_iterator173.n()).done;){var mark=_step173.value;view=new MarkView3(mark,[view],view.length);}}catch(err){_iterator173.e(err);}finally{_iterator173.f();}return view;}var NullWidget3=/*#__PURE__*/function(_WidgetType11){_inherits(NullWidget3,_WidgetType11);var _super60=_createSuper(NullWidget3);function NullWidget3(tag){var _this106;_classCallCheck(this,NullWidget3);_this106=_super60.call(this);_this106.tag=tag;return _this106;}_createClass(NullWidget3,[{key:"eq",value:function eq(other){return other.tag==this.tag;}},{key:"toDOM",value:function toDOM(){return document.createElement(this.tag);}},{key:"updateDOM",value:function updateDOM(elt){return elt.nodeName.toLowerCase()==this.tag;}}]);return NullWidget3;}(WidgetType3);var none5=[];var clickAddsSelectionRange3=/* @__PURE__ */Facet.define();var dragMovesSelection$13=/* @__PURE__ */Facet.define();var mouseSelectionStyle3=/* @__PURE__ */Facet.define();var exceptionSink3=/* @__PURE__ */Facet.define();var updateListener3=/* @__PURE__ */Facet.define();var inputHandler3=/* @__PURE__ */Facet.define();var scrollTo3=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});var centerOn3=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});var ScrollTarget3=/*#__PURE__*/function(){function ScrollTarget3(range){var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"nearest";var x=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"nearest";var yMargin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;var xMargin=arguments.length>4&&arguments[4]!==undefined?arguments[4]:5;_classCallCheck(this,ScrollTarget3);this.range=range;this.y=y;this.x=x;this.yMargin=yMargin;this.xMargin=xMargin;}_createClass(ScrollTarget3,[{key:"map",value:function map(changes){return changes.empty?this:new ScrollTarget3(this.range.map(changes),this.y,this.x,this.yMargin,this.xMargin);}}]);return ScrollTarget3;}();var scrollIntoView2=/* @__PURE__ */StateEffect.define({map:function map(t2,ch){return t2.map(ch);}});function logException3(state,exception,context){var handler=state.facet(exceptionSink3);if(handler.length)handler[0](exception);else if(window.onerror)window.onerror(String(exception),context,void 0,void 0,exception);else if(context)console.error(context+":",exception);else console.error(exception);}var editable3=/* @__PURE__ */Facet.define({combine:function combine(values){return values.length?values[0]:true;}});var PluginFieldProvider3=/*#__PURE__*/_createClass(function PluginFieldProvider3(field,get){_classCallCheck(this,PluginFieldProvider3);this.field=field;this.get=get;});var PluginField3=/*#__PURE__*/function(){function PluginField3(){_classCallCheck(this,PluginField3);}_createClass(PluginField3,[{key:"from",value:function from(get){return new PluginFieldProvider3(this,get);}}],[{key:"define",value:function define(){return new PluginField3();}}]);return PluginField3;}();PluginField3.decorations=/* @__PURE__ */PluginField3.define();PluginField3.atomicRanges=/* @__PURE__ */PluginField3.define();PluginField3.scrollMargins=/* @__PURE__ */PluginField3.define();var nextPluginID3=0;var viewPlugin3=/* @__PURE__ */Facet.define();var ViewPlugin3=/*#__PURE__*/function(){function ViewPlugin3(id,create,fields){_classCallCheck(this,ViewPlugin3);this.id=id;this.create=create;this.fields=fields;this.extension=viewPlugin3.of(this);}_createClass(ViewPlugin3,null,[{key:"define",value:function define(create,spec){var _ref34=spec||{},eventHandlers=_ref34.eventHandlers,provide=_ref34.provide,decorations6=_ref34.decorations;var fields=[];if(provide){var _iterator174=_createForOfIteratorHelper(Array.isArray(provide)?provide:[provide]),_step174;try{for(_iterator174.s();!(_step174=_iterator174.n()).done;){var provider=_step174.value;fields.push(provider);}}catch(err){_iterator174.e(err);}finally{_iterator174.f();}}if(eventHandlers)fields.push(domEventHandlers3.from(function(value){return{plugin:value,handlers:eventHandlers};}));if(decorations6)fields.push(PluginField3.decorations.from(decorations6));return new ViewPlugin3(nextPluginID3++,create,fields);}},{key:"fromClass",value:function fromClass(cls,spec){return ViewPlugin3.define(function(view){return new cls(view);},spec);}}]);return ViewPlugin3;}();var domEventHandlers3=/* @__PURE__ */PluginField3.define();var PluginInstance3=/*#__PURE__*/function(){function PluginInstance3(spec){_classCallCheck(this,PluginInstance3);this.spec=spec;this.mustUpdate=null;this.value=null;}_createClass(PluginInstance3,[{key:"takeField",value:function takeField(type,target){if(this.spec){var _iterator175=_createForOfIteratorHelper(this.spec.fields),_step175;try{for(_iterator175.s();!(_step175=_iterator175.n()).done;){var _step175$value=_step175.value,field=_step175$value.field,get=_step175$value.get;if(field==type)target.push(get(this.value));}}catch(err){_iterator175.e(err);}finally{_iterator175.f();}}}},{key:"update",value:function update(view){if(!this.value){if(this.spec){try{this.value=this.spec.create(view);}catch(e){logException3(view.state,e,"CodeMirror plugin crashed");this.deactivate();}}}else if(this.mustUpdate){var update=this.mustUpdate;this.mustUpdate=null;if(this.value.update){try{this.value.update(update);}catch(e){logException3(update.state,e,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy();}catch(_){}this.deactivate();}}}return this;}},{key:"destroy",value:function destroy(view){var _a;if((_a=this.value)===null||_a===void 0?void 0:_a.destroy){try{this.value.destroy();}catch(e){logException3(view.state,e,"CodeMirror plugin crashed");}}}},{key:"deactivate",value:function deactivate(){this.spec=this.value=null;}}]);return PluginInstance3;}();var editorAttributes3=/* @__PURE__ */Facet.define();var contentAttributes3=/* @__PURE__ */Facet.define();var decorations3=/* @__PURE__ */Facet.define();var styleModule3=/* @__PURE__ */Facet.define();var ChangedRange3=/*#__PURE__*/function(){function ChangedRange3(fromA,toA,fromB,toB){_classCallCheck(this,ChangedRange3);this.fromA=fromA;this.toA=toA;this.fromB=fromB;this.toB=toB;}_createClass(ChangedRange3,[{key:"join",value:function join(other){return new ChangedRange3(Math.min(this.fromA,other.fromA),Math.max(this.toA,other.toA),Math.min(this.fromB,other.fromB),Math.max(this.toB,other.toB));}},{key:"addToSet",value:function addToSet(set){var i=set.length,me=this;for(;i>0;i--){var range=set[i-1];if(range.fromA>me.toA)continue;if(range.toA<me.fromA)break;me=me.join(range);set.splice(i-1,1);}set.splice(i,0,me);return set;}}],[{key:"extendWithRanges",value:function extendWithRanges(diff,ranges){if(ranges.length==0)return diff;var result=[];for(var dI=0,rI=0,posA=0,posB=0;;dI++){var next=dI==diff.length?null:diff[dI],off=posA-posB;var end=next?next.fromB:1e9;while(rI<ranges.length&&ranges[rI]<end){var from=ranges[rI],to=ranges[rI+1];var fromB=Math.max(posB,from),toB=Math.min(end,to);if(fromB<=toB)new ChangedRange3(fromB+off,toB+off,fromB,toB).addToSet(result);if(to>end)break;else rI+=2;}if(!next)return result;new ChangedRange3(next.fromA,next.toA,next.fromB,next.toB).addToSet(result);posA=next.toA;posB=next.toB;}}}]);return ChangedRange3;}();var ViewUpdate3=/*#__PURE__*/function(){function ViewUpdate3(view,state){var transactions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:none5;_classCallCheck(this,ViewUpdate3);this.view=view;this.state=state;this.transactions=transactions;this.flags=0;this.startState=view.state;this.changes=ChangeSet.empty(this.startState.doc.length);var _iterator176=_createForOfIteratorHelper(transactions),_step176;try{for(_iterator176.s();!(_step176=_iterator176.n()).done;){var tr=_step176.value;this.changes=this.changes.compose(tr.changes);}}catch(err){_iterator176.e(err);}finally{_iterator176.f();}var changedRanges=[];this.changes.iterChangedRanges(function(fromA,toA,fromB,toB){return changedRanges.push(new ChangedRange3(fromA,toA,fromB,toB));});this.changedRanges=changedRanges;var focus=view.hasFocus;if(focus!=view.inputState.notifiedFocused){view.inputState.notifiedFocused=focus;this.flags|=1;}}_createClass(ViewUpdate3,[{key:"viewportChanged",get:function get(){return(this.flags&4)>0;}},{key:"heightChanged",get:function get(){return(this.flags&2)>0;}},{key:"geometryChanged",get:function get(){return this.docChanged||(this.flags&(8|2))>0;}},{key:"focusChanged",get:function get(){return(this.flags&1)>0;}},{key:"docChanged",get:function get(){return!this.changes.empty;}},{key:"selectionSet",get:function get(){return this.transactions.some(function(tr){return tr.selection;});}},{key:"empty",get:function get(){return this.flags==0&&this.transactions.length==0;}}]);return ViewUpdate3;}();var Direction3=/* @__PURE__ */function(Direction6){Direction6[Direction6["LTR"]=0]="LTR";Direction6[Direction6["RTL"]=1]="RTL";return Direction6;}(Direction3||(Direction3={}));var LTR3=Direction3.LTR;var RTL3=Direction3.RTL;function dec3(str){var result=[];for(var _i165=0;_i165<str.length;_i165++){result.push(1<<+str[_i165]);}return result;}var LowTypes3=/* @__PURE__ */dec3("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");var ArabicTypes3=/* @__PURE__ */dec3("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");var Brackets3=/* @__PURE__ */Object.create(null);var BracketStack3=[];for(var _i166=0,_arr4=["()","[]","{}"];_i166<_arr4.length;_i166++){var _p5=_arr4[_i166];var _l5=/* @__PURE__ */_p5.charCodeAt(0),_r12=/* @__PURE__ */_p5.charCodeAt(1);Brackets3[_l5]=_r12;Brackets3[_r12]=-_l5;}function charType3(ch){return ch<=247?LowTypes3[ch]:1424<=ch&&ch<=1524?2:1536<=ch&&ch<=1785?ArabicTypes3[ch-1536]:1774<=ch&&ch<=2220?4:8192<=ch&&ch<=8203?256:ch==8204?256:1;}var BidiRE3=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var BidiSpan3=/*#__PURE__*/function(){function BidiSpan3(from,to,level){_classCallCheck(this,BidiSpan3);this.from=from;this.to=to;this.level=level;}_createClass(BidiSpan3,[{key:"dir",get:function get(){return this.level%2?RTL3:LTR3;}},{key:"side",value:function side(end,dir){return this.dir==dir==end?this.to:this.from;}}],[{key:"find",value:function find(order,index,level,assoc){var maybe=-1;for(var _i167=0;_i167<order.length;_i167++){var span=order[_i167];if(span.from<=index&&span.to>=index){if(span.level==level)return _i167;if(maybe<0||(assoc!=0?assoc<0?span.from<index:span.to>index:order[maybe].level>span.level))maybe=_i167;}}if(maybe<0)throw new RangeError("Index out of range");return maybe;}}]);return BidiSpan3;}();var types3=[];function computeOrder3(line,direction){var len=line.length,outerType=direction==LTR3?1:2,oppositeType=direction==LTR3?2:1;if(!line||outerType==1&&!BidiRE3.test(line))return trivialOrder3(len);for(var _i168=0,prev=outerType,prevStrong=outerType;_i168<len;_i168++){var type=charType3(line.charCodeAt(_i168));if(type==512)type=prev;else if(type==8&&prevStrong==4)type=16;types3[_i168]=type==4?2:type;if(type&7)prevStrong=type;prev=type;}for(var _i169=0,_prev3=outerType,_prevStrong3=outerType;_i169<len;_i169++){var _type6=types3[_i169];if(_type6==128){if(_i169<len-1&&_prev3==types3[_i169+1]&&_prev3&24)_type6=types3[_i169]=_prev3;else types3[_i169]=256;}else if(_type6==64){var end=_i169+1;while(end<len&&types3[end]==64){end++;}var replace=_i169&&_prev3==8||end<len&&types3[end]==8?_prevStrong3==1?1:8:256;for(var j=_i169;j<end;j++){types3[j]=replace;}_i169=end-1;}else if(_type6==8&&_prevStrong3==1){types3[_i169]=1;}_prev3=_type6;if(_type6&7)_prevStrong3=_type6;}for(var _i170=0,sI=0,context=0,ch,br,_type7;_i170<len;_i170++){if(br=Brackets3[ch=line.charCodeAt(_i170)]){if(br<0){for(var sJ=sI-3;sJ>=0;sJ-=3){if(BracketStack3[sJ+1]==-br){var flags=BracketStack3[sJ+2];var type2=flags&2?outerType:!(flags&4)?0:flags&1?oppositeType:outerType;if(type2)types3[_i170]=types3[BracketStack3[sJ]]=type2;sI=sJ;break;}}}else if(BracketStack3.length==189){break;}else{BracketStack3[sI++]=_i170;BracketStack3[sI++]=ch;BracketStack3[sI++]=context;}}else if((_type7=types3[_i170])==2||_type7==1){var embed=_type7==outerType;context=embed?0:1;for(var _sJ3=sI-3;_sJ3>=0;_sJ3-=3){var cur2=BracketStack3[_sJ3+2];if(cur2&2)break;if(embed){BracketStack3[_sJ3+2]|=2;}else{if(cur2&4)break;BracketStack3[_sJ3+2]|=4;}}}}for(var _i171=0;_i171<len;_i171++){if(types3[_i171]==256){var _end7=_i171+1;while(_end7<len&&types3[_end7]==256){_end7++;}var beforeL=(_i171?types3[_i171-1]:outerType)==1;var afterL=(_end7<len?types3[_end7]:outerType)==1;var _replace3=beforeL==afterL?beforeL?1:2:outerType;for(var _j5=_i171;_j5<_end7;_j5++){types3[_j5]=_replace3;}_i171=_end7-1;}}var order=[];if(outerType==1){for(var _i172=0;_i172<len;){var start=_i172,rtl=types3[_i172++]!=1;while(_i172<len&&rtl==(types3[_i172]!=1)){_i172++;}if(rtl){for(var _j6=_i172;_j6>start;){var _end8=_j6,_l6=types3[--_j6]!=2;while(_j6>start&&_l6==(types3[_j6-1]!=2)){_j6--;}order.push(new BidiSpan3(_j6,_end8,_l6?2:1));}}else{order.push(new BidiSpan3(start,_i172,0));}}}else{for(var _i173=0;_i173<len;){var _start8=_i173,_rtl3=types3[_i173++]==2;while(_i173<len&&_rtl3==(types3[_i173]==2)){_i173++;}order.push(new BidiSpan3(_start8,_i173,_rtl3?1:2));}}return order;}function trivialOrder3(length){return[new BidiSpan3(0,length,0)];}var movedOver3="";function moveVisually3(line,order,dir,start,forward){var _a;var startIndex=start.head-line.from,spanI=-1;if(startIndex==0){if(!forward||!line.length)return null;if(order[0].level!=dir){startIndex=order[0].side(false,dir);spanI=0;}}else if(startIndex==line.length){if(forward)return null;var last=order[order.length-1];if(last.level!=dir){startIndex=last.side(true,dir);spanI=order.length-1;}}if(spanI<0)spanI=BidiSpan3.find(order,startIndex,(_a=start.bidiLevel)!==null&&_a!==void 0?_a:-1,start.assoc);var span=order[spanI];if(startIndex==span.side(forward,dir)){span=order[spanI+=forward?1:-1];startIndex=span.side(!forward,dir);}var indexForward=forward==(span.dir==dir);var nextIndex=findClusterBreak(line.text,startIndex,indexForward);movedOver3=line.text.slice(Math.min(startIndex,nextIndex),Math.max(startIndex,nextIndex));if(nextIndex!=span.side(forward,dir))return EditorSelection.cursor(nextIndex+line.from,indexForward?-1:1,span.level);var nextSpan=spanI==(forward?order.length-1:0)?null:order[spanI+(forward?1:-1)];if(!nextSpan&&span.level!=dir)return EditorSelection.cursor(forward?line.to:line.from,forward?-1:1,dir);if(nextSpan&&nextSpan.level<span.level)return EditorSelection.cursor(nextSpan.side(!forward,dir)+line.from,forward?1:-1,nextSpan.level);return EditorSelection.cursor(nextIndex+line.from,forward?-1:1,span.level);}var DOMReader3=/*#__PURE__*/function(){function DOMReader3(points,view){_classCallCheck(this,DOMReader3);this.points=points;this.view=view;this.text="";this.lineBreak=view.state.lineBreak;}_createClass(DOMReader3,[{key:"readRange",value:function readRange(start,end){if(!start)return this;var parent=start.parentNode;for(var cur2=start;;){this.findPointBefore(parent,cur2);this.readNode(cur2);var next=cur2.nextSibling;if(next==end)break;var view=ContentView3.get(cur2),nextView=ContentView3.get(next);if(view&&nextView?view.breakAfter:(view?view.breakAfter:isBlockElement3(cur2))||isBlockElement3(next)&&(cur2.nodeName!="BR"||cur2.cmIgnore))this.text+=this.lineBreak;cur2=next;}this.findPointBefore(parent,end);return this;}},{key:"readTextNode",value:function readTextNode(node){var _a,_b;var text=node.nodeValue;if(/^\u200b/.test(text)&&((_a=node.previousSibling)===null||_a===void 0?void 0:_a.contentEditable)=="false")text=text.slice(1);if(/\u200b$/.test(text)&&((_b=node.nextSibling)===null||_b===void 0?void 0:_b.contentEditable)=="false")text=text.slice(0,text.length-1);return text;}},{key:"readNode",value:function readNode(node){if(node.cmIgnore)return;var view=ContentView3.get(node);var fromView=view&&view.overrideDOMText;var text;if(fromView!=null)text=fromView.sliceString(0,void 0,this.lineBreak);else if(node.nodeType==3)text=this.readTextNode(node);else if(node.nodeName=="BR")text=node.nextSibling?this.lineBreak:"";else if(node.nodeType==1)this.readRange(node.firstChild,null);if(text!=null){this.findPointIn(node,text.length);this.text+=text;if(browser3.chrome&&this.view.inputState.lastKeyCode==13&&!node.nextSibling&&/\n\n$/.test(this.text))this.text=this.text.slice(0,-1);}}},{key:"findPointBefore",value:function findPointBefore(node,next){var _iterator177=_createForOfIteratorHelper(this.points),_step177;try{for(_iterator177.s();!(_step177=_iterator177.n()).done;){var point=_step177.value;if(point.node==node&&node.childNodes[point.offset]==next)point.pos=this.text.length;}}catch(err){_iterator177.e(err);}finally{_iterator177.f();}}},{key:"findPointIn",value:function findPointIn(node,maxLen){var _iterator178=_createForOfIteratorHelper(this.points),_step178;try{for(_iterator178.s();!(_step178=_iterator178.n()).done;){var point=_step178.value;if(point.node==node)point.pos=this.text.length+Math.min(point.offset,maxLen);}}catch(err){_iterator178.e(err);}finally{_iterator178.f();}}}]);return DOMReader3;}();function isBlockElement3(node){return node.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(node.nodeName);}var DOMPoint3=/*#__PURE__*/_createClass(function DOMPoint3(node,offset){_classCallCheck(this,DOMPoint3);this.node=node;this.offset=offset;this.pos=-1;});var DocView3=/*#__PURE__*/function(_ContentView18){_inherits(DocView3,_ContentView18);var _super61=_createSuper(DocView3);function DocView3(view){var _this107;_classCallCheck(this,DocView3);_this107=_super61.call(this);_this107.view=view;_this107.compositionDeco=Decoration3.none;_this107.decorations=[];_this107.pluginDecorationLength=0;_this107.minWidth=0;_this107.minWidthFrom=0;_this107.minWidthTo=0;_this107.impreciseAnchor=null;_this107.impreciseHead=null;_this107.forceSelection=false;_this107.lastUpdate=Date.now();_this107.setDOM(view.contentDOM);_this107.children=[new LineView3()];_this107.children[0].setParent(_assertThisInitialized(_this107));_this107.updateDeco();_this107.updateInner([new ChangedRange3(0,0,0,view.state.doc.length)],0);return _this107;}_createClass(DocView3,[{key:"root",get:function get(){return this.view.root;}},{key:"editorView",get:function get(){return this.view;}},{key:"length",get:function get(){return this.view.state.doc.length;}},{key:"update",value:function update(_update15){var _this108=this;var changedRanges=_update15.changedRanges;if(this.minWidth>0&&changedRanges.length){if(!changedRanges.every(function(_ref35){var fromA=_ref35.fromA,toA=_ref35.toA;return toA<_this108.minWidthFrom||fromA>_this108.minWidthTo;})){this.minWidth=this.minWidthFrom=this.minWidthTo=0;}else{this.minWidthFrom=_update15.changes.mapPos(this.minWidthFrom,1);this.minWidthTo=_update15.changes.mapPos(this.minWidthTo,1);}}if(this.view.inputState.composing<0)this.compositionDeco=Decoration3.none;else if(_update15.transactions.length||this.dirty)this.compositionDeco=computeCompositionDeco3(this.view,_update15.changes);if((browser3.ie||browser3.chrome)&&!this.compositionDeco.size&&_update15&&_update15.state.doc.lines!=_update15.startState.doc.lines)this.forceSelection=true;var prevDeco=this.decorations,deco=this.updateDeco();var decoDiff=findChangedDeco3(prevDeco,deco,_update15.changes);changedRanges=ChangedRange3.extendWithRanges(changedRanges,decoDiff);if(this.dirty==0&&changedRanges.length==0){return false;}else{this.updateInner(changedRanges,_update15.startState.doc.length);if(_update15.transactions.length)this.lastUpdate=Date.now();return true;}}},{key:"updateInner",value:function updateInner(changes,oldLength){var _this109=this;this.view.viewState.mustMeasureContent=true;this.updateChildren(changes,oldLength);var observer=this.view.observer;observer.ignore(function(){_this109.dom.style.height=_this109.view.viewState.contentHeight+"px";_this109.dom.style.minWidth=_this109.minWidth?_this109.minWidth+"px":"";var track=browser3.chrome||browser3.ios?{node:observer.selectionRange.focusNode,written:false}:void 0;_this109.sync(track);_this109.dirty=0;if(track&&(track.written||observer.selectionRange.focusNode!=track.node))_this109.forceSelection=true;_this109.dom.style.height="";});var gaps=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length){var _iterator179=_createForOfIteratorHelper(this.children),_step179;try{for(_iterator179.s();!(_step179=_iterator179.n()).done;){var child=_step179.value;if(child instanceof BlockWidgetView3&&child.widget instanceof BlockGapWidget3)gaps.push(child.dom);}}catch(err){_iterator179.e(err);}finally{_iterator179.f();}}observer.updateGaps(gaps);}},{key:"updateChildren",value:function updateChildren(changes,oldLength){var cursor2=this.childCursor(oldLength);for(var _i174=changes.length-1;;_i174--){var next=_i174>=0?changes[_i174]:null;if(!next)break;var fromA=next.fromA,toA=next.toA,fromB=next.fromB,toB=next.toB;var _ContentBuilder3$buil=ContentBuilder3.build(this.view.state.doc,fromB,toB,this.decorations,this.pluginDecorationLength),content2=_ContentBuilder3$buil.content,breakAtStart=_ContentBuilder3$buil.breakAtStart,openStart=_ContentBuilder3$buil.openStart,openEnd=_ContentBuilder3$buil.openEnd;var _cursor2$findPos5=cursor2.findPos(toA,1),toI=_cursor2$findPos5.i,toOff=_cursor2$findPos5.off;var _cursor2$findPos6=cursor2.findPos(fromA,-1),fromI=_cursor2$findPos6.i,fromOff=_cursor2$findPos6.off;replaceRange2(this,fromI,fromOff,toI,toOff,content2,breakAtStart,openStart,openEnd);}}},{key:"updateSelection",value:function updateSelection(){var _this110=this;var mustRead=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var fromPointer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(mustRead)this.view.observer.readSelectionRange();if(!(fromPointer||this.mayControlSelection())||browser3.ios&&this.view.inputState.rapidCompositionStart)return;var force=this.forceSelection;this.forceSelection=false;var main=this.view.state.selection.main;var anchor=this.domAtPos(main.anchor);var head=main.empty?anchor:this.domAtPos(main.head);if(browser3.gecko&&main.empty&&betweenUneditable3(anchor)){var dummy=document.createTextNode("");this.view.observer.ignore(function(){return anchor.node.insertBefore(dummy,anchor.node.childNodes[anchor.offset]||null);});anchor=head=new DOMPos3(dummy,0);force=true;}var domSel=this.view.observer.selectionRange;if(force||!domSel.focusNode||!isEquivalentPosition3(anchor.node,anchor.offset,domSel.anchorNode,domSel.anchorOffset)||!isEquivalentPosition3(head.node,head.offset,domSel.focusNode,domSel.focusOffset)){this.view.observer.ignore(function(){if(browser3.android&&browser3.chrome&&_this110.dom.contains(domSel.focusNode)&&inUneditable3(domSel.focusNode,_this110.dom)){_this110.dom.blur();_this110.dom.focus({preventScroll:true});}var rawSel=getSelection3(_this110.root);if(main.empty){if(browser3.gecko){var nextTo=nextToUneditable3(anchor.node,anchor.offset);if(nextTo&&nextTo!=(1|2)){var _text7=nearbyTextNode3(anchor.node,anchor.offset,nextTo==1?1:-1);if(_text7)anchor=new DOMPos3(_text7,nextTo==1?0:_text7.nodeValue.length);}}rawSel.collapse(anchor.node,anchor.offset);if(main.bidiLevel!=null&&domSel.cursorBidiLevel!=null)domSel.cursorBidiLevel=main.bidiLevel;}else if(rawSel.extend){rawSel.collapse(anchor.node,anchor.offset);rawSel.extend(head.node,head.offset);}else{var range=document.createRange();if(main.anchor>main.head){var _ref36=[head,anchor];anchor=_ref36[0];head=_ref36[1];}range.setEnd(head.node,head.offset);range.setStart(anchor.node,anchor.offset);rawSel.removeAllRanges();rawSel.addRange(range);}});this.view.observer.setSelectionRange(anchor,head);}this.impreciseAnchor=anchor.precise?null:new DOMPos3(domSel.anchorNode,domSel.anchorOffset);this.impreciseHead=head.precise?null:new DOMPos3(domSel.focusNode,domSel.focusOffset);}},{key:"enforceCursorAssoc",value:function enforceCursorAssoc(){if(this.compositionDeco.size)return;var cursor2=this.view.state.selection.main;var sel=getSelection3(this.root);if(!cursor2.empty||!cursor2.assoc||!sel.modify)return;var line=LineView3.find(this,cursor2.head);if(!line)return;var lineStart=line.posAtStart;if(cursor2.head==lineStart||cursor2.head==lineStart+line.length)return;var before=this.coordsAt(cursor2.head,-1),after=this.coordsAt(cursor2.head,1);if(!before||!after||before.bottom>after.top)return;var dom=this.domAtPos(cursor2.head+cursor2.assoc);sel.collapse(dom.node,dom.offset);sel.modify("move",cursor2.assoc<0?"forward":"backward","lineboundary");}},{key:"mayControlSelection",value:function mayControlSelection(){return this.view.state.facet(editable3)?this.root.activeElement==this.dom:hasSelection3(this.dom,this.view.observer.selectionRange);}},{key:"nearest",value:function nearest(dom){for(var cur2=dom;cur2;){var domView=ContentView3.get(cur2);if(domView&&domView.rootView==this)return domView;cur2=cur2.parentNode;}return null;}},{key:"posFromDOM",value:function posFromDOM(node,offset){var view=this.nearest(node);if(!view)throw new RangeError("Trying to find position for a DOM position outside of the document");return view.localPosFromDOM(node,offset)+view.posAtStart;}},{key:"domAtPos",value:function domAtPos(pos){var _this$childCursor$fin3=this.childCursor().findPos(pos,-1),i=_this$childCursor$fin3.i,off=_this$childCursor$fin3.off;for(;i<this.children.length-1;){var child=this.children[i];if(off<child.length||child instanceof LineView3)break;i++;off=0;}return this.children[i].domAtPos(off);}},{key:"coordsAt",value:function coordsAt(pos,side){for(var off=this.length,_i175=this.children.length-1;;_i175--){var child=this.children[_i175],start=off-child.breakAfter-child.length;if(pos>start||pos==start&&child.type!=BlockType3.WidgetBefore&&child.type!=BlockType3.WidgetAfter&&(!_i175||side==2||this.children[_i175-1].breakAfter||this.children[_i175-1].type==BlockType3.WidgetBefore&&side>-2))return child.coordsAt(pos-start,side);off=start;}}},{key:"measureVisibleLineHeights",value:function measureVisibleLineHeights(){var result=[],_this$view$viewState$3=this.view.viewState.viewport,from=_this$view$viewState$3.from,to=_this$view$viewState$3.to;var contentWidth=this.view.contentDOM.clientWidth;var isWider=contentWidth>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;var widest=-1;for(var pos=0,_i176=0;_i176<this.children.length;_i176++){var child=this.children[_i176],end=pos+child.length;if(end>to)break;if(pos>=from){var childRect=child.dom.getBoundingClientRect();result.push(childRect.height);if(isWider){var last=child.dom.lastChild;var rects=last?clientRectsFor3(last):[];if(rects.length){var rect=rects[rects.length-1];var width=this.view.textDirection==Direction3.LTR?rect.right-childRect.left:childRect.right-rect.left;if(width>widest){widest=width;this.minWidth=contentWidth;this.minWidthFrom=pos;this.minWidthTo=end;}}}}pos=end+child.breakAfter;}return result;}},{key:"measureTextSize",value:function measureTextSize(){var _this111=this;var _iterator180=_createForOfIteratorHelper(this.children),_step180;try{for(_iterator180.s();!(_step180=_iterator180.n()).done;){var child=_step180.value;if(child instanceof LineView3){var measure=child.measureTextSize();if(measure)return measure;}}}catch(err){_iterator180.e(err);}finally{_iterator180.f();}var dummy=document.createElement("div"),lineHeight,charWidth;dummy.className="cm-line";dummy.textContent="abc def ghi jkl mno pqr stu";this.view.observer.ignore(function(){_this111.dom.appendChild(dummy);var rect=clientRectsFor3(dummy.firstChild)[0];lineHeight=dummy.getBoundingClientRect().height;charWidth=rect?rect.width/27:7;dummy.remove();});return{lineHeight:lineHeight,charWidth:charWidth};}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;var i=this.children.length;if(i)pos-=this.children[--i].length;return new ChildCursor3(this.children,pos,i);}},{key:"computeBlockGapDeco",value:function computeBlockGapDeco(){var deco=[],vs=this.view.viewState;for(var pos=0,_i177=0;;_i177++){var next=_i177==vs.viewports.length?null:vs.viewports[_i177];var end=next?next.from-1:this.length;if(end>pos){var height=vs.lineBlockAt(end).bottom-vs.lineBlockAt(pos).top;deco.push(Decoration3.replace({widget:new BlockGapWidget3(height),block:true,inclusive:true}).range(pos,end));}if(!next)break;pos=next.to+1;}return Decoration3.set(deco);}},{key:"updateDeco",value:function updateDeco(){var pluginDecorations=this.view.pluginField(PluginField3.decorations);this.pluginDecorationLength=pluginDecorations.length;return this.decorations=[].concat(_toConsumableArray(pluginDecorations),_toConsumableArray(this.view.state.facet(decorations3)),[this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]);}},{key:"scrollIntoView",value:function scrollIntoView(target){var range=target.range;var rect=this.coordsAt(range.head,range.empty?range.assoc:range.head>range.anchor?-1:1),other;if(!rect)return;if(!range.empty&&(other=this.coordsAt(range.anchor,range.anchor>range.head?-1:1)))rect={left:Math.min(rect.left,other.left),top:Math.min(rect.top,other.top),right:Math.max(rect.right,other.right),bottom:Math.max(rect.bottom,other.bottom)};var mLeft=0,mRight=0,mTop=0,mBottom=0;var _iterator181=_createForOfIteratorHelper(this.view.pluginField(PluginField3.scrollMargins)),_step181;try{for(_iterator181.s();!(_step181=_iterator181.n()).done;){var margins=_step181.value;if(margins){var left=margins.left,right=margins.right,top2=margins.top,bottom=margins.bottom;if(left!=null)mLeft=Math.max(mLeft,left);if(right!=null)mRight=Math.max(mRight,right);if(top2!=null)mTop=Math.max(mTop,top2);if(bottom!=null)mBottom=Math.max(mBottom,bottom);}}}catch(err){_iterator181.e(err);}finally{_iterator181.f();}var targetRect={left:rect.left-mLeft,top:rect.top-mTop,right:rect.right+mRight,bottom:rect.bottom+mBottom};scrollRectIntoView3(this.view.scrollDOM,targetRect,range.head<range.anchor?-1:1,target.x,target.y,target.xMargin,target.yMargin,this.view.textDirection==Direction3.LTR);}}]);return DocView3;}(ContentView3);function betweenUneditable3(pos){return pos.node.nodeType==1&&pos.node.firstChild&&(pos.offset==0||pos.node.childNodes[pos.offset-1].contentEditable=="false")&&(pos.offset==pos.node.childNodes.length||pos.node.childNodes[pos.offset].contentEditable=="false");}var BlockGapWidget3=/*#__PURE__*/function(_WidgetType12){_inherits(BlockGapWidget3,_WidgetType12);var _super62=_createSuper(BlockGapWidget3);function BlockGapWidget3(height){var _this112;_classCallCheck(this,BlockGapWidget3);_this112=_super62.call(this);_this112.height=height;return _this112;}_createClass(BlockGapWidget3,[{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");this.updateDOM(elt);return elt;}},{key:"eq",value:function eq(other){return other.height==this.height;}},{key:"updateDOM",value:function updateDOM(elt){elt.style.height=this.height+"px";return true;}},{key:"estimatedHeight",get:function get(){return this.height;}}]);return BlockGapWidget3;}(WidgetType3);function compositionSurroundingNode2(view){var sel=view.observer.selectionRange;var textNode=sel.focusNode&&nearbyTextNode3(sel.focusNode,sel.focusOffset,0);if(!textNode)return null;var cView=view.docView.nearest(textNode);if(!cView)return null;if(cView instanceof LineView3){var topNode=textNode;while(topNode.parentNode!=cView.dom){topNode=topNode.parentNode;}var prev=topNode.previousSibling;while(prev&&!ContentView3.get(prev)){prev=prev.previousSibling;}var pos=prev?ContentView3.get(prev).posAtEnd:cView.posAtStart;return{from:pos,to:pos,node:topNode,text:textNode};}else{for(;;){var _cView2=cView,parent=_cView2.parent;if(!parent)return null;if(parent instanceof LineView3)break;cView=parent;}var from=cView.posAtStart;return{from:from,to:from+cView.length,node:cView.dom,text:textNode};}}function computeCompositionDeco3(view,changes){var surrounding=compositionSurroundingNode2(view);if(!surrounding)return Decoration3.none;var from=surrounding.from,to=surrounding.to,node=surrounding.node,textNode=surrounding.text;var newFrom=changes.mapPos(from,1),newTo=Math.max(newFrom,changes.mapPos(to,-1));var state=view.state,text=node.nodeType==3?node.nodeValue:new DOMReader3([],view).readRange(node.firstChild,null).text;if(newTo-newFrom<text.length){if(state.sliceDoc(newFrom,Math.min(state.doc.length,newFrom+text.length))==text)newTo=newFrom+text.length;else if(state.sliceDoc(Math.max(0,newTo-text.length),newTo)==text)newFrom=newTo-text.length;else return Decoration3.none;}else if(state.sliceDoc(newFrom,newTo)!=text){return Decoration3.none;}return Decoration3.set(Decoration3.replace({widget:new CompositionWidget3(node,textNode)}).range(newFrom,newTo));}var CompositionWidget3=/*#__PURE__*/function(_WidgetType13){_inherits(CompositionWidget3,_WidgetType13);var _super63=_createSuper(CompositionWidget3);function CompositionWidget3(top2,text){var _this113;_classCallCheck(this,CompositionWidget3);_this113=_super63.call(this);_this113.top=top2;_this113.text=text;return _this113;}_createClass(CompositionWidget3,[{key:"eq",value:function eq(other){return this.top==other.top&&this.text==other.text;}},{key:"toDOM",value:function toDOM(){return this.top;}},{key:"ignoreEvent",value:function ignoreEvent(){return false;}},{key:"customView",get:function get(){return CompositionView3;}}]);return CompositionWidget3;}(WidgetType3);function nearbyTextNode3(node,offset,side){for(;;){if(node.nodeType==3)return node;if(node.nodeType==1&&offset>0&&side<=0){node=node.childNodes[offset-1];offset=maxOffset3(node);}else if(node.nodeType==1&&offset<node.childNodes.length&&side>=0){node=node.childNodes[offset];offset=0;}else{return null;}}}function nextToUneditable3(node,offset){if(node.nodeType!=1)return 0;return(offset&&node.childNodes[offset-1].contentEditable=="false"?1:0)|(offset<node.childNodes.length&&node.childNodes[offset].contentEditable=="false"?2:0);}var DecorationComparator$13=/*#__PURE__*/function(){function DecorationComparator$13(){_classCallCheck(this,DecorationComparator$13);this.changes=[];}_createClass(DecorationComparator$13,[{key:"compareRange",value:function compareRange(from,to){addRange3(from,to,this.changes);}},{key:"comparePoint",value:function comparePoint(from,to){addRange3(from,to,this.changes);}}]);return DecorationComparator$13;}();function findChangedDeco3(a,b,diff){var comp=new DecorationComparator$13();RangeSet.compare(a,b,diff,comp);return comp.changes;}function inUneditable3(node,inside6){for(var cur2=node;cur2&&cur2!=inside6;cur2=cur2.assignedSlot||cur2.parentNode){if(cur2.nodeType==1&&cur2.contentEditable=="false"){return true;}}return false;}function groupAt3(state,pos){var bias=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var categorize=state.charCategorizer(pos);var line=state.doc.lineAt(pos),linePos=pos-line.from;if(line.length==0)return EditorSelection.cursor(pos);if(linePos==0)bias=1;else if(linePos==line.length)bias=-1;var from=linePos,to=linePos;if(bias<0)from=findClusterBreak(line.text,linePos,false);else to=findClusterBreak(line.text,linePos);var cat=categorize(line.text.slice(from,to));while(from>0){var prev=findClusterBreak(line.text,from,false);if(categorize(line.text.slice(prev,from))!=cat)break;from=prev;}while(to<line.length){var next=findClusterBreak(line.text,to);if(categorize(line.text.slice(to,next))!=cat)break;to=next;}return EditorSelection.range(from+line.from,to+line.from);}function getdx3(x,rect){return rect.left>x?rect.left-x:Math.max(0,x-rect.right);}function getdy3(y,rect){return rect.top>y?rect.top-y:Math.max(0,y-rect.bottom);}function yOverlap3(a,b){return a.top<b.bottom-1&&a.bottom>b.top+1;}function upTop3(rect,top2){return top2<rect.top?{top:top2,left:rect.left,right:rect.right,bottom:rect.bottom}:rect;}function upBot3(rect,bottom){return bottom>rect.bottom?{top:rect.top,left:rect.left,right:rect.right,bottom:bottom}:rect;}function domPosAtCoords3(parent,x,y){var closest,closestRect,closestX,closestY;var above,below,aboveRect,belowRect;for(var child=parent.firstChild;child;child=child.nextSibling){var rects=clientRectsFor3(child);for(var _i178=0;_i178<rects.length;_i178++){var rect=rects[_i178];if(closestRect&&yOverlap3(closestRect,rect))rect=upTop3(upBot3(rect,closestRect.bottom),closestRect.top);var dx=getdx3(x,rect),dy=getdy3(y,rect);if(dx==0&&dy==0)return child.nodeType==3?domPosInText3(child,x,y):domPosAtCoords3(child,x,y);if(!closest||closestY>dy||closestY==dy&&closestX>dx){closest=child;closestRect=rect;closestX=dx;closestY=dy;}if(dx==0){if(y>rect.bottom&&(!aboveRect||aboveRect.bottom<rect.bottom)){above=child;aboveRect=rect;}else if(y<rect.top&&(!belowRect||belowRect.top>rect.top)){below=child;belowRect=rect;}}else if(aboveRect&&yOverlap3(aboveRect,rect)){aboveRect=upBot3(aboveRect,rect.bottom);}else if(belowRect&&yOverlap3(belowRect,rect)){belowRect=upTop3(belowRect,rect.top);}}}if(aboveRect&&aboveRect.bottom>=y){closest=above;closestRect=aboveRect;}else if(belowRect&&belowRect.top<=y){closest=below;closestRect=belowRect;}if(!closest)return{node:parent,offset:0};var clipX=Math.max(closestRect.left,Math.min(closestRect.right,x));if(closest.nodeType==3)return domPosInText3(closest,clipX,y);if(!closestX&&closest.contentEditable=="true")return domPosAtCoords3(closest,clipX,y);var offset=Array.prototype.indexOf.call(parent.childNodes,closest)+(x>=(closestRect.left+closestRect.right)/2?1:0);return{node:parent,offset:offset};}function domPosInText3(node,x,y){var len=node.nodeValue.length;var closestOffset=-1,closestDY=1e9,generalSide=0;for(var _i179=0;_i179<len;_i179++){var rects=textRange3(node,_i179,_i179+1).getClientRects();for(var j=0;j<rects.length;j++){var rect=rects[j];if(rect.top==rect.bottom)continue;if(!generalSide)generalSide=x-rect.left;var dy=(rect.top>y?rect.top-y:y-rect.bottom)-1;if(rect.left-1<=x&&rect.right+1>=x&&dy<closestDY){var right=x>=(rect.left+rect.right)/2,after=right;if(browser3.chrome||browser3.gecko){var rectBefore=textRange3(node,_i179).getBoundingClientRect();if(rectBefore.left==rect.right)after=!right;}if(dy<=0)return{node:node,offset:_i179+(after?1:0)};closestOffset=_i179+(after?1:0);closestDY=dy;}}}return{node:node,offset:closestOffset>-1?closestOffset:generalSide>0?node.nodeValue.length:0};}function posAtCoords3(view,_ref37,precise){var x=_ref37.x,y=_ref37.y;var bias=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var _a;var content2=view.contentDOM.getBoundingClientRect(),docTop=content2.top+view.viewState.paddingTop;var block,docHeight=view.viewState.docHeight;var yOffset=y-docTop;if(yOffset<0)return 0;if(yOffset>docHeight)return view.state.doc.length;for(var halfLine=view.defaultLineHeight/2,bounced=false;;){block=view.elementAtHeight(yOffset);if(block.type==BlockType3.Text)break;for(;;){yOffset=bias>0?block.bottom+halfLine:block.top-halfLine;if(yOffset>=0&&yOffset<=docHeight)break;if(bounced)return precise?null:0;bounced=true;bias=-bias;}}y=docTop+yOffset;var lineStart=block.from;if(lineStart<view.viewport.from)return view.viewport.from==0?0:precise?null:posAtCoordsImprecise3(view,content2,block,x,y);if(lineStart>view.viewport.to)return view.viewport.to==view.state.doc.length?view.state.doc.length:precise?null:posAtCoordsImprecise3(view,content2,block,x,y);var doc6=view.dom.ownerDocument;var root=view.root.elementFromPoint?view.root:doc6;var element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null;if(!element){x=Math.max(content2.left+1,Math.min(content2.right-1,x));element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null;}var node,offset=-1;if(element&&((_a=view.docView.nearest(element))===null||_a===void 0?void 0:_a.isEditable)!=false){if(doc6.caretPositionFromPoint){var pos=doc6.caretPositionFromPoint(x,y);if(pos){node=pos.offsetNode;offset=pos.offset;}}else if(doc6.caretRangeFromPoint){var range=doc6.caretRangeFromPoint(x,y);if(range){node=range.startContainer;offset=range.startOffset;if(browser3.safari&&isSuspiciousCaretResult3(node,offset,x))node=void 0;}}}if(!node||!view.docView.dom.contains(node)){var line=LineView3.find(view.docView,lineStart);if(!line)return yOffset>block.top+block.height/2?block.to:block.from;var _domPosAtCoords3=domPosAtCoords3(line.dom,x,y);node=_domPosAtCoords3.node;offset=_domPosAtCoords3.offset;}return view.docView.posFromDOM(node,offset);}function posAtCoordsImprecise3(view,contentRect,block,x,y){var into=Math.round((x-contentRect.left)*view.defaultCharacterWidth);if(view.lineWrapping&&block.height>view.defaultLineHeight*1.5){var line=Math.floor((y-block.top)/view.defaultLineHeight);into+=line*view.viewState.heightOracle.lineLength;}var content2=view.state.sliceDoc(block.from,block.to);return block.from+findColumn(content2,into,view.state.tabSize);}function isSuspiciousCaretResult3(node,offset,x){var len;if(node.nodeType!=3||offset!=(len=node.nodeValue.length))return false;for(var next=node.nextSibling;next;next=next.nextSibling){if(next.nodeType!=1||next.nodeName!="BR")return false;}return textRange3(node,len-1,len).getBoundingClientRect().left>x;}function moveToLineBoundary3(view,start,forward,includeWrap){var line=view.state.doc.lineAt(start.head);var coords=!includeWrap||!view.lineWrapping?null:view.coordsAtPos(start.assoc<0&&start.head>line.from?start.head-1:start.head);if(coords){var editorRect=view.dom.getBoundingClientRect();var pos=view.posAtCoords({x:forward==(view.textDirection==Direction3.LTR)?editorRect.right-1:editorRect.left+1,y:(coords.top+coords.bottom)/2});if(pos!=null)return EditorSelection.cursor(pos,forward?-1:1);}var lineView=LineView3.find(view.docView,start.head);var end=lineView?forward?lineView.posAtEnd:lineView.posAtStart:forward?line.to:line.from;return EditorSelection.cursor(end,forward?-1:1);}function moveByChar3(view,start,forward,by){var line=view.state.doc.lineAt(start.head),spans=view.bidiSpans(line);for(var cur2=start,check=null;;){var next=moveVisually3(line,spans,view.textDirection,cur2,forward),_char4=movedOver3;if(!next){if(line.number==(forward?view.state.doc.lines:1))return cur2;_char4="\n";line=view.state.doc.line(line.number+(forward?1:-1));spans=view.bidiSpans(line);next=EditorSelection.cursor(forward?line.from:line.to);}if(!check){if(!by)return next;check=by(_char4);}else if(!check(_char4)){return cur2;}cur2=next;}}function byGroup3(view,pos,start){var categorize=view.state.charCategorizer(pos);var cat=categorize(start);return function(next){var nextCat=categorize(next);if(cat==CharCategory.Space)cat=nextCat;return cat==nextCat;};}function moveVertically3(view,start,forward,distance){var startPos=start.head,dir=forward?1:-1;if(startPos==(forward?view.state.doc.length:0))return EditorSelection.cursor(startPos,start.assoc);var goal=start.goalColumn,startY;var rect=view.contentDOM.getBoundingClientRect();var startCoords=view.coordsAtPos(startPos),docTop=view.documentTop;if(startCoords){if(goal==null)goal=startCoords.left-rect.left;startY=dir<0?startCoords.top:startCoords.bottom;}else{var line=view.viewState.lineBlockAt(startPos-docTop);if(goal==null)goal=Math.min(rect.right-rect.left,view.defaultCharacterWidth*(startPos-line.from));startY=(dir<0?line.top:line.bottom)+docTop;}var resolvedGoal=rect.left+goal;var dist=distance!==null&&distance!==void 0?distance:view.defaultLineHeight>>1;for(var extra=0;;extra+=10){var curY=startY+(dist+extra)*dir;var pos=posAtCoords3(view,{x:resolvedGoal,y:curY},false,dir);if(curY<rect.top||curY>rect.bottom||(dir<0?pos<startPos:pos>startPos))return EditorSelection.cursor(pos,start.assoc,void 0,goal);}}function skipAtoms3(view,oldPos,pos){var atoms=view.pluginField(PluginField3.atomicRanges);for(;;){var moved=false;var _iterator182=_createForOfIteratorHelper(atoms),_step182;try{for(_iterator182.s();!(_step182=_iterator182.n()).done;){var set=_step182.value;set.between(pos.from-1,pos.from+1,function(from,to,value){if(pos.from>from&&pos.from<to){pos=oldPos.from>pos.from?EditorSelection.cursor(from,1):EditorSelection.cursor(to,-1);moved=true;}});}}catch(err){_iterator182.e(err);}finally{_iterator182.f();}if(!moved)return pos;}}var InputState3=/*#__PURE__*/function(){function InputState3(view){var _this114=this;_classCallCheck(this,InputState3);this.lastKeyCode=0;this.lastKeyTime=0;this.pendingIOSKey=void 0;this.lastSelectionOrigin=null;this.lastSelectionTime=0;this.lastEscPress=0;this.lastContextMenu=0;this.scrollHandlers=[];this.registeredEvents=[];this.customHandlers=[];this.composing=-1;this.compositionFirstChange=null;this.compositionEndedAt=0;this.rapidCompositionStart=false;this.mouseSelection=null;var _loop17=function _loop17(type){var handler=handlers3[type];view.contentDOM.addEventListener(type,function(event){if(type=="keydown"&&_this114.keydown(view,event))return;if(!eventBelongsToEditor3(view,event)||_this114.ignoreDuringComposition(event))return;if(_this114.mustFlushObserver(event))view.observer.forceFlush();if(_this114.runCustomHandlers(type,view,event))event.preventDefault();else handler(view,event);});_this114.registeredEvents.push(type);};for(var type in handlers3){_loop17(type);}this.notifiedFocused=view.hasFocus;this.ensureHandlers(view);if(browser3.safari)view.contentDOM.addEventListener("input",function(){return null;});}_createClass(InputState3,[{key:"setSelectionOrigin",value:function setSelectionOrigin(origin){this.lastSelectionOrigin=origin;this.lastSelectionTime=Date.now();}},{key:"ensureHandlers",value:function ensureHandlers(view){var _this115=this;var handlers6=this.customHandlers=view.pluginField(domEventHandlers3);var _iterator183=_createForOfIteratorHelper(handlers6),_step183;try{for(_iterator183.s();!(_step183=_iterator183.n()).done;){var set=_step183.value;var _loop18=function _loop18(type){if(_this115.registeredEvents.indexOf(type)<0&&type!="scroll"){_this115.registeredEvents.push(type);view.contentDOM.addEventListener(type,function(event){if(!eventBelongsToEditor3(view,event))return;if(_this115.runCustomHandlers(type,view,event))event.preventDefault();});}};for(var type in set.handlers){_loop18(type);}}}catch(err){_iterator183.e(err);}finally{_iterator183.f();}}},{key:"runCustomHandlers",value:function runCustomHandlers(type,view,event){var _iterator184=_createForOfIteratorHelper(this.customHandlers),_step184;try{for(_iterator184.s();!(_step184=_iterator184.n()).done;){var set=_step184.value;var handler=set.handlers[type];if(handler){try{if(handler.call(set.plugin,event,view)||event.defaultPrevented)return true;}catch(e){logException3(view.state,e);}}}}catch(err){_iterator184.e(err);}finally{_iterator184.f();}return false;}},{key:"runScrollHandlers",value:function runScrollHandlers(view,event){var _iterator185=_createForOfIteratorHelper(this.customHandlers),_step185;try{for(_iterator185.s();!(_step185=_iterator185.n()).done;){var set=_step185.value;var handler=set.handlers.scroll;if(handler){try{handler.call(set.plugin,event,view);}catch(e){logException3(view.state,e);}}}}catch(err){_iterator185.e(err);}finally{_iterator185.f();}}},{key:"keydown",value:function keydown(view,event){var _this116=this;this.lastKeyCode=event.keyCode;this.lastKeyTime=Date.now();if(this.screenKeyEvent(view,event))return true;if(browser3.android&&browser3.chrome&&!event.synthetic&&(event.keyCode==13||event.keyCode==8)){view.observer.delayAndroidKey(event.key,event.keyCode);return true;}var pending;if(browser3.ios&&(pending=PendingKeys3.find(function(key){return key.keyCode==event.keyCode;}))&&!(event.ctrlKey||event.altKey||event.metaKey)&&!event.synthetic){this.pendingIOSKey=pending;setTimeout(function(){return _this116.flushIOSKey(view);},250);return true;}return false;}},{key:"flushIOSKey",value:function flushIOSKey(view){var key=this.pendingIOSKey;if(!key)return false;this.pendingIOSKey=void 0;return dispatchKey3(view.contentDOM,key.key,key.keyCode);}},{key:"ignoreDuringComposition",value:function ignoreDuringComposition(event){if(!/^key/.test(event.type))return false;if(this.composing>0)return true;if(browser3.safari&&Date.now()-this.compositionEndedAt<500){this.compositionEndedAt=0;return true;}return false;}},{key:"screenKeyEvent",value:function screenKeyEvent(view,event){var protectedTab=event.keyCode==9&&Date.now()<this.lastEscPress+2e3;if(event.keyCode==27)this.lastEscPress=Date.now();else if(modifierCodes3.indexOf(event.keyCode)<0)this.lastEscPress=0;return protectedTab;}},{key:"mustFlushObserver",value:function mustFlushObserver(event){return event.type=="keydown"&&event.keyCode!=229||event.type=="compositionend"&&!browser3.ios;}},{key:"startMouseSelection",value:function startMouseSelection(mouseSelection){if(this.mouseSelection)this.mouseSelection.destroy();this.mouseSelection=mouseSelection;}},{key:"update",value:function update(_update16){if(this.mouseSelection)this.mouseSelection.update(_update16);if(_update16.transactions.length)this.lastKeyCode=this.lastSelectionTime=0;}},{key:"destroy",value:function destroy(){if(this.mouseSelection)this.mouseSelection.destroy();}}]);return InputState3;}();var PendingKeys3=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}];var modifierCodes3=[16,17,18,20,91,92,224,225];var MouseSelection3=/*#__PURE__*/function(){function MouseSelection3(view,startEvent,style,mustSelect){_classCallCheck(this,MouseSelection3);this.view=view;this.style=style;this.mustSelect=mustSelect;this.lastEvent=startEvent;var doc6=view.contentDOM.ownerDocument;doc6.addEventListener("mousemove",this.move=this.move.bind(this));doc6.addEventListener("mouseup",this.up=this.up.bind(this));this.extend=startEvent.shiftKey;this.multiple=view.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange3(view,startEvent);this.dragMove=dragMovesSelection3(view,startEvent);this.dragging=isInPrimarySelection3(view,startEvent)&&getClickType3(startEvent)==1?null:false;if(this.dragging===false){startEvent.preventDefault();this.select(startEvent);}}_createClass(MouseSelection3,[{key:"move",value:function move(event){if(event.buttons==0)return this.destroy();if(this.dragging!==false)return;this.select(this.lastEvent=event);}},{key:"up",value:function up(event){if(this.dragging==null)this.select(this.lastEvent);if(!this.dragging)event.preventDefault();this.destroy();}},{key:"destroy",value:function destroy(){var doc6=this.view.contentDOM.ownerDocument;doc6.removeEventListener("mousemove",this.move);doc6.removeEventListener("mouseup",this.up);this.view.inputState.mouseSelection=null;}},{key:"select",value:function select(event){var selection2=this.style.get(event,this.extend,this.multiple);if(this.mustSelect||!selection2.eq(this.view.state.selection)||selection2.main.assoc!=this.view.state.selection.main.assoc)this.view.dispatch({selection:selection2,userEvent:"select.pointer",scrollIntoView:true});this.mustSelect=false;}},{key:"update",value:function update(_update17){var _this117=this;if(_update17.docChanged&&this.dragging)this.dragging=this.dragging.map(_update17.changes);if(this.style.update(_update17))setTimeout(function(){return _this117.select(_this117.lastEvent);},20);}}]);return MouseSelection3;}();function addsSelectionRange3(view,event){var facet=view.state.facet(clickAddsSelectionRange3);return facet.length?facet[0](event):browser3.mac?event.metaKey:event.ctrlKey;}function dragMovesSelection3(view,event){var facet=view.state.facet(dragMovesSelection$13);return facet.length?facet[0](event):browser3.mac?!event.altKey:!event.ctrlKey;}function isInPrimarySelection3(view,event){var main=view.state.selection.main;if(main.empty)return false;var sel=getSelection3(view.root);if(sel.rangeCount==0)return true;var rects=sel.getRangeAt(0).getClientRects();for(var _i180=0;_i180<rects.length;_i180++){var rect=rects[_i180];if(rect.left<=event.clientX&&rect.right>=event.clientX&&rect.top<=event.clientY&&rect.bottom>=event.clientY)return true;}return false;}function eventBelongsToEditor3(view,event){if(!event.bubbles)return true;if(event.defaultPrevented)return false;for(var node=event.target,cView;node!=view.contentDOM;node=node.parentNode){if(!node||node.nodeType==11||(cView=ContentView3.get(node))&&cView.ignoreEvent(event))return false;}return true;}var handlers3=/* @__PURE__ */Object.create(null);var brokenClipboardAPI3=browser3.ie&&browser3.ie_version<15||browser3.ios&&browser3.webkit_version<604;function capturePaste3(view){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.focus();setTimeout(function(){view.focus();target.remove();doPaste3(view,target.value);},50);}function doPaste3(view,input){var state=view.state,changes,i=1,text=state.toText(input);var byLine=text.lines==state.selection.ranges.length;var linewise=lastLinewiseCopy3!=null&&state.selection.ranges.every(function(r){return r.empty;})&&lastLinewiseCopy3==text.toString();if(linewise){var lastLine=-1;changes=state.changeByRange(function(range){var line=state.doc.lineAt(range.from);if(line.from==lastLine)return{range:range};lastLine=line.from;var insert2=state.toText((byLine?text.line(i++).text:input)+state.lineBreak);return{changes:{from:line.from,insert:insert2},range:EditorSelection.cursor(range.from+insert2.length)};});}else if(byLine){changes=state.changeByRange(function(range){var line=text.line(i++);return{changes:{from:range.from,to:range.to,insert:line.text},range:EditorSelection.cursor(range.from+line.length)};});}else{changes=state.replaceSelection(text);}view.dispatch(changes,{userEvent:"input.paste",scrollIntoView:true});}handlers3.keydown=function(view,event){view.inputState.setSelectionOrigin("select");};var lastTouch3=0;handlers3.touchstart=function(view,e){lastTouch3=Date.now();view.inputState.setSelectionOrigin("select.pointer");};handlers3.touchmove=function(view){view.inputState.setSelectionOrigin("select.pointer");};handlers3.mousedown=function(view,event){view.observer.flush();if(lastTouch3>Date.now()-2e3&&getClickType3(event)==1)return;var style=null;var _iterator186=_createForOfIteratorHelper(view.state.facet(mouseSelectionStyle3)),_step186;try{for(_iterator186.s();!(_step186=_iterator186.n()).done;){var makeStyle=_step186.value;style=makeStyle(view,event);if(style)break;}}catch(err){_iterator186.e(err);}finally{_iterator186.f();}if(!style&&event.button==0)style=basicMouseSelection3(view,event);if(style){var mustFocus=view.root.activeElement!=view.contentDOM;if(mustFocus)view.observer.ignore(function(){return focusPreventScroll3(view.contentDOM);});view.inputState.startMouseSelection(new MouseSelection3(view,event,style,mustFocus));}};function rangeForClick3(view,pos,bias,type){if(type==1){return EditorSelection.cursor(pos,bias);}else if(type==2){return groupAt3(view.state,pos,bias);}else{var visual=LineView3.find(view.docView,pos),line=view.state.doc.lineAt(visual?visual.posAtEnd:pos);var from=visual?visual.posAtStart:line.from,to=visual?visual.posAtEnd:line.to;if(to<view.state.doc.length&&to==line.to)to++;return EditorSelection.range(from,to);}}var insideY3=function insideY3(y,rect){return y>=rect.top&&y<=rect.bottom;};var inside3=function inside3(x,y,rect){return insideY3(y,rect)&&x>=rect.left&&x<=rect.right;};function findPositionSide3(view,pos,x,y){var line=LineView3.find(view.docView,pos);if(!line)return 1;var off=pos-line.posAtStart;if(off==0)return 1;if(off==line.length)return-1;var before=line.coordsAt(off,-1);if(before&&inside3(x,y,before))return-1;var after=line.coordsAt(off,1);if(after&&inside3(x,y,after))return 1;return before&&insideY3(y,before)?-1:1;}function queryPos3(view,event){var pos=view.posAtCoords({x:event.clientX,y:event.clientY},false);return{pos:pos,bias:findPositionSide3(view,pos,event.clientX,event.clientY)};}var BadMouseDetail3=browser3.ie&&browser3.ie_version<=11;var lastMouseDown3=null;var lastMouseDownCount3=0;var lastMouseDownTime3=0;function getClickType3(event){if(!BadMouseDetail3)return event.detail;var last=lastMouseDown3,lastTime=lastMouseDownTime3;lastMouseDown3=event;lastMouseDownTime3=Date.now();return lastMouseDownCount3=!last||lastTime>Date.now()-400&&Math.abs(last.clientX-event.clientX)<2&&Math.abs(last.clientY-event.clientY)<2?(lastMouseDownCount3+1)%3:1;}function basicMouseSelection3(view,event){var start=queryPos3(view,event),type=getClickType3(event);var startSel=view.state.selection;var last=start,lastEvent=event;return{update:function update(_update18){if(_update18.docChanged){if(start)start.pos=_update18.changes.mapPos(start.pos);startSel=startSel.map(_update18.changes);lastEvent=null;}},get:function get(event2,extend2,multiple){var cur2;if(lastEvent&&event2.clientX==lastEvent.clientX&&event2.clientY==lastEvent.clientY)cur2=last;else{cur2=last=queryPos3(view,event2);lastEvent=event2;}if(!cur2||!start)return startSel;var range=rangeForClick3(view,cur2.pos,cur2.bias,type);if(start.pos!=cur2.pos&&!extend2){var startRange=rangeForClick3(view,start.pos,start.bias,type);var from=Math.min(startRange.from,range.from),to=Math.max(startRange.to,range.to);range=from<range.from?EditorSelection.range(from,to):EditorSelection.range(to,from);}if(extend2)return startSel.replaceRange(startSel.main.extend(range.from,range.to));else if(multiple)return startSel.addRange(range);else return EditorSelection.create([range]);}};}handlers3.dragstart=function(view,event){var main=view.state.selection.main;var mouseSelection=view.inputState.mouseSelection;if(mouseSelection)mouseSelection.dragging=main;if(event.dataTransfer){event.dataTransfer.setData("Text",view.state.sliceDoc(main.from,main.to));event.dataTransfer.effectAllowed="copyMove";}};function dropText3(view,event,text,direct){if(!text)return;var dropPos=view.posAtCoords({x:event.clientX,y:event.clientY},false);event.preventDefault();var mouseSelection=view.inputState.mouseSelection;var del=direct&&mouseSelection&&mouseSelection.dragging&&mouseSelection.dragMove?{from:mouseSelection.dragging.from,to:mouseSelection.dragging.to}:null;var ins={from:dropPos,insert:text};var changes=view.state.changes(del?[del,ins]:ins);view.focus();view.dispatch({changes:changes,selection:{anchor:changes.mapPos(dropPos,-1),head:changes.mapPos(dropPos,1)},userEvent:del?"move.drop":"input.drop"});}handlers3.drop=function(view,event){if(!event.dataTransfer)return;if(view.state.readOnly)return event.preventDefault();var files=event.dataTransfer.files;if(files&&files.length){(function(){event.preventDefault();var text=Array(files.length),read=0;var finishFile=function finishFile(){if(++read==files.length)dropText3(view,event,text.filter(function(s){return s!=null;}).join(view.state.lineBreak),false);};var _loop19=function _loop19(_i181){var reader=new FileReader();reader.onerror=finishFile;reader.onload=function(){if(!/[\x00-\x08\x0e-\x1f]{2}/.test(reader.result))text[_i181]=reader.result;finishFile();};reader.readAsText(files[_i181]);};for(var _i181=0;_i181<files.length;_i181++){_loop19(_i181);}})();}else{dropText3(view,event,event.dataTransfer.getData("Text"),true);}};handlers3.paste=function(view,event){if(view.state.readOnly)return event.preventDefault();view.observer.flush();var data=brokenClipboardAPI3?null:event.clipboardData;if(data){doPaste3(view,data.getData("text/plain"));event.preventDefault();}else{capturePaste3(view);}};function captureCopy3(view,text){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.value=text;target.focus();target.selectionEnd=text.length;target.selectionStart=0;setTimeout(function(){target.remove();view.focus();},50);}function copiedRange3(state){var content2=[],ranges=[],linewise=false;var _iterator187=_createForOfIteratorHelper(state.selection.ranges),_step187;try{for(_iterator187.s();!(_step187=_iterator187.n()).done;){var range=_step187.value;if(!range.empty){content2.push(state.sliceDoc(range.from,range.to));ranges.push(range);}}}catch(err){_iterator187.e(err);}finally{_iterator187.f();}if(!content2.length){var upto=-1;var _iterator188=_createForOfIteratorHelper(state.selection.ranges),_step188;try{for(_iterator188.s();!(_step188=_iterator188.n()).done;){var from=_step188.value.from;var line=state.doc.lineAt(from);if(line.number>upto){content2.push(line.text);ranges.push({from:line.from,to:Math.min(state.doc.length,line.to+1)});}upto=line.number;}}catch(err){_iterator188.e(err);}finally{_iterator188.f();}linewise=true;}return{text:content2.join(state.lineBreak),ranges:ranges,linewise:linewise};}var lastLinewiseCopy3=null;handlers3.copy=handlers3.cut=function(view,event){var _copiedRange3=copiedRange3(view.state),text=_copiedRange3.text,ranges=_copiedRange3.ranges,linewise=_copiedRange3.linewise;if(!text&&!linewise)return;lastLinewiseCopy3=linewise?text:null;var data=brokenClipboardAPI3?null:event.clipboardData;if(data){event.preventDefault();data.clearData();data.setData("text/plain",text);}else{captureCopy3(view,text);}if(event.type=="cut"&&!view.state.readOnly)view.dispatch({changes:ranges,scrollIntoView:true,userEvent:"delete.cut"});};handlers3.focus=handlers3.blur=function(view){setTimeout(function(){if(view.hasFocus!=view.inputState.notifiedFocused)view.update([]);},10);};handlers3.beforeprint=function(view){view.viewState.printing=true;view.requestMeasure();setTimeout(function(){view.viewState.printing=false;view.requestMeasure();},2e3);};function forceClearComposition3(view,rapid){if(view.docView.compositionDeco.size){view.inputState.rapidCompositionStart=rapid;try{view.update([]);}finally{view.inputState.rapidCompositionStart=false;}}}handlers3.compositionstart=handlers3.compositionupdate=function(view){if(view.inputState.compositionFirstChange==null)view.inputState.compositionFirstChange=true;if(view.inputState.composing<0){view.inputState.composing=0;if(view.docView.compositionDeco.size){view.observer.flush();forceClearComposition3(view,true);}}};handlers3.compositionend=function(view){view.inputState.composing=-1;view.inputState.compositionEndedAt=Date.now();view.inputState.compositionFirstChange=null;setTimeout(function(){if(view.inputState.composing<0)forceClearComposition3(view,false);},50);};handlers3.contextmenu=function(view){view.inputState.lastContextMenu=Date.now();};handlers3.beforeinput=function(view,event){var _a;var pending;if(browser3.chrome&&browser3.android&&(pending=PendingKeys3.find(function(key){return key.inputType==event.inputType;}))){view.observer.delayAndroidKey(pending.key,pending.keyCode);if(pending.key=="Backspace"||pending.key=="Delete"){var startViewHeight=((_a=window.visualViewport)===null||_a===void 0?void 0:_a.height)||0;setTimeout(function(){var _a2;if((((_a2=window.visualViewport)===null||_a2===void 0?void 0:_a2.height)||0)>startViewHeight+10&&view.hasFocus){view.contentDOM.blur();view.focus();}},100);}}};var wrappingWhiteSpace3=["pre-wrap","normal","pre-line","break-spaces"];var HeightOracle3=/*#__PURE__*/function(){function HeightOracle3(){_classCallCheck(this,HeightOracle3);this.doc=Text.empty;this.lineWrapping=false;this.direction=Direction3.LTR;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.lineLength=30;this.heightChanged=false;}_createClass(HeightOracle3,[{key:"heightForGap",value:function heightForGap(from,to){var lines=this.doc.lineAt(to).number-this.doc.lineAt(from).number+1;if(this.lineWrapping)lines+=Math.ceil((to-from-lines*this.lineLength*0.5)/this.lineLength);return this.lineHeight*lines;}},{key:"heightForLine",value:function heightForLine(length){if(!this.lineWrapping)return this.lineHeight;var lines=1+Math.max(0,Math.ceil((length-this.lineLength)/(this.lineLength-5)));return lines*this.lineHeight;}},{key:"setDoc",value:function setDoc(doc6){this.doc=doc6;return this;}},{key:"mustRefreshForStyle",value:function mustRefreshForStyle(whiteSpace,direction){return wrappingWhiteSpace3.indexOf(whiteSpace)>-1!=this.lineWrapping||this.direction!=direction;}},{key:"mustRefreshForHeights",value:function mustRefreshForHeights(lineHeights){var newHeight=false;for(var _i182=0;_i182<lineHeights.length;_i182++){var h=lineHeights[_i182];if(h<0){_i182++;}else if(!this.heightSamples[Math.floor(h*10)]){newHeight=true;this.heightSamples[Math.floor(h*10)]=true;}}return newHeight;}},{key:"refresh",value:function refresh(whiteSpace,direction,lineHeight,charWidth,lineLength,knownHeights){var lineWrapping=wrappingWhiteSpace3.indexOf(whiteSpace)>-1;var changed=Math.round(lineHeight)!=Math.round(this.lineHeight)||this.lineWrapping!=lineWrapping||this.direction!=direction;this.lineWrapping=lineWrapping;this.direction=direction;this.lineHeight=lineHeight;this.charWidth=charWidth;this.lineLength=lineLength;if(changed){this.heightSamples={};for(var _i183=0;_i183<knownHeights.length;_i183++){var h=knownHeights[_i183];if(h<0)_i183++;else this.heightSamples[Math.floor(h*10)]=true;}}return changed;}}]);return HeightOracle3;}();var MeasuredHeights3=/*#__PURE__*/function(){function MeasuredHeights3(from,heights){_classCallCheck(this,MeasuredHeights3);this.from=from;this.heights=heights;this.index=0;}_createClass(MeasuredHeights3,[{key:"more",get:function get(){return this.index<this.heights.length;}}]);return MeasuredHeights3;}();var BlockInfo3=/*#__PURE__*/function(){function BlockInfo3(from,length,top2,height,type){_classCallCheck(this,BlockInfo3);this.from=from;this.length=length;this.top=top2;this.height=height;this.type=type;}_createClass(BlockInfo3,[{key:"to",get:function get(){return this.from+this.length;}},{key:"bottom",get:function get(){return this.top+this.height;}},{key:"join",value:function join(other){var detail=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(other.type)?other.type:[other]);return new BlockInfo3(this.from,this.length+other.length,this.top,this.height+other.height,detail);}},{key:"moveY",value:function moveY(offset){return!offset?this:new BlockInfo3(this.from,this.length,this.top+offset,this.height,Array.isArray(this.type)?this.type.map(function(b){return b.moveY(offset);}):this.type);}}]);return BlockInfo3;}();var QueryType3=/* @__PURE__ */function(QueryType7){QueryType7[QueryType7["ByPos"]=0]="ByPos";QueryType7[QueryType7["ByHeight"]=1]="ByHeight";QueryType7[QueryType7["ByPosNoHeight"]=2]="ByPosNoHeight";return QueryType7;}(QueryType3||(QueryType3={}));var Epsilon3=1e-3;var HeightMap3=/*#__PURE__*/function(){function HeightMap3(length,height){var flags=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;_classCallCheck(this,HeightMap3);this.length=length;this.height=height;this.flags=flags;}_createClass(HeightMap3,[{key:"outdated",get:function get(){return(this.flags&2)>0;},set:function set(value){this.flags=(value?2:0)|this.flags&~2;}},{key:"setHeight",value:function setHeight(oracle,height){if(this.height!=height){if(Math.abs(this.height-height)>Epsilon3)oracle.heightChanged=true;this.height=height;}}},{key:"replace",value:function replace(_from,_to,nodes){return HeightMap3.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(_to,result){result.push(this);}},{key:"decomposeRight",value:function decomposeRight(_from,result){result.push(this);}},{key:"applyChanges",value:function applyChanges(decorations6,oldDoc,oracle,changes){var me=this;for(var _i184=changes.length-1;_i184>=0;_i184--){var _changes$_i3=changes[_i184],fromA=_changes$_i3.fromA,toA=_changes$_i3.toA,fromB=_changes$_i3.fromB,toB=_changes$_i3.toB;var start=me.lineAt(fromA,QueryType3.ByPosNoHeight,oldDoc,0,0);var end=start.to>=toA?start:me.lineAt(toA,QueryType3.ByPosNoHeight,oldDoc,0,0);toB+=end.to-toA;toA=end.to;while(_i184>0&&start.from<=changes[_i184-1].toA){fromA=changes[_i184-1].fromA;fromB=changes[_i184-1].fromB;_i184--;if(fromA<start.from)start=me.lineAt(fromA,QueryType3.ByPosNoHeight,oldDoc,0,0);}fromB+=start.from-fromA;fromA=start.from;var nodes=NodeBuilder3.build(oracle,decorations6,fromB,toB);me=me.replace(fromA,toA,nodes);}return me.updateHeight(oracle,0);}}],[{key:"empty",value:function empty(){return new HeightMapText3(0,0);}},{key:"of",value:function of(nodes){if(nodes.length==1)return nodes[0];var i=0,j=nodes.length,before=0,after=0;for(;;){if(i==j){if(before>after*2){var split=nodes[i-1];if(split["break"])nodes.splice(--i,1,split.left,null,split.right);else nodes.splice(--i,1,split.left,split.right);j+=1+split["break"];before-=split.size;}else if(after>before*2){var _split3=nodes[j];if(_split3["break"])nodes.splice(j,1,_split3.left,null,_split3.right);else nodes.splice(j,1,_split3.left,_split3.right);j+=2+_split3["break"];after-=_split3.size;}else{break;}}else if(before<after){var next=nodes[i++];if(next)before+=next.size;}else{var _next4=nodes[--j];if(_next4)after+=_next4.size;}}var brk=0;if(nodes[i-1]==null){brk=1;i--;}else if(nodes[i]==null){brk=1;j++;}return new HeightMapBranch3(HeightMap3.of(nodes.slice(0,i)),brk,HeightMap3.of(nodes.slice(j)));}}]);return HeightMap3;}();HeightMap3.prototype.size=1;var HeightMapBlock3=/*#__PURE__*/function(_HeightMap7){_inherits(HeightMapBlock3,_HeightMap7);var _super64=_createSuper(HeightMapBlock3);function HeightMapBlock3(length,height,type){var _this118;_classCallCheck(this,HeightMapBlock3);_this118=_super64.call(this,length,height);_this118.type=type;return _this118;}_createClass(HeightMapBlock3,[{key:"blockAt",value:function blockAt(_height,_doc,top2,offset){return new BlockInfo3(offset,this.length,top2,this.height,this.type);}},{key:"lineAt",value:function lineAt(_value,_type,doc6,top2,offset){return this.blockAt(0,doc6,top2,offset);}},{key:"forEachLine",value:function forEachLine(_from,_to,doc6,top2,offset,f){f(this.blockAt(0,doc6,top2,offset));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var _force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);this.outdated=false;return this;}},{key:"toString",value:function toString(){return"block(".concat(this.length,")");}}]);return HeightMapBlock3;}(HeightMap3);var HeightMapText3=/*#__PURE__*/function(_HeightMapBlock3){_inherits(HeightMapText3,_HeightMapBlock3);var _super65=_createSuper(HeightMapText3);function HeightMapText3(length,height){var _this119;_classCallCheck(this,HeightMapText3);_this119=_super65.call(this,length,height,BlockType3.Text);_this119.collapsed=0;_this119.widgetHeight=0;return _this119;}_createClass(HeightMapText3,[{key:"replace",value:function replace(_from,_to,nodes){var node=nodes[0];if(nodes.length==1&&(node instanceof HeightMapText3||node instanceof HeightMapGap3&&node.flags&4)&&Math.abs(this.length-node.length)<10){if(node instanceof HeightMapGap3)node=new HeightMapText3(node.length,this.height);else node.height=this.height;if(!this.outdated)node.outdated=false;return node;}else{return HeightMap3.of(nodes);}}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);else if(force||this.outdated)this.setHeight(oracle,Math.max(this.widgetHeight,oracle.heightForLine(this.length-this.collapsed)));this.outdated=false;return this;}},{key:"toString",value:function toString(){return"line(".concat(this.length).concat(this.collapsed?-this.collapsed:"").concat(this.widgetHeight?":"+this.widgetHeight:"",")");}}]);return HeightMapText3;}(HeightMapBlock3);var HeightMapGap3=/*#__PURE__*/function(_HeightMap8){_inherits(HeightMapGap3,_HeightMap8);var _super66=_createSuper(HeightMapGap3);function HeightMapGap3(length){_classCallCheck(this,HeightMapGap3);return _super66.call(this,length,0);}_createClass(HeightMapGap3,[{key:"lines",value:function lines(doc6,offset){var firstLine=doc6.lineAt(offset).number,lastLine=doc6.lineAt(offset+this.length).number;return{firstLine:firstLine,lastLine:lastLine,lineHeight:this.height/(lastLine-firstLine+1)};}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var _this$lines7=this.lines(doc6,offset),firstLine=_this$lines7.firstLine,lastLine=_this$lines7.lastLine,lineHeight=_this$lines7.lineHeight;var line=Math.max(0,Math.min(lastLine-firstLine,Math.floor((height-top2)/lineHeight)));var _doc6$line3=doc6.line(firstLine+line),from=_doc6$line3.from,length=_doc6$line3.length;return new BlockInfo3(from,length,top2+lineHeight*line,lineHeight,BlockType3.Text);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){if(type==QueryType3.ByHeight)return this.blockAt(value,doc6,top2,offset);if(type==QueryType3.ByPosNoHeight){var _doc6$lineAt5=doc6.lineAt(value),from2=_doc6$lineAt5.from,to=_doc6$lineAt5.to;return new BlockInfo3(from2,to-from2,0,0,BlockType3.Text);}var _this$lines8=this.lines(doc6,offset),firstLine=_this$lines8.firstLine,lineHeight=_this$lines8.lineHeight;var _doc6$lineAt6=doc6.lineAt(value),from=_doc6$lineAt6.from,length=_doc6$lineAt6.length,number2=_doc6$lineAt6.number;return new BlockInfo3(from,length,top2+lineHeight*(number2-firstLine),lineHeight,BlockType3.Text);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var _this$lines9=this.lines(doc6,offset),firstLine=_this$lines9.firstLine,lineHeight=_this$lines9.lineHeight;for(var pos=Math.max(from,offset),end=Math.min(offset+this.length,to);pos<=end;){var line=doc6.lineAt(pos);if(pos==from)top2+=lineHeight*(line.number-firstLine);f(new BlockInfo3(line.from,line.length,top2,lineHeight,BlockType3.Text));top2+=lineHeight;pos=line.to+1;}}},{key:"replace",value:function replace(from,to,nodes){var after=this.length-to;if(after>0){var last=nodes[nodes.length-1];if(last instanceof HeightMapGap3)nodes[nodes.length-1]=new HeightMapGap3(last.length+after);else nodes.push(null,new HeightMapGap3(after-1));}if(from>0){var first=nodes[0];if(first instanceof HeightMapGap3)nodes[0]=new HeightMapGap3(from+first.length);else nodes.unshift(new HeightMapGap3(from-1),null);}return HeightMap3.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){result.push(new HeightMapGap3(to-1),null);}},{key:"decomposeRight",value:function decomposeRight(from,result){result.push(null,new HeightMapGap3(this.length-from-1));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var end=offset+this.length;if(measured&&measured.from<=offset+this.length&&measured.more){var nodes=[],pos=Math.max(offset,measured.from),singleHeight=-1;var wasChanged=oracle.heightChanged;if(measured.from>offset)nodes.push(new HeightMapGap3(measured.from-offset-1).updateHeight(oracle,offset));while(pos<=end&&measured.more){var len=oracle.doc.lineAt(pos).length;if(nodes.length)nodes.push(null);var height=measured.heights[measured.index++];if(singleHeight==-1)singleHeight=height;else if(Math.abs(height-singleHeight)>=Epsilon3)singleHeight=-2;var line=new HeightMapText3(len,height);line.outdated=false;nodes.push(line);pos+=len+1;}if(pos<=end)nodes.push(null,new HeightMapGap3(end-pos).updateHeight(oracle,pos));var result=HeightMap3.of(nodes);oracle.heightChanged=wasChanged||singleHeight<0||Math.abs(result.height-this.height)>=Epsilon3||Math.abs(singleHeight-this.lines(oracle.doc,offset).lineHeight)>=Epsilon3;return result;}else if(force||this.outdated){this.setHeight(oracle,oracle.heightForGap(offset,offset+this.length));this.outdated=false;}return this;}},{key:"toString",value:function toString(){return"gap(".concat(this.length,")");}}]);return HeightMapGap3;}(HeightMap3);var HeightMapBranch3=/*#__PURE__*/function(_HeightMap9){_inherits(HeightMapBranch3,_HeightMap9);var _super67=_createSuper(HeightMapBranch3);function HeightMapBranch3(left,brk,right){var _this120;_classCallCheck(this,HeightMapBranch3);_this120=_super67.call(this,left.length+brk+right.length,left.height+right.height,brk|(left.outdated||right.outdated?2:0));_this120.left=left;_this120.right=right;_this120.size=left.size+right.size;return _this120;}_createClass(HeightMapBranch3,[{key:"break",get:function get(){return this.flags&1;}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var mid=top2+this.left.height;return height<mid?this.left.blockAt(height,doc6,top2,offset):this.right.blockAt(height,doc6,mid,offset+this.left.length+this["break"]);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];var left=type==QueryType3.ByHeight?value<rightTop:value<rightOffset;var base2=left?this.left.lineAt(value,type,doc6,top2,offset):this.right.lineAt(value,type,doc6,rightTop,rightOffset);if(this["break"]||(left?base2.to<rightOffset:base2.from>rightOffset))return base2;var subQuery=type==QueryType3.ByPosNoHeight?QueryType3.ByPosNoHeight:QueryType3.ByPos;if(left)return base2.join(this.right.lineAt(rightOffset,subQuery,doc6,rightTop,rightOffset));else return this.left.lineAt(rightOffset,subQuery,doc6,top2,offset).join(base2);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];if(this["break"]){if(from<rightOffset)this.left.forEachLine(from,to,doc6,top2,offset,f);if(to>=rightOffset)this.right.forEachLine(from,to,doc6,rightTop,rightOffset,f);}else{var mid=this.lineAt(rightOffset,QueryType3.ByPos,doc6,top2,offset);if(from<mid.from)this.left.forEachLine(from,mid.from-1,doc6,top2,offset,f);if(mid.to>=from&&mid.from<=to)f(mid);if(to>mid.to)this.right.forEachLine(mid.to+1,to,doc6,rightTop,rightOffset,f);}}},{key:"replace",value:function replace(from,to,nodes){var rightStart=this.left.length+this["break"];if(to<rightStart)return this.balanced(this.left.replace(from,to,nodes),this.right);if(from>this.left.length)return this.balanced(this.left,this.right.replace(from-rightStart,to-rightStart,nodes));var result=[];if(from>0)this.decomposeLeft(from,result);var left=result.length;var _iterator189=_createForOfIteratorHelper(nodes),_step189;try{for(_iterator189.s();!(_step189=_iterator189.n()).done;){var node=_step189.value;result.push(node);}}catch(err){_iterator189.e(err);}finally{_iterator189.f();}if(from>0)mergeGaps3(result,left-1);if(to<this.length){var right=result.length;this.decomposeRight(to,result);mergeGaps3(result,right);}return HeightMap3.of(result);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){var left=this.left.length;if(to<=left)return this.left.decomposeLeft(to,result);result.push(this.left);if(this["break"]){left++;if(to>=left)result.push(null);}if(to>left)this.right.decomposeLeft(to-left,result);}},{key:"decomposeRight",value:function decomposeRight(from,result){var left=this.left.length,right=left+this["break"];if(from>=right)return this.right.decomposeRight(from-right,result);if(from<left)this.left.decomposeRight(from,result);if(this["break"]&&from<right)result.push(null);result.push(this.right);}},{key:"balanced",value:function balanced(left,right){if(left.size>2*right.size||right.size>2*left.size)return HeightMap3.of(this["break"]?[left,null,right]:[left,right]);this.left=left;this.right=right;this.height=left.height+right.height;this.outdated=left.outdated||right.outdated;this.size=left.size+right.size;this.length=left.length+this["break"]+right.length;return this;}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var left=this.left,right=this.right,rightStart=offset+left.length+this["break"],rebalance=null;if(measured&&measured.from<=offset+left.length&&measured.more)rebalance=left=left.updateHeight(oracle,offset,force,measured);else left.updateHeight(oracle,offset,force);if(measured&&measured.from<=rightStart+right.length&&measured.more)rebalance=right=right.updateHeight(oracle,rightStart,force,measured);else right.updateHeight(oracle,rightStart,force);if(rebalance)return this.balanced(left,right);this.height=this.left.height+this.right.height;this.outdated=false;return this;}},{key:"toString",value:function toString(){return this.left+(this["break"]?" ":"-")+this.right;}}]);return HeightMapBranch3;}(HeightMap3);function mergeGaps3(nodes,around){var before,after;if(nodes[around]==null&&(before=nodes[around-1])instanceof HeightMapGap3&&(after=nodes[around+1])instanceof HeightMapGap3)nodes.splice(around-1,3,new HeightMapGap3(before.length+1+after.length));}var relevantWidgetHeight3=5;var NodeBuilder3=/*#__PURE__*/function(){function NodeBuilder3(pos,oracle){_classCallCheck(this,NodeBuilder3);this.pos=pos;this.oracle=oracle;this.nodes=[];this.lineStart=-1;this.lineEnd=-1;this.covering=null;this.writtenTo=pos;}_createClass(NodeBuilder3,[{key:"isCovered",get:function get(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering;}},{key:"span",value:function span(_from,to){if(this.lineStart>-1){var end=Math.min(to,this.lineEnd),last=this.nodes[this.nodes.length-1];if(last instanceof HeightMapText3)last.length+=end-this.pos;else if(end>this.pos||!this.isCovered)this.nodes.push(new HeightMapText3(end-this.pos,-1));this.writtenTo=end;if(to>end){this.nodes.push(null);this.writtenTo++;this.lineStart=-1;}}this.pos=to;}},{key:"point",value:function point(from,to,deco){if(from<to||deco.heightRelevant){var height=deco.widget?deco.widget.estimatedHeight:0;if(height<0)height=this.oracle.lineHeight;var len=to-from;if(deco.block){this.addBlock(new HeightMapBlock3(len,height,deco.type));}else if(len||height>=relevantWidgetHeight3){this.addLineDeco(height,len);}}else if(to>from){this.span(from,to);}if(this.lineEnd>-1&&this.lineEnd<this.pos)this.lineEnd=this.oracle.doc.lineAt(this.pos).to;}},{key:"enterLine",value:function enterLine(){if(this.lineStart>-1)return;var _this$oracle$doc$line3=this.oracle.doc.lineAt(this.pos),from=_this$oracle$doc$line3.from,to=_this$oracle$doc$line3.to;this.lineStart=from;this.lineEnd=to;if(this.writtenTo<from){if(this.writtenTo<from-1||this.nodes[this.nodes.length-1]==null)this.nodes.push(this.blankContent(this.writtenTo,from-1));this.nodes.push(null);}if(this.pos>from)this.nodes.push(new HeightMapText3(this.pos-from,-1));this.writtenTo=this.pos;}},{key:"blankContent",value:function blankContent(from,to){var gap=new HeightMapGap3(to-from);if(this.oracle.doc.lineAt(from).to==to)gap.flags|=4;return gap;}},{key:"ensureLine",value:function ensureLine(){this.enterLine();var last=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(last instanceof HeightMapText3)return last;var line=new HeightMapText3(0,-1);this.nodes.push(line);return line;}},{key:"addBlock",value:function addBlock(block){this.enterLine();if(block.type==BlockType3.WidgetAfter&&!this.isCovered)this.ensureLine();this.nodes.push(block);this.writtenTo=this.pos=this.pos+block.length;if(block.type!=BlockType3.WidgetBefore)this.covering=block;}},{key:"addLineDeco",value:function addLineDeco(height,length){var line=this.ensureLine();line.length+=length;line.collapsed+=length;line.widgetHeight=Math.max(line.widgetHeight,height);this.writtenTo=this.pos=this.pos+length;}},{key:"finish",value:function finish(from){var last=this.nodes.length==0?null:this.nodes[this.nodes.length-1];if(this.lineStart>-1&&!(last instanceof HeightMapText3)&&!this.isCovered)this.nodes.push(new HeightMapText3(0,-1));else if(this.writtenTo<this.pos||last==null)this.nodes.push(this.blankContent(this.writtenTo,this.pos));var pos=from;var _iterator190=_createForOfIteratorHelper(this.nodes),_step190;try{for(_iterator190.s();!(_step190=_iterator190.n()).done;){var node=_step190.value;if(node instanceof HeightMapText3)node.updateHeight(this.oracle,pos);pos+=node?node.length:1;}}catch(err){_iterator190.e(err);}finally{_iterator190.f();}return this.nodes;}}],[{key:"build",value:function build(oracle,decorations6,from,to){var builder=new NodeBuilder3(from,oracle);RangeSet.spans(decorations6,from,to,builder,0);return builder.finish(from);}}]);return NodeBuilder3;}();function heightRelevantDecoChanges3(a,b,diff){var comp=new DecorationComparator3();RangeSet.compare(a,b,diff,comp,0);return comp.changes;}var DecorationComparator3=/*#__PURE__*/function(){function DecorationComparator3(){_classCallCheck(this,DecorationComparator3);this.changes=[];}_createClass(DecorationComparator3,[{key:"compareRange",value:function compareRange(){}},{key:"comparePoint",value:function comparePoint(from,to,a,b){if(from<to||a&&a.heightRelevant||b&&b.heightRelevant)addRange3(from,to,this.changes,5);}}]);return DecorationComparator3;}();function visiblePixelRange3(dom,paddingTop){var rect=dom.getBoundingClientRect();var left=Math.max(0,rect.left),right=Math.min(innerWidth,rect.right);var top2=Math.max(0,rect.top),bottom=Math.min(innerHeight,rect.bottom);var body=dom.ownerDocument.body;for(var parent=dom.parentNode;parent&&parent!=body;){if(parent.nodeType==1){var elt=parent;var style=window.getComputedStyle(elt);if((elt.scrollHeight>elt.clientHeight||elt.scrollWidth>elt.clientWidth)&&style.overflow!="visible"){var parentRect=elt.getBoundingClientRect();left=Math.max(left,parentRect.left);right=Math.min(right,parentRect.right);top2=Math.max(top2,parentRect.top);bottom=Math.min(bottom,parentRect.bottom);}parent=style.position=="absolute"||style.position=="fixed"?elt.offsetParent:elt.parentNode;}else if(parent.nodeType==11){parent=parent.host;}else{break;}}return{left:left-rect.left,right:Math.max(left,right)-rect.left,top:top2-(rect.top+paddingTop),bottom:Math.max(top2,bottom)-(rect.top+paddingTop)};}var LineGap3=/*#__PURE__*/function(){function LineGap3(from,to,size){_classCallCheck(this,LineGap3);this.from=from;this.to=to;this.size=size;}_createClass(LineGap3,[{key:"draw",value:function draw(wrapping){return Decoration3.replace({widget:new LineGapWidget3(this.size,wrapping)}).range(this.from,this.to);}}],[{key:"same",value:function same(a,b){if(a.length!=b.length)return false;for(var _i185=0;_i185<a.length;_i185++){var gA=a[_i185],gB=b[_i185];if(gA.from!=gB.from||gA.to!=gB.to||gA.size!=gB.size)return false;}return true;}}]);return LineGap3;}();var LineGapWidget3=/*#__PURE__*/function(_WidgetType14){_inherits(LineGapWidget3,_WidgetType14);var _super68=_createSuper(LineGapWidget3);function LineGapWidget3(size,vertical){var _this121;_classCallCheck(this,LineGapWidget3);_this121=_super68.call(this);_this121.size=size;_this121.vertical=vertical;return _this121;}_createClass(LineGapWidget3,[{key:"eq",value:function eq(other){return other.size==this.size&&other.vertical==this.vertical;}},{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");if(this.vertical){elt.style.height=this.size+"px";}else{elt.style.width=this.size+"px";elt.style.height="2px";elt.style.display="inline-block";}return elt;}},{key:"estimatedHeight",get:function get(){return this.vertical?this.size:-1;}}]);return LineGapWidget3;}(WidgetType3);var ViewState3=/*#__PURE__*/function(){function ViewState3(state){_classCallCheck(this,ViewState3);this.state=state;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=true;this.paddingTop=0;this.paddingBottom=0;this.contentDOMWidth=0;this.contentDOMHeight=0;this.editorHeight=0;this.editorWidth=0;this.heightOracle=new HeightOracle3();this.scaler=IdScaler3;this.scrollTarget=null;this.printing=false;this.mustMeasureContent=true;this.visibleRanges=[];this.mustEnforceCursorAssoc=false;this.heightMap=HeightMap3.empty().applyChanges(state.facet(decorations3),Text.empty,this.heightOracle.setDoc(state.doc),[new ChangedRange3(0,0,0,state.doc.length)]);this.viewport=this.getViewport(0,null);this.updateViewportLines();this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Decoration3.set(this.lineGaps.map(function(gap){return gap.draw(false);}));this.computeVisibleRanges();}_createClass(ViewState3,[{key:"updateForViewport",value:function updateForViewport(){var _this122=this;var viewports=[this.viewport],main=this.state.selection.main;var _loop20=function _loop20(_i186){var pos=_i186?main.head:main.anchor;if(!viewports.some(function(_ref38){var from=_ref38.from,to=_ref38.to;return pos>=from&&pos<=to;})){var _this122$lineBlockAt=_this122.lineBlockAt(pos),from=_this122$lineBlockAt.from,to=_this122$lineBlockAt.to;viewports.push(new Viewport3(from,to));}};for(var _i186=0;_i186<=1;_i186++){_loop20(_i186);}this.viewports=viewports.sort(function(a,b){return a.from-b.from;});this.scaler=this.heightMap.height<=7e6?IdScaler3:new BigScaler3(this.heightOracle.doc,this.heightMap,this.viewports);}},{key:"updateViewportLines",value:function updateViewportLines(){var _this123=this;this.viewportLines=[];this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,function(block){_this123.viewportLines.push(_this123.scaler.scale==1?block:scaleBlock3(block,_this123.scaler));});}},{key:"update",value:function update(_update19){var scrollTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var prev=this.state;this.state=_update19.state;var newDeco=this.state.facet(decorations3);var contentChanges=_update19.changedRanges;var heightChanges=ChangedRange3.extendWithRanges(contentChanges,heightRelevantDecoChanges3(_update19.startState.facet(decorations3),newDeco,_update19?_update19.changes:ChangeSet.empty(this.state.doc.length)));var prevHeight=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(newDeco,prev.doc,this.heightOracle.setDoc(this.state.doc),heightChanges);if(this.heightMap.height!=prevHeight)_update19.flags|=2;var viewport=heightChanges.length?this.mapViewport(this.viewport,_update19.changes):this.viewport;if(scrollTarget&&(scrollTarget.range.head<viewport.from||scrollTarget.range.head>viewport.to)||!this.viewportIsAppropriate(viewport))viewport=this.getViewport(0,scrollTarget);var updateLines=!_update19.changes.empty||_update19.flags&2||viewport.from!=this.viewport.from||viewport.to!=this.viewport.to;this.viewport=viewport;this.updateForViewport();if(updateLines)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,_update19.changes)));_update19.flags|=this.computeVisibleRanges();if(scrollTarget)this.scrollTarget=scrollTarget;if(!this.mustEnforceCursorAssoc&&_update19.selectionSet&&_update19.view.lineWrapping&&_update19.state.selection.main.empty&&_update19.state.selection.main.assoc)this.mustEnforceCursorAssoc=true;}},{key:"measure",value:function measure(view){var dom=view.contentDOM,style=window.getComputedStyle(dom);var oracle=this.heightOracle;var whiteSpace=style.whiteSpace,direction=style.direction=="rtl"?Direction3.RTL:Direction3.LTR;var refresh=this.heightOracle.mustRefreshForStyle(whiteSpace,direction);var measureContent=refresh||this.mustMeasureContent||this.contentDOMHeight!=dom.clientHeight;var result=0,bias=0;if(measureContent){this.mustMeasureContent=false;this.contentDOMHeight=dom.clientHeight;var paddingTop=parseInt(style.paddingTop)||0,paddingBottom=parseInt(style.paddingBottom)||0;if(this.paddingTop!=paddingTop||this.paddingBottom!=paddingBottom){result|=8;this.paddingTop=paddingTop;this.paddingBottom=paddingBottom;}}var pixelViewport=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:visiblePixelRange3(dom,this.paddingTop);var dTop=pixelViewport.top-this.pixelViewport.top,dBottom=pixelViewport.bottom-this.pixelViewport.bottom;this.pixelViewport=pixelViewport;var inView=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(inView!=this.inView){this.inView=inView;if(inView)measureContent=true;}if(!this.inView)return 0;var contentWidth=dom.clientWidth;if(this.contentDOMWidth!=contentWidth||this.editorHeight!=view.scrollDOM.clientHeight||this.editorWidth!=view.scrollDOM.clientWidth){this.contentDOMWidth=contentWidth;this.editorHeight=view.scrollDOM.clientHeight;this.editorWidth=view.scrollDOM.clientWidth;result|=8;}if(measureContent){var lineHeights=view.docView.measureVisibleLineHeights();if(oracle.mustRefreshForHeights(lineHeights))refresh=true;if(refresh||oracle.lineWrapping&&Math.abs(contentWidth-this.contentDOMWidth)>oracle.charWidth){var _view$docView$measure2=view.docView.measureTextSize(),lineHeight=_view$docView$measure2.lineHeight,charWidth=_view$docView$measure2.charWidth;refresh=oracle.refresh(whiteSpace,direction,lineHeight,charWidth,contentWidth/charWidth,lineHeights);if(refresh){view.docView.minWidth=0;result|=8;}}if(dTop>0&&dBottom>0)bias=Math.max(dTop,dBottom);else if(dTop<0&&dBottom<0)bias=Math.min(dTop,dBottom);oracle.heightChanged=false;this.heightMap=this.heightMap.updateHeight(oracle,0,refresh,new MeasuredHeights3(this.viewport.from,lineHeights));if(oracle.heightChanged)result|=2;}var viewportChange=!this.viewportIsAppropriate(this.viewport,bias)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);if(viewportChange)this.viewport=this.getViewport(bias,this.scrollTarget);this.updateForViewport();if(result&2||viewportChange)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(refresh?[]:this.lineGaps));result|=this.computeVisibleRanges();if(this.mustEnforceCursorAssoc){this.mustEnforceCursorAssoc=false;view.docView.enforceCursorAssoc();}return result;}},{key:"visibleTop",get:function get(){return this.scaler.fromDOM(this.pixelViewport.top);}},{key:"visibleBottom",get:function get(){return this.scaler.fromDOM(this.pixelViewport.bottom);}},{key:"getViewport",value:function getViewport(bias,scrollTarget){var marginTop=0.5-Math.max(-0.5,Math.min(0.5,bias/1e3/2));var map=this.heightMap,doc6=this.state.doc,visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;var viewport=new Viewport3(map.lineAt(visibleTop-marginTop*1e3,QueryType3.ByHeight,doc6,0,0).from,map.lineAt(visibleBottom+(1-marginTop)*1e3,QueryType3.ByHeight,doc6,0,0).to);if(scrollTarget){var head=scrollTarget.range.head,viewHeight=this.editorHeight;if(head<viewport.from||head>viewport.to){var block=map.lineAt(head,QueryType3.ByPos,doc6,0,0),topPos;if(scrollTarget.y=="center")topPos=(block.top+block.bottom)/2-viewHeight/2;else if(scrollTarget.y=="start"||scrollTarget.y=="nearest"&&head<viewport.from)topPos=block.top;else topPos=block.bottom-viewHeight;viewport=new Viewport3(map.lineAt(topPos-1e3/2,QueryType3.ByHeight,doc6,0,0).from,map.lineAt(topPos+viewHeight+1e3/2,QueryType3.ByHeight,doc6,0,0).to);}}return viewport;}},{key:"mapViewport",value:function mapViewport(viewport,changes){var from=changes.mapPos(viewport.from,-1),to=changes.mapPos(viewport.to,1);return new Viewport3(this.heightMap.lineAt(from,QueryType3.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(to,QueryType3.ByPos,this.state.doc,0,0).to);}},{key:"viewportIsAppropriate",value:function viewportIsAppropriate(_ref39){var from=_ref39.from,to=_ref39.to;var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(!this.inView)return true;var _this$heightMap$lineA5=this.heightMap.lineAt(from,QueryType3.ByPos,this.state.doc,0,0),top2=_this$heightMap$lineA5.top;var _this$heightMap$lineA6=this.heightMap.lineAt(to,QueryType3.ByPos,this.state.doc,0,0),bottom=_this$heightMap$lineA6.bottom;var visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;return(from==0||top2<=visibleTop-Math.max(10,Math.min(-bias,250)))&&(to==this.state.doc.length||bottom>=visibleBottom+Math.max(10,Math.min(bias,250)))&&top2>visibleTop-2*1e3&&bottom<visibleBottom+2*1e3;}},{key:"mapLineGaps",value:function mapLineGaps(gaps,changes){if(!gaps.length||changes.empty)return gaps;var mapped=[];var _iterator191=_createForOfIteratorHelper(gaps),_step191;try{for(_iterator191.s();!(_step191=_iterator191.n()).done;){var gap=_step191.value;if(!changes.touchesRange(gap.from,gap.to))mapped.push(new LineGap3(changes.mapPos(gap.from),changes.mapPos(gap.to),gap.size));}}catch(err){_iterator191.e(err);}finally{_iterator191.f();}return mapped;}},{key:"ensureLineGaps",value:function ensureLineGaps(current){var _this124=this;var gaps=[];if(this.heightOracle.direction!=Direction3.LTR)return gaps;var _iterator192=_createForOfIteratorHelper(this.viewportLines),_step192;try{var _loop21=function _loop21(){var line=_step192.value;if(line.length<4e3)return"continue";var structure=lineStructure3(line.from,line.to,_this124.state);if(structure.total<4e3)return"continue";var viewFrom=void 0,viewTo=void 0;if(_this124.heightOracle.lineWrapping){var marginHeight=2e3/_this124.heightOracle.lineLength*_this124.heightOracle.lineHeight;viewFrom=findPosition3(structure,(_this124.visibleTop-line.top-marginHeight)/line.height);viewTo=findPosition3(structure,(_this124.visibleBottom-line.top+marginHeight)/line.height);}else{var totalWidth=structure.total*_this124.heightOracle.charWidth;var marginWidth=2e3*_this124.heightOracle.charWidth;viewFrom=findPosition3(structure,(_this124.pixelViewport.left-marginWidth)/totalWidth);viewTo=findPosition3(structure,(_this124.pixelViewport.right+marginWidth)/totalWidth);}var outside=[];if(viewFrom>line.from)outside.push({from:line.from,to:viewFrom});if(viewTo<line.to)outside.push({from:viewTo,to:line.to});var sel=_this124.state.selection.main;if(sel.from>=line.from&&sel.from<=line.to)cutRange3(outside,sel.from-10,sel.from+10);if(!sel.empty&&sel.to>=line.from&&sel.to<=line.to)cutRange3(outside,sel.to-10,sel.to+10);var _loop22=function _loop22(){var _outside3$_i=_outside3[_i187],from=_outside3$_i.from,to=_outside3$_i.to;if(to-from>1e3){gaps.push(find3(current,function(gap){return gap.from>=line.from&&gap.to<=line.to&&Math.abs(gap.from-from)<1e3&&Math.abs(gap.to-to)<1e3;})||new LineGap3(from,to,_this124.gapSize(line,from,to,structure)));}};for(var _i187=0,_outside3=outside;_i187<_outside3.length;_i187++){_loop22();}};for(_iterator192.s();!(_step192=_iterator192.n()).done;){var _ret2=_loop21();if(_ret2==="continue")continue;}}catch(err){_iterator192.e(err);}finally{_iterator192.f();}return gaps;}},{key:"gapSize",value:function gapSize(line,from,to,structure){var fraction=findFraction3(structure,to)-findFraction3(structure,from);if(this.heightOracle.lineWrapping){return line.height*fraction;}else{return structure.total*this.heightOracle.charWidth*fraction;}}},{key:"updateLineGaps",value:function updateLineGaps(gaps){var _this125=this;if(!LineGap3.same(gaps,this.lineGaps)){this.lineGaps=gaps;this.lineGapDeco=Decoration3.set(gaps.map(function(gap){return gap.draw(_this125.heightOracle.lineWrapping);}));}}},{key:"computeVisibleRanges",value:function computeVisibleRanges(){var deco=this.state.facet(decorations3);if(this.lineGaps.length)deco=deco.concat(this.lineGapDeco);var ranges=[];RangeSet.spans(deco,this.viewport.from,this.viewport.to,{span:function span(from,to){ranges.push({from:from,to:to});},point:function point(){}},20);var changed=ranges.length!=this.visibleRanges.length||this.visibleRanges.some(function(r,i){return r.from!=ranges[i].from||r.to!=ranges[i].to;});this.visibleRanges=ranges;return changed?4:0;}},{key:"lineBlockAt",value:function lineBlockAt(pos){return pos>=this.viewport.from&&pos<=this.viewport.to&&this.viewportLines.find(function(b){return b.from<=pos&&b.to>=pos;})||scaleBlock3(this.heightMap.lineAt(pos,QueryType3.ByPos,this.state.doc,0,0),this.scaler);}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){return scaleBlock3(this.heightMap.lineAt(this.scaler.fromDOM(height),QueryType3.ByHeight,this.state.doc,0,0),this.scaler);}},{key:"elementAtHeight",value:function elementAtHeight(height){return scaleBlock3(this.heightMap.blockAt(this.scaler.fromDOM(height),this.state.doc,0,0),this.scaler);}},{key:"docHeight",get:function get(){return this.scaler.toDOM(this.heightMap.height);}},{key:"contentHeight",get:function get(){return this.docHeight+this.paddingTop+this.paddingBottom;}}]);return ViewState3;}();var Viewport3=/*#__PURE__*/_createClass(function Viewport3(from,to){_classCallCheck(this,Viewport3);this.from=from;this.to=to;});function lineStructure3(from,to,state){var ranges=[],pos=from,total=0;RangeSet.spans(state.facet(decorations3),from,to,{span:function span(){},point:function point(from2,to2){if(from2>pos){ranges.push({from:pos,to:from2});total+=from2-pos;}pos=to2;}},20);if(pos<to){ranges.push({from:pos,to:to});total+=to-pos;}return{total:total,ranges:ranges};}function findPosition3(_ref40,ratio){var total=_ref40.total,ranges=_ref40.ranges;if(ratio<=0)return ranges[0].from;if(ratio>=1)return ranges[ranges.length-1].to;var dist=Math.floor(total*ratio);for(var _i188=0;;_i188++){var _ranges$_i3=ranges[_i188],from=_ranges$_i3.from,to=_ranges$_i3.to,size=to-from;if(dist<=size)return from+dist;dist-=size;}}function findFraction3(structure,pos){var counted=0;var _iterator193=_createForOfIteratorHelper(structure.ranges),_step193;try{for(_iterator193.s();!(_step193=_iterator193.n()).done;){var _step193$value=_step193.value,from=_step193$value.from,to=_step193$value.to;if(pos<=to){counted+=pos-from;break;}counted+=to-from;}}catch(err){_iterator193.e(err);}finally{_iterator193.f();}return counted/structure.total;}function cutRange3(ranges,from,to){for(var _i189=0;_i189<ranges.length;_i189++){var _r13=ranges[_i189];if(_r13.from<to&&_r13.to>from){var pieces=[];if(_r13.from<from)pieces.push({from:_r13.from,to:from});if(_r13.to>to)pieces.push({from:to,to:_r13.to});ranges.splice.apply(ranges,[_i189,1].concat(pieces));_i189+=pieces.length-1;}}}function find3(array,f){var _iterator194=_createForOfIteratorHelper(array),_step194;try{for(_iterator194.s();!(_step194=_iterator194.n()).done;){var val=_step194.value;if(f(val))return val;}}catch(err){_iterator194.e(err);}finally{_iterator194.f();}return void 0;}var IdScaler3={toDOM:function toDOM(n){return n;},fromDOM:function fromDOM(n){return n;},scale:1};var BigScaler3=/*#__PURE__*/function(){function BigScaler3(doc6,heightMap,viewports){_classCallCheck(this,BigScaler3);var vpHeight=0,base2=0,domBase=0;this.viewports=viewports.map(function(_ref41){var from=_ref41.from,to=_ref41.to;var top2=heightMap.lineAt(from,QueryType3.ByPos,doc6,0,0).top;var bottom=heightMap.lineAt(to,QueryType3.ByPos,doc6,0,0).bottom;vpHeight+=bottom-top2;return{from:from,to:to,top:top2,bottom:bottom,domTop:0,domBottom:0};});this.scale=(7e6-vpHeight)/(heightMap.height-vpHeight);var _iterator195=_createForOfIteratorHelper(this.viewports),_step195;try{for(_iterator195.s();!(_step195=_iterator195.n()).done;){var obj=_step195.value;obj.domTop=domBase+(obj.top-base2)*this.scale;domBase=obj.domBottom=obj.domTop+(obj.bottom-obj.top);base2=obj.bottom;}}catch(err){_iterator195.e(err);}finally{_iterator195.f();}}_createClass(BigScaler3,[{key:"toDOM",value:function toDOM(n){for(var _i190=0,base2=0,domBase=0;;_i190++){var vp=_i190<this.viewports.length?this.viewports[_i190]:null;if(!vp||n<vp.top)return domBase+(n-base2)*this.scale;if(n<=vp.bottom)return vp.domTop+(n-vp.top);base2=vp.bottom;domBase=vp.domBottom;}}},{key:"fromDOM",value:function fromDOM(n){for(var _i191=0,base2=0,domBase=0;;_i191++){var vp=_i191<this.viewports.length?this.viewports[_i191]:null;if(!vp||n<vp.domTop)return base2+(n-domBase)/this.scale;if(n<=vp.domBottom)return vp.top+(n-vp.domTop);base2=vp.bottom;domBase=vp.domBottom;}}}]);return BigScaler3;}();function scaleBlock3(block,scaler){if(scaler.scale==1)return block;var bTop=scaler.toDOM(block.top),bBottom=scaler.toDOM(block.bottom);return new BlockInfo3(block.from,block.length,bTop,bBottom-bTop,Array.isArray(block.type)?block.type.map(function(b){return scaleBlock3(b,scaler);}):block.type);}var theme3=/* @__PURE__ */Facet.define({combine:function combine(strs){return strs.join(" ");}});var darkTheme3=/* @__PURE__ */Facet.define({combine:function combine(values){return values.indexOf(true)>-1;}});var baseThemeID3=/* @__PURE__ */StyleModule.newName();var baseLightID3=/* @__PURE__ */StyleModule.newName();var baseDarkID3=/* @__PURE__ */StyleModule.newName();var lightDarkIDs3={"&light":"."+baseLightID3,"&dark":"."+baseDarkID3};function buildTheme3(main,spec,scopes){return new StyleModule(spec,{finish:function finish(sel){return /&/.test(sel)?sel.replace(/&\w*/,function(m){if(m=="&")return main;if(!scopes||!scopes[m])throw new RangeError("Unsupported selector: ".concat(m));return scopes[m];}):main+" "+sel;}});}var baseTheme3=/* @__PURE__ */buildTheme3("."+baseThemeID3,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs3);var observeOptions3={childList:true,characterData:true,subtree:true,attributes:true,characterDataOldValue:true};var useCharData3=browser3.ie&&browser3.ie_version<=11;var DOMObserver3=/*#__PURE__*/function(){function DOMObserver3(view,onChange,onScrollChanged){var _this126=this;_classCallCheck(this,DOMObserver3);this.view=view;this.onChange=onChange;this.onScrollChanged=onScrollChanged;this.active=false;this.selectionRange=new DOMSelectionState2();this.selectionChanged=false;this.delayedFlush=-1;this.resizeTimeout=-1;this.queue=[];this.delayedAndroidKey=null;this.scrollTargets=[];this.intersection=null;this.resize=null;this.intersecting=false;this.gapIntersection=null;this.gaps=[];this.parentCheck=-1;this.dom=view.contentDOM;this.observer=new MutationObserver(function(mutations){var _iterator196=_createForOfIteratorHelper(mutations),_step196;try{for(_iterator196.s();!(_step196=_iterator196.n()).done;){var mut=_step196.value;_this126.queue.push(mut);}}catch(err){_iterator196.e(err);}finally{_iterator196.f();}if((browser3.ie&&browser3.ie_version<=11||browser3.ios&&view.composing)&&mutations.some(function(m){return m.type=="childList"&&m.removedNodes.length||m.type=="characterData"&&m.oldValue.length>m.target.nodeValue.length;}))_this126.flushSoon();else _this126.flush();});if(useCharData3)this.onCharData=function(event){_this126.queue.push({target:event.target,type:"characterData",oldValue:event.prevValue});_this126.flushSoon();};this.onSelectionChange=this.onSelectionChange.bind(this);if(typeof ResizeObserver=="function"){this.resize=new ResizeObserver(function(){if(_this126.view.docView.lastUpdate<Date.now()-75&&_this126.resizeTimeout<0)_this126.resizeTimeout=setTimeout(function(){_this126.resizeTimeout=-1;_this126.view.requestMeasure();},50);});this.resize.observe(view.scrollDOM);}this.start();this.onScroll=this.onScroll.bind(this);window.addEventListener("scroll",this.onScroll);if(typeof IntersectionObserver=="function"){this.intersection=new IntersectionObserver(function(entries){if(_this126.parentCheck<0)_this126.parentCheck=setTimeout(_this126.listenForScroll.bind(_this126),1e3);if(entries.length>0&&entries[entries.length-1].intersectionRatio>0!=_this126.intersecting){_this126.intersecting=!_this126.intersecting;if(_this126.intersecting!=_this126.view.inView)_this126.onScrollChanged(document.createEvent("Event"));}},{});this.intersection.observe(this.dom);this.gapIntersection=new IntersectionObserver(function(entries){if(entries.length>0&&entries[entries.length-1].intersectionRatio>0)_this126.onScrollChanged(document.createEvent("Event"));},{});}this.listenForScroll();this.readSelectionRange();this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange);}_createClass(DOMObserver3,[{key:"onScroll",value:function onScroll(e){if(this.intersecting)this.flush(false);this.onScrollChanged(e);}},{key:"updateGaps",value:function updateGaps(gaps){if(this.gapIntersection&&(gaps.length!=this.gaps.length||this.gaps.some(function(g,i){return g!=gaps[i];}))){this.gapIntersection.disconnect();var _iterator197=_createForOfIteratorHelper(gaps),_step197;try{for(_iterator197.s();!(_step197=_iterator197.n()).done;){var gap=_step197.value;this.gapIntersection.observe(gap);}}catch(err){_iterator197.e(err);}finally{_iterator197.f();}this.gaps=gaps;}}},{key:"onSelectionChange",value:function onSelectionChange(event){if(!this.readSelectionRange()||this.delayedAndroidKey)return;var view=this.view,sel=this.selectionRange;if(view.state.facet(editable3)?view.root.activeElement!=this.dom:!hasSelection3(view.dom,sel))return;var context=sel.anchorNode&&view.docView.nearest(sel.anchorNode);if(context&&context.ignoreEvent(event))return;if((browser3.ie&&browser3.ie_version<=11||browser3.android&&browser3.chrome)&&!view.state.selection.main.empty&&sel.focusNode&&isEquivalentPosition3(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))this.flushSoon();else this.flush(false);}},{key:"readSelectionRange",value:function readSelectionRange(){var root=this.view.root,domSel=getSelection3(root);var range=browser3.safari&&root.nodeType==11&&deepActiveElement3()==this.view.contentDOM&&safariSelectionRangeHack3(this.view)||domSel;if(this.selectionRange.eq(range))return false;this.selectionRange.setRange(range);return this.selectionChanged=true;}},{key:"setSelectionRange",value:function setSelectionRange(anchor,head){this.selectionRange.set(anchor.node,anchor.offset,head.node,head.offset);this.selectionChanged=false;}},{key:"listenForScroll",value:function listenForScroll(){this.parentCheck=-1;var i=0,changed=null;for(var dom=this.dom;dom;){if(dom.nodeType==1){if(!changed&&i<this.scrollTargets.length&&this.scrollTargets[i]==dom)i++;else if(!changed)changed=this.scrollTargets.slice(0,i);if(changed)changed.push(dom);dom=dom.assignedSlot||dom.parentNode;}else if(dom.nodeType==11){dom=dom.host;}else{break;}}if(i<this.scrollTargets.length&&!changed)changed=this.scrollTargets.slice(0,i);if(changed){var _iterator198=_createForOfIteratorHelper(this.scrollTargets),_step198;try{for(_iterator198.s();!(_step198=_iterator198.n()).done;){var _dom6=_step198.value;_dom6.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator198.e(err);}finally{_iterator198.f();}var _iterator199=_createForOfIteratorHelper(this.scrollTargets=changed),_step199;try{for(_iterator199.s();!(_step199=_iterator199.n()).done;){var _dom7=_step199.value;_dom7.addEventListener("scroll",this.onScroll);}}catch(err){_iterator199.e(err);}finally{_iterator199.f();}}}},{key:"ignore",value:function ignore(f){if(!this.active)return f();try{this.stop();return f();}finally{this.start();this.clear();}}},{key:"start",value:function start(){if(this.active)return;this.observer.observe(this.dom,observeOptions3);if(useCharData3)this.dom.addEventListener("DOMCharacterDataModified",this.onCharData);this.active=true;}},{key:"stop",value:function stop(){if(!this.active)return;this.active=false;this.observer.disconnect();if(useCharData3)this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData);}},{key:"clear",value:function clear(){this.observer.takeRecords();this.queue.length=0;this.selectionChanged=false;}},{key:"delayAndroidKey",value:function delayAndroidKey(key,keyCode){var _this127=this;if(!this.delayedAndroidKey)requestAnimationFrame(function(){var key2=_this127.delayedAndroidKey;_this127.delayedAndroidKey=null;var startState=_this127.view.state;if(dispatchKey3(_this127.view.contentDOM,key2.key,key2.keyCode))_this127.processRecords();else _this127.flush();if(_this127.view.state==startState)_this127.view.update([]);});if(!this.delayedAndroidKey||key=="Enter")this.delayedAndroidKey={key:key,keyCode:keyCode};}},{key:"flushSoon",value:function flushSoon(){var _this128=this;if(this.delayedFlush<0)this.delayedFlush=window.setTimeout(function(){_this128.delayedFlush=-1;_this128.flush();},20);}},{key:"forceFlush",value:function forceFlush(){if(this.delayedFlush>=0){window.clearTimeout(this.delayedFlush);this.delayedFlush=-1;this.flush();}}},{key:"processRecords",value:function processRecords(){var records=this.queue;var _iterator200=_createForOfIteratorHelper(this.observer.takeRecords()),_step200;try{for(_iterator200.s();!(_step200=_iterator200.n()).done;){var mut=_step200.value;records.push(mut);}}catch(err){_iterator200.e(err);}finally{_iterator200.f();}if(records.length)this.queue=[];var from=-1,to=-1,typeOver=false;var _iterator201=_createForOfIteratorHelper(records),_step201;try{for(_iterator201.s();!(_step201=_iterator201.n()).done;){var record=_step201.value;var range=this.readMutation(record);if(!range)continue;if(range.typeOver)typeOver=true;if(from==-1){from=range.from;to=range.to;}else{from=Math.min(range.from,from);to=Math.max(range.to,to);}}}catch(err){_iterator201.e(err);}finally{_iterator201.f();}return{from:from,to:to,typeOver:typeOver};}},{key:"flush",value:function flush(){var readSelection=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.delayedFlush>=0||this.delayedAndroidKey)return;if(readSelection)this.readSelectionRange();var _this$processRecords3=this.processRecords(),from=_this$processRecords3.from,to=_this$processRecords3.to,typeOver=_this$processRecords3.typeOver;var newSel=this.selectionChanged&&hasSelection3(this.dom,this.selectionRange);if(from<0&&!newSel)return;this.selectionChanged=false;var startState=this.view.state;this.onChange(from,to,typeOver);if(this.view.state==startState)this.view.update([]);}},{key:"readMutation",value:function readMutation(rec){var cView=this.view.docView.nearest(rec.target);if(!cView||cView.ignoreMutation(rec))return null;cView.markDirty(rec.type=="attributes");if(rec.type=="attributes")cView.dirty|=4;if(rec.type=="childList"){var childBefore=findChild3(cView,rec.previousSibling||rec.target.previousSibling,-1);var childAfter=findChild3(cView,rec.nextSibling||rec.target.nextSibling,1);return{from:childBefore?cView.posAfter(childBefore):cView.posAtStart,to:childAfter?cView.posBefore(childAfter):cView.posAtEnd,typeOver:false};}else if(rec.type=="characterData"){return{from:cView.posAtStart,to:cView.posAtEnd,typeOver:rec.target.nodeValue==rec.oldValue};}else{return null;}}},{key:"destroy",value:function destroy(){var _a,_b,_c;this.stop();(_a=this.intersection)===null||_a===void 0?void 0:_a.disconnect();(_b=this.gapIntersection)===null||_b===void 0?void 0:_b.disconnect();(_c=this.resize)===null||_c===void 0?void 0:_c.disconnect();var _iterator202=_createForOfIteratorHelper(this.scrollTargets),_step202;try{for(_iterator202.s();!(_step202=_iterator202.n()).done;){var dom=_step202.value;dom.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator202.e(err);}finally{_iterator202.f();}window.removeEventListener("scroll",this.onScroll);this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange);clearTimeout(this.parentCheck);clearTimeout(this.resizeTimeout);}}]);return DOMObserver3;}();function findChild3(cView,dom,dir){while(dom){var curView=ContentView3.get(dom);if(curView&&curView.parent==cView)return curView;var parent=dom.parentNode;dom=parent!=cView.dom?parent:dir>0?dom.nextSibling:dom.previousSibling;}return null;}function safariSelectionRangeHack3(view){var found=null;function read(event){event.preventDefault();event.stopImmediatePropagation();found=event.getTargetRanges()[0];}view.contentDOM.addEventListener("beforeinput",read,true);document.execCommand("indent");view.contentDOM.removeEventListener("beforeinput",read,true);if(!found)return null;var anchorNode=found.startContainer,anchorOffset=found.startOffset;var focusNode=found.endContainer,focusOffset=found.endOffset;var curAnchor=view.docView.domAtPos(view.state.selection.main.anchor);if(isEquivalentPosition3(curAnchor.node,curAnchor.offset,focusNode,focusOffset)){var _ref42=[focusNode,focusOffset,anchorNode,anchorOffset];anchorNode=_ref42[0];anchorOffset=_ref42[1];focusNode=_ref42[2];focusOffset=_ref42[3];}return{anchorNode:anchorNode,anchorOffset:anchorOffset,focusNode:focusNode,focusOffset:focusOffset};}function applyDOMChange3(view,start,end,typeOver){var change,newSel;var sel=view.state.selection.main;if(start>-1){var bounds=view.docView.domBoundsAround(start,end,0);if(!bounds||view.state.readOnly)return;var from=bounds.from,to=bounds.to;var selPoints=view.docView.impreciseHead||view.docView.impreciseAnchor?[]:selectionPoints3(view);var reader=new DOMReader3(selPoints,view);reader.readRange(bounds.startDOM,bounds.endDOM);newSel=selectionFromPoints3(selPoints,from);var preferredPos=sel.from,preferredSide=null;if(view.inputState.lastKeyCode===8&&view.inputState.lastKeyTime>Date.now()-100||browser3.android&&reader.text.length<to-from){preferredPos=sel.to;preferredSide="end";}var diff=findDiff3(view.state.sliceDoc(from,to),reader.text,preferredPos-from,preferredSide);if(diff)change={from:from+diff.from,to:from+diff.toA,insert:view.state.toText(reader.text.slice(diff.from,diff.toB))};}else if(view.hasFocus||!view.state.facet(editable3)){var domSel=view.observer.selectionRange;var _view$docView3=view.docView,iHead=_view$docView3.impreciseHead,iAnchor=_view$docView3.impreciseAnchor;var head=iHead&&iHead.node==domSel.focusNode&&iHead.offset==domSel.focusOffset||!contains3(view.contentDOM,domSel.focusNode)?view.state.selection.main.head:view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset);var anchor=iAnchor&&iAnchor.node==domSel.anchorNode&&iAnchor.offset==domSel.anchorOffset||!contains3(view.contentDOM,domSel.anchorNode)?view.state.selection.main.anchor:view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset);if(head!=sel.head||anchor!=sel.anchor)newSel=EditorSelection.single(anchor,head);}if(!change&&!newSel)return;if(!change&&typeOver&&!sel.empty&&newSel&&newSel.main.empty)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,sel.to)};else if(change&&change.from>=sel.from&&change.to<=sel.to&&(change.from!=sel.from||change.to!=sel.to)&&sel.to-sel.from-(change.to-change.from)<=4)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,change.from).append(change.insert).append(view.state.doc.slice(change.to,sel.to))};if(change){var startState=view.state;if(browser3.ios&&view.inputState.flushIOSKey(view))return;if(browser3.android&&(change.from==sel.from&&change.to==sel.to&&change.insert.length==1&&change.insert.lines==2&&dispatchKey3(view.contentDOM,"Enter",13)||change.from==sel.from-1&&change.to==sel.to&&change.insert.length==0&&dispatchKey3(view.contentDOM,"Backspace",8)||change.from==sel.from&&change.to==sel.to+1&&change.insert.length==0&&dispatchKey3(view.contentDOM,"Delete",46)))return;var _text8=change.insert.toString();if(view.state.facet(inputHandler3).some(function(h){return h(view,change.from,change.to,_text8);}))return;if(view.inputState.composing>=0)view.inputState.composing++;var tr;if(change.from>=sel.from&&change.to<=sel.to&&change.to-change.from>=(sel.to-sel.from)/3&&(!newSel||newSel.main.empty&&newSel.main.from==change.from+change.insert.length)&&view.inputState.composing<0){var before=sel.from<change.from?startState.sliceDoc(sel.from,change.from):"";var after=sel.to>change.to?startState.sliceDoc(change.to,sel.to):"";tr=startState.replaceSelection(view.state.toText(before+change.insert.sliceString(0,void 0,view.state.lineBreak)+after));}else{var changes=startState.changes(change);var mainSel=newSel&&!startState.selection.main.eq(newSel.main)&&newSel.main.to<=changes.newLength?newSel.main:void 0;if(startState.selection.ranges.length>1&&view.inputState.composing>=0&&change.to<=sel.to&&change.to>=sel.to-10){var replaced=view.state.sliceDoc(change.from,change.to);var compositionRange=compositionSurroundingNode2(view)||view.state.doc.lineAt(sel.head);var offset=sel.to-change.to,size=sel.to-sel.from;tr=startState.changeByRange(function(range){if(range.from==sel.from&&range.to==sel.to)return{changes:changes,range:mainSel||range.map(changes)};var to=range.to-offset,from=to-replaced.length;if(range.to-range.from!=size||view.state.sliceDoc(from,to)!=replaced||compositionRange&&range.to>=compositionRange.from&&range.from<=compositionRange.to)return{range:range};var rangeChanges=startState.changes({from:from,to:to,insert:change.insert}),selOff=range.to-sel.to;return{changes:rangeChanges,range:!mainSel?range.map(rangeChanges):EditorSelection.range(Math.max(0,mainSel.anchor+selOff),Math.max(0,mainSel.head+selOff))};});}else{tr={changes:changes,selection:mainSel&&startState.selection.replaceRange(mainSel)};}}var userEvent="input.type";if(view.composing){userEvent+=".compose";if(view.inputState.compositionFirstChange){userEvent+=".start";view.inputState.compositionFirstChange=false;}}view.dispatch(tr,{scrollIntoView:true,userEvent:userEvent});}else if(newSel&&!newSel.main.eq(sel)){var scrollIntoView6=false,_userEvent3="select";if(view.inputState.lastSelectionTime>Date.now()-50){if(view.inputState.lastSelectionOrigin=="select")scrollIntoView6=true;_userEvent3=view.inputState.lastSelectionOrigin;}view.dispatch({selection:newSel,scrollIntoView:scrollIntoView6,userEvent:_userEvent3});}}function findDiff3(a,b,preferredPos,preferredSide){var minLen=Math.min(a.length,b.length);var from=0;while(from<minLen&&a.charCodeAt(from)==b.charCodeAt(from)){from++;}if(from==minLen&&a.length==b.length)return null;var toA=a.length,toB=b.length;while(toA>0&&toB>0&&a.charCodeAt(toA-1)==b.charCodeAt(toB-1)){toA--;toB--;}if(preferredSide=="end"){var adjust=Math.max(0,from-Math.min(toA,toB));preferredPos-=toA+adjust-from;}if(toA<from&&a.length<b.length){var move=preferredPos<=from&&preferredPos>=toA?from-preferredPos:0;from-=move;toB=from+(toB-toA);toA=from;}else if(toB<from){var _move3=preferredPos<=from&&preferredPos>=toB?from-preferredPos:0;from-=_move3;toA=from+(toA-toB);toB=from;}return{from:from,toA:toA,toB:toB};}function selectionPoints3(view){var result=[];if(view.root.activeElement!=view.contentDOM)return result;var _view$observer$select3=view.observer.selectionRange,anchorNode=_view$observer$select3.anchorNode,anchorOffset=_view$observer$select3.anchorOffset,focusNode=_view$observer$select3.focusNode,focusOffset=_view$observer$select3.focusOffset;if(anchorNode){result.push(new DOMPoint3(anchorNode,anchorOffset));if(focusNode!=anchorNode||focusOffset!=anchorOffset)result.push(new DOMPoint3(focusNode,focusOffset));}return result;}function selectionFromPoints3(points,base2){if(points.length==0)return null;var anchor=points[0].pos,head=points.length==2?points[1].pos:anchor;return anchor>-1&&head>-1?EditorSelection.single(anchor+base2,head+base2):null;}var EditorView3=/*#__PURE__*/function(){function EditorView3(){var _this129=this;var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,EditorView3);this.plugins=[];this.pluginMap=/* @__PURE__ */new Map();this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.destroyed=false;this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.style.cssText="position: absolute; top: -10000px";this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);this._dispatch=config2.dispatch||function(tr){return _this129.update([tr]);};this.dispatch=this.dispatch.bind(this);this.root=config2.root||getRoot3(config2.parent)||document;this.viewState=new ViewState3(config2.state||EditorState.create());this.plugins=this.state.facet(viewPlugin3).map(function(spec){return new PluginInstance3(spec);});var _iterator203=_createForOfIteratorHelper(this.plugins),_step203;try{for(_iterator203.s();!(_step203=_iterator203.n()).done;){var plugin=_step203.value;plugin.update(this);}}catch(err){_iterator203.e(err);}finally{_iterator203.f();}this.observer=new DOMObserver3(this,function(from,to,typeOver){applyDOMChange3(_this129,from,to,typeOver);},function(event){_this129.inputState.runScrollHandlers(_this129,event);if(_this129.observer.intersecting)_this129.measure();});this.inputState=new InputState3(this);this.docView=new DocView3(this);this.mountStyles();this.updateAttrs();this.updateState=0;ensureGlobalHandler3();this.requestMeasure();if(config2.parent)config2.parent.appendChild(this.dom);}_createClass(EditorView3,[{key:"state",get:function get(){return this.viewState.state;}},{key:"viewport",get:function get(){return this.viewState.viewport;}},{key:"visibleRanges",get:function get(){return this.viewState.visibleRanges;}},{key:"inView",get:function get(){return this.viewState.inView;}},{key:"composing",get:function get(){return this.inputState.composing>0;}},{key:"dispatch",value:function dispatch(){var _this$state3;this._dispatch(arguments.length==1&&(arguments.length<=0?undefined:arguments[0])instanceof Transaction?arguments.length<=0?undefined:arguments[0]:(_this$state3=this.state).update.apply(_this$state3,arguments));}},{key:"update",value:function update(transactions){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");var redrawn=false,update;var state=this.state;var _iterator204=_createForOfIteratorHelper(transactions),_step204;try{for(_iterator204.s();!(_step204=_iterator204.n()).done;){var _tr3=_step204.value;if(_tr3.startState!=state)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");state=_tr3.state;}}catch(err){_iterator204.e(err);}finally{_iterator204.f();}if(this.destroyed){this.viewState.state=state;return;}if(state.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(state);update=new ViewUpdate3(this,state,transactions);var scrollTarget=this.viewState.scrollTarget;try{this.updateState=2;var _iterator205=_createForOfIteratorHelper(transactions),_step205;try{for(_iterator205.s();!(_step205=_iterator205.n()).done;){var tr=_step205.value;if(scrollTarget)scrollTarget=scrollTarget.map(tr.changes);if(tr.scrollIntoView){var main=tr.state.selection.main;scrollTarget=new ScrollTarget3(main.empty?main:EditorSelection.cursor(main.head,main.head>main.anchor?-1:1));}var _iterator206=_createForOfIteratorHelper(tr.effects),_step206;try{for(_iterator206.s();!(_step206=_iterator206.n()).done;){var e=_step206.value;if(e.is(scrollTo3))scrollTarget=new ScrollTarget3(e.value);else if(e.is(centerOn3))scrollTarget=new ScrollTarget3(e.value,"center");else if(e.is(scrollIntoView2))scrollTarget=e.value;}}catch(err){_iterator206.e(err);}finally{_iterator206.f();}}}catch(err){_iterator205.e(err);}finally{_iterator205.f();}this.viewState.update(update,scrollTarget);this.bidiCache=CachedOrder3.update(this.bidiCache,update.changes);if(!update.empty){this.updatePlugins(update);this.inputState.update(update);}redrawn=this.docView.update(update);if(this.state.facet(styleModule3)!=this.styleModules)this.mountStyles();this.updateAttrs();this.showAnnouncements(transactions);this.docView.updateSelection(redrawn,transactions.some(function(tr){return tr.isUserEvent("select.pointer");}));}finally{this.updateState=0;}if(redrawn||scrollTarget||this.viewState.mustEnforceCursorAssoc)this.requestMeasure();if(!update.empty){var _iterator207=_createForOfIteratorHelper(this.state.facet(updateListener3)),_step207;try{for(_iterator207.s();!(_step207=_iterator207.n()).done;){var listener=_step207.value;listener(update);}}catch(err){_iterator207.e(err);}finally{_iterator207.f();}}}},{key:"setState",value:function setState(newState){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=newState;return;}this.updateState=2;var hadFocus=this.hasFocus;try{var _iterator208=_createForOfIteratorHelper(this.plugins),_step208;try{for(_iterator208.s();!(_step208=_iterator208.n()).done;){var plugin=_step208.value;plugin.destroy(this);}}catch(err){_iterator208.e(err);}finally{_iterator208.f();}this.viewState=new ViewState3(newState);this.plugins=newState.facet(viewPlugin3).map(function(spec){return new PluginInstance3(spec);});this.pluginMap.clear();var _iterator209=_createForOfIteratorHelper(this.plugins),_step209;try{for(_iterator209.s();!(_step209=_iterator209.n()).done;){var _plugin8=_step209.value;_plugin8.update(this);}}catch(err){_iterator209.e(err);}finally{_iterator209.f();}this.docView=new DocView3(this);this.inputState.ensureHandlers(this);this.mountStyles();this.updateAttrs();this.bidiCache=[];}finally{this.updateState=0;}if(hadFocus)this.focus();this.requestMeasure();}},{key:"updatePlugins",value:function updatePlugins(update){var prevSpecs=update.startState.facet(viewPlugin3),specs=update.state.facet(viewPlugin3);if(prevSpecs!=specs){var newPlugins=[];var _iterator210=_createForOfIteratorHelper(specs),_step210;try{for(_iterator210.s();!(_step210=_iterator210.n()).done;){var spec=_step210.value;var found=prevSpecs.indexOf(spec);if(found<0){newPlugins.push(new PluginInstance3(spec));}else{var plugin=this.plugins[found];plugin.mustUpdate=update;newPlugins.push(plugin);}}}catch(err){_iterator210.e(err);}finally{_iterator210.f();}var _iterator211=_createForOfIteratorHelper(this.plugins),_step211;try{for(_iterator211.s();!(_step211=_iterator211.n()).done;){var _plugin9=_step211.value;if(_plugin9.mustUpdate!=update)_plugin9.destroy(this);}}catch(err){_iterator211.e(err);}finally{_iterator211.f();}this.plugins=newPlugins;this.pluginMap.clear();this.inputState.ensureHandlers(this);}else{var _iterator212=_createForOfIteratorHelper(this.plugins),_step212;try{for(_iterator212.s();!(_step212=_iterator212.n()).done;){var _p6=_step212.value;_p6.mustUpdate=update;}}catch(err){_iterator212.e(err);}finally{_iterator212.f();}}for(var _i192=0;_i192<this.plugins.length;_i192++){this.plugins[_i192].update(this);}}},{key:"measure",value:function measure(){var _this130=this;var flush=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.destroyed)return;if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.measureScheduled=0;if(flush)this.observer.flush();var updated=null;try{for(var _i193=0;;_i193++){this.updateState=1;var oldViewport=this.viewport;var changed=this.viewState.measure(this);if(!changed&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(_i193>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break;}var measuring=[];if(!(changed&4)){var _ref43=[measuring,this.measureRequests];this.measureRequests=_ref43[0];measuring=_ref43[1];}var measured=measuring.map(function(m){try{return m.read(_this130);}catch(e){logException3(_this130.state,e);return BadMeasure3;}});var update=new ViewUpdate3(this,this.state),redrawn=false,scrolled=false;update.flags|=changed;if(!updated)updated=update;else updated.flags|=changed;this.updateState=2;if(!update.empty){this.updatePlugins(update);this.inputState.update(update);this.updateAttrs();redrawn=this.docView.update(update);}for(var i2=0;i2<measuring.length;i2++){if(measured[i2]!=BadMeasure3){try{var m=measuring[i2];if(m.write)m.write(measured[i2],this);}catch(e){logException3(this.state,e);}}}if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget);this.viewState.scrollTarget=null;scrolled=true;}if(redrawn)this.docView.updateSelection(true);if(this.viewport.from==oldViewport.from&&this.viewport.to==oldViewport.to&&!scrolled&&this.measureRequests.length==0)break;}}finally{this.updateState=0;this.measureScheduled=-1;}if(updated&&!updated.empty){var _iterator213=_createForOfIteratorHelper(this.state.facet(updateListener3)),_step213;try{for(_iterator213.s();!(_step213=_iterator213.n()).done;){var listener=_step213.value;listener(updated);}}catch(err){_iterator213.e(err);}finally{_iterator213.f();}}}},{key:"themeClasses",get:function get(){return baseThemeID3+" "+(this.state.facet(darkTheme3)?baseDarkID3:baseLightID3)+" "+this.state.facet(theme3);}},{key:"updateAttrs",value:function updateAttrs(){var _this131=this;var editorAttrs=attrsFromFacet2(this,editorAttributes3,{"class":"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses});var contentAttrs={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:!this.state.facet(editable3)?"false":"true","class":"cm-content",style:"".concat(browser3.tabSize,": ").concat(this.state.tabSize),role:"textbox","aria-multiline":"true"};if(this.state.readOnly)contentAttrs["aria-readonly"]="true";attrsFromFacet2(this,contentAttributes3,contentAttrs);this.observer.ignore(function(){updateAttrs3(_this131.contentDOM,_this131.contentAttrs,contentAttrs);updateAttrs3(_this131.dom,_this131.editorAttrs,editorAttrs);});this.editorAttrs=editorAttrs;this.contentAttrs=contentAttrs;}},{key:"showAnnouncements",value:function showAnnouncements(trs){var first=true;var _iterator214=_createForOfIteratorHelper(trs),_step214;try{for(_iterator214.s();!(_step214=_iterator214.n()).done;){var tr=_step214.value;var _iterator215=_createForOfIteratorHelper(tr.effects),_step215;try{for(_iterator215.s();!(_step215=_iterator215.n()).done;){var effect=_step215.value;if(effect.is(EditorView3.announce)){if(first)this.announceDOM.textContent="";first=false;var div=this.announceDOM.appendChild(document.createElement("div"));div.textContent=effect.value;}}}catch(err){_iterator215.e(err);}finally{_iterator215.f();}}}catch(err){_iterator214.e(err);}finally{_iterator214.f();}}},{key:"mountStyles",value:function mountStyles(){this.styleModules=this.state.facet(styleModule3);StyleModule.mount(this.root,this.styleModules.concat(baseTheme3).reverse());}},{key:"readMeasured",value:function readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");if(this.updateState==0&&this.measureScheduled>-1)this.measure(false);}},{key:"requestMeasure",value:function requestMeasure(request){var _this132=this;if(this.measureScheduled<0)this.measureScheduled=requestAnimationFrame(function(){return _this132.measure();});if(request){if(request.key!=null)for(var _i194=0;_i194<this.measureRequests.length;_i194++){if(this.measureRequests[_i194].key===request.key){this.measureRequests[_i194]=request;return;}}this.measureRequests.push(request);}}},{key:"pluginField",value:function pluginField(field){var result=[];var _iterator216=_createForOfIteratorHelper(this.plugins),_step216;try{for(_iterator216.s();!(_step216=_iterator216.n()).done;){var plugin=_step216.value;plugin.update(this).takeField(field,result);}}catch(err){_iterator216.e(err);}finally{_iterator216.f();}return result;}},{key:"plugin",value:function plugin(_plugin7){var known=this.pluginMap.get(_plugin7);if(known===void 0||known&&known.spec!=_plugin7)this.pluginMap.set(_plugin7,known=this.plugins.find(function(p){return p.spec==_plugin7;})||null);return known&&known.update(this).value;}},{key:"documentTop",get:function get(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop;}},{key:"documentPadding",get:function get(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom};}},{key:"blockAtHeight",value:function blockAtHeight(height,docTop){var top2=ensureTop3(docTop,this);return this.elementAtHeight(height-top2).moveY(top2);}},{key:"elementAtHeight",value:function elementAtHeight(height){this.readMeasured();return this.viewState.elementAtHeight(height);}},{key:"visualLineAtHeight",value:function visualLineAtHeight(height,docTop){var top2=ensureTop3(docTop,this);return this.lineBlockAtHeight(height-top2).moveY(top2);}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){this.readMeasured();return this.viewState.lineBlockAtHeight(height);}},{key:"viewportLines",value:function viewportLines(f,docTop){var top2=ensureTop3(docTop,this);var _iterator217=_createForOfIteratorHelper(this.viewportLineBlocks),_step217;try{for(_iterator217.s();!(_step217=_iterator217.n()).done;){var line=_step217.value;f(line.moveY(top2));}}catch(err){_iterator217.e(err);}finally{_iterator217.f();}}},{key:"viewportLineBlocks",get:function get(){return this.viewState.viewportLines;}},{key:"visualLineAt",value:function visualLineAt(pos){var docTop=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.lineBlockAt(pos).moveY(docTop+this.viewState.paddingTop);}},{key:"lineBlockAt",value:function lineBlockAt(pos){return this.viewState.lineBlockAt(pos);}},{key:"contentHeight",get:function get(){return this.viewState.contentHeight;}},{key:"moveByChar",value:function moveByChar(start,forward,by){return skipAtoms3(this,start,moveByChar3(this,start,forward,by));}},{key:"moveByGroup",value:function moveByGroup(start,forward){var _this133=this;return skipAtoms3(this,start,moveByChar3(this,start,forward,function(initial){return byGroup3(_this133,start.head,initial);}));}},{key:"moveToLineBoundary",value:function moveToLineBoundary(start,forward){var includeWrap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return moveToLineBoundary3(this,start,forward,includeWrap);}},{key:"moveVertically",value:function moveVertically(start,forward,distance){return skipAtoms3(this,start,moveVertically3(this,start,forward,distance));}},{key:"scrollPosIntoView",value:function scrollPosIntoView(pos){this.dispatch({effects:scrollTo3.of(EditorSelection.cursor(pos))});}},{key:"domAtPos",value:function domAtPos(pos){return this.docView.domAtPos(pos);}},{key:"posAtDOM",value:function posAtDOM(node){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.docView.posFromDOM(node,offset);}},{key:"posAtCoords",value:function posAtCoords(coords){var precise=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.readMeasured();return posAtCoords3(this,coords,precise);}},{key:"coordsAtPos",value:function coordsAtPos(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.readMeasured();var rect=this.docView.coordsAt(pos,side);if(!rect||rect.left==rect.right)return rect;var line=this.state.doc.lineAt(pos),order=this.bidiSpans(line);var span=order[BidiSpan3.find(order,pos-line.from,-1,side)];return flattenRect3(rect,span.dir==Direction3.LTR==side>0);}},{key:"defaultCharacterWidth",get:function get(){return this.viewState.heightOracle.charWidth;}},{key:"defaultLineHeight",get:function get(){return this.viewState.heightOracle.lineHeight;}},{key:"textDirection",get:function get(){return this.viewState.heightOracle.direction;}},{key:"lineWrapping",get:function get(){return this.viewState.heightOracle.lineWrapping;}},{key:"bidiSpans",value:function bidiSpans(line){if(line.length>MaxBidiLine3)return trivialOrder3(line.length);var dir=this.textDirection;var _iterator218=_createForOfIteratorHelper(this.bidiCache),_step218;try{for(_iterator218.s();!(_step218=_iterator218.n()).done;){var entry=_step218.value;if(entry.from==line.from&&entry.dir==dir)return entry.order;}}catch(err){_iterator218.e(err);}finally{_iterator218.f();}var order=computeOrder3(line.text,this.textDirection);this.bidiCache.push(new CachedOrder3(line.from,line.to,dir,order));return order;}},{key:"hasFocus",get:function get(){var _a;return(document.hasFocus()||browser3.safari&&((_a=this.inputState)===null||_a===void 0?void 0:_a.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM;}},{key:"focus",value:function focus(){var _this134=this;this.observer.ignore(function(){focusPreventScroll3(_this134.contentDOM);_this134.docView.updateSelection();});}},{key:"destroy",value:function destroy(){var _iterator219=_createForOfIteratorHelper(this.plugins),_step219;try{for(_iterator219.s();!(_step219=_iterator219.n()).done;){var plugin=_step219.value;plugin.destroy(this);}}catch(err){_iterator219.e(err);}finally{_iterator219.f();}this.plugins=[];this.inputState.destroy();this.dom.remove();this.observer.destroy();if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.destroyed=true;}}],[{key:"scrollIntoView",value:function scrollIntoView(pos){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return scrollIntoView2.of(new ScrollTarget3(typeof pos=="number"?EditorSelection.cursor(pos):pos,options.y,options.x,options.yMargin,options.xMargin));}},{key:"domEventHandlers",value:function domEventHandlers(handlers6){return ViewPlugin3.define(function(){return{};},{eventHandlers:handlers6});}},{key:"theme",value:function theme(spec,options){var prefix=StyleModule.newName();var result=[theme3.of(prefix),styleModule3.of(buildTheme3(".".concat(prefix),spec))];if(options&&options.dark)result.push(darkTheme3.of(true));return result;}},{key:"baseTheme",value:function baseTheme(spec){return Prec.lowest(styleModule3.of(buildTheme3("."+baseThemeID3,spec,lightDarkIDs3)));}}]);return EditorView3;}();EditorView3.scrollTo=scrollTo3;EditorView3.centerOn=centerOn3;EditorView3.styleModule=styleModule3;EditorView3.inputHandler=inputHandler3;EditorView3.exceptionSink=exceptionSink3;EditorView3.updateListener=updateListener3;EditorView3.editable=editable3;EditorView3.mouseSelectionStyle=mouseSelectionStyle3;EditorView3.dragMovesSelection=dragMovesSelection$13;EditorView3.clickAddsSelectionRange=clickAddsSelectionRange3;EditorView3.decorations=decorations3;EditorView3.darkTheme=darkTheme3;EditorView3.contentAttributes=contentAttributes3;EditorView3.editorAttributes=editorAttributes3;EditorView3.lineWrapping=/* @__PURE__ */EditorView3.contentAttributes.of({"class":"cm-lineWrapping"});EditorView3.announce=/* @__PURE__ */StateEffect.define();var MaxBidiLine3=4096;function ensureTop3(given,view){return(given==null?view.contentDOM.getBoundingClientRect().top:given)+view.viewState.paddingTop;}var resizeDebounce3=-1;function ensureGlobalHandler3(){window.addEventListener("resize",function(){if(resizeDebounce3==-1)resizeDebounce3=setTimeout(handleResize3,50);});}function handleResize3(){resizeDebounce3=-1;var found=document.querySelectorAll(".cm-content");for(var _i195=0;_i195<found.length;_i195++){var docView=ContentView3.get(found[_i195]);if(docView)docView.editorView.requestMeasure();}}var BadMeasure3={};var CachedOrder3=/*#__PURE__*/function(){function CachedOrder3(from,to,dir,order){_classCallCheck(this,CachedOrder3);this.from=from;this.to=to;this.dir=dir;this.order=order;}_createClass(CachedOrder3,null,[{key:"update",value:function update(cache,changes){if(changes.empty)return cache;var result=[],lastDir=cache.length?cache[cache.length-1].dir:Direction3.LTR;for(var _i196=Math.max(0,cache.length-10);_i196<cache.length;_i196++){var entry=cache[_i196];if(entry.dir==lastDir&&!changes.touchesRange(entry.from,entry.to))result.push(new CachedOrder3(changes.mapPos(entry.from,1),changes.mapPos(entry.to,-1),entry.dir,entry.order));}return result;}}]);return CachedOrder3;}();function attrsFromFacet2(view,facet,base2){for(var sources=view.state.facet(facet),_i197=sources.length-1;_i197>=0;_i197--){var source=sources[_i197],value=typeof source=="function"?source(view):source;if(value)combineAttrs3(value,base2);}return base2;}var currentPlatform3=browser3.mac?"mac":browser3.windows?"win":browser3.linux?"linux":"key";var CanHidePrimary3=!browser3.ios;var themeSpec3={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};if(CanHidePrimary3)themeSpec3[".cm-line"].caretColor="transparent !important";var UnicodeRegexpSupport3=/x/.unicode!=null?"gu":"g";// ../node_modules/@codemirror/gutter/dist/index.js
var GutterMarker=/*#__PURE__*/function(_RangeValue4){_inherits(GutterMarker,_RangeValue4);var _super69=_createSuper(GutterMarker);function GutterMarker(){_classCallCheck(this,GutterMarker);return _super69.apply(this,arguments);}_createClass(GutterMarker,[{key:"compare",value:function compare(other){return this==other||this.constructor==other.constructor&&this.eq(other);}},{key:"eq",value:function eq(other){return false;}},{key:"destroy",value:function destroy(dom){}}]);return GutterMarker;}(RangeValue);GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=void 0;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=true;var gutterLineClass=/* @__PURE__ */Facet.define();var defaults={"class":"",renderEmptyElements:false,elementStyle:"",markers:function markers(){return RangeSet.empty;},lineMarker:function lineMarker(){return null;},lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}};var activeGutters=/* @__PURE__ */Facet.define();function gutter(config2){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults),config2))];}var baseTheme4=/* @__PURE__ */EditorView3.baseTheme({".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#999",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"}});var unfixGutters=/* @__PURE__ */Facet.define({combine:function combine(values){return values.some(function(x){return x;});}});function gutters(config2){var result=[gutterView,baseTheme4];if(config2&&config2.fixed===false)result.push(unfixGutters.of(true));return result;}var gutterView=/* @__PURE__ */ViewPlugin3.fromClass(/*#__PURE__*/function(){function _class5(view){_classCallCheck(this,_class5);this.view=view;this.prevViewport=view.viewport;this.dom=document.createElement("div");this.dom.className="cm-gutters";this.dom.setAttribute("aria-hidden","true");this.dom.style.minHeight=this.view.contentHeight+"px";this.gutters=view.state.facet(activeGutters).map(function(conf){return new SingleGutterView(view,conf);});var _iterator220=_createForOfIteratorHelper(this.gutters),_step220;try{for(_iterator220.s();!(_step220=_iterator220.n()).done;){var gutter2=_step220.value;this.dom.appendChild(gutter2.dom);}}catch(err){_iterator220.e(err);}finally{_iterator220.f();}this.fixed=!view.state.facet(unfixGutters);if(this.fixed){this.dom.style.position="sticky";}this.syncGutters(false);view.scrollDOM.insertBefore(this.dom,view.contentDOM);}_createClass(_class5,[{key:"update",value:function update(_update20){if(this.updateGutters(_update20)){var vpA=this.prevViewport,vpB=_update20.view.viewport;var vpOverlap=Math.min(vpA.to,vpB.to)-Math.max(vpA.from,vpB.from);this.syncGutters(vpOverlap<(vpB.to-vpB.from)*0.8);}if(_update20.geometryChanged)this.dom.style.minHeight=this.view.contentHeight+"px";if(this.view.state.facet(unfixGutters)!=!this.fixed){this.fixed=!this.fixed;this.dom.style.position=this.fixed?"sticky":"";}this.prevViewport=_update20.view.viewport;}},{key:"syncGutters",value:function syncGutters(detach){var _this135=this;var after=this.dom.nextSibling;if(detach)this.dom.remove();var lineClasses=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from);var classSet=[];var contexts=this.gutters.map(function(gutter2){return new UpdateContext(gutter2,_this135.view.viewport,-_this135.view.documentPadding.top);});var _iterator221=_createForOfIteratorHelper(this.view.viewportLineBlocks),_step221;try{for(_iterator221.s();!(_step221=_iterator221.n()).done;){var line=_step221.value;var _text9=void 0;if(Array.isArray(line.type)){var _iterator223=_createForOfIteratorHelper(line.type),_step223;try{for(_iterator223.s();!(_step223=_iterator223.n()).done;){var b=_step223.value;if(b.type==BlockType3.Text){_text9=b;break;}}}catch(err){_iterator223.e(err);}finally{_iterator223.f();}}else{_text9=line.type==BlockType3.Text?line:void 0;}if(!_text9)continue;if(classSet.length)classSet=[];advanceCursor(lineClasses,classSet,line.from);var _iterator224=_createForOfIteratorHelper(contexts),_step224;try{for(_iterator224.s();!(_step224=_iterator224.n()).done;){var cx=_step224.value;cx.line(this.view,_text9,classSet);}}catch(err){_iterator224.e(err);}finally{_iterator224.f();}}}catch(err){_iterator221.e(err);}finally{_iterator221.f();}var _iterator222=_createForOfIteratorHelper(contexts),_step222;try{for(_iterator222.s();!(_step222=_iterator222.n()).done;){var _cx=_step222.value;_cx.finish();}}catch(err){_iterator222.e(err);}finally{_iterator222.f();}if(detach)this.view.scrollDOM.insertBefore(this.dom,after);}},{key:"updateGutters",value:function updateGutters(update){var prev=update.startState.facet(activeGutters),cur2=update.state.facet(activeGutters);var change=update.docChanged||update.heightChanged||update.viewportChanged||!RangeSet.eq(update.startState.facet(gutterLineClass),update.state.facet(gutterLineClass),update.view.viewport.from,update.view.viewport.to);if(prev==cur2){var _iterator225=_createForOfIteratorHelper(this.gutters),_step225;try{for(_iterator225.s();!(_step225=_iterator225.n()).done;){var gutter2=_step225.value;if(gutter2.update(update))change=true;}}catch(err){_iterator225.e(err);}finally{_iterator225.f();}}else{change=true;var gutters2=[];var _iterator226=_createForOfIteratorHelper(cur2),_step226;try{for(_iterator226.s();!(_step226=_iterator226.n()).done;){var conf=_step226.value;var known=prev.indexOf(conf);if(known<0){gutters2.push(new SingleGutterView(this.view,conf));}else{this.gutters[known].update(update);gutters2.push(this.gutters[known]);}}}catch(err){_iterator226.e(err);}finally{_iterator226.f();}var _iterator227=_createForOfIteratorHelper(this.gutters),_step227;try{for(_iterator227.s();!(_step227=_iterator227.n()).done;){var _g=_step227.value;_g.dom.remove();if(gutters2.indexOf(_g)<0)_g.destroy();}}catch(err){_iterator227.e(err);}finally{_iterator227.f();}for(var _i198=0,_gutters=gutters2;_i198<_gutters.length;_i198++){var g=_gutters[_i198];this.dom.appendChild(g.dom);}this.gutters=gutters2;}return change;}},{key:"destroy",value:function destroy(){var _iterator228=_createForOfIteratorHelper(this.gutters),_step228;try{for(_iterator228.s();!(_step228=_iterator228.n()).done;){var view=_step228.value;view.destroy();}}catch(err){_iterator228.e(err);}finally{_iterator228.f();}this.dom.remove();}}]);return _class5;}(),{provide:/* @__PURE__ */PluginField3.scrollMargins.from(function(value){if(value.gutters.length==0||!value.fixed)return null;return value.view.textDirection==Direction3.LTR?{left:value.dom.offsetWidth}:{right:value.dom.offsetWidth};})});function asArray2(val){return Array.isArray(val)?val:[val];}function advanceCursor(cursor2,collect,pos){while(cursor2.value&&cursor2.from<=pos){if(cursor2.from==pos)collect.push(cursor2.value);cursor2.next();}}var UpdateContext=/*#__PURE__*/function(){function UpdateContext(gutter2,viewport,height){_classCallCheck(this,UpdateContext);this.gutter=gutter2;this.height=height;this.localMarkers=[];this.i=0;this.cursor=RangeSet.iter(gutter2.markers,viewport.from);}_createClass(UpdateContext,[{key:"line",value:function line(view,_line,extraMarkers){if(this.localMarkers.length)this.localMarkers=[];advanceCursor(this.cursor,this.localMarkers,_line.from);var localMarkers=extraMarkers.length?this.localMarkers.concat(extraMarkers):this.localMarkers;var forLine=this.gutter.config.lineMarker(view,_line,localMarkers);if(forLine)localMarkers.unshift(forLine);var gutter2=this.gutter;if(localMarkers.length==0&&!gutter2.config.renderEmptyElements)return;var above=_line.top-this.height;if(this.i==gutter2.elements.length){var newElt=new GutterElement(view,_line.height,above,localMarkers);gutter2.elements.push(newElt);gutter2.dom.appendChild(newElt.dom);}else{gutter2.elements[this.i].update(view,_line.height,above,localMarkers);}this.height=_line.bottom;this.i++;}},{key:"finish",value:function finish(){var gutter2=this.gutter;while(gutter2.elements.length>this.i){var last=gutter2.elements.pop();gutter2.dom.removeChild(last.dom);last.destroy();}}}]);return UpdateContext;}();var SingleGutterView=/*#__PURE__*/function(){function SingleGutterView(view,config2){var _this136=this;_classCallCheck(this,SingleGutterView);this.view=view;this.config=config2;this.elements=[];this.spacer=null;this.dom=document.createElement("div");this.dom.className="cm-gutter"+(this.config["class"]?" "+this.config["class"]:"");var _loop23=function _loop23(prop){_this136.dom.addEventListener(prop,function(event){var line=view.lineBlockAtHeight(event.clientY-view.documentTop);if(config2.domEventHandlers[prop](view,line,event))event.preventDefault();});};for(var prop in config2.domEventHandlers){_loop23(prop);}this.markers=asArray2(config2.markers(view));if(config2.initialSpacer){this.spacer=new GutterElement(view,0,0,[config2.initialSpacer(view)]);this.dom.appendChild(this.spacer.dom);this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none";}}_createClass(SingleGutterView,[{key:"update",value:function update(_update21){var prevMarkers=this.markers;this.markers=asArray2(this.config.markers(_update21.view));if(this.spacer&&this.config.updateSpacer){var updated=this.config.updateSpacer(this.spacer.markers[0],_update21);if(updated!=this.spacer.markers[0])this.spacer.update(_update21.view,0,0,[updated]);}var vp=_update21.view.viewport;return!RangeSet.eq(this.markers,prevMarkers,vp.from,vp.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(_update21):false);}},{key:"destroy",value:function destroy(){var _iterator229=_createForOfIteratorHelper(this.elements),_step229;try{for(_iterator229.s();!(_step229=_iterator229.n()).done;){var elt=_step229.value;elt.destroy();}}catch(err){_iterator229.e(err);}finally{_iterator229.f();}}}]);return SingleGutterView;}();var GutterElement=/*#__PURE__*/function(){function GutterElement(view,height,above,markers){_classCallCheck(this,GutterElement);this.height=-1;this.above=0;this.markers=[];this.dom=document.createElement("div");this.update(view,height,above,markers);}_createClass(GutterElement,[{key:"update",value:function update(view,height,above,markers){if(this.height!=height)this.dom.style.height=(this.height=height)+"px";if(this.above!=above)this.dom.style.marginTop=(this.above=above)?above+"px":"";if(!sameMarkers(this.markers,markers))this.setMarkers(view,markers);}},{key:"setMarkers",value:function setMarkers(view,markers){var cls="cm-gutterElement",domPos=this.dom.firstChild;for(var iNew=0,iOld=0;;){var skipTo=iOld,marker=iNew<markers.length?markers[iNew++]:null,matched=false;if(marker){var c=marker.elementClass;if(c)cls+=" "+c;for(var _i199=iOld;_i199<this.markers.length;_i199++){if(this.markers[_i199].compare(marker)){skipTo=_i199;matched=true;break;}}}else{skipTo=this.markers.length;}while(iOld<skipTo){var next=this.markers[iOld++];if(next.toDOM){next.destroy(domPos);var after=domPos.nextSibling;domPos.remove();domPos=after;}}if(!marker)break;if(marker.toDOM){if(matched)domPos=domPos.nextSibling;else this.dom.insertBefore(marker.toDOM(view),domPos);}if(matched)iOld++;}this.dom.className=cls;this.markers=markers;}},{key:"destroy",value:function destroy(){this.setMarkers(null,[]);}}]);return GutterElement;}();function sameMarkers(a,b){if(a.length!=b.length)return false;for(var _i200=0;_i200<a.length;_i200++){if(!a[_i200].compare(b[_i200]))return false;}return true;}var lineNumberMarkers=/* @__PURE__ */Facet.define();var lineNumberConfig=/* @__PURE__ */Facet.define({combine:function combine(values){return combineConfig(values,{formatNumber:String,domEventHandlers:{}},{domEventHandlers:function domEventHandlers(a,b){var result=Object.assign({},a);var _loop24=function _loop24(event){var exists=result[event],add2=b[event];result[event]=exists?function(view,line,event2){return exists(view,line,event2)||add2(view,line,event2);}:add2;};for(var event in b){_loop24(event);}return result;}});}});var NumberMarker=/*#__PURE__*/function(_GutterMarker){_inherits(NumberMarker,_GutterMarker);var _super70=_createSuper(NumberMarker);function NumberMarker(number2){var _this137;_classCallCheck(this,NumberMarker);_this137=_super70.call(this);_this137.number=number2;return _this137;}_createClass(NumberMarker,[{key:"eq",value:function eq(other){return this.number==other.number;}},{key:"toDOM",value:function toDOM(){return document.createTextNode(this.number);}}]);return NumberMarker;}(GutterMarker);function formatNumber(view,number2){return view.state.facet(lineNumberConfig).formatNumber(number2,view.state);}var lineNumberGutter=/* @__PURE__ */activeGutters.compute([lineNumberConfig],function(state){return{"class":"cm-lineNumbers",renderEmptyElements:false,markers:function markers(view){return view.state.facet(lineNumberMarkers);},lineMarker:function lineMarker(view,line,others){if(others.some(function(m){return m.toDOM;}))return null;return new NumberMarker(formatNumber(view,view.state.doc.lineAt(line.from).number));},lineMarkerChange:function lineMarkerChange(update){return update.startState.facet(lineNumberConfig)!=update.state.facet(lineNumberConfig);},initialSpacer:function initialSpacer(view){return new NumberMarker(formatNumber(view,maxLineNumber(view.state.doc.lines)));},updateSpacer:function updateSpacer(spacer,update){var max=formatNumber(update.view,maxLineNumber(update.view.state.doc.lines));return max==spacer.number?spacer:new NumberMarker(max);},domEventHandlers:state.facet(lineNumberConfig).domEventHandlers};});function lineNumbers(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[lineNumberConfig.of(config2),gutters(),lineNumberGutter];}function maxLineNumber(lines){var last=9;while(last<lines){last=last*10+9;}return last;}var activeLineGutterMarker=/* @__PURE__ */new(/*#__PURE__*/function(_GutterMarker2){_inherits(_class6,_GutterMarker2);var _super71=_createSuper(_class6);function _class6(){var _this138;_classCallCheck(this,_class6);_this138=_super71.apply(this,arguments);_this138.elementClass="cm-activeLineGutter";return _this138;}return _createClass(_class6);}(GutterMarker))();var activeLineGutterHighlighter=/* @__PURE__ */gutterLineClass.compute(["selection"],function(state){var marks=[],last=-1;var _iterator230=_createForOfIteratorHelper(state.selection.ranges),_step230;try{for(_iterator230.s();!(_step230=_iterator230.n()).done;){var range=_step230.value;if(range.empty){var linePos=state.doc.lineAt(range.head).from;if(linePos>last){last=linePos;marks.push(activeLineGutterMarker.range(linePos));}}}}catch(err){_iterator230.e(err);}finally{_iterator230.f();}return RangeSet.of(marks);});function highlightActiveLineGutter(){return activeLineGutterHighlighter;}// ../node_modules/@codemirror/fold/dist/index.js
function mapRange(range,mapping){var from=mapping.mapPos(range.from,1),to=mapping.mapPos(range.to,-1);return from>=to?void 0:{from:from,to:to};}var foldEffect=/* @__PURE__ */StateEffect.define({map:mapRange});var unfoldEffect=/* @__PURE__ */StateEffect.define({map:mapRange});function selectedLines(view){var lines=[];var _iterator231=_createForOfIteratorHelper(view.state.selection.ranges),_step231;try{var _loop25=function _loop25(){var head=_step231.value.head;if(lines.some(function(l){return l.from<=head&&l.to>=head;}))return"continue";lines.push(view.lineBlockAt(head));};for(_iterator231.s();!(_step231=_iterator231.n()).done;){var _ret3=_loop25();if(_ret3==="continue")continue;}}catch(err){_iterator231.e(err);}finally{_iterator231.f();}return lines;}var foldState=/* @__PURE__ */StateField.define({create:function create(){return Decoration2.none;},update:function update(folded,tr){folded=folded.map(tr.changes);var _iterator232=_createForOfIteratorHelper(tr.effects),_step232;try{var _loop26=function _loop26(){var e=_step232.value;if(e.is(foldEffect)&&!foldExists(folded,e.value.from,e.value.to))folded=folded.update({add:[foldWidget.range(e.value.from,e.value.to)]});else if(e.is(unfoldEffect))folded=folded.update({filter:function filter(from,to){return e.value.from!=from||e.value.to!=to;},filterFrom:e.value.from,filterTo:e.value.to});};for(_iterator232.s();!(_step232=_iterator232.n()).done;){_loop26();}}catch(err){_iterator232.e(err);}finally{_iterator232.f();}if(tr.selection){var onSelection=false,head=tr.selection.main.head;folded.between(head,head,function(a,b){if(a<head&&b>head)onSelection=true;});if(onSelection)folded=folded.update({filterFrom:head,filterTo:head,filter:function filter(a,b){return b<=head||a>=head;}});}return folded;},provide:function provide(f){return EditorView2.decorations.from(f);}});function foldInside(state,from,to){var _a;var found=null;(_a=state.field(foldState,false))===null||_a===void 0?void 0:_a.between(from,to,function(from2,to2){if(!found||found.from>from2)found={from:from2,to:to2};});return found;}function foldExists(folded,from,to){var found=false;folded.between(from,from,function(a,b){if(a==from&&b==to)found=true;});return found;}function maybeEnable(state,other){return state.field(foldState,false)?other:other.concat(StateEffect.appendConfig.of(codeFolding()));}var foldCode=function foldCode(view){var _iterator233=_createForOfIteratorHelper(selectedLines(view)),_step233;try{for(_iterator233.s();!(_step233=_iterator233.n()).done;){var line=_step233.value;var range=foldable(view.state,line.from,line.to);if(range){view.dispatch({effects:maybeEnable(view.state,[foldEffect.of(range),announceFold(view,range)])});return true;}}}catch(err){_iterator233.e(err);}finally{_iterator233.f();}return false;};var unfoldCode=function unfoldCode(view){if(!view.state.field(foldState,false))return false;var effects=[];var _iterator234=_createForOfIteratorHelper(selectedLines(view)),_step234;try{for(_iterator234.s();!(_step234=_iterator234.n()).done;){var line=_step234.value;var folded=foldInside(view.state,line.from,line.to);if(folded)effects.push(unfoldEffect.of(folded),announceFold(view,folded,false));}}catch(err){_iterator234.e(err);}finally{_iterator234.f();}if(effects.length)view.dispatch({effects:effects});return effects.length>0;};function announceFold(view,range){var fold=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var lineFrom=view.state.doc.lineAt(range.from).number,lineTo=view.state.doc.lineAt(range.to).number;return EditorView2.announce.of("".concat(view.state.phrase(fold?"Folded lines":"Unfolded lines")," ").concat(lineFrom," ").concat(view.state.phrase("to")," ").concat(lineTo,"."));}var foldAll=function foldAll(view){var state=view.state,effects=[];for(var pos=0;pos<state.doc.length;){var line=view.lineBlockAt(pos),range=foldable(state,line.from,line.to);if(range)effects.push(foldEffect.of(range));pos=(range?view.lineBlockAt(range.to):line).to+1;}if(effects.length)view.dispatch({effects:maybeEnable(view.state,effects)});return!!effects.length;};var unfoldAll=function unfoldAll(view){var field=view.state.field(foldState,false);if(!field||!field.size)return false;var effects=[];field.between(0,view.state.doc.length,function(from,to){effects.push(unfoldEffect.of({from:from,to:to}));});view.dispatch({effects:effects});return true;};var foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}];var defaultConfig={placeholderDOM:null,placeholderText:"\u2026"};var foldConfig=/* @__PURE__ */Facet.define({combine:function combine(values){return combineConfig(values,defaultConfig);}});function codeFolding(config2){var result=[foldState,baseTheme5];if(config2)result.push(foldConfig.of(config2));return result;}var foldWidget=/* @__PURE__ */Decoration2.replace({widget:/* @__PURE__ */new(/*#__PURE__*/function(_WidgetType15){_inherits(_class7,_WidgetType15);var _super72=_createSuper(_class7);function _class7(){_classCallCheck(this,_class7);return _super72.apply(this,arguments);}_createClass(_class7,[{key:"toDOM",value:function toDOM(view){var state=view.state,conf=state.facet(foldConfig);var onclick=function onclick(event){var line=view.lineBlockAt(view.posAtDOM(event.target));var folded=foldInside(view.state,line.from,line.to);if(folded)view.dispatch({effects:unfoldEffect.of(folded)});event.preventDefault();};if(conf.placeholderDOM)return conf.placeholderDOM(view,onclick);var element=document.createElement("span");element.textContent=conf.placeholderText;element.setAttribute("aria-label",state.phrase("folded code"));element.title=state.phrase("unfold");element.className="cm-foldPlaceholder";element.onclick=onclick;return element;}}]);return _class7;}(WidgetType2))()});var foldGutterDefaults={openText:"\u2304",closedText:"\u203A",markerDOM:null,domEventHandlers:{}};var FoldMarker=/*#__PURE__*/function(_GutterMarker3){_inherits(FoldMarker,_GutterMarker3);var _super73=_createSuper(FoldMarker);function FoldMarker(config2,open){var _this139;_classCallCheck(this,FoldMarker);_this139=_super73.call(this);_this139.config=config2;_this139.open=open;return _this139;}_createClass(FoldMarker,[{key:"eq",value:function eq(other){return this.config==other.config&&this.open==other.open;}},{key:"toDOM",value:function toDOM(view){if(this.config.markerDOM)return this.config.markerDOM(this.open);var span=document.createElement("span");span.textContent=this.open?this.config.openText:this.config.closedText;span.title=view.state.phrase(this.open?"Fold line":"Unfold line");return span;}}]);return FoldMarker;}(GutterMarker);function foldGutter(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var fullConfig=Object.assign(Object.assign({},foldGutterDefaults),config2);var canFold=new FoldMarker(fullConfig,true),canUnfold=new FoldMarker(fullConfig,false);var _markers=ViewPlugin2.fromClass(/*#__PURE__*/function(){function _class8(view){_classCallCheck(this,_class8);this.from=view.viewport.from;this.markers=this.buildMarkers(view);}_createClass(_class8,[{key:"update",value:function update(_update22){if(_update22.docChanged||_update22.viewportChanged||_update22.startState.facet(language)!=_update22.state.facet(language)||_update22.startState.field(foldState,false)!=_update22.state.field(foldState,false))this.markers=this.buildMarkers(_update22.view);}},{key:"buildMarkers",value:function buildMarkers(view){var builder=new RangeSetBuilder();var _iterator235=_createForOfIteratorHelper(view.viewportLineBlocks),_step235;try{for(_iterator235.s();!(_step235=_iterator235.n()).done;){var line=_step235.value;var mark=foldInside(view.state,line.from,line.to)?canUnfold:foldable(view.state,line.from,line.to)?canFold:null;if(mark)builder.add(line.from,line.from,mark);}}catch(err){_iterator235.e(err);}finally{_iterator235.f();}return builder.finish();}}]);return _class8;}());var domEventHandlers6=fullConfig.domEventHandlers;return[_markers,gutter({"class":"cm-foldGutter",markers:function markers(view){var _a;return((_a=view.plugin(_markers))===null||_a===void 0?void 0:_a.markers)||RangeSet.empty;},initialSpacer:function initialSpacer(){return new FoldMarker(fullConfig,false);},domEventHandlers:Object.assign(Object.assign({},domEventHandlers6),{click:function click(view,line,event){if(domEventHandlers6.click&&domEventHandlers6.click(view,line,event))return true;var folded=foldInside(view.state,line.from,line.to);if(folded){view.dispatch({effects:unfoldEffect.of(folded)});return true;}var range=foldable(view.state,line.from,line.to);if(range){view.dispatch({effects:foldEffect.of(range)});return true;}return false;}})}),codeFolding()];}var baseTheme5=/* @__PURE__ */EditorView2.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});// ../node_modules/@codemirror/commands/node_modules/@codemirror/view/dist/index.js
function getSelection4(root){var target;if(root.nodeType==11){target=root.getSelection?root:root.ownerDocument;}else{target=root;}return target.getSelection();}function contains4(dom,node){return node?dom.contains(node.nodeType!=1?node.parentNode:node):false;}function deepActiveElement4(){var elt=document.activeElement;while(elt&&elt.shadowRoot){elt=elt.shadowRoot.activeElement;}return elt;}function hasSelection4(dom,selection2){if(!selection2.anchorNode)return false;try{return contains4(dom,selection2.anchorNode);}catch(_){return false;}}function clientRectsFor4(dom){if(dom.nodeType==3)return textRange4(dom,0,dom.nodeValue.length).getClientRects();else if(dom.nodeType==1)return dom.getClientRects();else return[];}function isEquivalentPosition4(node,off,targetNode,targetOff){return targetNode?scanFor4(node,off,targetNode,targetOff,-1)||scanFor4(node,off,targetNode,targetOff,1):false;}function domIndex4(node){for(var index=0;;index++){node=node.previousSibling;if(!node)return index;}}function scanFor4(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return true;if(off==(dir<0?0:maxOffset4(node))){if(node.nodeName=="DIV")return false;var parent=node.parentNode;if(!parent||parent.nodeType!=1)return false;off=domIndex4(node)+(dir<0?0:1);node=parent;}else if(node.nodeType==1){node=node.childNodes[off+(dir<0?-1:0)];if(node.nodeType==1&&node.contentEditable=="false")return false;off=dir<0?maxOffset4(node):0;}else{return false;}}}function maxOffset4(node){return node.nodeType==3?node.nodeValue.length:node.childNodes.length;}var Rect04={left:0,right:0,top:0,bottom:0};function flattenRect4(rect,left){var x=left?rect.left:rect.right;return{left:x,right:x,top:rect.top,bottom:rect.bottom};}function windowRect4(win){return{left:0,right:win.innerWidth,top:0,bottom:win.innerHeight};}function scrollRectIntoView4(dom,rect,side,x,y,xMargin,yMargin,ltr){var doc6=dom.ownerDocument,win=doc6.defaultView;for(var cur2=dom;cur2;){if(cur2.nodeType==1){var bounding=void 0,top2=cur2==doc6.body;if(top2){bounding=windowRect4(win);}else{if(cur2.scrollHeight<=cur2.clientHeight&&cur2.scrollWidth<=cur2.clientWidth){cur2=cur2.parentNode;continue;}var rect2=cur2.getBoundingClientRect();bounding={left:rect2.left,right:rect2.left+cur2.clientWidth,top:rect2.top,bottom:rect2.top+cur2.clientHeight};}var moveX=0,moveY=0;if(y=="nearest"){if(rect.top<bounding.top){moveY=-(bounding.top-rect.top+yMargin);if(side>0&&rect.bottom>bounding.bottom+moveY)moveY=rect.bottom-bounding.bottom+moveY+yMargin;}else if(rect.bottom>bounding.bottom){moveY=rect.bottom-bounding.bottom+yMargin;if(side<0&&rect.top-moveY<bounding.top)moveY=-(bounding.top+moveY-rect.top+yMargin);}}else{var rectHeight=rect.bottom-rect.top,boundingHeight=bounding.bottom-bounding.top;var targetTop=y=="center"&&rectHeight<=boundingHeight?rect.top+rectHeight/2-boundingHeight/2:y=="start"||y=="center"&&side<0?rect.top-yMargin:rect.bottom-boundingHeight+yMargin;moveY=targetTop-bounding.top;}if(x=="nearest"){if(rect.left<bounding.left){moveX=-(bounding.left-rect.left+xMargin);if(side>0&&rect.right>bounding.right+moveX)moveX=rect.right-bounding.right+moveX+xMargin;}else if(rect.right>bounding.right){moveX=rect.right-bounding.right+xMargin;if(side<0&&rect.left<bounding.left+moveX)moveX=-(bounding.left+moveX-rect.left+xMargin);}}else{var targetLeft=x=="center"?rect.left+(rect.right-rect.left)/2-(bounding.right-bounding.left)/2:x=="start"==ltr?rect.left-xMargin:rect.right-(bounding.right-bounding.left)+xMargin;moveX=targetLeft-bounding.left;}if(moveX||moveY){if(top2){win.scrollBy(moveX,moveY);}else{if(moveY){var start=cur2.scrollTop;cur2.scrollTop+=moveY;moveY=cur2.scrollTop-start;}if(moveX){var _start9=cur2.scrollLeft;cur2.scrollLeft+=moveX;moveX=cur2.scrollLeft-_start9;}rect={left:rect.left-moveX,top:rect.top-moveY,right:rect.right-moveX,bottom:rect.bottom-moveY};}}if(top2)break;cur2=cur2.assignedSlot||cur2.parentNode;x=y="nearest";}else if(cur2.nodeType==11){cur2=cur2.host;}else{break;}}}var DOMSelectionState3=/*#__PURE__*/function(){function DOMSelectionState3(){_classCallCheck(this,DOMSelectionState3);this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0;}_createClass(DOMSelectionState3,[{key:"eq",value:function eq(domSel){return this.anchorNode==domSel.anchorNode&&this.anchorOffset==domSel.anchorOffset&&this.focusNode==domSel.focusNode&&this.focusOffset==domSel.focusOffset;}},{key:"setRange",value:function setRange(range){this.set(range.anchorNode,range.anchorOffset,range.focusNode,range.focusOffset);}},{key:"set",value:function set(anchorNode,anchorOffset,focusNode,focusOffset){this.anchorNode=anchorNode;this.anchorOffset=anchorOffset;this.focusNode=focusNode;this.focusOffset=focusOffset;}}]);return DOMSelectionState3;}();var preventScrollSupported4=null;function focusPreventScroll4(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported4)return dom.focus(preventScrollSupported4);var stack=[];for(var cur2=dom;cur2;cur2=cur2.parentNode){stack.push(cur2,cur2.scrollTop,cur2.scrollLeft);if(cur2==cur2.ownerDocument)break;}dom.focus(preventScrollSupported4==null?Object.defineProperties({},{preventScroll:{get:function get(){preventScrollSupported4={preventScroll:true};return true;},configurable:true,enumerable:true}}):void 0);if(!preventScrollSupported4){preventScrollSupported4=false;for(var _i201=0;_i201<stack.length;){var elt=stack[_i201++],top2=stack[_i201++],left=stack[_i201++];if(elt.scrollTop!=top2)elt.scrollTop=top2;if(elt.scrollLeft!=left)elt.scrollLeft=left;}}}var scratchRange4;function textRange4(node,from){var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:from;var range=scratchRange4||(scratchRange4=document.createRange());range.setEnd(node,to);range.setStart(node,from);return range;}function dispatchKey4(elt,name2,code){var options={key:name2,code:name2,keyCode:code,which:code,cancelable:true};var down=new KeyboardEvent("keydown",options);down.synthetic=true;elt.dispatchEvent(down);var up=new KeyboardEvent("keyup",options);up.synthetic=true;elt.dispatchEvent(up);return down.defaultPrevented||up.defaultPrevented;}function getRoot4(node){while(node){if(node&&(node.nodeType==9||node.nodeType==11&&node.host))return node;node=node.assignedSlot||node.parentNode;}return null;}function clearAttributes3(node){while(node.attributes.length){node.removeAttributeNode(node.attributes[0]);}}var DOMPos4=/*#__PURE__*/function(){function DOMPos4(node,offset){var precise=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_classCallCheck(this,DOMPos4);this.node=node;this.offset=offset;this.precise=precise;}_createClass(DOMPos4,null,[{key:"before",value:function before(dom,precise){return new DOMPos4(dom.parentNode,domIndex4(dom),precise);}},{key:"after",value:function after(dom,precise){return new DOMPos4(dom.parentNode,domIndex4(dom)+1,precise);}}]);return DOMPos4;}();var noChildren3=[];var ContentView4=/*#__PURE__*/function(){function ContentView4(){_classCallCheck(this,ContentView4);this.parent=null;this.dom=null;this.dirty=2;}_createClass(ContentView4,[{key:"editorView",get:function get(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"posAtStart",get:function get(){return this.parent?this.parent.posBefore(this):0;}},{key:"posAtEnd",get:function get(){return this.posAtStart+this.length;}},{key:"posBefore",value:function posBefore(view){var pos=this.posAtStart;var _iterator236=_createForOfIteratorHelper(this.children),_step236;try{for(_iterator236.s();!(_step236=_iterator236.n()).done;){var child=_step236.value;if(child==view)return pos;pos+=child.length+child.breakAfter;}}catch(err){_iterator236.e(err);}finally{_iterator236.f();}throw new RangeError("Invalid child in posBefore");}},{key:"posAfter",value:function posAfter(view){return this.posBefore(view)+view.length;}},{key:"coordsAt",value:function coordsAt(_pos,_side){return null;}},{key:"sync",value:function sync(track){if(this.dirty&2){var parent=this.dom;var pos=parent.firstChild;var _iterator237=_createForOfIteratorHelper(this.children),_step237;try{for(_iterator237.s();!(_step237=_iterator237.n()).done;){var child=_step237.value;if(child.dirty){if(!child.dom&&pos){var contentView=ContentView4.get(pos);if(!contentView||!contentView.parent&&contentView.constructor==child.constructor)child.reuseDOM(pos);}child.sync(track);child.dirty=0;}if(track&&!track.written&&track.node==parent&&pos!=child.dom)track.written=true;if(child.dom.parentNode==parent){while(pos&&pos!=child.dom){pos=rm4(pos);}pos=child.dom.nextSibling;}else{parent.insertBefore(child.dom,pos);}}}catch(err){_iterator237.e(err);}finally{_iterator237.f();}if(pos&&track&&track.node==parent)track.written=true;while(pos){pos=rm4(pos);}}else if(this.dirty&1){var _iterator238=_createForOfIteratorHelper(this.children),_step238;try{for(_iterator238.s();!(_step238=_iterator238.n()).done;){var _child4=_step238.value;if(_child4.dirty){_child4.sync(track);_child4.dirty=0;}}}catch(err){_iterator238.e(err);}finally{_iterator238.f();}}}},{key:"reuseDOM",value:function reuseDOM(_dom){}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){var after;if(node==this.dom){after=this.dom.childNodes[offset];}else{var bias=maxOffset4(node)==0?0:offset==0?-1:1;for(;;){var parent=node.parentNode;if(parent==this.dom)break;if(bias==0&&parent.firstChild!=parent.lastChild){if(node==parent.firstChild)bias=-1;else bias=1;}node=parent;}if(bias<0)after=node;else after=node.nextSibling;}if(after==this.dom.firstChild)return 0;while(after&&!ContentView4.get(after)){after=after.nextSibling;}if(!after)return this.length;for(var _i202=0,pos=0;;_i202++){var child=this.children[_i202];if(child.dom==after)return pos;pos+=child.length+child.breakAfter;}}},{key:"domBoundsAround",value:function domBoundsAround(from,to){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var fromI=-1,fromStart=-1,toI=-1,toEnd=-1;for(var _i203=0,pos=offset,prevEnd=offset;_i203<this.children.length;_i203++){var child=this.children[_i203],end=pos+child.length;if(pos<from&&end>to)return child.domBoundsAround(from,to,pos);if(end>=from&&fromI==-1){fromI=_i203;fromStart=pos;}if(pos>to&&child.dom.parentNode==this.dom){toI=_i203;toEnd=prevEnd;break;}prevEnd=end;pos=end+child.breakAfter;}return{from:fromStart,to:toEnd<0?offset+this.length:toEnd,startDOM:(fromI?this.children[fromI-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:toI<this.children.length&&toI>=0?this.children[toI].dom:null};}},{key:"markDirty",value:function markDirty(){var andParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.dirty|=2;this.markParentsDirty(andParent);}},{key:"markParentsDirty",value:function markParentsDirty(childList){for(var parent=this.parent;parent;parent=parent.parent){if(childList)parent.dirty|=2;if(parent.dirty&1)return;parent.dirty|=1;childList=false;}}},{key:"setParent",value:function setParent(parent){if(this.parent!=parent){this.parent=parent;if(this.dirty)this.markParentsDirty(true);}}},{key:"setDOM",value:function setDOM(dom){if(this.dom)this.dom.cmView=null;this.dom=dom;dom.cmView=this;}},{key:"rootView",get:function get(){for(var v=this;;){var parent=v.parent;if(!parent)return v;v=parent;}}},{key:"replaceChildren",value:function replaceChildren(from,to){var _this$children4;var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:noChildren3;this.markDirty();for(var _i204=from;_i204<to;_i204++){var child=this.children[_i204];if(child.parent==this)child.destroy();}(_this$children4=this.children).splice.apply(_this$children4,[from,to-from].concat(_toConsumableArray(children)));for(var _i205=0;_i205<children.length;_i205++){children[_i205].setParent(this);}}},{key:"ignoreMutation",value:function ignoreMutation(_rec){return false;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return false;}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;return new ChildCursor4(this.children,pos,this.children.length);}},{key:"childPos",value:function childPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return this.childCursor().findPos(pos,bias);}},{key:"toString",value:function toString(){var name2=this.constructor.name.replace("View","");return name2+(this.children.length?"("+this.children.join()+")":this.length?"["+(name2=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"");}},{key:"isEditable",get:function get(){return true;}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){return false;}},{key:"become",value:function become(other){return false;}},{key:"getSide",value:function getSide(){return 0;}},{key:"destroy",value:function destroy(){this.parent=null;}}],[{key:"get",value:function get(node){return node.cmView;}}]);return ContentView4;}();ContentView4.prototype.breakAfter=0;function rm4(dom){var next=dom.nextSibling;dom.parentNode.removeChild(dom);return next;}var ChildCursor4=/*#__PURE__*/function(){function ChildCursor4(children,pos,i){_classCallCheck(this,ChildCursor4);this.children=children;this.pos=pos;this.i=i;this.off=0;}_createClass(ChildCursor4,[{key:"findPos",value:function findPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;for(;;){if(pos>this.pos||pos==this.pos&&(bias>0||this.i==0||this.children[this.i-1].breakAfter)){this.off=pos-this.pos;return this;}var next=this.children[--this.i];this.pos-=next.length+next.breakAfter;}}}]);return ChildCursor4;}();function replaceRange3(parent,fromI,fromOff,toI,toOff,insert2,breakAtStart,openStart,openEnd){var children=parent.children;var before=children.length?children[fromI]:null;var last=insert2.length?insert2[insert2.length-1]:null;var breakAtEnd=last?last.breakAfter:breakAtStart;if(fromI==toI&&before&&!breakAtStart&&!breakAtEnd&&insert2.length<2&&before.merge(fromOff,toOff,insert2.length?last:null,fromOff==0,openStart,openEnd))return;if(toI<children.length){var after=children[toI];if(after&&toOff<after.length){if(fromI==toI){after=after.split(toOff);toOff=0;}if(!breakAtEnd&&last&&after.merge(0,toOff,last,true,0,openEnd)){insert2[insert2.length-1]=after;}else{if(toOff)after.merge(0,toOff,null,false,0,openEnd);insert2.push(after);}}else if(after===null||after===void 0?void 0:after.breakAfter){if(last)last.breakAfter=1;else breakAtStart=1;}toI++;}if(before){before.breakAfter=breakAtStart;if(fromOff>0){if(!breakAtStart&&insert2.length&&before.merge(fromOff,before.length,insert2[0],false,openStart,0)){before.breakAfter=insert2.shift().breakAfter;}else if(fromOff<before.length||before.children.length&&before.children[before.children.length-1].length==0){before.merge(fromOff,before.length,null,false,openStart,0);}fromI++;}}while(fromI<toI&&insert2.length){if(children[toI-1].become(insert2[insert2.length-1])){toI--;insert2.pop();openEnd=insert2.length?0:openStart;}else if(children[fromI].become(insert2[0])){fromI++;insert2.shift();openStart=insert2.length?0:openEnd;}else{break;}}if(!insert2.length&&fromI&&toI<children.length&&!children[fromI-1].breakAfter&&children[toI].merge(0,0,children[fromI-1],false,openStart,openEnd))fromI--;if(fromI<toI||insert2.length)parent.replaceChildren(fromI,toI,insert2);}function mergeChildrenInto3(parent,from,to,insert2,openStart,openEnd){var cur2=parent.childCursor();var _cur2$findPos7=cur2.findPos(to,1),toI=_cur2$findPos7.i,toOff=_cur2$findPos7.off;var _cur2$findPos8=cur2.findPos(from,-1),fromI=_cur2$findPos8.i,fromOff=_cur2$findPos8.off;var dLen=from-to;var _iterator239=_createForOfIteratorHelper(insert2),_step239;try{for(_iterator239.s();!(_step239=_iterator239.n()).done;){var view=_step239.value;dLen+=view.length;}}catch(err){_iterator239.e(err);}finally{_iterator239.f();}parent.length+=dLen;replaceRange3(parent,fromI,fromOff,toI,toOff,insert2,0,openStart,openEnd);}var _ref44=typeof navigator!="undefined"?[navigator,document]:[{userAgent:"",vendor:"",platform:""},{documentElement:{style:{}}}],_ref45=_slicedToArray(_ref44,2),nav4=_ref45[0],doc4=_ref45[1];var ie_edge4=/* @__PURE__ */ /Edge\/(\d+)/.exec(nav4.userAgent);var ie_upto104=/* @__PURE__ */ /MSIE \d/.test(nav4.userAgent);var ie_11up4=/* @__PURE__ */ /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav4.userAgent);var ie5=!!(ie_upto104||ie_11up4||ie_edge4);var gecko5=!ie5&&/* @__PURE__ */ /gecko\/(\d+)/i.test(nav4.userAgent);var chrome5=!ie5&&/* @__PURE__ */ /Chrome\/(\d+)/.exec(nav4.userAgent);var webkit4=("webkitFontSmoothing"in doc4.documentElement.style);var safari5=!ie5&&/* @__PURE__ */ /Apple Computer/.test(nav4.vendor);var ios4=safari5&&(/* @__PURE__ */ /Mobile\/\w+/.test(nav4.userAgent)||nav4.maxTouchPoints>2);var browser4={mac:ios4||/* @__PURE__ */ /Mac/.test(nav4.platform),windows:/* @__PURE__ */ /Win/.test(nav4.platform),linux:/* @__PURE__ */ /Linux|X11/.test(nav4.platform),ie:ie5,ie_version:ie_upto104?doc4.documentMode||6:ie_11up4?+ie_11up4[1]:ie_edge4?+ie_edge4[1]:0,gecko:gecko5,gecko_version:gecko5?+(/* @__PURE__ */ /Firefox\/(\d+)/.exec(nav4.userAgent)||[0,0])[1]:0,chrome:!!chrome5,chrome_version:chrome5?+chrome5[1]:0,ios:ios4,android:/* @__PURE__ */ /Android\b/.test(nav4.userAgent),webkit:webkit4,safari:safari5,webkit_version:webkit4?+(/* @__PURE__ */ /\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc4.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var MaxJoinLen4=256;var TextView4=/*#__PURE__*/function(_ContentView19){_inherits(TextView4,_ContentView19);var _super74=_createSuper(TextView4);function TextView4(text){var _this140;_classCallCheck(this,TextView4);_this140=_super74.call(this);_this140.text=text;return _this140;}_createClass(TextView4,[{key:"length",get:function get(){return this.text.length;}},{key:"createDOM",value:function createDOM(textDOM){this.setDOM(textDOM||document.createTextNode(this.text));}},{key:"sync",value:function sync(track){if(!this.dom)this.createDOM();if(this.dom.nodeValue!=this.text){if(track&&track.node==this.dom)track.written=true;this.dom.nodeValue=this.text;}}},{key:"reuseDOM",value:function reuseDOM(dom){if(dom.nodeType==3)this.createDOM(dom);}},{key:"merge",value:function merge(from,to,source){if(source&&(!(source instanceof TextView4)||this.length-(to-from)+source.length>MaxJoinLen4))return false;this.text=this.text.slice(0,from)+(source?source.text:"")+this.text.slice(to);this.markDirty();return true;}},{key:"split",value:function split(from){var result=new TextView4(this.text.slice(from));this.text=this.text.slice(0,from);this.markDirty();return result;}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return node==this.dom?offset:offset?this.text.length:0;}},{key:"domAtPos",value:function domAtPos(pos){return new DOMPos4(this.dom,pos);}},{key:"domBoundsAround",value:function domBoundsAround(_from,_to,offset){return{from:offset,to:offset+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling};}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords4(this.dom,pos,side);}}]);return TextView4;}(ContentView4);var MarkView4=/*#__PURE__*/function(_ContentView20){_inherits(MarkView4,_ContentView20);var _super75=_createSuper(MarkView4);function MarkView4(mark){var _this141;var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,MarkView4);_this141=_super75.call(this);_this141.mark=mark;_this141.children=children;_this141.length=length;var _iterator240=_createForOfIteratorHelper(children),_step240;try{for(_iterator240.s();!(_step240=_iterator240.n()).done;){var ch=_step240.value;ch.setParent(_assertThisInitialized(_this141));}}catch(err){_iterator240.e(err);}finally{_iterator240.f();}return _this141;}_createClass(MarkView4,[{key:"setAttrs",value:function setAttrs(dom){clearAttributes3(dom);if(this.mark["class"])dom.className=this.mark["class"];if(this.mark.attrs)for(var name2 in this.mark.attrs){dom.setAttribute(name2,this.mark.attrs[name2]);}return dom;}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName==this.mark.tagName.toUpperCase()){this.setDOM(node);this.dirty|=4|2;}}},{key:"sync",value:function sync(track){if(!this.dom)this.setDOM(this.setAttrs(document.createElement(this.mark.tagName)));else if(this.dirty&4)this.setAttrs(this.dom);_get(_getPrototypeOf(MarkView4.prototype),"sync",this).call(this,track);}},{key:"merge",value:function merge(from,to,source,_hasStart,openStart,openEnd){if(source&&(!(source instanceof MarkView4&&source.mark.eq(this.mark))||from&&openStart<=0||to<this.length&&openEnd<=0))return false;mergeChildrenInto3(this,from,to,source?source.children:[],openStart-1,openEnd-1);this.markDirty();return true;}},{key:"split",value:function split(from){var result=[],off=0,detachFrom=-1,i=0;var _iterator241=_createForOfIteratorHelper(this.children),_step241;try{for(_iterator241.s();!(_step241=_iterator241.n()).done;){var elt=_step241.value;var end=off+elt.length;if(end>from)result.push(off<from?elt.split(from-off):elt);if(detachFrom<0&&off>=from)detachFrom=i;off=end;i++;}}catch(err){_iterator241.e(err);}finally{_iterator241.f();}var length=this.length-from;this.length=from;if(detachFrom>-1){this.children.length=detachFrom;this.markDirty();}return new MarkView4(this.mark,result,length);}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos4(this.dom,this.children,pos);}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren4(this,pos,side);}}]);return MarkView4;}(ContentView4);function textCoords4(text,pos,side){var length=text.nodeValue.length;if(pos>length)pos=length;var from=pos,to=pos,flatten2=0;if(pos==0&&side<0||pos==length&&side>=0){if(!(browser4.chrome||browser4.gecko)){if(pos){from--;flatten2=1;}else{to++;flatten2=-1;}}}else{if(side<0)from--;else to++;}var rects=textRange4(text,from,to).getClientRects();if(!rects.length)return Rect04;var rect=rects[(flatten2?flatten2<0:side>=0)?0:rects.length-1];if(browser4.safari&&!flatten2&&rect.width==0)rect=Array.prototype.find.call(rects,function(r){return r.width;})||rect;return flatten2?flattenRect4(rect,flatten2<0):rect||null;}var WidgetView4=/*#__PURE__*/function(_ContentView21){_inherits(WidgetView4,_ContentView21);var _super76=_createSuper(WidgetView4);function WidgetView4(widget,length,side){var _this142;_classCallCheck(this,WidgetView4);_this142=_super76.call(this);_this142.widget=widget;_this142.length=length;_this142.side=side;return _this142;}_createClass(WidgetView4,[{key:"split",value:function split(from){var result=WidgetView4.create(this.widget,this.length-from,this.side);this.length-=from;return result;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"getSide",value:function getSide(){return this.side;}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source&&(!(source instanceof WidgetView4)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"become",value:function become(other){if(other.length==this.length&&other instanceof WidgetView4&&other.side==this.side){if(this.widget.constructor==other.widget.constructor){if(!this.widget.eq(other.widget))this.markDirty(true);this.widget=other.widget;return true;}}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}},{key:"overrideDOMText",get:function get(){if(this.length==0)return Text.empty;var top2=this;while(top2.parent){top2=top2.parent;}var view=top2.editorView,text=view&&view.state.doc,start=this.posAtStart;return text?text.slice(start,start+this.length):Text.empty;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos4.before(this.dom):DOMPos4.after(this.dom,pos==this.length);}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){var rects=this.dom.getClientRects(),rect=null;if(!rects.length)return Rect04;for(var _i206=pos>0?rects.length-1:0;;_i206+=pos>0?-1:1){rect=rects[_i206];if(pos>0?_i206==0:_i206==rects.length-1||rect.top<rect.bottom)break;}return pos==0&&side>0||pos==this.length&&side<=0?rect:flattenRect4(rect,pos==0);}},{key:"isEditable",get:function get(){return false;}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(WidgetView4.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom);}}],[{key:"create",value:function create(widget,length,side){return new(widget.customView||WidgetView4)(widget,length,side);}}]);return WidgetView4;}(ContentView4);var CompositionView4=/*#__PURE__*/function(_WidgetView4){_inherits(CompositionView4,_WidgetView4);var _super77=_createSuper(CompositionView4);function CompositionView4(){_classCallCheck(this,CompositionView4);return _super77.apply(this,arguments);}_createClass(CompositionView4,[{key:"domAtPos",value:function domAtPos(pos){return new DOMPos4(this.widget.text,pos);}},{key:"sync",value:function sync(){this.setDOM(this.widget.toDOM());}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return!offset?0:node.nodeType==3?Math.min(offset,this.length):this.length;}},{key:"ignoreMutation",value:function ignoreMutation(){return false;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords4(this.widget.text,pos,side);}},{key:"isEditable",get:function get(){return true;}}]);return CompositionView4;}(WidgetView4);var ZeroWidthSpace3=browser4.android?"\u200B\u200B":"\u200B";var WidgetBufferView4=/*#__PURE__*/function(_ContentView22){_inherits(WidgetBufferView4,_ContentView22);var _super78=_createSuper(WidgetBufferView4);function WidgetBufferView4(side){var _this143;_classCallCheck(this,WidgetBufferView4);_this143=_super78.call(this);_this143.side=side;return _this143;}_createClass(WidgetBufferView4,[{key:"length",get:function get(){return 0;}},{key:"merge",value:function merge(){return false;}},{key:"become",value:function become(other){return other instanceof WidgetBufferView4&&other.side==this.side;}},{key:"split",value:function split(){return new WidgetBufferView4(this.side);}},{key:"sync",value:function sync(){if(!this.dom)this.setDOM(document.createTextNode(ZeroWidthSpace3));else if(this.dirty&&this.dom.nodeValue!=ZeroWidthSpace3)this.dom.nodeValue=ZeroWidthSpace3;}},{key:"getSide",value:function getSide(){return this.side;}},{key:"domAtPos",value:function domAtPos(pos){return DOMPos4.before(this.dom);}},{key:"localPosFromDOM",value:function localPosFromDOM(){return 0;}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos){var rects=clientRectsFor4(this.dom);return rects[rects.length-1]||null;}},{key:"overrideDOMText",get:function get(){return Text.of([this.dom.nodeValue.replace(/\u200b/g,"")]);}}]);return WidgetBufferView4;}(ContentView4);TextView4.prototype.children=WidgetView4.prototype.children=WidgetBufferView4.prototype.children=noChildren3;function inlineDOMAtPos4(dom,children,pos){var i=0;for(var off=0;i<children.length;i++){var child=children[i],end=off+child.length;if(end==off&&child.getSide()<=0)continue;if(pos>off&&pos<end&&child.dom.parentNode==dom)return child.domAtPos(pos-off);if(pos<=off)break;off=end;}for(;i>0;i--){var before=children[i-1].dom;if(before.parentNode==dom)return DOMPos4.after(before);}return new DOMPos4(dom,0);}function joinInlineInto4(parent,view,open){var last,children=parent.children;if(open>0&&view instanceof MarkView4&&children.length&&(last=children[children.length-1])instanceof MarkView4&&last.mark.eq(view.mark)){joinInlineInto4(last,view.children[0],open-1);}else{children.push(view);view.setParent(parent);}parent.length+=view.length;}function coordsInChildren4(view,pos,side){for(var off=0,_i207=0;_i207<view.children.length;_i207++){var child=view.children[_i207],end=off+child.length,next=void 0;if((side<=0||end==view.length||child.getSide()>0?end>=pos:end>pos)&&(pos<end||_i207+1==view.children.length||(next=view.children[_i207+1]).length||next.getSide()>0)){var flatten2=0;if(end==off){if(child.getSide()<=0)continue;flatten2=side=-child.getSide();}var rect=child.coordsAt(pos-off,side);return flatten2&&rect?flattenRect4(rect,side<0):rect;}off=end;}var last=view.dom.lastChild;if(!last)return view.dom.getBoundingClientRect();var rects=clientRectsFor4(last);return rects[rects.length-1]||null;}function combineAttrs4(source,target){for(var name2 in source){if(name2=="class"&&target["class"])target["class"]+=" "+source["class"];else if(name2=="style"&&target.style)target.style+=";"+source.style;else target[name2]=source[name2];}return target;}function attrsEq4(a,b){if(a==b)return true;if(!a||!b)return false;var keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length!=keysB.length)return false;for(var _i208=0,_keysA4=keysA;_i208<_keysA4.length;_i208++){var key=_keysA4[_i208];if(keysB.indexOf(key)==-1||a[key]!==b[key])return false;}return true;}function updateAttrs4(dom,prev,attrs){if(prev){for(var name2 in prev){if(!(attrs&&name2 in attrs))dom.removeAttribute(name2);}}if(attrs){for(var _name4 in attrs){if(!(prev&&prev[_name4]==attrs[_name4]))dom.setAttribute(_name4,attrs[_name4]);}}}var WidgetType4=/*#__PURE__*/function(){function WidgetType4(){_classCallCheck(this,WidgetType4);}_createClass(WidgetType4,[{key:"eq",value:function eq(_widget){return false;}},{key:"updateDOM",value:function updateDOM(_dom){return false;}},{key:"compare",value:function compare(other){return this==other||this.constructor==other.constructor&&this.eq(other);}},{key:"estimatedHeight",get:function get(){return-1;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return true;}},{key:"customView",get:function get(){return null;}},{key:"destroy",value:function destroy(_dom){}}]);return WidgetType4;}();var BlockType4=/* @__PURE__ */function(BlockType6){BlockType6[BlockType6["Text"]=0]="Text";BlockType6[BlockType6["WidgetBefore"]=1]="WidgetBefore";BlockType6[BlockType6["WidgetAfter"]=2]="WidgetAfter";BlockType6[BlockType6["WidgetRange"]=3]="WidgetRange";return BlockType6;}(BlockType4||(BlockType4={}));var Decoration4=/*#__PURE__*/function(_RangeValue5){_inherits(Decoration4,_RangeValue5);var _super79=_createSuper(Decoration4);function Decoration4(startSide,endSide,widget,spec){var _this144;_classCallCheck(this,Decoration4);_this144=_super79.call(this);_this144.startSide=startSide;_this144.endSide=endSide;_this144.widget=widget;_this144.spec=spec;return _this144;}_createClass(Decoration4,[{key:"heightRelevant",get:function get(){return false;}},{key:"hasHeight",value:function hasHeight(){return this.widget?this.widget.estimatedHeight>-1:false;}}],[{key:"mark",value:function mark(spec){return new MarkDecoration4(spec);}},{key:"widget",value:function widget(spec){var side=spec.side||0,block=!!spec.block;side+=block?side>0?3e8:-4e8:side>0?1e8:-1e8;return new PointDecoration4(spec,side,side,block,spec.widget||null,false);}},{key:"replace",value:function replace(spec){var block=!!spec.block;var _getInclusive7=getInclusive4(spec,block),start=_getInclusive7.start,end=_getInclusive7.end;var startSide=block?start?-3e8:-1:4e8;var endSide=block?end?2e8:1:-5e8;return new PointDecoration4(spec,startSide,endSide,block,spec.widget||null,true);}},{key:"line",value:function line(spec){return new LineDecoration4(spec);}},{key:"set",value:function set(of){var sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return RangeSet.of(of,sort);}}]);return Decoration4;}(RangeValue);Decoration4.none=RangeSet.empty;var MarkDecoration4=/*#__PURE__*/function(_Decoration10){_inherits(MarkDecoration4,_Decoration10);var _super80=_createSuper(MarkDecoration4);function MarkDecoration4(spec){var _this145;_classCallCheck(this,MarkDecoration4);var _getInclusive8=getInclusive4(spec),start=_getInclusive8.start,end=_getInclusive8.end;_this145=_super80.call(this,start?-1:4e8,end?1:-5e8,null,spec);_this145.tagName=spec.tagName||"span";_this145["class"]=spec["class"]||"";_this145.attrs=spec.attributes||null;return _this145;}_createClass(MarkDecoration4,[{key:"eq",value:function eq(other){return this==other||other instanceof MarkDecoration4&&this.tagName==other.tagName&&this["class"]==other["class"]&&attrsEq4(this.attrs,other.attrs);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(from>=to)throw new RangeError("Mark decorations may not be empty");return _get(_getPrototypeOf(MarkDecoration4.prototype),"range",this).call(this,from,to);}}]);return MarkDecoration4;}(Decoration4);MarkDecoration4.prototype.point=false;var LineDecoration4=/*#__PURE__*/function(_Decoration11){_inherits(LineDecoration4,_Decoration11);var _super81=_createSuper(LineDecoration4);function LineDecoration4(spec){_classCallCheck(this,LineDecoration4);return _super81.call(this,-2e8,-2e8,null,spec);}_createClass(LineDecoration4,[{key:"eq",value:function eq(other){return other instanceof LineDecoration4&&attrsEq4(this.spec.attributes,other.spec.attributes);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(to!=from)throw new RangeError("Line decoration ranges must be zero-length");return _get(_getPrototypeOf(LineDecoration4.prototype),"range",this).call(this,from,to);}}]);return LineDecoration4;}(Decoration4);LineDecoration4.prototype.mapMode=MapMode.TrackBefore;LineDecoration4.prototype.point=true;var PointDecoration4=/*#__PURE__*/function(_Decoration12){_inherits(PointDecoration4,_Decoration12);var _super82=_createSuper(PointDecoration4);function PointDecoration4(spec,startSide,endSide,block,widget,isReplace){var _this146;_classCallCheck(this,PointDecoration4);_this146=_super82.call(this,startSide,endSide,widget,spec);_this146.block=block;_this146.isReplace=isReplace;_this146.mapMode=!block?MapMode.TrackDel:startSide<=0?MapMode.TrackBefore:MapMode.TrackAfter;return _this146;}_createClass(PointDecoration4,[{key:"type",get:function get(){return this.startSide<this.endSide?BlockType4.WidgetRange:this.startSide<=0?BlockType4.WidgetBefore:BlockType4.WidgetAfter;}},{key:"heightRelevant",get:function get(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5;}},{key:"eq",value:function eq(other){return other instanceof PointDecoration4&&widgetsEq4(this.widget,other.widget)&&this.block==other.block&&this.startSide==other.startSide&&this.endSide==other.endSide;}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(this.isReplace&&(from>to||from==to&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&to!=from)throw new RangeError("Widget decorations can only have zero-length ranges");return _get(_getPrototypeOf(PointDecoration4.prototype),"range",this).call(this,from,to);}}]);return PointDecoration4;}(Decoration4);PointDecoration4.prototype.point=true;function getInclusive4(spec){var block=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var start=spec.inclusiveStart,end=spec.inclusiveEnd;if(start==null)start=spec.inclusive;if(end==null)end=spec.inclusive;return{start:start!==null&&start!==void 0?start:block,end:end!==null&&end!==void 0?end:block};}function widgetsEq4(a,b){return a==b||!!(a&&b&&a.compare(b));}function addRange4(from,to,ranges){var margin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var last=ranges.length-1;if(last>=0&&ranges[last]+margin>=from)ranges[last]=Math.max(ranges[last],to);else ranges.push(from,to);}var LineView4=/*#__PURE__*/function(_ContentView23){_inherits(LineView4,_ContentView23);var _super83=_createSuper(LineView4);function LineView4(){var _this147;_classCallCheck(this,LineView4);_this147=_super83.apply(this,arguments);_this147.children=[];_this147.length=0;_this147.prevAttrs=void 0;_this147.attrs=null;_this147.breakAfter=0;return _this147;}_createClass(LineView4,[{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source){if(!(source instanceof LineView4))return false;if(!this.dom)source.transferDOM(this);}if(hasStart)this.setDeco(source?source.attrs:null);mergeChildrenInto3(this,from,to,source?source.children:[],openStart,openEnd);return true;}},{key:"split",value:function split(at){var end=new LineView4();end.breakAfter=this.breakAfter;if(this.length==0)return end;var _this$childPos4=this.childPos(at),i=_this$childPos4.i,off=_this$childPos4.off;if(off){end.append(this.children[i].split(off),0);this.children[i].merge(off,this.children[i].length,null,false,0,0);i++;}for(var j=i;j<this.children.length;j++){end.append(this.children[j],0);}while(i>0&&this.children[i-1].length==0){this.children[--i].destroy();}this.children.length=i;this.markDirty();this.length=at;return end;}},{key:"transferDOM",value:function transferDOM(other){if(!this.dom)return;other.setDOM(this.dom);other.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs;this.prevAttrs=void 0;this.dom=null;}},{key:"setDeco",value:function setDeco(attrs){if(!attrsEq4(this.attrs,attrs)){if(this.dom){this.prevAttrs=this.attrs;this.markDirty();}this.attrs=attrs;}}},{key:"append",value:function append(child,openStart){joinInlineInto4(this,child,openStart);}},{key:"addLineDeco",value:function addLineDeco(deco){var attrs=deco.spec.attributes,cls=deco.spec["class"];if(attrs)this.attrs=combineAttrs4(attrs,this.attrs||{});if(cls)this.attrs=combineAttrs4({"class":cls},this.attrs||{});}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos4(this.dom,this.children,pos);}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName=="DIV"){this.setDOM(node);this.dirty|=4|2;}}},{key:"sync",value:function sync(track){var _a;if(!this.dom){this.setDOM(document.createElement("div"));this.dom.className="cm-line";this.prevAttrs=this.attrs?null:void 0;}else if(this.dirty&4){clearAttributes3(this.dom);this.dom.className="cm-line";this.prevAttrs=this.attrs?null:void 0;}if(this.prevAttrs!==void 0){updateAttrs4(this.dom,this.prevAttrs,this.attrs);this.dom.classList.add("cm-line");this.prevAttrs=void 0;}_get(_getPrototypeOf(LineView4.prototype),"sync",this).call(this,track);var last=this.dom.lastChild;while(last&&ContentView4.get(last)instanceof MarkView4){last=last.lastChild;}if(!last||last.nodeName!="BR"&&((_a=ContentView4.get(last))===null||_a===void 0?void 0:_a.isEditable)==false&&(!browser4.ios||!this.children.some(function(ch){return ch instanceof TextView4;}))){var hack=document.createElement("BR");hack.cmIgnore=true;this.dom.appendChild(hack);}}},{key:"measureTextSize",value:function measureTextSize(){if(this.children.length==0||this.length>20)return null;var totalWidth=0;var _iterator242=_createForOfIteratorHelper(this.children),_step242;try{for(_iterator242.s();!(_step242=_iterator242.n()).done;){var child=_step242.value;if(!(child instanceof TextView4))return null;var rects=clientRectsFor4(child.dom);if(rects.length!=1)return null;totalWidth+=rects[0].width;}}catch(err){_iterator242.e(err);}finally{_iterator242.f();}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:totalWidth/this.length};}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren4(this,pos,side);}},{key:"become",value:function become(_other){return false;}},{key:"type",get:function get(){return BlockType4.Text;}}],[{key:"find",value:function find(docView,pos){for(var _i209=0,off=0;_i209<docView.children.length;_i209++){var block=docView.children[_i209],end=off+block.length;if(end>=pos){if(block instanceof LineView4)return block;if(end>pos)break;}off=end+block.breakAfter;}return null;}}]);return LineView4;}(ContentView4);var BlockWidgetView4=/*#__PURE__*/function(_ContentView24){_inherits(BlockWidgetView4,_ContentView24);var _super84=_createSuper(BlockWidgetView4);function BlockWidgetView4(widget,length,type){var _this148;_classCallCheck(this,BlockWidgetView4);_this148=_super84.call(this);_this148.widget=widget;_this148.length=length;_this148.type=type;_this148.breakAfter=0;return _this148;}_createClass(BlockWidgetView4,[{key:"merge",value:function merge(from,to,source,_takeDeco,openStart,openEnd){if(source&&(!(source instanceof BlockWidgetView4)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos4.before(this.dom):DOMPos4.after(this.dom,pos==this.length);}},{key:"split",value:function split(at){var len=this.length-at;this.length=at;var end=new BlockWidgetView4(this.widget,len,this.type);end.breakAfter=this.breakAfter;return end;}},{key:"children",get:function get(){return noChildren3;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"overrideDOMText",get:function get(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty;}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"become",value:function become(other){if(other instanceof BlockWidgetView4&&other.type==this.type&&other.widget.constructor==this.widget.constructor){if(!other.widget.eq(this.widget))this.markDirty(true);this.widget=other.widget;this.length=other.length;this.breakAfter=other.breakAfter;return true;}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(BlockWidgetView4.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom);}}]);return BlockWidgetView4;}(ContentView4);var ContentBuilder4=/*#__PURE__*/function(){function ContentBuilder4(doc6,pos,end,disallowBlockEffectsBelow){_classCallCheck(this,ContentBuilder4);this.doc=doc6;this.pos=pos;this.end=end;this.disallowBlockEffectsBelow=disallowBlockEffectsBelow;this.content=[];this.curLine=null;this.breakAtStart=0;this.pendingBuffer=0;this.atCursorPos=true;this.openStart=-1;this.openEnd=-1;this.text="";this.textOff=0;this.cursor=doc6.iter();this.skip=pos;}_createClass(ContentBuilder4,[{key:"posCovered",value:function posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;var last=this.content[this.content.length-1];return!last.breakAfter&&!(last instanceof BlockWidgetView4&&last.type==BlockType4.WidgetBefore);}},{key:"getLine",value:function getLine(){if(!this.curLine){this.content.push(this.curLine=new LineView4());this.atCursorPos=true;}return this.curLine;}},{key:"flushBuffer",value:function flushBuffer(active){if(this.pendingBuffer){this.curLine.append(wrapMarks4(new WidgetBufferView4(-1),active),active.length);this.pendingBuffer=0;}}},{key:"addBlockWidget",value:function addBlockWidget(view){this.flushBuffer([]);this.curLine=null;this.content.push(view);}},{key:"finish",value:function finish(openEnd){if(!openEnd)this.flushBuffer([]);else this.pendingBuffer=0;if(!this.posCovered())this.getLine();}},{key:"buildText",value:function buildText(length,active,openStart){while(length>0){if(this.textOff==this.text.length){var _this$cursor$next5=this.cursor.next(this.skip),value=_this$cursor$next5.value,lineBreak=_this$cursor$next5.lineBreak,done=_this$cursor$next5.done;this.skip=0;if(done)throw new Error("Ran out of text content when drawing inline views");if(lineBreak){if(!this.posCovered())this.getLine();if(this.content.length)this.content[this.content.length-1].breakAfter=1;else this.breakAtStart=1;this.flushBuffer([]);this.curLine=null;length--;continue;}else{this.text=value;this.textOff=0;}}var take=Math.min(this.text.length-this.textOff,length,512);this.flushBuffer(active.slice(0,openStart));this.getLine().append(wrapMarks4(new TextView4(this.text.slice(this.textOff,this.textOff+take)),active),openStart);this.atCursorPos=true;this.textOff+=take;length-=take;openStart=0;}}},{key:"span",value:function span(from,to,active,openStart){this.buildText(to-from,active,openStart);this.pos=to;if(this.openStart<0)this.openStart=openStart;}},{key:"point",value:function point(from,to,deco,active,openStart){var len=to-from;if(deco instanceof PointDecoration4){if(deco.block){var type=deco.type;if(type==BlockType4.WidgetAfter&&!this.posCovered())this.getLine();this.addBlockWidget(new BlockWidgetView4(deco.widget||new NullWidget4("div"),len,type));}else{var view=WidgetView4.create(deco.widget||new NullWidget4("span"),len,deco.startSide);var cursorBefore=this.atCursorPos&&!view.isEditable&&openStart<=active.length&&(from<to||deco.startSide>0);var cursorAfter=!view.isEditable&&(from<to||deco.startSide<=0);var line=this.getLine();if(this.pendingBuffer==2&&!cursorBefore)this.pendingBuffer=0;this.flushBuffer(active);if(cursorBefore){line.append(wrapMarks4(new WidgetBufferView4(1),active),openStart);openStart=active.length+Math.max(0,openStart-active.length);}line.append(wrapMarks4(view,active),openStart);this.atCursorPos=cursorAfter;this.pendingBuffer=!cursorAfter?0:from<to?1:2;}}else if(this.doc.lineAt(this.pos).from==this.pos){this.getLine().addLineDeco(deco);}if(len){if(this.textOff+len<=this.text.length){this.textOff+=len;}else{this.skip+=len-(this.text.length-this.textOff);this.text="";this.textOff=0;}this.pos=to;}if(this.openStart<0)this.openStart=openStart;}},{key:"filterPoint",value:function filterPoint(from,to,value,index){if(index>=this.disallowBlockEffectsBelow||!(value instanceof PointDecoration4))return true;if(value.block)throw new RangeError("Block decorations may not be specified via plugins");return to<=this.doc.lineAt(this.pos).to;}}],[{key:"build",value:function build(text,from,to,decorations6,pluginDecorationLength){var builder=new ContentBuilder4(text,from,to,pluginDecorationLength);builder.openEnd=RangeSet.spans(decorations6,from,to,builder);if(builder.openStart<0)builder.openStart=builder.openEnd;builder.finish(builder.openEnd);return builder;}}]);return ContentBuilder4;}();function wrapMarks4(view,active){var _iterator243=_createForOfIteratorHelper(active),_step243;try{for(_iterator243.s();!(_step243=_iterator243.n()).done;){var mark=_step243.value;view=new MarkView4(mark,[view],view.length);}}catch(err){_iterator243.e(err);}finally{_iterator243.f();}return view;}var NullWidget4=/*#__PURE__*/function(_WidgetType16){_inherits(NullWidget4,_WidgetType16);var _super85=_createSuper(NullWidget4);function NullWidget4(tag){var _this149;_classCallCheck(this,NullWidget4);_this149=_super85.call(this);_this149.tag=tag;return _this149;}_createClass(NullWidget4,[{key:"eq",value:function eq(other){return other.tag==this.tag;}},{key:"toDOM",value:function toDOM(){return document.createElement(this.tag);}},{key:"updateDOM",value:function updateDOM(elt){return elt.nodeName.toLowerCase()==this.tag;}}]);return NullWidget4;}(WidgetType4);var none6=[];var clickAddsSelectionRange4=/* @__PURE__ */Facet.define();var dragMovesSelection$14=/* @__PURE__ */Facet.define();var mouseSelectionStyle4=/* @__PURE__ */Facet.define();var exceptionSink4=/* @__PURE__ */Facet.define();var updateListener4=/* @__PURE__ */Facet.define();var inputHandler4=/* @__PURE__ */Facet.define();var scrollTo4=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});var centerOn4=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});var ScrollTarget4=/*#__PURE__*/function(){function ScrollTarget4(range){var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"nearest";var x=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"nearest";var yMargin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;var xMargin=arguments.length>4&&arguments[4]!==undefined?arguments[4]:5;_classCallCheck(this,ScrollTarget4);this.range=range;this.y=y;this.x=x;this.yMargin=yMargin;this.xMargin=xMargin;}_createClass(ScrollTarget4,[{key:"map",value:function map(changes){return changes.empty?this:new ScrollTarget4(this.range.map(changes),this.y,this.x,this.yMargin,this.xMargin);}}]);return ScrollTarget4;}();var scrollIntoView3=/* @__PURE__ */StateEffect.define({map:function map(t2,ch){return t2.map(ch);}});function logException4(state,exception,context){var handler=state.facet(exceptionSink4);if(handler.length)handler[0](exception);else if(window.onerror)window.onerror(String(exception),context,void 0,void 0,exception);else if(context)console.error(context+":",exception);else console.error(exception);}var editable4=/* @__PURE__ */Facet.define({combine:function combine(values){return values.length?values[0]:true;}});var PluginFieldProvider4=/*#__PURE__*/_createClass(function PluginFieldProvider4(field,get){_classCallCheck(this,PluginFieldProvider4);this.field=field;this.get=get;});var PluginField4=/*#__PURE__*/function(){function PluginField4(){_classCallCheck(this,PluginField4);}_createClass(PluginField4,[{key:"from",value:function from(get){return new PluginFieldProvider4(this,get);}}],[{key:"define",value:function define(){return new PluginField4();}}]);return PluginField4;}();PluginField4.decorations=/* @__PURE__ */PluginField4.define();PluginField4.atomicRanges=/* @__PURE__ */PluginField4.define();PluginField4.scrollMargins=/* @__PURE__ */PluginField4.define();var nextPluginID4=0;var viewPlugin4=/* @__PURE__ */Facet.define();var ViewPlugin4=/*#__PURE__*/function(){function ViewPlugin4(id,create,fields){_classCallCheck(this,ViewPlugin4);this.id=id;this.create=create;this.fields=fields;this.extension=viewPlugin4.of(this);}_createClass(ViewPlugin4,null,[{key:"define",value:function define(create,spec){var _ref46=spec||{},eventHandlers=_ref46.eventHandlers,provide=_ref46.provide,decorations6=_ref46.decorations;var fields=[];if(provide){var _iterator244=_createForOfIteratorHelper(Array.isArray(provide)?provide:[provide]),_step244;try{for(_iterator244.s();!(_step244=_iterator244.n()).done;){var provider=_step244.value;fields.push(provider);}}catch(err){_iterator244.e(err);}finally{_iterator244.f();}}if(eventHandlers)fields.push(domEventHandlers4.from(function(value){return{plugin:value,handlers:eventHandlers};}));if(decorations6)fields.push(PluginField4.decorations.from(decorations6));return new ViewPlugin4(nextPluginID4++,create,fields);}},{key:"fromClass",value:function fromClass(cls,spec){return ViewPlugin4.define(function(view){return new cls(view);},spec);}}]);return ViewPlugin4;}();var domEventHandlers4=/* @__PURE__ */PluginField4.define();var PluginInstance4=/*#__PURE__*/function(){function PluginInstance4(spec){_classCallCheck(this,PluginInstance4);this.spec=spec;this.mustUpdate=null;this.value=null;}_createClass(PluginInstance4,[{key:"takeField",value:function takeField(type,target){if(this.spec){var _iterator245=_createForOfIteratorHelper(this.spec.fields),_step245;try{for(_iterator245.s();!(_step245=_iterator245.n()).done;){var _step245$value=_step245.value,field=_step245$value.field,get=_step245$value.get;if(field==type)target.push(get(this.value));}}catch(err){_iterator245.e(err);}finally{_iterator245.f();}}}},{key:"update",value:function update(view){if(!this.value){if(this.spec){try{this.value=this.spec.create(view);}catch(e){logException4(view.state,e,"CodeMirror plugin crashed");this.deactivate();}}}else if(this.mustUpdate){var update=this.mustUpdate;this.mustUpdate=null;if(this.value.update){try{this.value.update(update);}catch(e){logException4(update.state,e,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy();}catch(_){}this.deactivate();}}}return this;}},{key:"destroy",value:function destroy(view){var _a;if((_a=this.value)===null||_a===void 0?void 0:_a.destroy){try{this.value.destroy();}catch(e){logException4(view.state,e,"CodeMirror plugin crashed");}}}},{key:"deactivate",value:function deactivate(){this.spec=this.value=null;}}]);return PluginInstance4;}();var editorAttributes4=/* @__PURE__ */Facet.define();var contentAttributes4=/* @__PURE__ */Facet.define();var decorations4=/* @__PURE__ */Facet.define();var styleModule4=/* @__PURE__ */Facet.define();var ChangedRange4=/*#__PURE__*/function(){function ChangedRange4(fromA,toA,fromB,toB){_classCallCheck(this,ChangedRange4);this.fromA=fromA;this.toA=toA;this.fromB=fromB;this.toB=toB;}_createClass(ChangedRange4,[{key:"join",value:function join(other){return new ChangedRange4(Math.min(this.fromA,other.fromA),Math.max(this.toA,other.toA),Math.min(this.fromB,other.fromB),Math.max(this.toB,other.toB));}},{key:"addToSet",value:function addToSet(set){var i=set.length,me=this;for(;i>0;i--){var range=set[i-1];if(range.fromA>me.toA)continue;if(range.toA<me.fromA)break;me=me.join(range);set.splice(i-1,1);}set.splice(i,0,me);return set;}}],[{key:"extendWithRanges",value:function extendWithRanges(diff,ranges){if(ranges.length==0)return diff;var result=[];for(var dI=0,rI=0,posA=0,posB=0;;dI++){var next=dI==diff.length?null:diff[dI],off=posA-posB;var end=next?next.fromB:1e9;while(rI<ranges.length&&ranges[rI]<end){var from=ranges[rI],to=ranges[rI+1];var fromB=Math.max(posB,from),toB=Math.min(end,to);if(fromB<=toB)new ChangedRange4(fromB+off,toB+off,fromB,toB).addToSet(result);if(to>end)break;else rI+=2;}if(!next)return result;new ChangedRange4(next.fromA,next.toA,next.fromB,next.toB).addToSet(result);posA=next.toA;posB=next.toB;}}}]);return ChangedRange4;}();var ViewUpdate4=/*#__PURE__*/function(){function ViewUpdate4(view,state){var transactions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:none6;_classCallCheck(this,ViewUpdate4);this.view=view;this.state=state;this.transactions=transactions;this.flags=0;this.startState=view.state;this.changes=ChangeSet.empty(this.startState.doc.length);var _iterator246=_createForOfIteratorHelper(transactions),_step246;try{for(_iterator246.s();!(_step246=_iterator246.n()).done;){var tr=_step246.value;this.changes=this.changes.compose(tr.changes);}}catch(err){_iterator246.e(err);}finally{_iterator246.f();}var changedRanges=[];this.changes.iterChangedRanges(function(fromA,toA,fromB,toB){return changedRanges.push(new ChangedRange4(fromA,toA,fromB,toB));});this.changedRanges=changedRanges;var focus=view.hasFocus;if(focus!=view.inputState.notifiedFocused){view.inputState.notifiedFocused=focus;this.flags|=1;}}_createClass(ViewUpdate4,[{key:"viewportChanged",get:function get(){return(this.flags&4)>0;}},{key:"heightChanged",get:function get(){return(this.flags&2)>0;}},{key:"geometryChanged",get:function get(){return this.docChanged||(this.flags&(8|2))>0;}},{key:"focusChanged",get:function get(){return(this.flags&1)>0;}},{key:"docChanged",get:function get(){return!this.changes.empty;}},{key:"selectionSet",get:function get(){return this.transactions.some(function(tr){return tr.selection;});}},{key:"empty",get:function get(){return this.flags==0&&this.transactions.length==0;}}]);return ViewUpdate4;}();var Direction4=/* @__PURE__ */function(Direction6){Direction6[Direction6["LTR"]=0]="LTR";Direction6[Direction6["RTL"]=1]="RTL";return Direction6;}(Direction4||(Direction4={}));var LTR4=Direction4.LTR;var RTL4=Direction4.RTL;function dec4(str){var result=[];for(var _i210=0;_i210<str.length;_i210++){result.push(1<<+str[_i210]);}return result;}var LowTypes4=/* @__PURE__ */dec4("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");var ArabicTypes4=/* @__PURE__ */dec4("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");var Brackets4=/* @__PURE__ */Object.create(null);var BracketStack4=[];for(var _i211=0,_arr5=["()","[]","{}"];_i211<_arr5.length;_i211++){var _p7=_arr5[_i211];var _l7=/* @__PURE__ */_p7.charCodeAt(0),_r14=/* @__PURE__ */_p7.charCodeAt(1);Brackets4[_l7]=_r14;Brackets4[_r14]=-_l7;}function charType4(ch){return ch<=247?LowTypes4[ch]:1424<=ch&&ch<=1524?2:1536<=ch&&ch<=1785?ArabicTypes4[ch-1536]:1774<=ch&&ch<=2220?4:8192<=ch&&ch<=8203?256:ch==8204?256:1;}var BidiRE4=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var BidiSpan4=/*#__PURE__*/function(){function BidiSpan4(from,to,level){_classCallCheck(this,BidiSpan4);this.from=from;this.to=to;this.level=level;}_createClass(BidiSpan4,[{key:"dir",get:function get(){return this.level%2?RTL4:LTR4;}},{key:"side",value:function side(end,dir){return this.dir==dir==end?this.to:this.from;}}],[{key:"find",value:function find(order,index,level,assoc){var maybe=-1;for(var _i212=0;_i212<order.length;_i212++){var span=order[_i212];if(span.from<=index&&span.to>=index){if(span.level==level)return _i212;if(maybe<0||(assoc!=0?assoc<0?span.from<index:span.to>index:order[maybe].level>span.level))maybe=_i212;}}if(maybe<0)throw new RangeError("Index out of range");return maybe;}}]);return BidiSpan4;}();var types4=[];function computeOrder4(line,direction){var len=line.length,outerType=direction==LTR4?1:2,oppositeType=direction==LTR4?2:1;if(!line||outerType==1&&!BidiRE4.test(line))return trivialOrder4(len);for(var _i213=0,prev=outerType,prevStrong=outerType;_i213<len;_i213++){var type=charType4(line.charCodeAt(_i213));if(type==512)type=prev;else if(type==8&&prevStrong==4)type=16;types4[_i213]=type==4?2:type;if(type&7)prevStrong=type;prev=type;}for(var _i214=0,_prev4=outerType,_prevStrong4=outerType;_i214<len;_i214++){var _type8=types4[_i214];if(_type8==128){if(_i214<len-1&&_prev4==types4[_i214+1]&&_prev4&24)_type8=types4[_i214]=_prev4;else types4[_i214]=256;}else if(_type8==64){var end=_i214+1;while(end<len&&types4[end]==64){end++;}var replace=_i214&&_prev4==8||end<len&&types4[end]==8?_prevStrong4==1?1:8:256;for(var j=_i214;j<end;j++){types4[j]=replace;}_i214=end-1;}else if(_type8==8&&_prevStrong4==1){types4[_i214]=1;}_prev4=_type8;if(_type8&7)_prevStrong4=_type8;}for(var _i215=0,sI=0,context=0,ch,br,_type9;_i215<len;_i215++){if(br=Brackets4[ch=line.charCodeAt(_i215)]){if(br<0){for(var sJ=sI-3;sJ>=0;sJ-=3){if(BracketStack4[sJ+1]==-br){var flags=BracketStack4[sJ+2];var type2=flags&2?outerType:!(flags&4)?0:flags&1?oppositeType:outerType;if(type2)types4[_i215]=types4[BracketStack4[sJ]]=type2;sI=sJ;break;}}}else if(BracketStack4.length==189){break;}else{BracketStack4[sI++]=_i215;BracketStack4[sI++]=ch;BracketStack4[sI++]=context;}}else if((_type9=types4[_i215])==2||_type9==1){var embed=_type9==outerType;context=embed?0:1;for(var _sJ4=sI-3;_sJ4>=0;_sJ4-=3){var cur2=BracketStack4[_sJ4+2];if(cur2&2)break;if(embed){BracketStack4[_sJ4+2]|=2;}else{if(cur2&4)break;BracketStack4[_sJ4+2]|=4;}}}}for(var _i216=0;_i216<len;_i216++){if(types4[_i216]==256){var _end9=_i216+1;while(_end9<len&&types4[_end9]==256){_end9++;}var beforeL=(_i216?types4[_i216-1]:outerType)==1;var afterL=(_end9<len?types4[_end9]:outerType)==1;var _replace4=beforeL==afterL?beforeL?1:2:outerType;for(var _j7=_i216;_j7<_end9;_j7++){types4[_j7]=_replace4;}_i216=_end9-1;}}var order=[];if(outerType==1){for(var _i217=0;_i217<len;){var start=_i217,rtl=types4[_i217++]!=1;while(_i217<len&&rtl==(types4[_i217]!=1)){_i217++;}if(rtl){for(var _j8=_i217;_j8>start;){var _end10=_j8,_l8=types4[--_j8]!=2;while(_j8>start&&_l8==(types4[_j8-1]!=2)){_j8--;}order.push(new BidiSpan4(_j8,_end10,_l8?2:1));}}else{order.push(new BidiSpan4(start,_i217,0));}}}else{for(var _i218=0;_i218<len;){var _start10=_i218,_rtl4=types4[_i218++]==2;while(_i218<len&&_rtl4==(types4[_i218]==2)){_i218++;}order.push(new BidiSpan4(_start10,_i218,_rtl4?1:2));}}return order;}function trivialOrder4(length){return[new BidiSpan4(0,length,0)];}var movedOver4="";function moveVisually4(line,order,dir,start,forward){var _a;var startIndex=start.head-line.from,spanI=-1;if(startIndex==0){if(!forward||!line.length)return null;if(order[0].level!=dir){startIndex=order[0].side(false,dir);spanI=0;}}else if(startIndex==line.length){if(forward)return null;var last=order[order.length-1];if(last.level!=dir){startIndex=last.side(true,dir);spanI=order.length-1;}}if(spanI<0)spanI=BidiSpan4.find(order,startIndex,(_a=start.bidiLevel)!==null&&_a!==void 0?_a:-1,start.assoc);var span=order[spanI];if(startIndex==span.side(forward,dir)){span=order[spanI+=forward?1:-1];startIndex=span.side(!forward,dir);}var indexForward=forward==(span.dir==dir);var nextIndex=findClusterBreak(line.text,startIndex,indexForward);movedOver4=line.text.slice(Math.min(startIndex,nextIndex),Math.max(startIndex,nextIndex));if(nextIndex!=span.side(forward,dir))return EditorSelection.cursor(nextIndex+line.from,indexForward?-1:1,span.level);var nextSpan=spanI==(forward?order.length-1:0)?null:order[spanI+(forward?1:-1)];if(!nextSpan&&span.level!=dir)return EditorSelection.cursor(forward?line.to:line.from,forward?-1:1,dir);if(nextSpan&&nextSpan.level<span.level)return EditorSelection.cursor(nextSpan.side(!forward,dir)+line.from,forward?1:-1,nextSpan.level);return EditorSelection.cursor(nextIndex+line.from,forward?-1:1,span.level);}var DOMReader4=/*#__PURE__*/function(){function DOMReader4(points,view){_classCallCheck(this,DOMReader4);this.points=points;this.view=view;this.text="";this.lineBreak=view.state.lineBreak;}_createClass(DOMReader4,[{key:"readRange",value:function readRange(start,end){if(!start)return this;var parent=start.parentNode;for(var cur2=start;;){this.findPointBefore(parent,cur2);this.readNode(cur2);var next=cur2.nextSibling;if(next==end)break;var view=ContentView4.get(cur2),nextView=ContentView4.get(next);if(view&&nextView?view.breakAfter:(view?view.breakAfter:isBlockElement4(cur2))||isBlockElement4(next)&&(cur2.nodeName!="BR"||cur2.cmIgnore))this.text+=this.lineBreak;cur2=next;}this.findPointBefore(parent,end);return this;}},{key:"readTextNode",value:function readTextNode(node){var _a,_b;var text=node.nodeValue;if(/^\u200b/.test(text)&&((_a=node.previousSibling)===null||_a===void 0?void 0:_a.contentEditable)=="false")text=text.slice(1);if(/\u200b$/.test(text)&&((_b=node.nextSibling)===null||_b===void 0?void 0:_b.contentEditable)=="false")text=text.slice(0,text.length-1);return text;}},{key:"readNode",value:function readNode(node){if(node.cmIgnore)return;var view=ContentView4.get(node);var fromView=view&&view.overrideDOMText;var text;if(fromView!=null)text=fromView.sliceString(0,void 0,this.lineBreak);else if(node.nodeType==3)text=this.readTextNode(node);else if(node.nodeName=="BR")text=node.nextSibling?this.lineBreak:"";else if(node.nodeType==1)this.readRange(node.firstChild,null);if(text!=null){this.findPointIn(node,text.length);this.text+=text;if(browser4.chrome&&this.view.inputState.lastKeyCode==13&&!node.nextSibling&&/\n\n$/.test(this.text))this.text=this.text.slice(0,-1);}}},{key:"findPointBefore",value:function findPointBefore(node,next){var _iterator247=_createForOfIteratorHelper(this.points),_step247;try{for(_iterator247.s();!(_step247=_iterator247.n()).done;){var point=_step247.value;if(point.node==node&&node.childNodes[point.offset]==next)point.pos=this.text.length;}}catch(err){_iterator247.e(err);}finally{_iterator247.f();}}},{key:"findPointIn",value:function findPointIn(node,maxLen){var _iterator248=_createForOfIteratorHelper(this.points),_step248;try{for(_iterator248.s();!(_step248=_iterator248.n()).done;){var point=_step248.value;if(point.node==node)point.pos=this.text.length+Math.min(point.offset,maxLen);}}catch(err){_iterator248.e(err);}finally{_iterator248.f();}}}]);return DOMReader4;}();function isBlockElement4(node){return node.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(node.nodeName);}var DOMPoint4=/*#__PURE__*/_createClass(function DOMPoint4(node,offset){_classCallCheck(this,DOMPoint4);this.node=node;this.offset=offset;this.pos=-1;});var DocView4=/*#__PURE__*/function(_ContentView25){_inherits(DocView4,_ContentView25);var _super86=_createSuper(DocView4);function DocView4(view){var _this150;_classCallCheck(this,DocView4);_this150=_super86.call(this);_this150.view=view;_this150.compositionDeco=Decoration4.none;_this150.decorations=[];_this150.pluginDecorationLength=0;_this150.minWidth=0;_this150.minWidthFrom=0;_this150.minWidthTo=0;_this150.impreciseAnchor=null;_this150.impreciseHead=null;_this150.forceSelection=false;_this150.lastUpdate=Date.now();_this150.setDOM(view.contentDOM);_this150.children=[new LineView4()];_this150.children[0].setParent(_assertThisInitialized(_this150));_this150.updateDeco();_this150.updateInner([new ChangedRange4(0,0,0,view.state.doc.length)],0);return _this150;}_createClass(DocView4,[{key:"root",get:function get(){return this.view.root;}},{key:"editorView",get:function get(){return this.view;}},{key:"length",get:function get(){return this.view.state.doc.length;}},{key:"update",value:function update(_update23){var _this151=this;var changedRanges=_update23.changedRanges;if(this.minWidth>0&&changedRanges.length){if(!changedRanges.every(function(_ref47){var fromA=_ref47.fromA,toA=_ref47.toA;return toA<_this151.minWidthFrom||fromA>_this151.minWidthTo;})){this.minWidth=this.minWidthFrom=this.minWidthTo=0;}else{this.minWidthFrom=_update23.changes.mapPos(this.minWidthFrom,1);this.minWidthTo=_update23.changes.mapPos(this.minWidthTo,1);}}if(this.view.inputState.composing<0)this.compositionDeco=Decoration4.none;else if(_update23.transactions.length||this.dirty)this.compositionDeco=computeCompositionDeco4(this.view,_update23.changes);if((browser4.ie||browser4.chrome)&&!this.compositionDeco.size&&_update23&&_update23.state.doc.lines!=_update23.startState.doc.lines)this.forceSelection=true;var prevDeco=this.decorations,deco=this.updateDeco();var decoDiff=findChangedDeco4(prevDeco,deco,_update23.changes);changedRanges=ChangedRange4.extendWithRanges(changedRanges,decoDiff);if(this.dirty==0&&changedRanges.length==0){return false;}else{this.updateInner(changedRanges,_update23.startState.doc.length);if(_update23.transactions.length)this.lastUpdate=Date.now();return true;}}},{key:"updateInner",value:function updateInner(changes,oldLength){var _this152=this;this.view.viewState.mustMeasureContent=true;this.updateChildren(changes,oldLength);var observer=this.view.observer;observer.ignore(function(){_this152.dom.style.height=_this152.view.viewState.contentHeight+"px";_this152.dom.style.minWidth=_this152.minWidth?_this152.minWidth+"px":"";var track=browser4.chrome||browser4.ios?{node:observer.selectionRange.focusNode,written:false}:void 0;_this152.sync(track);_this152.dirty=0;if(track&&(track.written||observer.selectionRange.focusNode!=track.node))_this152.forceSelection=true;_this152.dom.style.height="";});var gaps=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length){var _iterator249=_createForOfIteratorHelper(this.children),_step249;try{for(_iterator249.s();!(_step249=_iterator249.n()).done;){var child=_step249.value;if(child instanceof BlockWidgetView4&&child.widget instanceof BlockGapWidget4)gaps.push(child.dom);}}catch(err){_iterator249.e(err);}finally{_iterator249.f();}}observer.updateGaps(gaps);}},{key:"updateChildren",value:function updateChildren(changes,oldLength){var cursor2=this.childCursor(oldLength);for(var _i219=changes.length-1;;_i219--){var next=_i219>=0?changes[_i219]:null;if(!next)break;var fromA=next.fromA,toA=next.toA,fromB=next.fromB,toB=next.toB;var _ContentBuilder4$buil=ContentBuilder4.build(this.view.state.doc,fromB,toB,this.decorations,this.pluginDecorationLength),content2=_ContentBuilder4$buil.content,breakAtStart=_ContentBuilder4$buil.breakAtStart,openStart=_ContentBuilder4$buil.openStart,openEnd=_ContentBuilder4$buil.openEnd;var _cursor2$findPos7=cursor2.findPos(toA,1),toI=_cursor2$findPos7.i,toOff=_cursor2$findPos7.off;var _cursor2$findPos8=cursor2.findPos(fromA,-1),fromI=_cursor2$findPos8.i,fromOff=_cursor2$findPos8.off;replaceRange3(this,fromI,fromOff,toI,toOff,content2,breakAtStart,openStart,openEnd);}}},{key:"updateSelection",value:function updateSelection(){var _this153=this;var mustRead=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var fromPointer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(mustRead)this.view.observer.readSelectionRange();if(!(fromPointer||this.mayControlSelection())||browser4.ios&&this.view.inputState.rapidCompositionStart)return;var force=this.forceSelection;this.forceSelection=false;var main=this.view.state.selection.main;var anchor=this.domAtPos(main.anchor);var head=main.empty?anchor:this.domAtPos(main.head);if(browser4.gecko&&main.empty&&betweenUneditable4(anchor)){var dummy=document.createTextNode("");this.view.observer.ignore(function(){return anchor.node.insertBefore(dummy,anchor.node.childNodes[anchor.offset]||null);});anchor=head=new DOMPos4(dummy,0);force=true;}var domSel=this.view.observer.selectionRange;if(force||!domSel.focusNode||!isEquivalentPosition4(anchor.node,anchor.offset,domSel.anchorNode,domSel.anchorOffset)||!isEquivalentPosition4(head.node,head.offset,domSel.focusNode,domSel.focusOffset)){this.view.observer.ignore(function(){if(browser4.android&&browser4.chrome&&_this153.dom.contains(domSel.focusNode)&&inUneditable4(domSel.focusNode,_this153.dom)){_this153.dom.blur();_this153.dom.focus({preventScroll:true});}var rawSel=getSelection4(_this153.root);if(main.empty){if(browser4.gecko){var nextTo=nextToUneditable4(anchor.node,anchor.offset);if(nextTo&&nextTo!=(1|2)){var _text10=nearbyTextNode4(anchor.node,anchor.offset,nextTo==1?1:-1);if(_text10)anchor=new DOMPos4(_text10,nextTo==1?0:_text10.nodeValue.length);}}rawSel.collapse(anchor.node,anchor.offset);if(main.bidiLevel!=null&&domSel.cursorBidiLevel!=null)domSel.cursorBidiLevel=main.bidiLevel;}else if(rawSel.extend){rawSel.collapse(anchor.node,anchor.offset);rawSel.extend(head.node,head.offset);}else{var range=document.createRange();if(main.anchor>main.head){var _ref48=[head,anchor];anchor=_ref48[0];head=_ref48[1];}range.setEnd(head.node,head.offset);range.setStart(anchor.node,anchor.offset);rawSel.removeAllRanges();rawSel.addRange(range);}});this.view.observer.setSelectionRange(anchor,head);}this.impreciseAnchor=anchor.precise?null:new DOMPos4(domSel.anchorNode,domSel.anchorOffset);this.impreciseHead=head.precise?null:new DOMPos4(domSel.focusNode,domSel.focusOffset);}},{key:"enforceCursorAssoc",value:function enforceCursorAssoc(){if(this.compositionDeco.size)return;var cursor2=this.view.state.selection.main;var sel=getSelection4(this.root);if(!cursor2.empty||!cursor2.assoc||!sel.modify)return;var line=LineView4.find(this,cursor2.head);if(!line)return;var lineStart=line.posAtStart;if(cursor2.head==lineStart||cursor2.head==lineStart+line.length)return;var before=this.coordsAt(cursor2.head,-1),after=this.coordsAt(cursor2.head,1);if(!before||!after||before.bottom>after.top)return;var dom=this.domAtPos(cursor2.head+cursor2.assoc);sel.collapse(dom.node,dom.offset);sel.modify("move",cursor2.assoc<0?"forward":"backward","lineboundary");}},{key:"mayControlSelection",value:function mayControlSelection(){return this.view.state.facet(editable4)?this.root.activeElement==this.dom:hasSelection4(this.dom,this.view.observer.selectionRange);}},{key:"nearest",value:function nearest(dom){for(var cur2=dom;cur2;){var domView=ContentView4.get(cur2);if(domView&&domView.rootView==this)return domView;cur2=cur2.parentNode;}return null;}},{key:"posFromDOM",value:function posFromDOM(node,offset){var view=this.nearest(node);if(!view)throw new RangeError("Trying to find position for a DOM position outside of the document");return view.localPosFromDOM(node,offset)+view.posAtStart;}},{key:"domAtPos",value:function domAtPos(pos){var _this$childCursor$fin4=this.childCursor().findPos(pos,-1),i=_this$childCursor$fin4.i,off=_this$childCursor$fin4.off;for(;i<this.children.length-1;){var child=this.children[i];if(off<child.length||child instanceof LineView4)break;i++;off=0;}return this.children[i].domAtPos(off);}},{key:"coordsAt",value:function coordsAt(pos,side){for(var off=this.length,_i220=this.children.length-1;;_i220--){var child=this.children[_i220],start=off-child.breakAfter-child.length;if(pos>start||pos==start&&child.type!=BlockType4.WidgetBefore&&child.type!=BlockType4.WidgetAfter&&(!_i220||side==2||this.children[_i220-1].breakAfter||this.children[_i220-1].type==BlockType4.WidgetBefore&&side>-2))return child.coordsAt(pos-start,side);off=start;}}},{key:"measureVisibleLineHeights",value:function measureVisibleLineHeights(){var result=[],_this$view$viewState$4=this.view.viewState.viewport,from=_this$view$viewState$4.from,to=_this$view$viewState$4.to;var contentWidth=this.view.contentDOM.clientWidth;var isWider=contentWidth>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;var widest=-1;for(var pos=0,_i221=0;_i221<this.children.length;_i221++){var child=this.children[_i221],end=pos+child.length;if(end>to)break;if(pos>=from){var childRect=child.dom.getBoundingClientRect();result.push(childRect.height);if(isWider){var last=child.dom.lastChild;var rects=last?clientRectsFor4(last):[];if(rects.length){var rect=rects[rects.length-1];var width=this.view.textDirection==Direction4.LTR?rect.right-childRect.left:childRect.right-rect.left;if(width>widest){widest=width;this.minWidth=contentWidth;this.minWidthFrom=pos;this.minWidthTo=end;}}}}pos=end+child.breakAfter;}return result;}},{key:"measureTextSize",value:function measureTextSize(){var _this154=this;var _iterator250=_createForOfIteratorHelper(this.children),_step250;try{for(_iterator250.s();!(_step250=_iterator250.n()).done;){var child=_step250.value;if(child instanceof LineView4){var measure=child.measureTextSize();if(measure)return measure;}}}catch(err){_iterator250.e(err);}finally{_iterator250.f();}var dummy=document.createElement("div"),lineHeight,charWidth;dummy.className="cm-line";dummy.textContent="abc def ghi jkl mno pqr stu";this.view.observer.ignore(function(){_this154.dom.appendChild(dummy);var rect=clientRectsFor4(dummy.firstChild)[0];lineHeight=dummy.getBoundingClientRect().height;charWidth=rect?rect.width/27:7;dummy.remove();});return{lineHeight:lineHeight,charWidth:charWidth};}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;var i=this.children.length;if(i)pos-=this.children[--i].length;return new ChildCursor4(this.children,pos,i);}},{key:"computeBlockGapDeco",value:function computeBlockGapDeco(){var deco=[],vs=this.view.viewState;for(var pos=0,_i222=0;;_i222++){var next=_i222==vs.viewports.length?null:vs.viewports[_i222];var end=next?next.from-1:this.length;if(end>pos){var height=vs.lineBlockAt(end).bottom-vs.lineBlockAt(pos).top;deco.push(Decoration4.replace({widget:new BlockGapWidget4(height),block:true,inclusive:true}).range(pos,end));}if(!next)break;pos=next.to+1;}return Decoration4.set(deco);}},{key:"updateDeco",value:function updateDeco(){var pluginDecorations=this.view.pluginField(PluginField4.decorations);this.pluginDecorationLength=pluginDecorations.length;return this.decorations=[].concat(_toConsumableArray(pluginDecorations),_toConsumableArray(this.view.state.facet(decorations4)),[this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]);}},{key:"scrollIntoView",value:function scrollIntoView(target){var range=target.range;var rect=this.coordsAt(range.head,range.empty?range.assoc:range.head>range.anchor?-1:1),other;if(!rect)return;if(!range.empty&&(other=this.coordsAt(range.anchor,range.anchor>range.head?-1:1)))rect={left:Math.min(rect.left,other.left),top:Math.min(rect.top,other.top),right:Math.max(rect.right,other.right),bottom:Math.max(rect.bottom,other.bottom)};var mLeft=0,mRight=0,mTop=0,mBottom=0;var _iterator251=_createForOfIteratorHelper(this.view.pluginField(PluginField4.scrollMargins)),_step251;try{for(_iterator251.s();!(_step251=_iterator251.n()).done;){var margins=_step251.value;if(margins){var left=margins.left,right=margins.right,top2=margins.top,bottom=margins.bottom;if(left!=null)mLeft=Math.max(mLeft,left);if(right!=null)mRight=Math.max(mRight,right);if(top2!=null)mTop=Math.max(mTop,top2);if(bottom!=null)mBottom=Math.max(mBottom,bottom);}}}catch(err){_iterator251.e(err);}finally{_iterator251.f();}var targetRect={left:rect.left-mLeft,top:rect.top-mTop,right:rect.right+mRight,bottom:rect.bottom+mBottom};scrollRectIntoView4(this.view.scrollDOM,targetRect,range.head<range.anchor?-1:1,target.x,target.y,target.xMargin,target.yMargin,this.view.textDirection==Direction4.LTR);}}]);return DocView4;}(ContentView4);function betweenUneditable4(pos){return pos.node.nodeType==1&&pos.node.firstChild&&(pos.offset==0||pos.node.childNodes[pos.offset-1].contentEditable=="false")&&(pos.offset==pos.node.childNodes.length||pos.node.childNodes[pos.offset].contentEditable=="false");}var BlockGapWidget4=/*#__PURE__*/function(_WidgetType17){_inherits(BlockGapWidget4,_WidgetType17);var _super87=_createSuper(BlockGapWidget4);function BlockGapWidget4(height){var _this155;_classCallCheck(this,BlockGapWidget4);_this155=_super87.call(this);_this155.height=height;return _this155;}_createClass(BlockGapWidget4,[{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");this.updateDOM(elt);return elt;}},{key:"eq",value:function eq(other){return other.height==this.height;}},{key:"updateDOM",value:function updateDOM(elt){elt.style.height=this.height+"px";return true;}},{key:"estimatedHeight",get:function get(){return this.height;}}]);return BlockGapWidget4;}(WidgetType4);function compositionSurroundingNode3(view){var sel=view.observer.selectionRange;var textNode=sel.focusNode&&nearbyTextNode4(sel.focusNode,sel.focusOffset,0);if(!textNode)return null;var cView=view.docView.nearest(textNode);if(!cView)return null;if(cView instanceof LineView4){var topNode=textNode;while(topNode.parentNode!=cView.dom){topNode=topNode.parentNode;}var prev=topNode.previousSibling;while(prev&&!ContentView4.get(prev)){prev=prev.previousSibling;}var pos=prev?ContentView4.get(prev).posAtEnd:cView.posAtStart;return{from:pos,to:pos,node:topNode,text:textNode};}else{for(;;){var _cView3=cView,parent=_cView3.parent;if(!parent)return null;if(parent instanceof LineView4)break;cView=parent;}var from=cView.posAtStart;return{from:from,to:from+cView.length,node:cView.dom,text:textNode};}}function computeCompositionDeco4(view,changes){var surrounding=compositionSurroundingNode3(view);if(!surrounding)return Decoration4.none;var from=surrounding.from,to=surrounding.to,node=surrounding.node,textNode=surrounding.text;var newFrom=changes.mapPos(from,1),newTo=Math.max(newFrom,changes.mapPos(to,-1));var state=view.state,text=node.nodeType==3?node.nodeValue:new DOMReader4([],view).readRange(node.firstChild,null).text;if(newTo-newFrom<text.length){if(state.sliceDoc(newFrom,Math.min(state.doc.length,newFrom+text.length))==text)newTo=newFrom+text.length;else if(state.sliceDoc(Math.max(0,newTo-text.length),newTo)==text)newFrom=newTo-text.length;else return Decoration4.none;}else if(state.sliceDoc(newFrom,newTo)!=text){return Decoration4.none;}return Decoration4.set(Decoration4.replace({widget:new CompositionWidget4(node,textNode)}).range(newFrom,newTo));}var CompositionWidget4=/*#__PURE__*/function(_WidgetType18){_inherits(CompositionWidget4,_WidgetType18);var _super88=_createSuper(CompositionWidget4);function CompositionWidget4(top2,text){var _this156;_classCallCheck(this,CompositionWidget4);_this156=_super88.call(this);_this156.top=top2;_this156.text=text;return _this156;}_createClass(CompositionWidget4,[{key:"eq",value:function eq(other){return this.top==other.top&&this.text==other.text;}},{key:"toDOM",value:function toDOM(){return this.top;}},{key:"ignoreEvent",value:function ignoreEvent(){return false;}},{key:"customView",get:function get(){return CompositionView4;}}]);return CompositionWidget4;}(WidgetType4);function nearbyTextNode4(node,offset,side){for(;;){if(node.nodeType==3)return node;if(node.nodeType==1&&offset>0&&side<=0){node=node.childNodes[offset-1];offset=maxOffset4(node);}else if(node.nodeType==1&&offset<node.childNodes.length&&side>=0){node=node.childNodes[offset];offset=0;}else{return null;}}}function nextToUneditable4(node,offset){if(node.nodeType!=1)return 0;return(offset&&node.childNodes[offset-1].contentEditable=="false"?1:0)|(offset<node.childNodes.length&&node.childNodes[offset].contentEditable=="false"?2:0);}var DecorationComparator$14=/*#__PURE__*/function(){function DecorationComparator$14(){_classCallCheck(this,DecorationComparator$14);this.changes=[];}_createClass(DecorationComparator$14,[{key:"compareRange",value:function compareRange(from,to){addRange4(from,to,this.changes);}},{key:"comparePoint",value:function comparePoint(from,to){addRange4(from,to,this.changes);}}]);return DecorationComparator$14;}();function findChangedDeco4(a,b,diff){var comp=new DecorationComparator$14();RangeSet.compare(a,b,diff,comp);return comp.changes;}function inUneditable4(node,inside6){for(var cur2=node;cur2&&cur2!=inside6;cur2=cur2.assignedSlot||cur2.parentNode){if(cur2.nodeType==1&&cur2.contentEditable=="false"){return true;}}return false;}function groupAt4(state,pos){var bias=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var categorize=state.charCategorizer(pos);var line=state.doc.lineAt(pos),linePos=pos-line.from;if(line.length==0)return EditorSelection.cursor(pos);if(linePos==0)bias=1;else if(linePos==line.length)bias=-1;var from=linePos,to=linePos;if(bias<0)from=findClusterBreak(line.text,linePos,false);else to=findClusterBreak(line.text,linePos);var cat=categorize(line.text.slice(from,to));while(from>0){var prev=findClusterBreak(line.text,from,false);if(categorize(line.text.slice(prev,from))!=cat)break;from=prev;}while(to<line.length){var next=findClusterBreak(line.text,to);if(categorize(line.text.slice(to,next))!=cat)break;to=next;}return EditorSelection.range(from+line.from,to+line.from);}function getdx4(x,rect){return rect.left>x?rect.left-x:Math.max(0,x-rect.right);}function getdy4(y,rect){return rect.top>y?rect.top-y:Math.max(0,y-rect.bottom);}function yOverlap4(a,b){return a.top<b.bottom-1&&a.bottom>b.top+1;}function upTop4(rect,top2){return top2<rect.top?{top:top2,left:rect.left,right:rect.right,bottom:rect.bottom}:rect;}function upBot4(rect,bottom){return bottom>rect.bottom?{top:rect.top,left:rect.left,right:rect.right,bottom:bottom}:rect;}function domPosAtCoords4(parent,x,y){var closest,closestRect,closestX,closestY;var above,below,aboveRect,belowRect;for(var child=parent.firstChild;child;child=child.nextSibling){var rects=clientRectsFor4(child);for(var _i223=0;_i223<rects.length;_i223++){var rect=rects[_i223];if(closestRect&&yOverlap4(closestRect,rect))rect=upTop4(upBot4(rect,closestRect.bottom),closestRect.top);var dx=getdx4(x,rect),dy=getdy4(y,rect);if(dx==0&&dy==0)return child.nodeType==3?domPosInText4(child,x,y):domPosAtCoords4(child,x,y);if(!closest||closestY>dy||closestY==dy&&closestX>dx){closest=child;closestRect=rect;closestX=dx;closestY=dy;}if(dx==0){if(y>rect.bottom&&(!aboveRect||aboveRect.bottom<rect.bottom)){above=child;aboveRect=rect;}else if(y<rect.top&&(!belowRect||belowRect.top>rect.top)){below=child;belowRect=rect;}}else if(aboveRect&&yOverlap4(aboveRect,rect)){aboveRect=upBot4(aboveRect,rect.bottom);}else if(belowRect&&yOverlap4(belowRect,rect)){belowRect=upTop4(belowRect,rect.top);}}}if(aboveRect&&aboveRect.bottom>=y){closest=above;closestRect=aboveRect;}else if(belowRect&&belowRect.top<=y){closest=below;closestRect=belowRect;}if(!closest)return{node:parent,offset:0};var clipX=Math.max(closestRect.left,Math.min(closestRect.right,x));if(closest.nodeType==3)return domPosInText4(closest,clipX,y);if(!closestX&&closest.contentEditable=="true")return domPosAtCoords4(closest,clipX,y);var offset=Array.prototype.indexOf.call(parent.childNodes,closest)+(x>=(closestRect.left+closestRect.right)/2?1:0);return{node:parent,offset:offset};}function domPosInText4(node,x,y){var len=node.nodeValue.length;var closestOffset=-1,closestDY=1e9,generalSide=0;for(var _i224=0;_i224<len;_i224++){var rects=textRange4(node,_i224,_i224+1).getClientRects();for(var j=0;j<rects.length;j++){var rect=rects[j];if(rect.top==rect.bottom)continue;if(!generalSide)generalSide=x-rect.left;var dy=(rect.top>y?rect.top-y:y-rect.bottom)-1;if(rect.left-1<=x&&rect.right+1>=x&&dy<closestDY){var right=x>=(rect.left+rect.right)/2,after=right;if(browser4.chrome||browser4.gecko){var rectBefore=textRange4(node,_i224).getBoundingClientRect();if(rectBefore.left==rect.right)after=!right;}if(dy<=0)return{node:node,offset:_i224+(after?1:0)};closestOffset=_i224+(after?1:0);closestDY=dy;}}}return{node:node,offset:closestOffset>-1?closestOffset:generalSide>0?node.nodeValue.length:0};}function posAtCoords4(view,_ref49,precise){var x=_ref49.x,y=_ref49.y;var bias=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var _a;var content2=view.contentDOM.getBoundingClientRect(),docTop=content2.top+view.viewState.paddingTop;var block,docHeight=view.viewState.docHeight;var yOffset=y-docTop;if(yOffset<0)return 0;if(yOffset>docHeight)return view.state.doc.length;for(var halfLine=view.defaultLineHeight/2,bounced=false;;){block=view.elementAtHeight(yOffset);if(block.type==BlockType4.Text)break;for(;;){yOffset=bias>0?block.bottom+halfLine:block.top-halfLine;if(yOffset>=0&&yOffset<=docHeight)break;if(bounced)return precise?null:0;bounced=true;bias=-bias;}}y=docTop+yOffset;var lineStart=block.from;if(lineStart<view.viewport.from)return view.viewport.from==0?0:precise?null:posAtCoordsImprecise4(view,content2,block,x,y);if(lineStart>view.viewport.to)return view.viewport.to==view.state.doc.length?view.state.doc.length:precise?null:posAtCoordsImprecise4(view,content2,block,x,y);var doc6=view.dom.ownerDocument;var root=view.root.elementFromPoint?view.root:doc6;var element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null;if(!element){x=Math.max(content2.left+1,Math.min(content2.right-1,x));element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null;}var node,offset=-1;if(element&&((_a=view.docView.nearest(element))===null||_a===void 0?void 0:_a.isEditable)!=false){if(doc6.caretPositionFromPoint){var pos=doc6.caretPositionFromPoint(x,y);if(pos){node=pos.offsetNode;offset=pos.offset;}}else if(doc6.caretRangeFromPoint){var range=doc6.caretRangeFromPoint(x,y);if(range){node=range.startContainer;offset=range.startOffset;if(browser4.safari&&isSuspiciousCaretResult4(node,offset,x))node=void 0;}}}if(!node||!view.docView.dom.contains(node)){var line=LineView4.find(view.docView,lineStart);if(!line)return yOffset>block.top+block.height/2?block.to:block.from;var _domPosAtCoords4=domPosAtCoords4(line.dom,x,y);node=_domPosAtCoords4.node;offset=_domPosAtCoords4.offset;}return view.docView.posFromDOM(node,offset);}function posAtCoordsImprecise4(view,contentRect,block,x,y){var into=Math.round((x-contentRect.left)*view.defaultCharacterWidth);if(view.lineWrapping&&block.height>view.defaultLineHeight*1.5){var line=Math.floor((y-block.top)/view.defaultLineHeight);into+=line*view.viewState.heightOracle.lineLength;}var content2=view.state.sliceDoc(block.from,block.to);return block.from+findColumn(content2,into,view.state.tabSize);}function isSuspiciousCaretResult4(node,offset,x){var len;if(node.nodeType!=3||offset!=(len=node.nodeValue.length))return false;for(var next=node.nextSibling;next;next=next.nextSibling){if(next.nodeType!=1||next.nodeName!="BR")return false;}return textRange4(node,len-1,len).getBoundingClientRect().left>x;}function moveToLineBoundary4(view,start,forward,includeWrap){var line=view.state.doc.lineAt(start.head);var coords=!includeWrap||!view.lineWrapping?null:view.coordsAtPos(start.assoc<0&&start.head>line.from?start.head-1:start.head);if(coords){var editorRect=view.dom.getBoundingClientRect();var pos=view.posAtCoords({x:forward==(view.textDirection==Direction4.LTR)?editorRect.right-1:editorRect.left+1,y:(coords.top+coords.bottom)/2});if(pos!=null)return EditorSelection.cursor(pos,forward?-1:1);}var lineView=LineView4.find(view.docView,start.head);var end=lineView?forward?lineView.posAtEnd:lineView.posAtStart:forward?line.to:line.from;return EditorSelection.cursor(end,forward?-1:1);}function moveByChar4(view,start,forward,by){var line=view.state.doc.lineAt(start.head),spans=view.bidiSpans(line);for(var cur2=start,check=null;;){var next=moveVisually4(line,spans,view.textDirection,cur2,forward),_char5=movedOver4;if(!next){if(line.number==(forward?view.state.doc.lines:1))return cur2;_char5="\n";line=view.state.doc.line(line.number+(forward?1:-1));spans=view.bidiSpans(line);next=EditorSelection.cursor(forward?line.from:line.to);}if(!check){if(!by)return next;check=by(_char5);}else if(!check(_char5)){return cur2;}cur2=next;}}function byGroup4(view,pos,start){var categorize=view.state.charCategorizer(pos);var cat=categorize(start);return function(next){var nextCat=categorize(next);if(cat==CharCategory.Space)cat=nextCat;return cat==nextCat;};}function moveVertically4(view,start,forward,distance){var startPos=start.head,dir=forward?1:-1;if(startPos==(forward?view.state.doc.length:0))return EditorSelection.cursor(startPos,start.assoc);var goal=start.goalColumn,startY;var rect=view.contentDOM.getBoundingClientRect();var startCoords=view.coordsAtPos(startPos),docTop=view.documentTop;if(startCoords){if(goal==null)goal=startCoords.left-rect.left;startY=dir<0?startCoords.top:startCoords.bottom;}else{var line=view.viewState.lineBlockAt(startPos-docTop);if(goal==null)goal=Math.min(rect.right-rect.left,view.defaultCharacterWidth*(startPos-line.from));startY=(dir<0?line.top:line.bottom)+docTop;}var resolvedGoal=rect.left+goal;var dist=distance!==null&&distance!==void 0?distance:view.defaultLineHeight>>1;for(var extra=0;;extra+=10){var curY=startY+(dist+extra)*dir;var pos=posAtCoords4(view,{x:resolvedGoal,y:curY},false,dir);if(curY<rect.top||curY>rect.bottom||(dir<0?pos<startPos:pos>startPos))return EditorSelection.cursor(pos,start.assoc,void 0,goal);}}function skipAtoms4(view,oldPos,pos){var atoms=view.pluginField(PluginField4.atomicRanges);for(;;){var moved=false;var _iterator252=_createForOfIteratorHelper(atoms),_step252;try{for(_iterator252.s();!(_step252=_iterator252.n()).done;){var set=_step252.value;set.between(pos.from-1,pos.from+1,function(from,to,value){if(pos.from>from&&pos.from<to){pos=oldPos.from>pos.from?EditorSelection.cursor(from,1):EditorSelection.cursor(to,-1);moved=true;}});}}catch(err){_iterator252.e(err);}finally{_iterator252.f();}if(!moved)return pos;}}var InputState4=/*#__PURE__*/function(){function InputState4(view){var _this157=this;_classCallCheck(this,InputState4);this.lastKeyCode=0;this.lastKeyTime=0;this.pendingIOSKey=void 0;this.lastSelectionOrigin=null;this.lastSelectionTime=0;this.lastEscPress=0;this.lastContextMenu=0;this.scrollHandlers=[];this.registeredEvents=[];this.customHandlers=[];this.composing=-1;this.compositionFirstChange=null;this.compositionEndedAt=0;this.rapidCompositionStart=false;this.mouseSelection=null;var _loop27=function _loop27(type){var handler=handlers4[type];view.contentDOM.addEventListener(type,function(event){if(type=="keydown"&&_this157.keydown(view,event))return;if(!eventBelongsToEditor4(view,event)||_this157.ignoreDuringComposition(event))return;if(_this157.mustFlushObserver(event))view.observer.forceFlush();if(_this157.runCustomHandlers(type,view,event))event.preventDefault();else handler(view,event);});_this157.registeredEvents.push(type);};for(var type in handlers4){_loop27(type);}this.notifiedFocused=view.hasFocus;this.ensureHandlers(view);if(browser4.safari)view.contentDOM.addEventListener("input",function(){return null;});}_createClass(InputState4,[{key:"setSelectionOrigin",value:function setSelectionOrigin(origin){this.lastSelectionOrigin=origin;this.lastSelectionTime=Date.now();}},{key:"ensureHandlers",value:function ensureHandlers(view){var _this158=this;var handlers6=this.customHandlers=view.pluginField(domEventHandlers4);var _iterator253=_createForOfIteratorHelper(handlers6),_step253;try{for(_iterator253.s();!(_step253=_iterator253.n()).done;){var set=_step253.value;var _loop28=function _loop28(type){if(_this158.registeredEvents.indexOf(type)<0&&type!="scroll"){_this158.registeredEvents.push(type);view.contentDOM.addEventListener(type,function(event){if(!eventBelongsToEditor4(view,event))return;if(_this158.runCustomHandlers(type,view,event))event.preventDefault();});}};for(var type in set.handlers){_loop28(type);}}}catch(err){_iterator253.e(err);}finally{_iterator253.f();}}},{key:"runCustomHandlers",value:function runCustomHandlers(type,view,event){var _iterator254=_createForOfIteratorHelper(this.customHandlers),_step254;try{for(_iterator254.s();!(_step254=_iterator254.n()).done;){var set=_step254.value;var handler=set.handlers[type];if(handler){try{if(handler.call(set.plugin,event,view)||event.defaultPrevented)return true;}catch(e){logException4(view.state,e);}}}}catch(err){_iterator254.e(err);}finally{_iterator254.f();}return false;}},{key:"runScrollHandlers",value:function runScrollHandlers(view,event){var _iterator255=_createForOfIteratorHelper(this.customHandlers),_step255;try{for(_iterator255.s();!(_step255=_iterator255.n()).done;){var set=_step255.value;var handler=set.handlers.scroll;if(handler){try{handler.call(set.plugin,event,view);}catch(e){logException4(view.state,e);}}}}catch(err){_iterator255.e(err);}finally{_iterator255.f();}}},{key:"keydown",value:function keydown(view,event){var _this159=this;this.lastKeyCode=event.keyCode;this.lastKeyTime=Date.now();if(this.screenKeyEvent(view,event))return true;if(browser4.android&&browser4.chrome&&!event.synthetic&&(event.keyCode==13||event.keyCode==8)){view.observer.delayAndroidKey(event.key,event.keyCode);return true;}var pending;if(browser4.ios&&(pending=PendingKeys4.find(function(key){return key.keyCode==event.keyCode;}))&&!(event.ctrlKey||event.altKey||event.metaKey)&&!event.synthetic){this.pendingIOSKey=pending;setTimeout(function(){return _this159.flushIOSKey(view);},250);return true;}return false;}},{key:"flushIOSKey",value:function flushIOSKey(view){var key=this.pendingIOSKey;if(!key)return false;this.pendingIOSKey=void 0;return dispatchKey4(view.contentDOM,key.key,key.keyCode);}},{key:"ignoreDuringComposition",value:function ignoreDuringComposition(event){if(!/^key/.test(event.type))return false;if(this.composing>0)return true;if(browser4.safari&&Date.now()-this.compositionEndedAt<500){this.compositionEndedAt=0;return true;}return false;}},{key:"screenKeyEvent",value:function screenKeyEvent(view,event){var protectedTab=event.keyCode==9&&Date.now()<this.lastEscPress+2e3;if(event.keyCode==27)this.lastEscPress=Date.now();else if(modifierCodes4.indexOf(event.keyCode)<0)this.lastEscPress=0;return protectedTab;}},{key:"mustFlushObserver",value:function mustFlushObserver(event){return event.type=="keydown"&&event.keyCode!=229||event.type=="compositionend"&&!browser4.ios;}},{key:"startMouseSelection",value:function startMouseSelection(mouseSelection){if(this.mouseSelection)this.mouseSelection.destroy();this.mouseSelection=mouseSelection;}},{key:"update",value:function update(_update24){if(this.mouseSelection)this.mouseSelection.update(_update24);if(_update24.transactions.length)this.lastKeyCode=this.lastSelectionTime=0;}},{key:"destroy",value:function destroy(){if(this.mouseSelection)this.mouseSelection.destroy();}}]);return InputState4;}();var PendingKeys4=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}];var modifierCodes4=[16,17,18,20,91,92,224,225];var MouseSelection4=/*#__PURE__*/function(){function MouseSelection4(view,startEvent,style,mustSelect){_classCallCheck(this,MouseSelection4);this.view=view;this.style=style;this.mustSelect=mustSelect;this.lastEvent=startEvent;var doc6=view.contentDOM.ownerDocument;doc6.addEventListener("mousemove",this.move=this.move.bind(this));doc6.addEventListener("mouseup",this.up=this.up.bind(this));this.extend=startEvent.shiftKey;this.multiple=view.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange4(view,startEvent);this.dragMove=dragMovesSelection4(view,startEvent);this.dragging=isInPrimarySelection4(view,startEvent)&&getClickType4(startEvent)==1?null:false;if(this.dragging===false){startEvent.preventDefault();this.select(startEvent);}}_createClass(MouseSelection4,[{key:"move",value:function move(event){if(event.buttons==0)return this.destroy();if(this.dragging!==false)return;this.select(this.lastEvent=event);}},{key:"up",value:function up(event){if(this.dragging==null)this.select(this.lastEvent);if(!this.dragging)event.preventDefault();this.destroy();}},{key:"destroy",value:function destroy(){var doc6=this.view.contentDOM.ownerDocument;doc6.removeEventListener("mousemove",this.move);doc6.removeEventListener("mouseup",this.up);this.view.inputState.mouseSelection=null;}},{key:"select",value:function select(event){var selection2=this.style.get(event,this.extend,this.multiple);if(this.mustSelect||!selection2.eq(this.view.state.selection)||selection2.main.assoc!=this.view.state.selection.main.assoc)this.view.dispatch({selection:selection2,userEvent:"select.pointer",scrollIntoView:true});this.mustSelect=false;}},{key:"update",value:function update(_update25){var _this160=this;if(_update25.docChanged&&this.dragging)this.dragging=this.dragging.map(_update25.changes);if(this.style.update(_update25))setTimeout(function(){return _this160.select(_this160.lastEvent);},20);}}]);return MouseSelection4;}();function addsSelectionRange4(view,event){var facet=view.state.facet(clickAddsSelectionRange4);return facet.length?facet[0](event):browser4.mac?event.metaKey:event.ctrlKey;}function dragMovesSelection4(view,event){var facet=view.state.facet(dragMovesSelection$14);return facet.length?facet[0](event):browser4.mac?!event.altKey:!event.ctrlKey;}function isInPrimarySelection4(view,event){var main=view.state.selection.main;if(main.empty)return false;var sel=getSelection4(view.root);if(sel.rangeCount==0)return true;var rects=sel.getRangeAt(0).getClientRects();for(var _i225=0;_i225<rects.length;_i225++){var rect=rects[_i225];if(rect.left<=event.clientX&&rect.right>=event.clientX&&rect.top<=event.clientY&&rect.bottom>=event.clientY)return true;}return false;}function eventBelongsToEditor4(view,event){if(!event.bubbles)return true;if(event.defaultPrevented)return false;for(var node=event.target,cView;node!=view.contentDOM;node=node.parentNode){if(!node||node.nodeType==11||(cView=ContentView4.get(node))&&cView.ignoreEvent(event))return false;}return true;}var handlers4=/* @__PURE__ */Object.create(null);var brokenClipboardAPI4=browser4.ie&&browser4.ie_version<15||browser4.ios&&browser4.webkit_version<604;function capturePaste4(view){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.focus();setTimeout(function(){view.focus();target.remove();doPaste4(view,target.value);},50);}function doPaste4(view,input){var state=view.state,changes,i=1,text=state.toText(input);var byLine=text.lines==state.selection.ranges.length;var linewise=lastLinewiseCopy4!=null&&state.selection.ranges.every(function(r){return r.empty;})&&lastLinewiseCopy4==text.toString();if(linewise){var lastLine=-1;changes=state.changeByRange(function(range){var line=state.doc.lineAt(range.from);if(line.from==lastLine)return{range:range};lastLine=line.from;var insert2=state.toText((byLine?text.line(i++).text:input)+state.lineBreak);return{changes:{from:line.from,insert:insert2},range:EditorSelection.cursor(range.from+insert2.length)};});}else if(byLine){changes=state.changeByRange(function(range){var line=text.line(i++);return{changes:{from:range.from,to:range.to,insert:line.text},range:EditorSelection.cursor(range.from+line.length)};});}else{changes=state.replaceSelection(text);}view.dispatch(changes,{userEvent:"input.paste",scrollIntoView:true});}handlers4.keydown=function(view,event){view.inputState.setSelectionOrigin("select");};var lastTouch4=0;handlers4.touchstart=function(view,e){lastTouch4=Date.now();view.inputState.setSelectionOrigin("select.pointer");};handlers4.touchmove=function(view){view.inputState.setSelectionOrigin("select.pointer");};handlers4.mousedown=function(view,event){view.observer.flush();if(lastTouch4>Date.now()-2e3&&getClickType4(event)==1)return;var style=null;var _iterator256=_createForOfIteratorHelper(view.state.facet(mouseSelectionStyle4)),_step256;try{for(_iterator256.s();!(_step256=_iterator256.n()).done;){var makeStyle=_step256.value;style=makeStyle(view,event);if(style)break;}}catch(err){_iterator256.e(err);}finally{_iterator256.f();}if(!style&&event.button==0)style=basicMouseSelection4(view,event);if(style){var mustFocus=view.root.activeElement!=view.contentDOM;if(mustFocus)view.observer.ignore(function(){return focusPreventScroll4(view.contentDOM);});view.inputState.startMouseSelection(new MouseSelection4(view,event,style,mustFocus));}};function rangeForClick4(view,pos,bias,type){if(type==1){return EditorSelection.cursor(pos,bias);}else if(type==2){return groupAt4(view.state,pos,bias);}else{var visual=LineView4.find(view.docView,pos),line=view.state.doc.lineAt(visual?visual.posAtEnd:pos);var from=visual?visual.posAtStart:line.from,to=visual?visual.posAtEnd:line.to;if(to<view.state.doc.length&&to==line.to)to++;return EditorSelection.range(from,to);}}var insideY4=function insideY4(y,rect){return y>=rect.top&&y<=rect.bottom;};var inside4=function inside4(x,y,rect){return insideY4(y,rect)&&x>=rect.left&&x<=rect.right;};function findPositionSide4(view,pos,x,y){var line=LineView4.find(view.docView,pos);if(!line)return 1;var off=pos-line.posAtStart;if(off==0)return 1;if(off==line.length)return-1;var before=line.coordsAt(off,-1);if(before&&inside4(x,y,before))return-1;var after=line.coordsAt(off,1);if(after&&inside4(x,y,after))return 1;return before&&insideY4(y,before)?-1:1;}function queryPos4(view,event){var pos=view.posAtCoords({x:event.clientX,y:event.clientY},false);return{pos:pos,bias:findPositionSide4(view,pos,event.clientX,event.clientY)};}var BadMouseDetail4=browser4.ie&&browser4.ie_version<=11;var lastMouseDown4=null;var lastMouseDownCount4=0;var lastMouseDownTime4=0;function getClickType4(event){if(!BadMouseDetail4)return event.detail;var last=lastMouseDown4,lastTime=lastMouseDownTime4;lastMouseDown4=event;lastMouseDownTime4=Date.now();return lastMouseDownCount4=!last||lastTime>Date.now()-400&&Math.abs(last.clientX-event.clientX)<2&&Math.abs(last.clientY-event.clientY)<2?(lastMouseDownCount4+1)%3:1;}function basicMouseSelection4(view,event){var start=queryPos4(view,event),type=getClickType4(event);var startSel=view.state.selection;var last=start,lastEvent=event;return{update:function update(_update26){if(_update26.docChanged){if(start)start.pos=_update26.changes.mapPos(start.pos);startSel=startSel.map(_update26.changes);lastEvent=null;}},get:function get(event2,extend2,multiple){var cur2;if(lastEvent&&event2.clientX==lastEvent.clientX&&event2.clientY==lastEvent.clientY)cur2=last;else{cur2=last=queryPos4(view,event2);lastEvent=event2;}if(!cur2||!start)return startSel;var range=rangeForClick4(view,cur2.pos,cur2.bias,type);if(start.pos!=cur2.pos&&!extend2){var startRange=rangeForClick4(view,start.pos,start.bias,type);var from=Math.min(startRange.from,range.from),to=Math.max(startRange.to,range.to);range=from<range.from?EditorSelection.range(from,to):EditorSelection.range(to,from);}if(extend2)return startSel.replaceRange(startSel.main.extend(range.from,range.to));else if(multiple)return startSel.addRange(range);else return EditorSelection.create([range]);}};}handlers4.dragstart=function(view,event){var main=view.state.selection.main;var mouseSelection=view.inputState.mouseSelection;if(mouseSelection)mouseSelection.dragging=main;if(event.dataTransfer){event.dataTransfer.setData("Text",view.state.sliceDoc(main.from,main.to));event.dataTransfer.effectAllowed="copyMove";}};function dropText4(view,event,text,direct){if(!text)return;var dropPos=view.posAtCoords({x:event.clientX,y:event.clientY},false);event.preventDefault();var mouseSelection=view.inputState.mouseSelection;var del=direct&&mouseSelection&&mouseSelection.dragging&&mouseSelection.dragMove?{from:mouseSelection.dragging.from,to:mouseSelection.dragging.to}:null;var ins={from:dropPos,insert:text};var changes=view.state.changes(del?[del,ins]:ins);view.focus();view.dispatch({changes:changes,selection:{anchor:changes.mapPos(dropPos,-1),head:changes.mapPos(dropPos,1)},userEvent:del?"move.drop":"input.drop"});}handlers4.drop=function(view,event){if(!event.dataTransfer)return;if(view.state.readOnly)return event.preventDefault();var files=event.dataTransfer.files;if(files&&files.length){(function(){event.preventDefault();var text=Array(files.length),read=0;var finishFile=function finishFile(){if(++read==files.length)dropText4(view,event,text.filter(function(s){return s!=null;}).join(view.state.lineBreak),false);};var _loop29=function _loop29(_i226){var reader=new FileReader();reader.onerror=finishFile;reader.onload=function(){if(!/[\x00-\x08\x0e-\x1f]{2}/.test(reader.result))text[_i226]=reader.result;finishFile();};reader.readAsText(files[_i226]);};for(var _i226=0;_i226<files.length;_i226++){_loop29(_i226);}})();}else{dropText4(view,event,event.dataTransfer.getData("Text"),true);}};handlers4.paste=function(view,event){if(view.state.readOnly)return event.preventDefault();view.observer.flush();var data=brokenClipboardAPI4?null:event.clipboardData;if(data){doPaste4(view,data.getData("text/plain"));event.preventDefault();}else{capturePaste4(view);}};function captureCopy4(view,text){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.value=text;target.focus();target.selectionEnd=text.length;target.selectionStart=0;setTimeout(function(){target.remove();view.focus();},50);}function copiedRange4(state){var content2=[],ranges=[],linewise=false;var _iterator257=_createForOfIteratorHelper(state.selection.ranges),_step257;try{for(_iterator257.s();!(_step257=_iterator257.n()).done;){var range=_step257.value;if(!range.empty){content2.push(state.sliceDoc(range.from,range.to));ranges.push(range);}}}catch(err){_iterator257.e(err);}finally{_iterator257.f();}if(!content2.length){var upto=-1;var _iterator258=_createForOfIteratorHelper(state.selection.ranges),_step258;try{for(_iterator258.s();!(_step258=_iterator258.n()).done;){var from=_step258.value.from;var line=state.doc.lineAt(from);if(line.number>upto){content2.push(line.text);ranges.push({from:line.from,to:Math.min(state.doc.length,line.to+1)});}upto=line.number;}}catch(err){_iterator258.e(err);}finally{_iterator258.f();}linewise=true;}return{text:content2.join(state.lineBreak),ranges:ranges,linewise:linewise};}var lastLinewiseCopy4=null;handlers4.copy=handlers4.cut=function(view,event){var _copiedRange4=copiedRange4(view.state),text=_copiedRange4.text,ranges=_copiedRange4.ranges,linewise=_copiedRange4.linewise;if(!text&&!linewise)return;lastLinewiseCopy4=linewise?text:null;var data=brokenClipboardAPI4?null:event.clipboardData;if(data){event.preventDefault();data.clearData();data.setData("text/plain",text);}else{captureCopy4(view,text);}if(event.type=="cut"&&!view.state.readOnly)view.dispatch({changes:ranges,scrollIntoView:true,userEvent:"delete.cut"});};handlers4.focus=handlers4.blur=function(view){setTimeout(function(){if(view.hasFocus!=view.inputState.notifiedFocused)view.update([]);},10);};handlers4.beforeprint=function(view){view.viewState.printing=true;view.requestMeasure();setTimeout(function(){view.viewState.printing=false;view.requestMeasure();},2e3);};function forceClearComposition4(view,rapid){if(view.docView.compositionDeco.size){view.inputState.rapidCompositionStart=rapid;try{view.update([]);}finally{view.inputState.rapidCompositionStart=false;}}}handlers4.compositionstart=handlers4.compositionupdate=function(view){if(view.inputState.compositionFirstChange==null)view.inputState.compositionFirstChange=true;if(view.inputState.composing<0){view.inputState.composing=0;if(view.docView.compositionDeco.size){view.observer.flush();forceClearComposition4(view,true);}}};handlers4.compositionend=function(view){view.inputState.composing=-1;view.inputState.compositionEndedAt=Date.now();view.inputState.compositionFirstChange=null;setTimeout(function(){if(view.inputState.composing<0)forceClearComposition4(view,false);},50);};handlers4.contextmenu=function(view){view.inputState.lastContextMenu=Date.now();};handlers4.beforeinput=function(view,event){var _a;var pending;if(browser4.chrome&&browser4.android&&(pending=PendingKeys4.find(function(key){return key.inputType==event.inputType;}))){view.observer.delayAndroidKey(pending.key,pending.keyCode);if(pending.key=="Backspace"||pending.key=="Delete"){var startViewHeight=((_a=window.visualViewport)===null||_a===void 0?void 0:_a.height)||0;setTimeout(function(){var _a2;if((((_a2=window.visualViewport)===null||_a2===void 0?void 0:_a2.height)||0)>startViewHeight+10&&view.hasFocus){view.contentDOM.blur();view.focus();}},100);}}};var wrappingWhiteSpace4=["pre-wrap","normal","pre-line","break-spaces"];var HeightOracle4=/*#__PURE__*/function(){function HeightOracle4(){_classCallCheck(this,HeightOracle4);this.doc=Text.empty;this.lineWrapping=false;this.direction=Direction4.LTR;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.lineLength=30;this.heightChanged=false;}_createClass(HeightOracle4,[{key:"heightForGap",value:function heightForGap(from,to){var lines=this.doc.lineAt(to).number-this.doc.lineAt(from).number+1;if(this.lineWrapping)lines+=Math.ceil((to-from-lines*this.lineLength*0.5)/this.lineLength);return this.lineHeight*lines;}},{key:"heightForLine",value:function heightForLine(length){if(!this.lineWrapping)return this.lineHeight;var lines=1+Math.max(0,Math.ceil((length-this.lineLength)/(this.lineLength-5)));return lines*this.lineHeight;}},{key:"setDoc",value:function setDoc(doc6){this.doc=doc6;return this;}},{key:"mustRefreshForStyle",value:function mustRefreshForStyle(whiteSpace,direction){return wrappingWhiteSpace4.indexOf(whiteSpace)>-1!=this.lineWrapping||this.direction!=direction;}},{key:"mustRefreshForHeights",value:function mustRefreshForHeights(lineHeights){var newHeight=false;for(var _i227=0;_i227<lineHeights.length;_i227++){var h=lineHeights[_i227];if(h<0){_i227++;}else if(!this.heightSamples[Math.floor(h*10)]){newHeight=true;this.heightSamples[Math.floor(h*10)]=true;}}return newHeight;}},{key:"refresh",value:function refresh(whiteSpace,direction,lineHeight,charWidth,lineLength,knownHeights){var lineWrapping=wrappingWhiteSpace4.indexOf(whiteSpace)>-1;var changed=Math.round(lineHeight)!=Math.round(this.lineHeight)||this.lineWrapping!=lineWrapping||this.direction!=direction;this.lineWrapping=lineWrapping;this.direction=direction;this.lineHeight=lineHeight;this.charWidth=charWidth;this.lineLength=lineLength;if(changed){this.heightSamples={};for(var _i228=0;_i228<knownHeights.length;_i228++){var h=knownHeights[_i228];if(h<0)_i228++;else this.heightSamples[Math.floor(h*10)]=true;}}return changed;}}]);return HeightOracle4;}();var MeasuredHeights4=/*#__PURE__*/function(){function MeasuredHeights4(from,heights){_classCallCheck(this,MeasuredHeights4);this.from=from;this.heights=heights;this.index=0;}_createClass(MeasuredHeights4,[{key:"more",get:function get(){return this.index<this.heights.length;}}]);return MeasuredHeights4;}();var BlockInfo4=/*#__PURE__*/function(){function BlockInfo4(from,length,top2,height,type){_classCallCheck(this,BlockInfo4);this.from=from;this.length=length;this.top=top2;this.height=height;this.type=type;}_createClass(BlockInfo4,[{key:"to",get:function get(){return this.from+this.length;}},{key:"bottom",get:function get(){return this.top+this.height;}},{key:"join",value:function join(other){var detail=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(other.type)?other.type:[other]);return new BlockInfo4(this.from,this.length+other.length,this.top,this.height+other.height,detail);}},{key:"moveY",value:function moveY(offset){return!offset?this:new BlockInfo4(this.from,this.length,this.top+offset,this.height,Array.isArray(this.type)?this.type.map(function(b){return b.moveY(offset);}):this.type);}}]);return BlockInfo4;}();var QueryType4=/* @__PURE__ */function(QueryType7){QueryType7[QueryType7["ByPos"]=0]="ByPos";QueryType7[QueryType7["ByHeight"]=1]="ByHeight";QueryType7[QueryType7["ByPosNoHeight"]=2]="ByPosNoHeight";return QueryType7;}(QueryType4||(QueryType4={}));var Epsilon4=1e-3;var HeightMap4=/*#__PURE__*/function(){function HeightMap4(length,height){var flags=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;_classCallCheck(this,HeightMap4);this.length=length;this.height=height;this.flags=flags;}_createClass(HeightMap4,[{key:"outdated",get:function get(){return(this.flags&2)>0;},set:function set(value){this.flags=(value?2:0)|this.flags&~2;}},{key:"setHeight",value:function setHeight(oracle,height){if(this.height!=height){if(Math.abs(this.height-height)>Epsilon4)oracle.heightChanged=true;this.height=height;}}},{key:"replace",value:function replace(_from,_to,nodes){return HeightMap4.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(_to,result){result.push(this);}},{key:"decomposeRight",value:function decomposeRight(_from,result){result.push(this);}},{key:"applyChanges",value:function applyChanges(decorations6,oldDoc,oracle,changes){var me=this;for(var _i229=changes.length-1;_i229>=0;_i229--){var _changes$_i4=changes[_i229],fromA=_changes$_i4.fromA,toA=_changes$_i4.toA,fromB=_changes$_i4.fromB,toB=_changes$_i4.toB;var start=me.lineAt(fromA,QueryType4.ByPosNoHeight,oldDoc,0,0);var end=start.to>=toA?start:me.lineAt(toA,QueryType4.ByPosNoHeight,oldDoc,0,0);toB+=end.to-toA;toA=end.to;while(_i229>0&&start.from<=changes[_i229-1].toA){fromA=changes[_i229-1].fromA;fromB=changes[_i229-1].fromB;_i229--;if(fromA<start.from)start=me.lineAt(fromA,QueryType4.ByPosNoHeight,oldDoc,0,0);}fromB+=start.from-fromA;fromA=start.from;var nodes=NodeBuilder4.build(oracle,decorations6,fromB,toB);me=me.replace(fromA,toA,nodes);}return me.updateHeight(oracle,0);}}],[{key:"empty",value:function empty(){return new HeightMapText4(0,0);}},{key:"of",value:function of(nodes){if(nodes.length==1)return nodes[0];var i=0,j=nodes.length,before=0,after=0;for(;;){if(i==j){if(before>after*2){var split=nodes[i-1];if(split["break"])nodes.splice(--i,1,split.left,null,split.right);else nodes.splice(--i,1,split.left,split.right);j+=1+split["break"];before-=split.size;}else if(after>before*2){var _split4=nodes[j];if(_split4["break"])nodes.splice(j,1,_split4.left,null,_split4.right);else nodes.splice(j,1,_split4.left,_split4.right);j+=2+_split4["break"];after-=_split4.size;}else{break;}}else if(before<after){var next=nodes[i++];if(next)before+=next.size;}else{var _next5=nodes[--j];if(_next5)after+=_next5.size;}}var brk=0;if(nodes[i-1]==null){brk=1;i--;}else if(nodes[i]==null){brk=1;j++;}return new HeightMapBranch4(HeightMap4.of(nodes.slice(0,i)),brk,HeightMap4.of(nodes.slice(j)));}}]);return HeightMap4;}();HeightMap4.prototype.size=1;var HeightMapBlock4=/*#__PURE__*/function(_HeightMap10){_inherits(HeightMapBlock4,_HeightMap10);var _super89=_createSuper(HeightMapBlock4);function HeightMapBlock4(length,height,type){var _this161;_classCallCheck(this,HeightMapBlock4);_this161=_super89.call(this,length,height);_this161.type=type;return _this161;}_createClass(HeightMapBlock4,[{key:"blockAt",value:function blockAt(_height,_doc,top2,offset){return new BlockInfo4(offset,this.length,top2,this.height,this.type);}},{key:"lineAt",value:function lineAt(_value,_type,doc6,top2,offset){return this.blockAt(0,doc6,top2,offset);}},{key:"forEachLine",value:function forEachLine(_from,_to,doc6,top2,offset,f){f(this.blockAt(0,doc6,top2,offset));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var _force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);this.outdated=false;return this;}},{key:"toString",value:function toString(){return"block(".concat(this.length,")");}}]);return HeightMapBlock4;}(HeightMap4);var HeightMapText4=/*#__PURE__*/function(_HeightMapBlock4){_inherits(HeightMapText4,_HeightMapBlock4);var _super90=_createSuper(HeightMapText4);function HeightMapText4(length,height){var _this162;_classCallCheck(this,HeightMapText4);_this162=_super90.call(this,length,height,BlockType4.Text);_this162.collapsed=0;_this162.widgetHeight=0;return _this162;}_createClass(HeightMapText4,[{key:"replace",value:function replace(_from,_to,nodes){var node=nodes[0];if(nodes.length==1&&(node instanceof HeightMapText4||node instanceof HeightMapGap4&&node.flags&4)&&Math.abs(this.length-node.length)<10){if(node instanceof HeightMapGap4)node=new HeightMapText4(node.length,this.height);else node.height=this.height;if(!this.outdated)node.outdated=false;return node;}else{return HeightMap4.of(nodes);}}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);else if(force||this.outdated)this.setHeight(oracle,Math.max(this.widgetHeight,oracle.heightForLine(this.length-this.collapsed)));this.outdated=false;return this;}},{key:"toString",value:function toString(){return"line(".concat(this.length).concat(this.collapsed?-this.collapsed:"").concat(this.widgetHeight?":"+this.widgetHeight:"",")");}}]);return HeightMapText4;}(HeightMapBlock4);var HeightMapGap4=/*#__PURE__*/function(_HeightMap11){_inherits(HeightMapGap4,_HeightMap11);var _super91=_createSuper(HeightMapGap4);function HeightMapGap4(length){_classCallCheck(this,HeightMapGap4);return _super91.call(this,length,0);}_createClass(HeightMapGap4,[{key:"lines",value:function lines(doc6,offset){var firstLine=doc6.lineAt(offset).number,lastLine=doc6.lineAt(offset+this.length).number;return{firstLine:firstLine,lastLine:lastLine,lineHeight:this.height/(lastLine-firstLine+1)};}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var _this$lines10=this.lines(doc6,offset),firstLine=_this$lines10.firstLine,lastLine=_this$lines10.lastLine,lineHeight=_this$lines10.lineHeight;var line=Math.max(0,Math.min(lastLine-firstLine,Math.floor((height-top2)/lineHeight)));var _doc6$line4=doc6.line(firstLine+line),from=_doc6$line4.from,length=_doc6$line4.length;return new BlockInfo4(from,length,top2+lineHeight*line,lineHeight,BlockType4.Text);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){if(type==QueryType4.ByHeight)return this.blockAt(value,doc6,top2,offset);if(type==QueryType4.ByPosNoHeight){var _doc6$lineAt7=doc6.lineAt(value),from2=_doc6$lineAt7.from,to=_doc6$lineAt7.to;return new BlockInfo4(from2,to-from2,0,0,BlockType4.Text);}var _this$lines11=this.lines(doc6,offset),firstLine=_this$lines11.firstLine,lineHeight=_this$lines11.lineHeight;var _doc6$lineAt8=doc6.lineAt(value),from=_doc6$lineAt8.from,length=_doc6$lineAt8.length,number2=_doc6$lineAt8.number;return new BlockInfo4(from,length,top2+lineHeight*(number2-firstLine),lineHeight,BlockType4.Text);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var _this$lines12=this.lines(doc6,offset),firstLine=_this$lines12.firstLine,lineHeight=_this$lines12.lineHeight;for(var pos=Math.max(from,offset),end=Math.min(offset+this.length,to);pos<=end;){var line=doc6.lineAt(pos);if(pos==from)top2+=lineHeight*(line.number-firstLine);f(new BlockInfo4(line.from,line.length,top2,lineHeight,BlockType4.Text));top2+=lineHeight;pos=line.to+1;}}},{key:"replace",value:function replace(from,to,nodes){var after=this.length-to;if(after>0){var last=nodes[nodes.length-1];if(last instanceof HeightMapGap4)nodes[nodes.length-1]=new HeightMapGap4(last.length+after);else nodes.push(null,new HeightMapGap4(after-1));}if(from>0){var first=nodes[0];if(first instanceof HeightMapGap4)nodes[0]=new HeightMapGap4(from+first.length);else nodes.unshift(new HeightMapGap4(from-1),null);}return HeightMap4.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){result.push(new HeightMapGap4(to-1),null);}},{key:"decomposeRight",value:function decomposeRight(from,result){result.push(null,new HeightMapGap4(this.length-from-1));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var end=offset+this.length;if(measured&&measured.from<=offset+this.length&&measured.more){var nodes=[],pos=Math.max(offset,measured.from),singleHeight=-1;var wasChanged=oracle.heightChanged;if(measured.from>offset)nodes.push(new HeightMapGap4(measured.from-offset-1).updateHeight(oracle,offset));while(pos<=end&&measured.more){var len=oracle.doc.lineAt(pos).length;if(nodes.length)nodes.push(null);var height=measured.heights[measured.index++];if(singleHeight==-1)singleHeight=height;else if(Math.abs(height-singleHeight)>=Epsilon4)singleHeight=-2;var line=new HeightMapText4(len,height);line.outdated=false;nodes.push(line);pos+=len+1;}if(pos<=end)nodes.push(null,new HeightMapGap4(end-pos).updateHeight(oracle,pos));var result=HeightMap4.of(nodes);oracle.heightChanged=wasChanged||singleHeight<0||Math.abs(result.height-this.height)>=Epsilon4||Math.abs(singleHeight-this.lines(oracle.doc,offset).lineHeight)>=Epsilon4;return result;}else if(force||this.outdated){this.setHeight(oracle,oracle.heightForGap(offset,offset+this.length));this.outdated=false;}return this;}},{key:"toString",value:function toString(){return"gap(".concat(this.length,")");}}]);return HeightMapGap4;}(HeightMap4);var HeightMapBranch4=/*#__PURE__*/function(_HeightMap12){_inherits(HeightMapBranch4,_HeightMap12);var _super92=_createSuper(HeightMapBranch4);function HeightMapBranch4(left,brk,right){var _this163;_classCallCheck(this,HeightMapBranch4);_this163=_super92.call(this,left.length+brk+right.length,left.height+right.height,brk|(left.outdated||right.outdated?2:0));_this163.left=left;_this163.right=right;_this163.size=left.size+right.size;return _this163;}_createClass(HeightMapBranch4,[{key:"break",get:function get(){return this.flags&1;}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var mid=top2+this.left.height;return height<mid?this.left.blockAt(height,doc6,top2,offset):this.right.blockAt(height,doc6,mid,offset+this.left.length+this["break"]);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];var left=type==QueryType4.ByHeight?value<rightTop:value<rightOffset;var base2=left?this.left.lineAt(value,type,doc6,top2,offset):this.right.lineAt(value,type,doc6,rightTop,rightOffset);if(this["break"]||(left?base2.to<rightOffset:base2.from>rightOffset))return base2;var subQuery=type==QueryType4.ByPosNoHeight?QueryType4.ByPosNoHeight:QueryType4.ByPos;if(left)return base2.join(this.right.lineAt(rightOffset,subQuery,doc6,rightTop,rightOffset));else return this.left.lineAt(rightOffset,subQuery,doc6,top2,offset).join(base2);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];if(this["break"]){if(from<rightOffset)this.left.forEachLine(from,to,doc6,top2,offset,f);if(to>=rightOffset)this.right.forEachLine(from,to,doc6,rightTop,rightOffset,f);}else{var mid=this.lineAt(rightOffset,QueryType4.ByPos,doc6,top2,offset);if(from<mid.from)this.left.forEachLine(from,mid.from-1,doc6,top2,offset,f);if(mid.to>=from&&mid.from<=to)f(mid);if(to>mid.to)this.right.forEachLine(mid.to+1,to,doc6,rightTop,rightOffset,f);}}},{key:"replace",value:function replace(from,to,nodes){var rightStart=this.left.length+this["break"];if(to<rightStart)return this.balanced(this.left.replace(from,to,nodes),this.right);if(from>this.left.length)return this.balanced(this.left,this.right.replace(from-rightStart,to-rightStart,nodes));var result=[];if(from>0)this.decomposeLeft(from,result);var left=result.length;var _iterator259=_createForOfIteratorHelper(nodes),_step259;try{for(_iterator259.s();!(_step259=_iterator259.n()).done;){var node=_step259.value;result.push(node);}}catch(err){_iterator259.e(err);}finally{_iterator259.f();}if(from>0)mergeGaps4(result,left-1);if(to<this.length){var right=result.length;this.decomposeRight(to,result);mergeGaps4(result,right);}return HeightMap4.of(result);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){var left=this.left.length;if(to<=left)return this.left.decomposeLeft(to,result);result.push(this.left);if(this["break"]){left++;if(to>=left)result.push(null);}if(to>left)this.right.decomposeLeft(to-left,result);}},{key:"decomposeRight",value:function decomposeRight(from,result){var left=this.left.length,right=left+this["break"];if(from>=right)return this.right.decomposeRight(from-right,result);if(from<left)this.left.decomposeRight(from,result);if(this["break"]&&from<right)result.push(null);result.push(this.right);}},{key:"balanced",value:function balanced(left,right){if(left.size>2*right.size||right.size>2*left.size)return HeightMap4.of(this["break"]?[left,null,right]:[left,right]);this.left=left;this.right=right;this.height=left.height+right.height;this.outdated=left.outdated||right.outdated;this.size=left.size+right.size;this.length=left.length+this["break"]+right.length;return this;}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var left=this.left,right=this.right,rightStart=offset+left.length+this["break"],rebalance=null;if(measured&&measured.from<=offset+left.length&&measured.more)rebalance=left=left.updateHeight(oracle,offset,force,measured);else left.updateHeight(oracle,offset,force);if(measured&&measured.from<=rightStart+right.length&&measured.more)rebalance=right=right.updateHeight(oracle,rightStart,force,measured);else right.updateHeight(oracle,rightStart,force);if(rebalance)return this.balanced(left,right);this.height=this.left.height+this.right.height;this.outdated=false;return this;}},{key:"toString",value:function toString(){return this.left+(this["break"]?" ":"-")+this.right;}}]);return HeightMapBranch4;}(HeightMap4);function mergeGaps4(nodes,around){var before,after;if(nodes[around]==null&&(before=nodes[around-1])instanceof HeightMapGap4&&(after=nodes[around+1])instanceof HeightMapGap4)nodes.splice(around-1,3,new HeightMapGap4(before.length+1+after.length));}var relevantWidgetHeight4=5;var NodeBuilder4=/*#__PURE__*/function(){function NodeBuilder4(pos,oracle){_classCallCheck(this,NodeBuilder4);this.pos=pos;this.oracle=oracle;this.nodes=[];this.lineStart=-1;this.lineEnd=-1;this.covering=null;this.writtenTo=pos;}_createClass(NodeBuilder4,[{key:"isCovered",get:function get(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering;}},{key:"span",value:function span(_from,to){if(this.lineStart>-1){var end=Math.min(to,this.lineEnd),last=this.nodes[this.nodes.length-1];if(last instanceof HeightMapText4)last.length+=end-this.pos;else if(end>this.pos||!this.isCovered)this.nodes.push(new HeightMapText4(end-this.pos,-1));this.writtenTo=end;if(to>end){this.nodes.push(null);this.writtenTo++;this.lineStart=-1;}}this.pos=to;}},{key:"point",value:function point(from,to,deco){if(from<to||deco.heightRelevant){var height=deco.widget?deco.widget.estimatedHeight:0;if(height<0)height=this.oracle.lineHeight;var len=to-from;if(deco.block){this.addBlock(new HeightMapBlock4(len,height,deco.type));}else if(len||height>=relevantWidgetHeight4){this.addLineDeco(height,len);}}else if(to>from){this.span(from,to);}if(this.lineEnd>-1&&this.lineEnd<this.pos)this.lineEnd=this.oracle.doc.lineAt(this.pos).to;}},{key:"enterLine",value:function enterLine(){if(this.lineStart>-1)return;var _this$oracle$doc$line4=this.oracle.doc.lineAt(this.pos),from=_this$oracle$doc$line4.from,to=_this$oracle$doc$line4.to;this.lineStart=from;this.lineEnd=to;if(this.writtenTo<from){if(this.writtenTo<from-1||this.nodes[this.nodes.length-1]==null)this.nodes.push(this.blankContent(this.writtenTo,from-1));this.nodes.push(null);}if(this.pos>from)this.nodes.push(new HeightMapText4(this.pos-from,-1));this.writtenTo=this.pos;}},{key:"blankContent",value:function blankContent(from,to){var gap=new HeightMapGap4(to-from);if(this.oracle.doc.lineAt(from).to==to)gap.flags|=4;return gap;}},{key:"ensureLine",value:function ensureLine(){this.enterLine();var last=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(last instanceof HeightMapText4)return last;var line=new HeightMapText4(0,-1);this.nodes.push(line);return line;}},{key:"addBlock",value:function addBlock(block){this.enterLine();if(block.type==BlockType4.WidgetAfter&&!this.isCovered)this.ensureLine();this.nodes.push(block);this.writtenTo=this.pos=this.pos+block.length;if(block.type!=BlockType4.WidgetBefore)this.covering=block;}},{key:"addLineDeco",value:function addLineDeco(height,length){var line=this.ensureLine();line.length+=length;line.collapsed+=length;line.widgetHeight=Math.max(line.widgetHeight,height);this.writtenTo=this.pos=this.pos+length;}},{key:"finish",value:function finish(from){var last=this.nodes.length==0?null:this.nodes[this.nodes.length-1];if(this.lineStart>-1&&!(last instanceof HeightMapText4)&&!this.isCovered)this.nodes.push(new HeightMapText4(0,-1));else if(this.writtenTo<this.pos||last==null)this.nodes.push(this.blankContent(this.writtenTo,this.pos));var pos=from;var _iterator260=_createForOfIteratorHelper(this.nodes),_step260;try{for(_iterator260.s();!(_step260=_iterator260.n()).done;){var node=_step260.value;if(node instanceof HeightMapText4)node.updateHeight(this.oracle,pos);pos+=node?node.length:1;}}catch(err){_iterator260.e(err);}finally{_iterator260.f();}return this.nodes;}}],[{key:"build",value:function build(oracle,decorations6,from,to){var builder=new NodeBuilder4(from,oracle);RangeSet.spans(decorations6,from,to,builder,0);return builder.finish(from);}}]);return NodeBuilder4;}();function heightRelevantDecoChanges4(a,b,diff){var comp=new DecorationComparator4();RangeSet.compare(a,b,diff,comp,0);return comp.changes;}var DecorationComparator4=/*#__PURE__*/function(){function DecorationComparator4(){_classCallCheck(this,DecorationComparator4);this.changes=[];}_createClass(DecorationComparator4,[{key:"compareRange",value:function compareRange(){}},{key:"comparePoint",value:function comparePoint(from,to,a,b){if(from<to||a&&a.heightRelevant||b&&b.heightRelevant)addRange4(from,to,this.changes,5);}}]);return DecorationComparator4;}();function visiblePixelRange4(dom,paddingTop){var rect=dom.getBoundingClientRect();var left=Math.max(0,rect.left),right=Math.min(innerWidth,rect.right);var top2=Math.max(0,rect.top),bottom=Math.min(innerHeight,rect.bottom);var body=dom.ownerDocument.body;for(var parent=dom.parentNode;parent&&parent!=body;){if(parent.nodeType==1){var elt=parent;var style=window.getComputedStyle(elt);if((elt.scrollHeight>elt.clientHeight||elt.scrollWidth>elt.clientWidth)&&style.overflow!="visible"){var parentRect=elt.getBoundingClientRect();left=Math.max(left,parentRect.left);right=Math.min(right,parentRect.right);top2=Math.max(top2,parentRect.top);bottom=Math.min(bottom,parentRect.bottom);}parent=style.position=="absolute"||style.position=="fixed"?elt.offsetParent:elt.parentNode;}else if(parent.nodeType==11){parent=parent.host;}else{break;}}return{left:left-rect.left,right:Math.max(left,right)-rect.left,top:top2-(rect.top+paddingTop),bottom:Math.max(top2,bottom)-(rect.top+paddingTop)};}var LineGap4=/*#__PURE__*/function(){function LineGap4(from,to,size){_classCallCheck(this,LineGap4);this.from=from;this.to=to;this.size=size;}_createClass(LineGap4,[{key:"draw",value:function draw(wrapping){return Decoration4.replace({widget:new LineGapWidget4(this.size,wrapping)}).range(this.from,this.to);}}],[{key:"same",value:function same(a,b){if(a.length!=b.length)return false;for(var _i230=0;_i230<a.length;_i230++){var gA=a[_i230],gB=b[_i230];if(gA.from!=gB.from||gA.to!=gB.to||gA.size!=gB.size)return false;}return true;}}]);return LineGap4;}();var LineGapWidget4=/*#__PURE__*/function(_WidgetType19){_inherits(LineGapWidget4,_WidgetType19);var _super93=_createSuper(LineGapWidget4);function LineGapWidget4(size,vertical){var _this164;_classCallCheck(this,LineGapWidget4);_this164=_super93.call(this);_this164.size=size;_this164.vertical=vertical;return _this164;}_createClass(LineGapWidget4,[{key:"eq",value:function eq(other){return other.size==this.size&&other.vertical==this.vertical;}},{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");if(this.vertical){elt.style.height=this.size+"px";}else{elt.style.width=this.size+"px";elt.style.height="2px";elt.style.display="inline-block";}return elt;}},{key:"estimatedHeight",get:function get(){return this.vertical?this.size:-1;}}]);return LineGapWidget4;}(WidgetType4);var ViewState4=/*#__PURE__*/function(){function ViewState4(state){_classCallCheck(this,ViewState4);this.state=state;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=true;this.paddingTop=0;this.paddingBottom=0;this.contentDOMWidth=0;this.contentDOMHeight=0;this.editorHeight=0;this.editorWidth=0;this.heightOracle=new HeightOracle4();this.scaler=IdScaler4;this.scrollTarget=null;this.printing=false;this.mustMeasureContent=true;this.visibleRanges=[];this.mustEnforceCursorAssoc=false;this.heightMap=HeightMap4.empty().applyChanges(state.facet(decorations4),Text.empty,this.heightOracle.setDoc(state.doc),[new ChangedRange4(0,0,0,state.doc.length)]);this.viewport=this.getViewport(0,null);this.updateViewportLines();this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Decoration4.set(this.lineGaps.map(function(gap){return gap.draw(false);}));this.computeVisibleRanges();}_createClass(ViewState4,[{key:"updateForViewport",value:function updateForViewport(){var _this165=this;var viewports=[this.viewport],main=this.state.selection.main;var _loop30=function _loop30(_i231){var pos=_i231?main.head:main.anchor;if(!viewports.some(function(_ref50){var from=_ref50.from,to=_ref50.to;return pos>=from&&pos<=to;})){var _this165$lineBlockAt=_this165.lineBlockAt(pos),from=_this165$lineBlockAt.from,to=_this165$lineBlockAt.to;viewports.push(new Viewport4(from,to));}};for(var _i231=0;_i231<=1;_i231++){_loop30(_i231);}this.viewports=viewports.sort(function(a,b){return a.from-b.from;});this.scaler=this.heightMap.height<=7e6?IdScaler4:new BigScaler4(this.heightOracle.doc,this.heightMap,this.viewports);}},{key:"updateViewportLines",value:function updateViewportLines(){var _this166=this;this.viewportLines=[];this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,function(block){_this166.viewportLines.push(_this166.scaler.scale==1?block:scaleBlock4(block,_this166.scaler));});}},{key:"update",value:function update(_update27){var scrollTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var prev=this.state;this.state=_update27.state;var newDeco=this.state.facet(decorations4);var contentChanges=_update27.changedRanges;var heightChanges=ChangedRange4.extendWithRanges(contentChanges,heightRelevantDecoChanges4(_update27.startState.facet(decorations4),newDeco,_update27?_update27.changes:ChangeSet.empty(this.state.doc.length)));var prevHeight=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(newDeco,prev.doc,this.heightOracle.setDoc(this.state.doc),heightChanges);if(this.heightMap.height!=prevHeight)_update27.flags|=2;var viewport=heightChanges.length?this.mapViewport(this.viewport,_update27.changes):this.viewport;if(scrollTarget&&(scrollTarget.range.head<viewport.from||scrollTarget.range.head>viewport.to)||!this.viewportIsAppropriate(viewport))viewport=this.getViewport(0,scrollTarget);var updateLines=!_update27.changes.empty||_update27.flags&2||viewport.from!=this.viewport.from||viewport.to!=this.viewport.to;this.viewport=viewport;this.updateForViewport();if(updateLines)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,_update27.changes)));_update27.flags|=this.computeVisibleRanges();if(scrollTarget)this.scrollTarget=scrollTarget;if(!this.mustEnforceCursorAssoc&&_update27.selectionSet&&_update27.view.lineWrapping&&_update27.state.selection.main.empty&&_update27.state.selection.main.assoc)this.mustEnforceCursorAssoc=true;}},{key:"measure",value:function measure(view){var dom=view.contentDOM,style=window.getComputedStyle(dom);var oracle=this.heightOracle;var whiteSpace=style.whiteSpace,direction=style.direction=="rtl"?Direction4.RTL:Direction4.LTR;var refresh=this.heightOracle.mustRefreshForStyle(whiteSpace,direction);var measureContent=refresh||this.mustMeasureContent||this.contentDOMHeight!=dom.clientHeight;var result=0,bias=0;if(measureContent){this.mustMeasureContent=false;this.contentDOMHeight=dom.clientHeight;var paddingTop=parseInt(style.paddingTop)||0,paddingBottom=parseInt(style.paddingBottom)||0;if(this.paddingTop!=paddingTop||this.paddingBottom!=paddingBottom){result|=8;this.paddingTop=paddingTop;this.paddingBottom=paddingBottom;}}var pixelViewport=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:visiblePixelRange4(dom,this.paddingTop);var dTop=pixelViewport.top-this.pixelViewport.top,dBottom=pixelViewport.bottom-this.pixelViewport.bottom;this.pixelViewport=pixelViewport;var inView=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(inView!=this.inView){this.inView=inView;if(inView)measureContent=true;}if(!this.inView)return 0;var contentWidth=dom.clientWidth;if(this.contentDOMWidth!=contentWidth||this.editorHeight!=view.scrollDOM.clientHeight||this.editorWidth!=view.scrollDOM.clientWidth){this.contentDOMWidth=contentWidth;this.editorHeight=view.scrollDOM.clientHeight;this.editorWidth=view.scrollDOM.clientWidth;result|=8;}if(measureContent){var lineHeights=view.docView.measureVisibleLineHeights();if(oracle.mustRefreshForHeights(lineHeights))refresh=true;if(refresh||oracle.lineWrapping&&Math.abs(contentWidth-this.contentDOMWidth)>oracle.charWidth){var _view$docView$measure3=view.docView.measureTextSize(),lineHeight=_view$docView$measure3.lineHeight,charWidth=_view$docView$measure3.charWidth;refresh=oracle.refresh(whiteSpace,direction,lineHeight,charWidth,contentWidth/charWidth,lineHeights);if(refresh){view.docView.minWidth=0;result|=8;}}if(dTop>0&&dBottom>0)bias=Math.max(dTop,dBottom);else if(dTop<0&&dBottom<0)bias=Math.min(dTop,dBottom);oracle.heightChanged=false;this.heightMap=this.heightMap.updateHeight(oracle,0,refresh,new MeasuredHeights4(this.viewport.from,lineHeights));if(oracle.heightChanged)result|=2;}var viewportChange=!this.viewportIsAppropriate(this.viewport,bias)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);if(viewportChange)this.viewport=this.getViewport(bias,this.scrollTarget);this.updateForViewport();if(result&2||viewportChange)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(refresh?[]:this.lineGaps));result|=this.computeVisibleRanges();if(this.mustEnforceCursorAssoc){this.mustEnforceCursorAssoc=false;view.docView.enforceCursorAssoc();}return result;}},{key:"visibleTop",get:function get(){return this.scaler.fromDOM(this.pixelViewport.top);}},{key:"visibleBottom",get:function get(){return this.scaler.fromDOM(this.pixelViewport.bottom);}},{key:"getViewport",value:function getViewport(bias,scrollTarget){var marginTop=0.5-Math.max(-0.5,Math.min(0.5,bias/1e3/2));var map=this.heightMap,doc6=this.state.doc,visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;var viewport=new Viewport4(map.lineAt(visibleTop-marginTop*1e3,QueryType4.ByHeight,doc6,0,0).from,map.lineAt(visibleBottom+(1-marginTop)*1e3,QueryType4.ByHeight,doc6,0,0).to);if(scrollTarget){var head=scrollTarget.range.head,viewHeight=this.editorHeight;if(head<viewport.from||head>viewport.to){var block=map.lineAt(head,QueryType4.ByPos,doc6,0,0),topPos;if(scrollTarget.y=="center")topPos=(block.top+block.bottom)/2-viewHeight/2;else if(scrollTarget.y=="start"||scrollTarget.y=="nearest"&&head<viewport.from)topPos=block.top;else topPos=block.bottom-viewHeight;viewport=new Viewport4(map.lineAt(topPos-1e3/2,QueryType4.ByHeight,doc6,0,0).from,map.lineAt(topPos+viewHeight+1e3/2,QueryType4.ByHeight,doc6,0,0).to);}}return viewport;}},{key:"mapViewport",value:function mapViewport(viewport,changes){var from=changes.mapPos(viewport.from,-1),to=changes.mapPos(viewport.to,1);return new Viewport4(this.heightMap.lineAt(from,QueryType4.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(to,QueryType4.ByPos,this.state.doc,0,0).to);}},{key:"viewportIsAppropriate",value:function viewportIsAppropriate(_ref51){var from=_ref51.from,to=_ref51.to;var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(!this.inView)return true;var _this$heightMap$lineA7=this.heightMap.lineAt(from,QueryType4.ByPos,this.state.doc,0,0),top2=_this$heightMap$lineA7.top;var _this$heightMap$lineA8=this.heightMap.lineAt(to,QueryType4.ByPos,this.state.doc,0,0),bottom=_this$heightMap$lineA8.bottom;var visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;return(from==0||top2<=visibleTop-Math.max(10,Math.min(-bias,250)))&&(to==this.state.doc.length||bottom>=visibleBottom+Math.max(10,Math.min(bias,250)))&&top2>visibleTop-2*1e3&&bottom<visibleBottom+2*1e3;}},{key:"mapLineGaps",value:function mapLineGaps(gaps,changes){if(!gaps.length||changes.empty)return gaps;var mapped=[];var _iterator261=_createForOfIteratorHelper(gaps),_step261;try{for(_iterator261.s();!(_step261=_iterator261.n()).done;){var gap=_step261.value;if(!changes.touchesRange(gap.from,gap.to))mapped.push(new LineGap4(changes.mapPos(gap.from),changes.mapPos(gap.to),gap.size));}}catch(err){_iterator261.e(err);}finally{_iterator261.f();}return mapped;}},{key:"ensureLineGaps",value:function ensureLineGaps(current){var _this167=this;var gaps=[];if(this.heightOracle.direction!=Direction4.LTR)return gaps;var _iterator262=_createForOfIteratorHelper(this.viewportLines),_step262;try{var _loop31=function _loop31(){var line=_step262.value;if(line.length<4e3)return"continue";var structure=lineStructure4(line.from,line.to,_this167.state);if(structure.total<4e3)return"continue";var viewFrom=void 0,viewTo=void 0;if(_this167.heightOracle.lineWrapping){var marginHeight=2e3/_this167.heightOracle.lineLength*_this167.heightOracle.lineHeight;viewFrom=findPosition4(structure,(_this167.visibleTop-line.top-marginHeight)/line.height);viewTo=findPosition4(structure,(_this167.visibleBottom-line.top+marginHeight)/line.height);}else{var totalWidth=structure.total*_this167.heightOracle.charWidth;var marginWidth=2e3*_this167.heightOracle.charWidth;viewFrom=findPosition4(structure,(_this167.pixelViewport.left-marginWidth)/totalWidth);viewTo=findPosition4(structure,(_this167.pixelViewport.right+marginWidth)/totalWidth);}var outside=[];if(viewFrom>line.from)outside.push({from:line.from,to:viewFrom});if(viewTo<line.to)outside.push({from:viewTo,to:line.to});var sel=_this167.state.selection.main;if(sel.from>=line.from&&sel.from<=line.to)cutRange4(outside,sel.from-10,sel.from+10);if(!sel.empty&&sel.to>=line.from&&sel.to<=line.to)cutRange4(outside,sel.to-10,sel.to+10);var _loop32=function _loop32(){var _outside4$_i=_outside4[_i232],from=_outside4$_i.from,to=_outside4$_i.to;if(to-from>1e3){gaps.push(find4(current,function(gap){return gap.from>=line.from&&gap.to<=line.to&&Math.abs(gap.from-from)<1e3&&Math.abs(gap.to-to)<1e3;})||new LineGap4(from,to,_this167.gapSize(line,from,to,structure)));}};for(var _i232=0,_outside4=outside;_i232<_outside4.length;_i232++){_loop32();}};for(_iterator262.s();!(_step262=_iterator262.n()).done;){var _ret4=_loop31();if(_ret4==="continue")continue;}}catch(err){_iterator262.e(err);}finally{_iterator262.f();}return gaps;}},{key:"gapSize",value:function gapSize(line,from,to,structure){var fraction=findFraction4(structure,to)-findFraction4(structure,from);if(this.heightOracle.lineWrapping){return line.height*fraction;}else{return structure.total*this.heightOracle.charWidth*fraction;}}},{key:"updateLineGaps",value:function updateLineGaps(gaps){var _this168=this;if(!LineGap4.same(gaps,this.lineGaps)){this.lineGaps=gaps;this.lineGapDeco=Decoration4.set(gaps.map(function(gap){return gap.draw(_this168.heightOracle.lineWrapping);}));}}},{key:"computeVisibleRanges",value:function computeVisibleRanges(){var deco=this.state.facet(decorations4);if(this.lineGaps.length)deco=deco.concat(this.lineGapDeco);var ranges=[];RangeSet.spans(deco,this.viewport.from,this.viewport.to,{span:function span(from,to){ranges.push({from:from,to:to});},point:function point(){}},20);var changed=ranges.length!=this.visibleRanges.length||this.visibleRanges.some(function(r,i){return r.from!=ranges[i].from||r.to!=ranges[i].to;});this.visibleRanges=ranges;return changed?4:0;}},{key:"lineBlockAt",value:function lineBlockAt(pos){return pos>=this.viewport.from&&pos<=this.viewport.to&&this.viewportLines.find(function(b){return b.from<=pos&&b.to>=pos;})||scaleBlock4(this.heightMap.lineAt(pos,QueryType4.ByPos,this.state.doc,0,0),this.scaler);}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){return scaleBlock4(this.heightMap.lineAt(this.scaler.fromDOM(height),QueryType4.ByHeight,this.state.doc,0,0),this.scaler);}},{key:"elementAtHeight",value:function elementAtHeight(height){return scaleBlock4(this.heightMap.blockAt(this.scaler.fromDOM(height),this.state.doc,0,0),this.scaler);}},{key:"docHeight",get:function get(){return this.scaler.toDOM(this.heightMap.height);}},{key:"contentHeight",get:function get(){return this.docHeight+this.paddingTop+this.paddingBottom;}}]);return ViewState4;}();var Viewport4=/*#__PURE__*/_createClass(function Viewport4(from,to){_classCallCheck(this,Viewport4);this.from=from;this.to=to;});function lineStructure4(from,to,state){var ranges=[],pos=from,total=0;RangeSet.spans(state.facet(decorations4),from,to,{span:function span(){},point:function point(from2,to2){if(from2>pos){ranges.push({from:pos,to:from2});total+=from2-pos;}pos=to2;}},20);if(pos<to){ranges.push({from:pos,to:to});total+=to-pos;}return{total:total,ranges:ranges};}function findPosition4(_ref52,ratio){var total=_ref52.total,ranges=_ref52.ranges;if(ratio<=0)return ranges[0].from;if(ratio>=1)return ranges[ranges.length-1].to;var dist=Math.floor(total*ratio);for(var _i233=0;;_i233++){var _ranges$_i4=ranges[_i233],from=_ranges$_i4.from,to=_ranges$_i4.to,size=to-from;if(dist<=size)return from+dist;dist-=size;}}function findFraction4(structure,pos){var counted=0;var _iterator263=_createForOfIteratorHelper(structure.ranges),_step263;try{for(_iterator263.s();!(_step263=_iterator263.n()).done;){var _step263$value=_step263.value,from=_step263$value.from,to=_step263$value.to;if(pos<=to){counted+=pos-from;break;}counted+=to-from;}}catch(err){_iterator263.e(err);}finally{_iterator263.f();}return counted/structure.total;}function cutRange4(ranges,from,to){for(var _i234=0;_i234<ranges.length;_i234++){var _r15=ranges[_i234];if(_r15.from<to&&_r15.to>from){var pieces=[];if(_r15.from<from)pieces.push({from:_r15.from,to:from});if(_r15.to>to)pieces.push({from:to,to:_r15.to});ranges.splice.apply(ranges,[_i234,1].concat(pieces));_i234+=pieces.length-1;}}}function find4(array,f){var _iterator264=_createForOfIteratorHelper(array),_step264;try{for(_iterator264.s();!(_step264=_iterator264.n()).done;){var val=_step264.value;if(f(val))return val;}}catch(err){_iterator264.e(err);}finally{_iterator264.f();}return void 0;}var IdScaler4={toDOM:function toDOM(n){return n;},fromDOM:function fromDOM(n){return n;},scale:1};var BigScaler4=/*#__PURE__*/function(){function BigScaler4(doc6,heightMap,viewports){_classCallCheck(this,BigScaler4);var vpHeight=0,base2=0,domBase=0;this.viewports=viewports.map(function(_ref53){var from=_ref53.from,to=_ref53.to;var top2=heightMap.lineAt(from,QueryType4.ByPos,doc6,0,0).top;var bottom=heightMap.lineAt(to,QueryType4.ByPos,doc6,0,0).bottom;vpHeight+=bottom-top2;return{from:from,to:to,top:top2,bottom:bottom,domTop:0,domBottom:0};});this.scale=(7e6-vpHeight)/(heightMap.height-vpHeight);var _iterator265=_createForOfIteratorHelper(this.viewports),_step265;try{for(_iterator265.s();!(_step265=_iterator265.n()).done;){var obj=_step265.value;obj.domTop=domBase+(obj.top-base2)*this.scale;domBase=obj.domBottom=obj.domTop+(obj.bottom-obj.top);base2=obj.bottom;}}catch(err){_iterator265.e(err);}finally{_iterator265.f();}}_createClass(BigScaler4,[{key:"toDOM",value:function toDOM(n){for(var _i235=0,base2=0,domBase=0;;_i235++){var vp=_i235<this.viewports.length?this.viewports[_i235]:null;if(!vp||n<vp.top)return domBase+(n-base2)*this.scale;if(n<=vp.bottom)return vp.domTop+(n-vp.top);base2=vp.bottom;domBase=vp.domBottom;}}},{key:"fromDOM",value:function fromDOM(n){for(var _i236=0,base2=0,domBase=0;;_i236++){var vp=_i236<this.viewports.length?this.viewports[_i236]:null;if(!vp||n<vp.domTop)return base2+(n-domBase)/this.scale;if(n<=vp.domBottom)return vp.top+(n-vp.domTop);base2=vp.bottom;domBase=vp.domBottom;}}}]);return BigScaler4;}();function scaleBlock4(block,scaler){if(scaler.scale==1)return block;var bTop=scaler.toDOM(block.top),bBottom=scaler.toDOM(block.bottom);return new BlockInfo4(block.from,block.length,bTop,bBottom-bTop,Array.isArray(block.type)?block.type.map(function(b){return scaleBlock4(b,scaler);}):block.type);}var theme4=/* @__PURE__ */Facet.define({combine:function combine(strs){return strs.join(" ");}});var darkTheme4=/* @__PURE__ */Facet.define({combine:function combine(values){return values.indexOf(true)>-1;}});var baseThemeID4=/* @__PURE__ */StyleModule.newName();var baseLightID4=/* @__PURE__ */StyleModule.newName();var baseDarkID4=/* @__PURE__ */StyleModule.newName();var lightDarkIDs4={"&light":"."+baseLightID4,"&dark":"."+baseDarkID4};function buildTheme4(main,spec,scopes){return new StyleModule(spec,{finish:function finish(sel){return /&/.test(sel)?sel.replace(/&\w*/,function(m){if(m=="&")return main;if(!scopes||!scopes[m])throw new RangeError("Unsupported selector: ".concat(m));return scopes[m];}):main+" "+sel;}});}var baseTheme6=/* @__PURE__ */buildTheme4("."+baseThemeID4,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs4);var observeOptions4={childList:true,characterData:true,subtree:true,attributes:true,characterDataOldValue:true};var useCharData4=browser4.ie&&browser4.ie_version<=11;var DOMObserver4=/*#__PURE__*/function(){function DOMObserver4(view,onChange,onScrollChanged){var _this169=this;_classCallCheck(this,DOMObserver4);this.view=view;this.onChange=onChange;this.onScrollChanged=onScrollChanged;this.active=false;this.selectionRange=new DOMSelectionState3();this.selectionChanged=false;this.delayedFlush=-1;this.resizeTimeout=-1;this.queue=[];this.delayedAndroidKey=null;this.scrollTargets=[];this.intersection=null;this.resize=null;this.intersecting=false;this.gapIntersection=null;this.gaps=[];this.parentCheck=-1;this.dom=view.contentDOM;this.observer=new MutationObserver(function(mutations){var _iterator266=_createForOfIteratorHelper(mutations),_step266;try{for(_iterator266.s();!(_step266=_iterator266.n()).done;){var mut=_step266.value;_this169.queue.push(mut);}}catch(err){_iterator266.e(err);}finally{_iterator266.f();}if((browser4.ie&&browser4.ie_version<=11||browser4.ios&&view.composing)&&mutations.some(function(m){return m.type=="childList"&&m.removedNodes.length||m.type=="characterData"&&m.oldValue.length>m.target.nodeValue.length;}))_this169.flushSoon();else _this169.flush();});if(useCharData4)this.onCharData=function(event){_this169.queue.push({target:event.target,type:"characterData",oldValue:event.prevValue});_this169.flushSoon();};this.onSelectionChange=this.onSelectionChange.bind(this);if(typeof ResizeObserver=="function"){this.resize=new ResizeObserver(function(){if(_this169.view.docView.lastUpdate<Date.now()-75&&_this169.resizeTimeout<0)_this169.resizeTimeout=setTimeout(function(){_this169.resizeTimeout=-1;_this169.view.requestMeasure();},50);});this.resize.observe(view.scrollDOM);}this.start();this.onScroll=this.onScroll.bind(this);window.addEventListener("scroll",this.onScroll);if(typeof IntersectionObserver=="function"){this.intersection=new IntersectionObserver(function(entries){if(_this169.parentCheck<0)_this169.parentCheck=setTimeout(_this169.listenForScroll.bind(_this169),1e3);if(entries.length>0&&entries[entries.length-1].intersectionRatio>0!=_this169.intersecting){_this169.intersecting=!_this169.intersecting;if(_this169.intersecting!=_this169.view.inView)_this169.onScrollChanged(document.createEvent("Event"));}},{});this.intersection.observe(this.dom);this.gapIntersection=new IntersectionObserver(function(entries){if(entries.length>0&&entries[entries.length-1].intersectionRatio>0)_this169.onScrollChanged(document.createEvent("Event"));},{});}this.listenForScroll();this.readSelectionRange();this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange);}_createClass(DOMObserver4,[{key:"onScroll",value:function onScroll(e){if(this.intersecting)this.flush(false);this.onScrollChanged(e);}},{key:"updateGaps",value:function updateGaps(gaps){if(this.gapIntersection&&(gaps.length!=this.gaps.length||this.gaps.some(function(g,i){return g!=gaps[i];}))){this.gapIntersection.disconnect();var _iterator267=_createForOfIteratorHelper(gaps),_step267;try{for(_iterator267.s();!(_step267=_iterator267.n()).done;){var gap=_step267.value;this.gapIntersection.observe(gap);}}catch(err){_iterator267.e(err);}finally{_iterator267.f();}this.gaps=gaps;}}},{key:"onSelectionChange",value:function onSelectionChange(event){if(!this.readSelectionRange()||this.delayedAndroidKey)return;var view=this.view,sel=this.selectionRange;if(view.state.facet(editable4)?view.root.activeElement!=this.dom:!hasSelection4(view.dom,sel))return;var context=sel.anchorNode&&view.docView.nearest(sel.anchorNode);if(context&&context.ignoreEvent(event))return;if((browser4.ie&&browser4.ie_version<=11||browser4.android&&browser4.chrome)&&!view.state.selection.main.empty&&sel.focusNode&&isEquivalentPosition4(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))this.flushSoon();else this.flush(false);}},{key:"readSelectionRange",value:function readSelectionRange(){var root=this.view.root,domSel=getSelection4(root);var range=browser4.safari&&root.nodeType==11&&deepActiveElement4()==this.view.contentDOM&&safariSelectionRangeHack4(this.view)||domSel;if(this.selectionRange.eq(range))return false;this.selectionRange.setRange(range);return this.selectionChanged=true;}},{key:"setSelectionRange",value:function setSelectionRange(anchor,head){this.selectionRange.set(anchor.node,anchor.offset,head.node,head.offset);this.selectionChanged=false;}},{key:"listenForScroll",value:function listenForScroll(){this.parentCheck=-1;var i=0,changed=null;for(var dom=this.dom;dom;){if(dom.nodeType==1){if(!changed&&i<this.scrollTargets.length&&this.scrollTargets[i]==dom)i++;else if(!changed)changed=this.scrollTargets.slice(0,i);if(changed)changed.push(dom);dom=dom.assignedSlot||dom.parentNode;}else if(dom.nodeType==11){dom=dom.host;}else{break;}}if(i<this.scrollTargets.length&&!changed)changed=this.scrollTargets.slice(0,i);if(changed){var _iterator268=_createForOfIteratorHelper(this.scrollTargets),_step268;try{for(_iterator268.s();!(_step268=_iterator268.n()).done;){var _dom8=_step268.value;_dom8.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator268.e(err);}finally{_iterator268.f();}var _iterator269=_createForOfIteratorHelper(this.scrollTargets=changed),_step269;try{for(_iterator269.s();!(_step269=_iterator269.n()).done;){var _dom9=_step269.value;_dom9.addEventListener("scroll",this.onScroll);}}catch(err){_iterator269.e(err);}finally{_iterator269.f();}}}},{key:"ignore",value:function ignore(f){if(!this.active)return f();try{this.stop();return f();}finally{this.start();this.clear();}}},{key:"start",value:function start(){if(this.active)return;this.observer.observe(this.dom,observeOptions4);if(useCharData4)this.dom.addEventListener("DOMCharacterDataModified",this.onCharData);this.active=true;}},{key:"stop",value:function stop(){if(!this.active)return;this.active=false;this.observer.disconnect();if(useCharData4)this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData);}},{key:"clear",value:function clear(){this.observer.takeRecords();this.queue.length=0;this.selectionChanged=false;}},{key:"delayAndroidKey",value:function delayAndroidKey(key,keyCode){var _this170=this;if(!this.delayedAndroidKey)requestAnimationFrame(function(){var key2=_this170.delayedAndroidKey;_this170.delayedAndroidKey=null;var startState=_this170.view.state;if(dispatchKey4(_this170.view.contentDOM,key2.key,key2.keyCode))_this170.processRecords();else _this170.flush();if(_this170.view.state==startState)_this170.view.update([]);});if(!this.delayedAndroidKey||key=="Enter")this.delayedAndroidKey={key:key,keyCode:keyCode};}},{key:"flushSoon",value:function flushSoon(){var _this171=this;if(this.delayedFlush<0)this.delayedFlush=window.setTimeout(function(){_this171.delayedFlush=-1;_this171.flush();},20);}},{key:"forceFlush",value:function forceFlush(){if(this.delayedFlush>=0){window.clearTimeout(this.delayedFlush);this.delayedFlush=-1;this.flush();}}},{key:"processRecords",value:function processRecords(){var records=this.queue;var _iterator270=_createForOfIteratorHelper(this.observer.takeRecords()),_step270;try{for(_iterator270.s();!(_step270=_iterator270.n()).done;){var mut=_step270.value;records.push(mut);}}catch(err){_iterator270.e(err);}finally{_iterator270.f();}if(records.length)this.queue=[];var from=-1,to=-1,typeOver=false;var _iterator271=_createForOfIteratorHelper(records),_step271;try{for(_iterator271.s();!(_step271=_iterator271.n()).done;){var record=_step271.value;var range=this.readMutation(record);if(!range)continue;if(range.typeOver)typeOver=true;if(from==-1){from=range.from;to=range.to;}else{from=Math.min(range.from,from);to=Math.max(range.to,to);}}}catch(err){_iterator271.e(err);}finally{_iterator271.f();}return{from:from,to:to,typeOver:typeOver};}},{key:"flush",value:function flush(){var readSelection=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.delayedFlush>=0||this.delayedAndroidKey)return;if(readSelection)this.readSelectionRange();var _this$processRecords4=this.processRecords(),from=_this$processRecords4.from,to=_this$processRecords4.to,typeOver=_this$processRecords4.typeOver;var newSel=this.selectionChanged&&hasSelection4(this.dom,this.selectionRange);if(from<0&&!newSel)return;this.selectionChanged=false;var startState=this.view.state;this.onChange(from,to,typeOver);if(this.view.state==startState)this.view.update([]);}},{key:"readMutation",value:function readMutation(rec){var cView=this.view.docView.nearest(rec.target);if(!cView||cView.ignoreMutation(rec))return null;cView.markDirty(rec.type=="attributes");if(rec.type=="attributes")cView.dirty|=4;if(rec.type=="childList"){var childBefore=findChild4(cView,rec.previousSibling||rec.target.previousSibling,-1);var childAfter=findChild4(cView,rec.nextSibling||rec.target.nextSibling,1);return{from:childBefore?cView.posAfter(childBefore):cView.posAtStart,to:childAfter?cView.posBefore(childAfter):cView.posAtEnd,typeOver:false};}else if(rec.type=="characterData"){return{from:cView.posAtStart,to:cView.posAtEnd,typeOver:rec.target.nodeValue==rec.oldValue};}else{return null;}}},{key:"destroy",value:function destroy(){var _a,_b,_c;this.stop();(_a=this.intersection)===null||_a===void 0?void 0:_a.disconnect();(_b=this.gapIntersection)===null||_b===void 0?void 0:_b.disconnect();(_c=this.resize)===null||_c===void 0?void 0:_c.disconnect();var _iterator272=_createForOfIteratorHelper(this.scrollTargets),_step272;try{for(_iterator272.s();!(_step272=_iterator272.n()).done;){var dom=_step272.value;dom.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator272.e(err);}finally{_iterator272.f();}window.removeEventListener("scroll",this.onScroll);this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange);clearTimeout(this.parentCheck);clearTimeout(this.resizeTimeout);}}]);return DOMObserver4;}();function findChild4(cView,dom,dir){while(dom){var curView=ContentView4.get(dom);if(curView&&curView.parent==cView)return curView;var parent=dom.parentNode;dom=parent!=cView.dom?parent:dir>0?dom.nextSibling:dom.previousSibling;}return null;}function safariSelectionRangeHack4(view){var found=null;function read(event){event.preventDefault();event.stopImmediatePropagation();found=event.getTargetRanges()[0];}view.contentDOM.addEventListener("beforeinput",read,true);document.execCommand("indent");view.contentDOM.removeEventListener("beforeinput",read,true);if(!found)return null;var anchorNode=found.startContainer,anchorOffset=found.startOffset;var focusNode=found.endContainer,focusOffset=found.endOffset;var curAnchor=view.docView.domAtPos(view.state.selection.main.anchor);if(isEquivalentPosition4(curAnchor.node,curAnchor.offset,focusNode,focusOffset)){var _ref54=[focusNode,focusOffset,anchorNode,anchorOffset];anchorNode=_ref54[0];anchorOffset=_ref54[1];focusNode=_ref54[2];focusOffset=_ref54[3];}return{anchorNode:anchorNode,anchorOffset:anchorOffset,focusNode:focusNode,focusOffset:focusOffset};}function applyDOMChange4(view,start,end,typeOver){var change,newSel;var sel=view.state.selection.main;if(start>-1){var bounds=view.docView.domBoundsAround(start,end,0);if(!bounds||view.state.readOnly)return;var from=bounds.from,to=bounds.to;var selPoints=view.docView.impreciseHead||view.docView.impreciseAnchor?[]:selectionPoints4(view);var reader=new DOMReader4(selPoints,view);reader.readRange(bounds.startDOM,bounds.endDOM);newSel=selectionFromPoints4(selPoints,from);var preferredPos=sel.from,preferredSide=null;if(view.inputState.lastKeyCode===8&&view.inputState.lastKeyTime>Date.now()-100||browser4.android&&reader.text.length<to-from){preferredPos=sel.to;preferredSide="end";}var diff=findDiff4(view.state.sliceDoc(from,to),reader.text,preferredPos-from,preferredSide);if(diff)change={from:from+diff.from,to:from+diff.toA,insert:view.state.toText(reader.text.slice(diff.from,diff.toB))};}else if(view.hasFocus||!view.state.facet(editable4)){var domSel=view.observer.selectionRange;var _view$docView4=view.docView,iHead=_view$docView4.impreciseHead,iAnchor=_view$docView4.impreciseAnchor;var head=iHead&&iHead.node==domSel.focusNode&&iHead.offset==domSel.focusOffset||!contains4(view.contentDOM,domSel.focusNode)?view.state.selection.main.head:view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset);var anchor=iAnchor&&iAnchor.node==domSel.anchorNode&&iAnchor.offset==domSel.anchorOffset||!contains4(view.contentDOM,domSel.anchorNode)?view.state.selection.main.anchor:view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset);if(head!=sel.head||anchor!=sel.anchor)newSel=EditorSelection.single(anchor,head);}if(!change&&!newSel)return;if(!change&&typeOver&&!sel.empty&&newSel&&newSel.main.empty)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,sel.to)};else if(change&&change.from>=sel.from&&change.to<=sel.to&&(change.from!=sel.from||change.to!=sel.to)&&sel.to-sel.from-(change.to-change.from)<=4)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,change.from).append(change.insert).append(view.state.doc.slice(change.to,sel.to))};if(change){var startState=view.state;if(browser4.ios&&view.inputState.flushIOSKey(view))return;if(browser4.android&&(change.from==sel.from&&change.to==sel.to&&change.insert.length==1&&change.insert.lines==2&&dispatchKey4(view.contentDOM,"Enter",13)||change.from==sel.from-1&&change.to==sel.to&&change.insert.length==0&&dispatchKey4(view.contentDOM,"Backspace",8)||change.from==sel.from&&change.to==sel.to+1&&change.insert.length==0&&dispatchKey4(view.contentDOM,"Delete",46)))return;var _text11=change.insert.toString();if(view.state.facet(inputHandler4).some(function(h){return h(view,change.from,change.to,_text11);}))return;if(view.inputState.composing>=0)view.inputState.composing++;var tr;if(change.from>=sel.from&&change.to<=sel.to&&change.to-change.from>=(sel.to-sel.from)/3&&(!newSel||newSel.main.empty&&newSel.main.from==change.from+change.insert.length)&&view.inputState.composing<0){var before=sel.from<change.from?startState.sliceDoc(sel.from,change.from):"";var after=sel.to>change.to?startState.sliceDoc(change.to,sel.to):"";tr=startState.replaceSelection(view.state.toText(before+change.insert.sliceString(0,void 0,view.state.lineBreak)+after));}else{var changes=startState.changes(change);var mainSel=newSel&&!startState.selection.main.eq(newSel.main)&&newSel.main.to<=changes.newLength?newSel.main:void 0;if(startState.selection.ranges.length>1&&view.inputState.composing>=0&&change.to<=sel.to&&change.to>=sel.to-10){var replaced=view.state.sliceDoc(change.from,change.to);var compositionRange=compositionSurroundingNode3(view)||view.state.doc.lineAt(sel.head);var offset=sel.to-change.to,size=sel.to-sel.from;tr=startState.changeByRange(function(range){if(range.from==sel.from&&range.to==sel.to)return{changes:changes,range:mainSel||range.map(changes)};var to=range.to-offset,from=to-replaced.length;if(range.to-range.from!=size||view.state.sliceDoc(from,to)!=replaced||compositionRange&&range.to>=compositionRange.from&&range.from<=compositionRange.to)return{range:range};var rangeChanges=startState.changes({from:from,to:to,insert:change.insert}),selOff=range.to-sel.to;return{changes:rangeChanges,range:!mainSel?range.map(rangeChanges):EditorSelection.range(Math.max(0,mainSel.anchor+selOff),Math.max(0,mainSel.head+selOff))};});}else{tr={changes:changes,selection:mainSel&&startState.selection.replaceRange(mainSel)};}}var userEvent="input.type";if(view.composing){userEvent+=".compose";if(view.inputState.compositionFirstChange){userEvent+=".start";view.inputState.compositionFirstChange=false;}}view.dispatch(tr,{scrollIntoView:true,userEvent:userEvent});}else if(newSel&&!newSel.main.eq(sel)){var scrollIntoView6=false,_userEvent4="select";if(view.inputState.lastSelectionTime>Date.now()-50){if(view.inputState.lastSelectionOrigin=="select")scrollIntoView6=true;_userEvent4=view.inputState.lastSelectionOrigin;}view.dispatch({selection:newSel,scrollIntoView:scrollIntoView6,userEvent:_userEvent4});}}function findDiff4(a,b,preferredPos,preferredSide){var minLen=Math.min(a.length,b.length);var from=0;while(from<minLen&&a.charCodeAt(from)==b.charCodeAt(from)){from++;}if(from==minLen&&a.length==b.length)return null;var toA=a.length,toB=b.length;while(toA>0&&toB>0&&a.charCodeAt(toA-1)==b.charCodeAt(toB-1)){toA--;toB--;}if(preferredSide=="end"){var adjust=Math.max(0,from-Math.min(toA,toB));preferredPos-=toA+adjust-from;}if(toA<from&&a.length<b.length){var move=preferredPos<=from&&preferredPos>=toA?from-preferredPos:0;from-=move;toB=from+(toB-toA);toA=from;}else if(toB<from){var _move4=preferredPos<=from&&preferredPos>=toB?from-preferredPos:0;from-=_move4;toA=from+(toA-toB);toB=from;}return{from:from,toA:toA,toB:toB};}function selectionPoints4(view){var result=[];if(view.root.activeElement!=view.contentDOM)return result;var _view$observer$select4=view.observer.selectionRange,anchorNode=_view$observer$select4.anchorNode,anchorOffset=_view$observer$select4.anchorOffset,focusNode=_view$observer$select4.focusNode,focusOffset=_view$observer$select4.focusOffset;if(anchorNode){result.push(new DOMPoint4(anchorNode,anchorOffset));if(focusNode!=anchorNode||focusOffset!=anchorOffset)result.push(new DOMPoint4(focusNode,focusOffset));}return result;}function selectionFromPoints4(points,base2){if(points.length==0)return null;var anchor=points[0].pos,head=points.length==2?points[1].pos:anchor;return anchor>-1&&head>-1?EditorSelection.single(anchor+base2,head+base2):null;}var EditorView4=/*#__PURE__*/function(){function EditorView4(){var _this172=this;var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,EditorView4);this.plugins=[];this.pluginMap=/* @__PURE__ */new Map();this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.destroyed=false;this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.style.cssText="position: absolute; top: -10000px";this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);this._dispatch=config2.dispatch||function(tr){return _this172.update([tr]);};this.dispatch=this.dispatch.bind(this);this.root=config2.root||getRoot4(config2.parent)||document;this.viewState=new ViewState4(config2.state||EditorState.create());this.plugins=this.state.facet(viewPlugin4).map(function(spec){return new PluginInstance4(spec);});var _iterator273=_createForOfIteratorHelper(this.plugins),_step273;try{for(_iterator273.s();!(_step273=_iterator273.n()).done;){var plugin=_step273.value;plugin.update(this);}}catch(err){_iterator273.e(err);}finally{_iterator273.f();}this.observer=new DOMObserver4(this,function(from,to,typeOver){applyDOMChange4(_this172,from,to,typeOver);},function(event){_this172.inputState.runScrollHandlers(_this172,event);if(_this172.observer.intersecting)_this172.measure();});this.inputState=new InputState4(this);this.docView=new DocView4(this);this.mountStyles();this.updateAttrs();this.updateState=0;ensureGlobalHandler4();this.requestMeasure();if(config2.parent)config2.parent.appendChild(this.dom);}_createClass(EditorView4,[{key:"state",get:function get(){return this.viewState.state;}},{key:"viewport",get:function get(){return this.viewState.viewport;}},{key:"visibleRanges",get:function get(){return this.viewState.visibleRanges;}},{key:"inView",get:function get(){return this.viewState.inView;}},{key:"composing",get:function get(){return this.inputState.composing>0;}},{key:"dispatch",value:function dispatch(){var _this$state4;this._dispatch(arguments.length==1&&(arguments.length<=0?undefined:arguments[0])instanceof Transaction?arguments.length<=0?undefined:arguments[0]:(_this$state4=this.state).update.apply(_this$state4,arguments));}},{key:"update",value:function update(transactions){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");var redrawn=false,update;var state=this.state;var _iterator274=_createForOfIteratorHelper(transactions),_step274;try{for(_iterator274.s();!(_step274=_iterator274.n()).done;){var _tr4=_step274.value;if(_tr4.startState!=state)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");state=_tr4.state;}}catch(err){_iterator274.e(err);}finally{_iterator274.f();}if(this.destroyed){this.viewState.state=state;return;}if(state.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(state);update=new ViewUpdate4(this,state,transactions);var scrollTarget=this.viewState.scrollTarget;try{this.updateState=2;var _iterator275=_createForOfIteratorHelper(transactions),_step275;try{for(_iterator275.s();!(_step275=_iterator275.n()).done;){var tr=_step275.value;if(scrollTarget)scrollTarget=scrollTarget.map(tr.changes);if(tr.scrollIntoView){var main=tr.state.selection.main;scrollTarget=new ScrollTarget4(main.empty?main:EditorSelection.cursor(main.head,main.head>main.anchor?-1:1));}var _iterator276=_createForOfIteratorHelper(tr.effects),_step276;try{for(_iterator276.s();!(_step276=_iterator276.n()).done;){var e=_step276.value;if(e.is(scrollTo4))scrollTarget=new ScrollTarget4(e.value);else if(e.is(centerOn4))scrollTarget=new ScrollTarget4(e.value,"center");else if(e.is(scrollIntoView3))scrollTarget=e.value;}}catch(err){_iterator276.e(err);}finally{_iterator276.f();}}}catch(err){_iterator275.e(err);}finally{_iterator275.f();}this.viewState.update(update,scrollTarget);this.bidiCache=CachedOrder4.update(this.bidiCache,update.changes);if(!update.empty){this.updatePlugins(update);this.inputState.update(update);}redrawn=this.docView.update(update);if(this.state.facet(styleModule4)!=this.styleModules)this.mountStyles();this.updateAttrs();this.showAnnouncements(transactions);this.docView.updateSelection(redrawn,transactions.some(function(tr){return tr.isUserEvent("select.pointer");}));}finally{this.updateState=0;}if(redrawn||scrollTarget||this.viewState.mustEnforceCursorAssoc)this.requestMeasure();if(!update.empty){var _iterator277=_createForOfIteratorHelper(this.state.facet(updateListener4)),_step277;try{for(_iterator277.s();!(_step277=_iterator277.n()).done;){var listener=_step277.value;listener(update);}}catch(err){_iterator277.e(err);}finally{_iterator277.f();}}}},{key:"setState",value:function setState(newState){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=newState;return;}this.updateState=2;var hadFocus=this.hasFocus;try{var _iterator278=_createForOfIteratorHelper(this.plugins),_step278;try{for(_iterator278.s();!(_step278=_iterator278.n()).done;){var plugin=_step278.value;plugin.destroy(this);}}catch(err){_iterator278.e(err);}finally{_iterator278.f();}this.viewState=new ViewState4(newState);this.plugins=newState.facet(viewPlugin4).map(function(spec){return new PluginInstance4(spec);});this.pluginMap.clear();var _iterator279=_createForOfIteratorHelper(this.plugins),_step279;try{for(_iterator279.s();!(_step279=_iterator279.n()).done;){var _plugin11=_step279.value;_plugin11.update(this);}}catch(err){_iterator279.e(err);}finally{_iterator279.f();}this.docView=new DocView4(this);this.inputState.ensureHandlers(this);this.mountStyles();this.updateAttrs();this.bidiCache=[];}finally{this.updateState=0;}if(hadFocus)this.focus();this.requestMeasure();}},{key:"updatePlugins",value:function updatePlugins(update){var prevSpecs=update.startState.facet(viewPlugin4),specs=update.state.facet(viewPlugin4);if(prevSpecs!=specs){var newPlugins=[];var _iterator280=_createForOfIteratorHelper(specs),_step280;try{for(_iterator280.s();!(_step280=_iterator280.n()).done;){var spec=_step280.value;var found=prevSpecs.indexOf(spec);if(found<0){newPlugins.push(new PluginInstance4(spec));}else{var plugin=this.plugins[found];plugin.mustUpdate=update;newPlugins.push(plugin);}}}catch(err){_iterator280.e(err);}finally{_iterator280.f();}var _iterator281=_createForOfIteratorHelper(this.plugins),_step281;try{for(_iterator281.s();!(_step281=_iterator281.n()).done;){var _plugin12=_step281.value;if(_plugin12.mustUpdate!=update)_plugin12.destroy(this);}}catch(err){_iterator281.e(err);}finally{_iterator281.f();}this.plugins=newPlugins;this.pluginMap.clear();this.inputState.ensureHandlers(this);}else{var _iterator282=_createForOfIteratorHelper(this.plugins),_step282;try{for(_iterator282.s();!(_step282=_iterator282.n()).done;){var _p8=_step282.value;_p8.mustUpdate=update;}}catch(err){_iterator282.e(err);}finally{_iterator282.f();}}for(var _i237=0;_i237<this.plugins.length;_i237++){this.plugins[_i237].update(this);}}},{key:"measure",value:function measure(){var _this173=this;var flush=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.destroyed)return;if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.measureScheduled=0;if(flush)this.observer.flush();var updated=null;try{for(var _i238=0;;_i238++){this.updateState=1;var oldViewport=this.viewport;var changed=this.viewState.measure(this);if(!changed&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(_i238>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break;}var measuring=[];if(!(changed&4)){var _ref55=[measuring,this.measureRequests];this.measureRequests=_ref55[0];measuring=_ref55[1];}var measured=measuring.map(function(m){try{return m.read(_this173);}catch(e){logException4(_this173.state,e);return BadMeasure4;}});var update=new ViewUpdate4(this,this.state),redrawn=false,scrolled=false;update.flags|=changed;if(!updated)updated=update;else updated.flags|=changed;this.updateState=2;if(!update.empty){this.updatePlugins(update);this.inputState.update(update);this.updateAttrs();redrawn=this.docView.update(update);}for(var i2=0;i2<measuring.length;i2++){if(measured[i2]!=BadMeasure4){try{var m=measuring[i2];if(m.write)m.write(measured[i2],this);}catch(e){logException4(this.state,e);}}}if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget);this.viewState.scrollTarget=null;scrolled=true;}if(redrawn)this.docView.updateSelection(true);if(this.viewport.from==oldViewport.from&&this.viewport.to==oldViewport.to&&!scrolled&&this.measureRequests.length==0)break;}}finally{this.updateState=0;this.measureScheduled=-1;}if(updated&&!updated.empty){var _iterator283=_createForOfIteratorHelper(this.state.facet(updateListener4)),_step283;try{for(_iterator283.s();!(_step283=_iterator283.n()).done;){var listener=_step283.value;listener(updated);}}catch(err){_iterator283.e(err);}finally{_iterator283.f();}}}},{key:"themeClasses",get:function get(){return baseThemeID4+" "+(this.state.facet(darkTheme4)?baseDarkID4:baseLightID4)+" "+this.state.facet(theme4);}},{key:"updateAttrs",value:function updateAttrs(){var _this174=this;var editorAttrs=attrsFromFacet3(this,editorAttributes4,{"class":"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses});var contentAttrs={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:!this.state.facet(editable4)?"false":"true","class":"cm-content",style:"".concat(browser4.tabSize,": ").concat(this.state.tabSize),role:"textbox","aria-multiline":"true"};if(this.state.readOnly)contentAttrs["aria-readonly"]="true";attrsFromFacet3(this,contentAttributes4,contentAttrs);this.observer.ignore(function(){updateAttrs4(_this174.contentDOM,_this174.contentAttrs,contentAttrs);updateAttrs4(_this174.dom,_this174.editorAttrs,editorAttrs);});this.editorAttrs=editorAttrs;this.contentAttrs=contentAttrs;}},{key:"showAnnouncements",value:function showAnnouncements(trs){var first=true;var _iterator284=_createForOfIteratorHelper(trs),_step284;try{for(_iterator284.s();!(_step284=_iterator284.n()).done;){var tr=_step284.value;var _iterator285=_createForOfIteratorHelper(tr.effects),_step285;try{for(_iterator285.s();!(_step285=_iterator285.n()).done;){var effect=_step285.value;if(effect.is(EditorView4.announce)){if(first)this.announceDOM.textContent="";first=false;var div=this.announceDOM.appendChild(document.createElement("div"));div.textContent=effect.value;}}}catch(err){_iterator285.e(err);}finally{_iterator285.f();}}}catch(err){_iterator284.e(err);}finally{_iterator284.f();}}},{key:"mountStyles",value:function mountStyles(){this.styleModules=this.state.facet(styleModule4);StyleModule.mount(this.root,this.styleModules.concat(baseTheme6).reverse());}},{key:"readMeasured",value:function readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");if(this.updateState==0&&this.measureScheduled>-1)this.measure(false);}},{key:"requestMeasure",value:function requestMeasure(request){var _this175=this;if(this.measureScheduled<0)this.measureScheduled=requestAnimationFrame(function(){return _this175.measure();});if(request){if(request.key!=null)for(var _i239=0;_i239<this.measureRequests.length;_i239++){if(this.measureRequests[_i239].key===request.key){this.measureRequests[_i239]=request;return;}}this.measureRequests.push(request);}}},{key:"pluginField",value:function pluginField(field){var result=[];var _iterator286=_createForOfIteratorHelper(this.plugins),_step286;try{for(_iterator286.s();!(_step286=_iterator286.n()).done;){var plugin=_step286.value;plugin.update(this).takeField(field,result);}}catch(err){_iterator286.e(err);}finally{_iterator286.f();}return result;}},{key:"plugin",value:function plugin(_plugin10){var known=this.pluginMap.get(_plugin10);if(known===void 0||known&&known.spec!=_plugin10)this.pluginMap.set(_plugin10,known=this.plugins.find(function(p){return p.spec==_plugin10;})||null);return known&&known.update(this).value;}},{key:"documentTop",get:function get(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop;}},{key:"documentPadding",get:function get(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom};}},{key:"blockAtHeight",value:function blockAtHeight(height,docTop){var top2=ensureTop4(docTop,this);return this.elementAtHeight(height-top2).moveY(top2);}},{key:"elementAtHeight",value:function elementAtHeight(height){this.readMeasured();return this.viewState.elementAtHeight(height);}},{key:"visualLineAtHeight",value:function visualLineAtHeight(height,docTop){var top2=ensureTop4(docTop,this);return this.lineBlockAtHeight(height-top2).moveY(top2);}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){this.readMeasured();return this.viewState.lineBlockAtHeight(height);}},{key:"viewportLines",value:function viewportLines(f,docTop){var top2=ensureTop4(docTop,this);var _iterator287=_createForOfIteratorHelper(this.viewportLineBlocks),_step287;try{for(_iterator287.s();!(_step287=_iterator287.n()).done;){var line=_step287.value;f(line.moveY(top2));}}catch(err){_iterator287.e(err);}finally{_iterator287.f();}}},{key:"viewportLineBlocks",get:function get(){return this.viewState.viewportLines;}},{key:"visualLineAt",value:function visualLineAt(pos){var docTop=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.lineBlockAt(pos).moveY(docTop+this.viewState.paddingTop);}},{key:"lineBlockAt",value:function lineBlockAt(pos){return this.viewState.lineBlockAt(pos);}},{key:"contentHeight",get:function get(){return this.viewState.contentHeight;}},{key:"moveByChar",value:function moveByChar(start,forward,by){return skipAtoms4(this,start,moveByChar4(this,start,forward,by));}},{key:"moveByGroup",value:function moveByGroup(start,forward){var _this176=this;return skipAtoms4(this,start,moveByChar4(this,start,forward,function(initial){return byGroup4(_this176,start.head,initial);}));}},{key:"moveToLineBoundary",value:function moveToLineBoundary(start,forward){var includeWrap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return moveToLineBoundary4(this,start,forward,includeWrap);}},{key:"moveVertically",value:function moveVertically(start,forward,distance){return skipAtoms4(this,start,moveVertically4(this,start,forward,distance));}},{key:"scrollPosIntoView",value:function scrollPosIntoView(pos){this.dispatch({effects:scrollTo4.of(EditorSelection.cursor(pos))});}},{key:"domAtPos",value:function domAtPos(pos){return this.docView.domAtPos(pos);}},{key:"posAtDOM",value:function posAtDOM(node){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.docView.posFromDOM(node,offset);}},{key:"posAtCoords",value:function posAtCoords(coords){var precise=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.readMeasured();return posAtCoords4(this,coords,precise);}},{key:"coordsAtPos",value:function coordsAtPos(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.readMeasured();var rect=this.docView.coordsAt(pos,side);if(!rect||rect.left==rect.right)return rect;var line=this.state.doc.lineAt(pos),order=this.bidiSpans(line);var span=order[BidiSpan4.find(order,pos-line.from,-1,side)];return flattenRect4(rect,span.dir==Direction4.LTR==side>0);}},{key:"defaultCharacterWidth",get:function get(){return this.viewState.heightOracle.charWidth;}},{key:"defaultLineHeight",get:function get(){return this.viewState.heightOracle.lineHeight;}},{key:"textDirection",get:function get(){return this.viewState.heightOracle.direction;}},{key:"lineWrapping",get:function get(){return this.viewState.heightOracle.lineWrapping;}},{key:"bidiSpans",value:function bidiSpans(line){if(line.length>MaxBidiLine4)return trivialOrder4(line.length);var dir=this.textDirection;var _iterator288=_createForOfIteratorHelper(this.bidiCache),_step288;try{for(_iterator288.s();!(_step288=_iterator288.n()).done;){var entry=_step288.value;if(entry.from==line.from&&entry.dir==dir)return entry.order;}}catch(err){_iterator288.e(err);}finally{_iterator288.f();}var order=computeOrder4(line.text,this.textDirection);this.bidiCache.push(new CachedOrder4(line.from,line.to,dir,order));return order;}},{key:"hasFocus",get:function get(){var _a;return(document.hasFocus()||browser4.safari&&((_a=this.inputState)===null||_a===void 0?void 0:_a.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM;}},{key:"focus",value:function focus(){var _this177=this;this.observer.ignore(function(){focusPreventScroll4(_this177.contentDOM);_this177.docView.updateSelection();});}},{key:"destroy",value:function destroy(){var _iterator289=_createForOfIteratorHelper(this.plugins),_step289;try{for(_iterator289.s();!(_step289=_iterator289.n()).done;){var plugin=_step289.value;plugin.destroy(this);}}catch(err){_iterator289.e(err);}finally{_iterator289.f();}this.plugins=[];this.inputState.destroy();this.dom.remove();this.observer.destroy();if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.destroyed=true;}}],[{key:"scrollIntoView",value:function scrollIntoView(pos){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return scrollIntoView3.of(new ScrollTarget4(typeof pos=="number"?EditorSelection.cursor(pos):pos,options.y,options.x,options.yMargin,options.xMargin));}},{key:"domEventHandlers",value:function domEventHandlers(handlers6){return ViewPlugin4.define(function(){return{};},{eventHandlers:handlers6});}},{key:"theme",value:function theme(spec,options){var prefix=StyleModule.newName();var result=[theme4.of(prefix),styleModule4.of(buildTheme4(".".concat(prefix),spec))];if(options&&options.dark)result.push(darkTheme4.of(true));return result;}},{key:"baseTheme",value:function baseTheme(spec){return Prec.lowest(styleModule4.of(buildTheme4("."+baseThemeID4,spec,lightDarkIDs4)));}}]);return EditorView4;}();EditorView4.scrollTo=scrollTo4;EditorView4.centerOn=centerOn4;EditorView4.styleModule=styleModule4;EditorView4.inputHandler=inputHandler4;EditorView4.exceptionSink=exceptionSink4;EditorView4.updateListener=updateListener4;EditorView4.editable=editable4;EditorView4.mouseSelectionStyle=mouseSelectionStyle4;EditorView4.dragMovesSelection=dragMovesSelection$14;EditorView4.clickAddsSelectionRange=clickAddsSelectionRange4;EditorView4.decorations=decorations4;EditorView4.darkTheme=darkTheme4;EditorView4.contentAttributes=contentAttributes4;EditorView4.editorAttributes=editorAttributes4;EditorView4.lineWrapping=/* @__PURE__ */EditorView4.contentAttributes.of({"class":"cm-lineWrapping"});EditorView4.announce=/* @__PURE__ */StateEffect.define();var MaxBidiLine4=4096;function ensureTop4(given,view){return(given==null?view.contentDOM.getBoundingClientRect().top:given)+view.viewState.paddingTop;}var resizeDebounce4=-1;function ensureGlobalHandler4(){window.addEventListener("resize",function(){if(resizeDebounce4==-1)resizeDebounce4=setTimeout(handleResize4,50);});}function handleResize4(){resizeDebounce4=-1;var found=document.querySelectorAll(".cm-content");for(var _i240=0;_i240<found.length;_i240++){var docView=ContentView4.get(found[_i240]);if(docView)docView.editorView.requestMeasure();}}var BadMeasure4={};var CachedOrder4=/*#__PURE__*/function(){function CachedOrder4(from,to,dir,order){_classCallCheck(this,CachedOrder4);this.from=from;this.to=to;this.dir=dir;this.order=order;}_createClass(CachedOrder4,null,[{key:"update",value:function update(cache,changes){if(changes.empty)return cache;var result=[],lastDir=cache.length?cache[cache.length-1].dir:Direction4.LTR;for(var _i241=Math.max(0,cache.length-10);_i241<cache.length;_i241++){var entry=cache[_i241];if(entry.dir==lastDir&&!changes.touchesRange(entry.from,entry.to))result.push(new CachedOrder4(changes.mapPos(entry.from,1),changes.mapPos(entry.to,-1),entry.dir,entry.order));}return result;}}]);return CachedOrder4;}();function attrsFromFacet3(view,facet,base2){for(var sources=view.state.facet(facet),_i242=sources.length-1;_i242>=0;_i242--){var source=sources[_i242],value=typeof source=="function"?source(view):source;if(value)combineAttrs4(value,base2);}return base2;}var currentPlatform4=browser4.mac?"mac":browser4.windows?"win":browser4.linux?"linux":"key";var CanHidePrimary4=!browser4.ios;var themeSpec4={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};if(CanHidePrimary4)themeSpec4[".cm-line"].caretColor="transparent !important";var UnicodeRegexpSupport4=/x/.unicode!=null?"gu":"g";// ../node_modules/@codemirror/matchbrackets/dist/index.js
var baseTheme7=/* @__PURE__ */EditorView.baseTheme({".cm-matchingBracket":{backgroundColor:"#328c8252"},".cm-nonmatchingBracket":{backgroundColor:"#bb555544"}});var DefaultScanDist=1e4;var DefaultBrackets="()[]{}";var bracketMatchingConfig=/* @__PURE__ */Facet.define({combine:function combine(configs){return combineConfig(configs,{afterCursor:true,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist});}});var matchingMark=/* @__PURE__ */Decoration.mark({"class":"cm-matchingBracket"});var nonmatchingMark=/* @__PURE__ */Decoration.mark({"class":"cm-nonmatchingBracket"});var bracketMatchingState=/* @__PURE__ */StateField.define({create:function create(){return Decoration.none;},update:function update(deco,tr){if(!tr.docChanged&&!tr.selection)return deco;var decorations6=[];var config2=tr.state.facet(bracketMatchingConfig);var _iterator290=_createForOfIteratorHelper(tr.state.selection.ranges),_step290;try{for(_iterator290.s();!(_step290=_iterator290.n()).done;){var range=_step290.value;if(!range.empty)continue;var match=matchBrackets(tr.state,range.head,-1,config2)||range.head>0&&matchBrackets(tr.state,range.head-1,1,config2)||config2.afterCursor&&(matchBrackets(tr.state,range.head,1,config2)||range.head<tr.state.doc.length&&matchBrackets(tr.state,range.head+1,-1,config2));if(!match)continue;var mark=match.matched?matchingMark:nonmatchingMark;decorations6.push(mark.range(match.start.from,match.start.to));if(match.end)decorations6.push(mark.range(match.end.from,match.end.to));}}catch(err){_iterator290.e(err);}finally{_iterator290.f();}return Decoration.set(decorations6,true);},provide:function provide(f){return EditorView.decorations.from(f);}});var bracketMatchingUnique=[bracketMatchingState,baseTheme7];function bracketMatching(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[bracketMatchingConfig.of(config2),bracketMatchingUnique];}function matchingNodes(node,dir,brackets){var byProp=node.prop(dir<0?NodeProp.openedBy:NodeProp.closedBy);if(byProp)return byProp;if(node.name.length==1){var index=brackets.indexOf(node.name);if(index>-1&&index%2==(dir<0?1:0))return[brackets[index+dir]];}return null;}function matchBrackets(state,pos,dir){var config2=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};var maxScanDistance=config2.maxScanDistance||DefaultScanDist,brackets=config2.brackets||DefaultBrackets;var tree=syntaxTree(state),node=tree.resolveInner(pos,dir);for(var cur2=node;cur2;cur2=cur2.parent){var matches=matchingNodes(cur2.type,dir,brackets);if(matches&&cur2.from<cur2.to)return matchMarkedBrackets(state,pos,dir,cur2,matches,brackets);}return matchPlainBrackets(state,pos,dir,tree,node.type,maxScanDistance,brackets);}function matchMarkedBrackets(_state,_pos,dir,token,matching,brackets){var parent=token.parent,firstToken={from:token.from,to:token.to};var depth=0,cursor2=parent===null||parent===void 0?void 0:parent.cursor;if(cursor2&&(dir<0?cursor2.childBefore(token.from):cursor2.childAfter(token.to)))do{if(dir<0?cursor2.to<=token.from:cursor2.from>=token.to){if(depth==0&&matching.indexOf(cursor2.type.name)>-1&&cursor2.from<cursor2.to){return{start:firstToken,end:{from:cursor2.from,to:cursor2.to},matched:true};}else if(matchingNodes(cursor2.type,dir,brackets)){depth++;}else if(matchingNodes(cursor2.type,-dir,brackets)){depth--;if(depth==0)return{start:firstToken,end:cursor2.from==cursor2.to?void 0:{from:cursor2.from,to:cursor2.to},matched:false};}}}while(dir<0?cursor2.prevSibling():cursor2.nextSibling());return{start:firstToken,matched:false};}function matchPlainBrackets(state,pos,dir,tree,tokenType,maxScanDistance,brackets){var startCh=dir<0?state.sliceDoc(pos-1,pos):state.sliceDoc(pos,pos+1);var bracket2=brackets.indexOf(startCh);if(bracket2<0||bracket2%2==0!=dir>0)return null;var startToken={from:dir<0?pos-1:pos,to:dir>0?pos+1:pos};var iter=state.doc.iterRange(pos,dir>0?state.doc.length:0),depth=0;for(var distance=0;!iter.next().done&&distance<=maxScanDistance;){var _text12=iter.value;if(dir<0)distance+=_text12.length;var basePos=pos+distance*dir;for(var pos2=dir>0?0:_text12.length-1,end=dir>0?_text12.length:-1;pos2!=end;pos2+=dir){var found=brackets.indexOf(_text12[pos2]);if(found<0||tree.resolve(basePos+pos2,1).type!=tokenType)continue;if(found%2==0==dir>0){depth++;}else if(depth==1){return{start:startToken,end:{from:basePos+pos2,to:basePos+pos2+1},matched:found>>1==bracket2>>1};}else{depth--;}}if(dir>0)distance+=_text12.length;}return iter.done?{start:startToken,matched:false}:null;}// ../node_modules/@codemirror/commands/dist/index.js
function updateSel(sel,by){return EditorSelection.create(sel.ranges.map(by),sel.mainIndex);}function setSel(state,selection2){return state.update({selection:selection2,scrollIntoView:true,userEvent:"select"});}function moveSel(_ref56,how){var state=_ref56.state,dispatch=_ref56.dispatch;var selection2=updateSel(state.selection,how);if(selection2.eq(state.selection))return false;dispatch(setSel(state,selection2));return true;}function rangeEnd(range,forward){return EditorSelection.cursor(forward?range.to:range.from);}function cursorByChar(view,forward){return moveSel(view,function(range){return range.empty?view.moveByChar(range,forward):rangeEnd(range,forward);});}var cursorCharLeft=function cursorCharLeft(view){return cursorByChar(view,view.textDirection!=Direction4.LTR);};var cursorCharRight=function cursorCharRight(view){return cursorByChar(view,view.textDirection==Direction4.LTR);};function cursorByGroup(view,forward){return moveSel(view,function(range){return range.empty?view.moveByGroup(range,forward):rangeEnd(range,forward);});}var cursorGroupLeft=function cursorGroupLeft(view){return cursorByGroup(view,view.textDirection!=Direction4.LTR);};var cursorGroupRight=function cursorGroupRight(view){return cursorByGroup(view,view.textDirection==Direction4.LTR);};function interestingNode(state,node,bracketProp){if(node.type.prop(bracketProp))return true;var len=node.to-node.from;return len&&(len>2||/[^\s,.;:]/.test(state.sliceDoc(node.from,node.to)))||node.firstChild;}function moveBySyntax(state,start,forward){var pos=syntaxTree(state).resolveInner(start.head);var bracketProp=forward?NodeProp.closedBy:NodeProp.openedBy;for(var at=start.head;;){var next=forward?pos.childAfter(at):pos.childBefore(at);if(!next)break;if(interestingNode(state,next,bracketProp))pos=next;else at=forward?next.to:next.from;}var bracket2=pos.type.prop(bracketProp),match,newPos;if(bracket2&&(match=forward?matchBrackets(state,pos.from,1):matchBrackets(state,pos.to,-1))&&match.matched)newPos=forward?match.end.to:match.end.from;else newPos=forward?pos.to:pos.from;return EditorSelection.cursor(newPos,forward?-1:1);}var cursorSyntaxLeft=function cursorSyntaxLeft(view){return moveSel(view,function(range){return moveBySyntax(view.state,range,view.textDirection!=Direction4.LTR);});};var cursorSyntaxRight=function cursorSyntaxRight(view){return moveSel(view,function(range){return moveBySyntax(view.state,range,view.textDirection==Direction4.LTR);});};function cursorByLine(view,forward){return moveSel(view,function(range){if(!range.empty)return rangeEnd(range,forward);var moved=view.moveVertically(range,forward);return moved.head!=range.head?moved:view.moveToLineBoundary(range,forward);});}var cursorLineUp=function cursorLineUp(view){return cursorByLine(view,false);};var cursorLineDown=function cursorLineDown(view){return cursorByLine(view,true);};function cursorByPage(view,forward){var state=view.state,selection2=updateSel(state.selection,function(range){return range.empty?view.moveVertically(range,forward,view.dom.clientHeight):rangeEnd(range,forward);});if(selection2.eq(state.selection))return false;var startPos=view.coordsAtPos(state.selection.main.head);var scrollRect=view.scrollDOM.getBoundingClientRect();view.dispatch(setSel(state,selection2),{effects:startPos&&startPos.top>scrollRect.top&&startPos.bottom<scrollRect.bottom?EditorView4.scrollIntoView(selection2.main.head,{y:"start",yMargin:startPos.top-scrollRect.top}):void 0});return true;}var cursorPageUp=function cursorPageUp(view){return cursorByPage(view,false);};var cursorPageDown=function cursorPageDown(view){return cursorByPage(view,true);};function moveByLineBoundary(view,start,forward){var line=view.lineBlockAt(start.head),moved=view.moveToLineBoundary(start,forward);if(moved.head==start.head&&moved.head!=(forward?line.to:line.from))moved=view.moveToLineBoundary(start,forward,false);if(!forward&&moved.head==line.from&&line.length){var space=/^\s*/.exec(view.state.sliceDoc(line.from,Math.min(line.from+100,line.to)))[0].length;if(space&&start.head!=line.from+space)moved=EditorSelection.cursor(line.from+space);}return moved;}var cursorLineBoundaryForward=function cursorLineBoundaryForward(view){return moveSel(view,function(range){return moveByLineBoundary(view,range,true);});};var cursorLineBoundaryBackward=function cursorLineBoundaryBackward(view){return moveSel(view,function(range){return moveByLineBoundary(view,range,false);});};var cursorLineStart=function cursorLineStart(view){return moveSel(view,function(range){return EditorSelection.cursor(view.lineBlockAt(range.head).from,1);});};var cursorLineEnd=function cursorLineEnd(view){return moveSel(view,function(range){return EditorSelection.cursor(view.lineBlockAt(range.head).to,-1);});};function toMatchingBracket(state,dispatch,extend2){var found=false,selection2=updateSel(state.selection,function(range){var matching=matchBrackets(state,range.head,-1)||matchBrackets(state,range.head,1)||range.head>0&&matchBrackets(state,range.head-1,1)||range.head<state.doc.length&&matchBrackets(state,range.head+1,-1);if(!matching||!matching.end)return range;found=true;var head=matching.start.from==range.head?matching.end.to:matching.end.from;return extend2?EditorSelection.range(range.anchor,head):EditorSelection.cursor(head);});if(!found)return false;dispatch(setSel(state,selection2));return true;}var cursorMatchingBracket=function cursorMatchingBracket(_ref57){var state=_ref57.state,dispatch=_ref57.dispatch;return toMatchingBracket(state,dispatch,false);};function extendSel(view,how){var selection2=updateSel(view.state.selection,function(range){var head=how(range);return EditorSelection.range(range.anchor,head.head,head.goalColumn);});if(selection2.eq(view.state.selection))return false;view.dispatch(setSel(view.state,selection2));return true;}function selectByChar(view,forward){return extendSel(view,function(range){return view.moveByChar(range,forward);});}var selectCharLeft=function selectCharLeft(view){return selectByChar(view,view.textDirection!=Direction4.LTR);};var selectCharRight=function selectCharRight(view){return selectByChar(view,view.textDirection==Direction4.LTR);};function selectByGroup(view,forward){return extendSel(view,function(range){return view.moveByGroup(range,forward);});}var selectGroupLeft=function selectGroupLeft(view){return selectByGroup(view,view.textDirection!=Direction4.LTR);};var selectGroupRight=function selectGroupRight(view){return selectByGroup(view,view.textDirection==Direction4.LTR);};var selectSyntaxLeft=function selectSyntaxLeft(view){return extendSel(view,function(range){return moveBySyntax(view.state,range,view.textDirection!=Direction4.LTR);});};var selectSyntaxRight=function selectSyntaxRight(view){return extendSel(view,function(range){return moveBySyntax(view.state,range,view.textDirection==Direction4.LTR);});};function selectByLine(view,forward){return extendSel(view,function(range){return view.moveVertically(range,forward);});}var selectLineUp=function selectLineUp(view){return selectByLine(view,false);};var selectLineDown=function selectLineDown(view){return selectByLine(view,true);};function selectByPage(view,forward){return extendSel(view,function(range){return view.moveVertically(range,forward,view.dom.clientHeight);});}var selectPageUp=function selectPageUp(view){return selectByPage(view,false);};var selectPageDown=function selectPageDown(view){return selectByPage(view,true);};var selectLineBoundaryForward=function selectLineBoundaryForward(view){return extendSel(view,function(range){return moveByLineBoundary(view,range,true);});};var selectLineBoundaryBackward=function selectLineBoundaryBackward(view){return extendSel(view,function(range){return moveByLineBoundary(view,range,false);});};var selectLineStart=function selectLineStart(view){return extendSel(view,function(range){return EditorSelection.cursor(view.lineBlockAt(range.head).from);});};var selectLineEnd=function selectLineEnd(view){return extendSel(view,function(range){return EditorSelection.cursor(view.lineBlockAt(range.head).to);});};var cursorDocStart=function cursorDocStart(_ref58){var state=_ref58.state,dispatch=_ref58.dispatch;dispatch(setSel(state,{anchor:0}));return true;};var cursorDocEnd=function cursorDocEnd(_ref59){var state=_ref59.state,dispatch=_ref59.dispatch;dispatch(setSel(state,{anchor:state.doc.length}));return true;};var selectDocStart=function selectDocStart(_ref60){var state=_ref60.state,dispatch=_ref60.dispatch;dispatch(setSel(state,{anchor:state.selection.main.anchor,head:0}));return true;};var selectDocEnd=function selectDocEnd(_ref61){var state=_ref61.state,dispatch=_ref61.dispatch;dispatch(setSel(state,{anchor:state.selection.main.anchor,head:state.doc.length}));return true;};var selectAll=function selectAll(_ref62){var state=_ref62.state,dispatch=_ref62.dispatch;dispatch(state.update({selection:{anchor:0,head:state.doc.length},userEvent:"select"}));return true;};var selectLine=function selectLine(_ref63){var state=_ref63.state,dispatch=_ref63.dispatch;var ranges=selectedLineBlocks(state).map(function(_ref64){var from=_ref64.from,to=_ref64.to;return EditorSelection.range(from,Math.min(to+1,state.doc.length));});dispatch(state.update({selection:EditorSelection.create(ranges),userEvent:"select"}));return true;};var selectParentSyntax=function selectParentSyntax(_ref65){var state=_ref65.state,dispatch=_ref65.dispatch;var selection2=updateSel(state.selection,function(range){var _a;var context=syntaxTree(state).resolveInner(range.head,1);while(!(context.from<range.from&&context.to>=range.to||context.to>range.to&&context.from<=range.from||!((_a=context.parent)===null||_a===void 0?void 0:_a.parent))){context=context.parent;}return EditorSelection.range(context.to,context.from);});dispatch(setSel(state,selection2));return true;};var simplifySelection=function simplifySelection(_ref66){var state=_ref66.state,dispatch=_ref66.dispatch;var cur2=state.selection,selection2=null;if(cur2.ranges.length>1)selection2=EditorSelection.create([cur2.main]);else if(!cur2.main.empty)selection2=EditorSelection.create([EditorSelection.cursor(cur2.main.head)]);if(!selection2)return false;dispatch(setSel(state,selection2));return true;};function deleteBy(_ref67,by){var state=_ref67.state,dispatch=_ref67.dispatch;if(state.readOnly)return false;var event="delete.selection";var changes=state.changeByRange(function(range){var from=range.from,to=range.to;if(from==to){var towards=by(from);if(towards<from)event="delete.backward";else if(towards>from)event="delete.forward";from=Math.min(from,towards);to=Math.max(to,towards);}return from==to?{range:range}:{changes:{from:from,to:to},range:EditorSelection.cursor(from)};});if(changes.changes.empty)return false;dispatch(state.update(changes,{scrollIntoView:true,userEvent:event}));return true;}function skipAtomic(target,pos,forward){if(target instanceof EditorView4){var _iterator291=_createForOfIteratorHelper(target.pluginField(PluginField4.atomicRanges)),_step291;try{for(_iterator291.s();!(_step291=_iterator291.n()).done;){var ranges=_step291.value;ranges.between(pos,pos,function(from,to){if(from<pos&&to>pos)pos=forward?to:from;});}}catch(err){_iterator291.e(err);}finally{_iterator291.f();}}return pos;}var deleteByChar=function deleteByChar(target,forward){return deleteBy(target,function(pos){var state=target.state,line=state.doc.lineAt(pos),before,targetPos;if(!forward&&pos>line.from&&pos<line.from+200&&!/[^ \t]/.test(before=line.text.slice(0,pos-line.from))){if(before[before.length-1]=="	")return pos-1;var col=_countColumn(before,state.tabSize),drop=col%getIndentUnit(state)||getIndentUnit(state);for(var _i243=0;_i243<drop&&before[before.length-1-_i243]==" ";_i243++){pos--;}targetPos=pos;}else{targetPos=findClusterBreak(line.text,pos-line.from,forward,forward)+line.from;if(targetPos==pos&&line.number!=(forward?state.doc.lines:1))targetPos+=forward?1:-1;}return skipAtomic(target,targetPos,forward);});};var deleteCharBackward=function deleteCharBackward(view){return deleteByChar(view,false);};var deleteCharForward=function deleteCharForward(view){return deleteByChar(view,true);};var deleteByGroup=function deleteByGroup(target,forward){return deleteBy(target,function(start){var pos=start,state=target.state,line=state.doc.lineAt(pos);var categorize=state.charCategorizer(pos);for(var cat=null;;){if(pos==(forward?line.to:line.from)){if(pos==start&&line.number!=(forward?state.doc.lines:1))pos+=forward?1:-1;break;}var next=findClusterBreak(line.text,pos-line.from,forward)+line.from;var nextChar2=line.text.slice(Math.min(pos,next)-line.from,Math.max(pos,next)-line.from);var nextCat=categorize(nextChar2);if(cat!=null&&nextCat!=cat)break;if(nextChar2!=" "||pos!=start)cat=nextCat;pos=next;}return skipAtomic(target,pos,forward);});};var deleteGroupBackward=function deleteGroupBackward(target){return deleteByGroup(target,false);};var deleteGroupForward=function deleteGroupForward(target){return deleteByGroup(target,true);};var deleteToLineEnd=function deleteToLineEnd(view){return deleteBy(view,function(pos){var lineEnd=view.lineBlockAt(pos).to;return skipAtomic(view,pos<lineEnd?lineEnd:Math.min(view.state.doc.length,pos+1),true);});};var deleteToLineStart=function deleteToLineStart(view){return deleteBy(view,function(pos){var lineStart=view.lineBlockAt(pos).from;return skipAtomic(view,pos>lineStart?lineStart:Math.max(0,pos-1),false);});};var splitLine=function splitLine(_ref68){var state=_ref68.state,dispatch=_ref68.dispatch;if(state.readOnly)return false;var changes=state.changeByRange(function(range){return{changes:{from:range.from,to:range.to,insert:Text.of(["",""])},range:EditorSelection.cursor(range.from)};});dispatch(state.update(changes,{scrollIntoView:true,userEvent:"input"}));return true;};var transposeChars=function transposeChars(_ref69){var state=_ref69.state,dispatch=_ref69.dispatch;if(state.readOnly)return false;var changes=state.changeByRange(function(range){if(!range.empty||range.from==0||range.from==state.doc.length)return{range:range};var pos=range.from,line=state.doc.lineAt(pos);var from=pos==line.from?pos-1:findClusterBreak(line.text,pos-line.from,false)+line.from;var to=pos==line.to?pos+1:findClusterBreak(line.text,pos-line.from,true)+line.from;return{changes:{from:from,to:to,insert:state.doc.slice(pos,to).append(state.doc.slice(from,pos))},range:EditorSelection.cursor(to)};});if(changes.changes.empty)return false;dispatch(state.update(changes,{scrollIntoView:true,userEvent:"move.character"}));return true;};function selectedLineBlocks(state){var blocks=[],upto=-1;var _iterator292=_createForOfIteratorHelper(state.selection.ranges),_step292;try{for(_iterator292.s();!(_step292=_iterator292.n()).done;){var range=_step292.value;var startLine=state.doc.lineAt(range.from),endLine=state.doc.lineAt(range.to);if(!range.empty&&range.to==endLine.from)endLine=state.doc.lineAt(range.to-1);if(upto>=startLine.number){var prev=blocks[blocks.length-1];prev.to=endLine.to;prev.ranges.push(range);}else{blocks.push({from:startLine.from,to:endLine.to,ranges:[range]});}upto=endLine.number+1;}}catch(err){_iterator292.e(err);}finally{_iterator292.f();}return blocks;}function moveLine(state,dispatch,forward){if(state.readOnly)return false;var changes=[],ranges=[];var _iterator293=_createForOfIteratorHelper(selectedLineBlocks(state)),_step293;try{for(_iterator293.s();!(_step293=_iterator293.n()).done;){var block=_step293.value;if(forward?block.to==state.doc.length:block.from==0)continue;var nextLine=state.doc.lineAt(forward?block.to+1:block.from-1);var size=nextLine.length+1;if(forward){changes.push({from:block.to,to:nextLine.to},{from:block.from,insert:nextLine.text+state.lineBreak});var _iterator294=_createForOfIteratorHelper(block.ranges),_step294;try{for(_iterator294.s();!(_step294=_iterator294.n()).done;){var _r16=_step294.value;ranges.push(EditorSelection.range(Math.min(state.doc.length,_r16.anchor+size),Math.min(state.doc.length,_r16.head+size)));}}catch(err){_iterator294.e(err);}finally{_iterator294.f();}}else{changes.push({from:nextLine.from,to:block.from},{from:block.to,insert:state.lineBreak+nextLine.text});var _iterator295=_createForOfIteratorHelper(block.ranges),_step295;try{for(_iterator295.s();!(_step295=_iterator295.n()).done;){var _r17=_step295.value;ranges.push(EditorSelection.range(_r17.anchor-size,_r17.head-size));}}catch(err){_iterator295.e(err);}finally{_iterator295.f();}}}}catch(err){_iterator293.e(err);}finally{_iterator293.f();}if(!changes.length)return false;dispatch(state.update({changes:changes,scrollIntoView:true,selection:EditorSelection.create(ranges,state.selection.mainIndex),userEvent:"move.line"}));return true;}var moveLineUp=function moveLineUp(_ref70){var state=_ref70.state,dispatch=_ref70.dispatch;return moveLine(state,dispatch,false);};var moveLineDown=function moveLineDown(_ref71){var state=_ref71.state,dispatch=_ref71.dispatch;return moveLine(state,dispatch,true);};function copyLine(state,dispatch,forward){if(state.readOnly)return false;var changes=[];var _iterator296=_createForOfIteratorHelper(selectedLineBlocks(state)),_step296;try{for(_iterator296.s();!(_step296=_iterator296.n()).done;){var block=_step296.value;if(forward)changes.push({from:block.from,insert:state.doc.slice(block.from,block.to)+state.lineBreak});else changes.push({from:block.to,insert:state.lineBreak+state.doc.slice(block.from,block.to)});}}catch(err){_iterator296.e(err);}finally{_iterator296.f();}dispatch(state.update({changes:changes,scrollIntoView:true,userEvent:"input.copyline"}));return true;}var copyLineUp=function copyLineUp(_ref72){var state=_ref72.state,dispatch=_ref72.dispatch;return copyLine(state,dispatch,false);};var copyLineDown=function copyLineDown(_ref73){var state=_ref73.state,dispatch=_ref73.dispatch;return copyLine(state,dispatch,true);};var deleteLine=function deleteLine(view){if(view.state.readOnly)return false;var state=view.state,changes=state.changes(selectedLineBlocks(state).map(function(_ref74){var from=_ref74.from,to=_ref74.to;if(from>0)from--;else if(to<state.doc.length)to++;return{from:from,to:to};}));var selection2=updateSel(state.selection,function(range){return view.moveVertically(range,true);}).map(changes);view.dispatch({changes:changes,selection:selection2,scrollIntoView:true,userEvent:"delete.line"});return true;};function isBetweenBrackets(state,pos){if(/\(\)|\[\]|\{\}/.test(state.sliceDoc(pos-1,pos+1)))return{from:pos,to:pos};var context=syntaxTree(state).resolveInner(pos);var before=context.childBefore(pos),after=context.childAfter(pos),closedBy;if(before&&after&&before.to<=pos&&after.from>=pos&&(closedBy=before.type.prop(NodeProp.closedBy))&&closedBy.indexOf(after.name)>-1&&state.doc.lineAt(before.to).from==state.doc.lineAt(after.from).from)return{from:before.to,to:after.from};return null;}var insertNewlineAndIndent=/* @__PURE__ */newlineAndIndent(false);var insertBlankLine=/* @__PURE__ */newlineAndIndent(true);function newlineAndIndent(atEof){return function(_ref75){var state=_ref75.state,dispatch=_ref75.dispatch;if(state.readOnly)return false;var changes=state.changeByRange(function(range){var from=range.from,to=range.to,line=state.doc.lineAt(from);var explode=!atEof&&from==to&&isBetweenBrackets(state,from);if(atEof)from=to=(to<=line.to?line:state.doc.lineAt(to)).to;var cx=new IndentContext(state,{simulateBreak:from,simulateDoubleBreak:!!explode});var indent=getIndentation(cx,from);if(indent==null)indent=/^\s*/.exec(state.doc.lineAt(from).text)[0].length;while(to<line.to&&/\s/.test(line.text[to-line.from])){to++;}if(explode){from=explode.from;to=explode.to;}else if(from>line.from&&from<line.from+100&&!/\S/.test(line.text.slice(0,from)))from=line.from;var insert2=["",indentString(state,indent)];if(explode)insert2.push(indentString(state,cx.lineIndent(line.from,-1)));return{changes:{from:from,to:to,insert:Text.of(insert2)},range:EditorSelection.cursor(from+1+insert2[1].length)};});dispatch(state.update(changes,{scrollIntoView:true,userEvent:"input"}));return true;};}function changeBySelectedLine(state,f){var atLine=-1;return state.changeByRange(function(range){var changes=[];for(var pos=range.from;pos<=range.to;){var line=state.doc.lineAt(pos);if(line.number>atLine&&(range.empty||range.to>line.from)){f(line,changes,range);atLine=line.number;}pos=line.to+1;}var changeSet=state.changes(changes);return{changes:changes,range:EditorSelection.range(changeSet.mapPos(range.anchor,1),changeSet.mapPos(range.head,1))};});}var indentSelection=function indentSelection(_ref76){var state=_ref76.state,dispatch=_ref76.dispatch;if(state.readOnly)return false;var updated=/* @__PURE__ */Object.create(null);var context=new IndentContext(state,{overrideIndentation:function overrideIndentation(start){var found=updated[start];return found==null?-1:found;}});var changes=changeBySelectedLine(state,function(line,changes2,range){var indent=getIndentation(context,line.from);if(indent==null)return;if(!/\S/.test(line.text))indent=0;var cur2=/^\s*/.exec(line.text)[0];var norm=indentString(state,indent);if(cur2!=norm||range.from<line.from+cur2.length){updated[line.from]=indent;changes2.push({from:line.from,to:line.from+cur2.length,insert:norm});}});if(!changes.changes.empty)dispatch(state.update(changes,{userEvent:"indent"}));return true;};var indentMore=function indentMore(_ref77){var state=_ref77.state,dispatch=_ref77.dispatch;if(state.readOnly)return false;dispatch(state.update(changeBySelectedLine(state,function(line,changes){changes.push({from:line.from,insert:state.facet(indentUnit)});}),{userEvent:"input.indent"}));return true;};var indentLess=function indentLess(_ref78){var state=_ref78.state,dispatch=_ref78.dispatch;if(state.readOnly)return false;dispatch(state.update(changeBySelectedLine(state,function(line,changes){var space=/^\s*/.exec(line.text)[0];if(!space)return;var col=_countColumn(space,state.tabSize),keep=0;var insert2=indentString(state,Math.max(0,col-getIndentUnit(state)));while(keep<space.length&&keep<insert2.length&&space.charCodeAt(keep)==insert2.charCodeAt(keep)){keep++;}changes.push({from:line.from+keep,to:line.from+space.length,insert:insert2.slice(keep)});}),{userEvent:"delete.dedent"}));return true;};var emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:true},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}];var standardKeymap=/* @__PURE__ */[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:true},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:true},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:true},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:true},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteToLineStart},{mac:"Mod-Delete",run:deleteToLineEnd}].concat(/* @__PURE__ */emacsStyleKeymap.map(function(b){return{mac:b.key,run:b.run,shift:b.shift};}));var defaultKeymap=/* @__PURE__ */[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:true},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket}].concat(standardKeymap);// ../node_modules/@codemirror/closebrackets/dist/index.js
var defaults2={brackets:["(","[","{","'",'"'],before:")]}'\":;>"};var closeBracketEffect=/* @__PURE__ */StateEffect.define({map:function map(value,mapping){var mapped=mapping.mapPos(value,-1,MapMode.TrackAfter);return mapped==null?void 0:mapped;}});var skipBracketEffect=/* @__PURE__ */StateEffect.define({map:function map(value,mapping){return mapping.mapPos(value);}});var closedBracket=/* @__PURE__ */new(/*#__PURE__*/function(_RangeValue6){_inherits(_class9,_RangeValue6);var _super94=_createSuper(_class9);function _class9(){_classCallCheck(this,_class9);return _super94.apply(this,arguments);}return _createClass(_class9);}(RangeValue))();closedBracket.startSide=1;closedBracket.endSide=-1;var bracketState=/* @__PURE__ */StateField.define({create:function create(){return RangeSet.empty;},update:function update(value,tr){if(tr.selection){var lineStart=tr.state.doc.lineAt(tr.selection.main.head).from;var prevLineStart=tr.startState.doc.lineAt(tr.startState.selection.main.head).from;if(lineStart!=tr.changes.mapPos(prevLineStart,-1))value=RangeSet.empty;}value=value.map(tr.changes);var _iterator297=_createForOfIteratorHelper(tr.effects),_step297;try{var _loop33=function _loop33(){var effect=_step297.value;if(effect.is(closeBracketEffect))value=value.update({add:[closedBracket.range(effect.value,effect.value+1)]});else if(effect.is(skipBracketEffect))value=value.update({filter:function filter(from){return from!=effect.value;}});};for(_iterator297.s();!(_step297=_iterator297.n()).done;){_loop33();}}catch(err){_iterator297.e(err);}finally{_iterator297.f();}return value;}});function closeBrackets(){return[EditorView.inputHandler.of(handleInput),bracketState];}var definedClosing="()[]{}<>";function closing(ch){for(var _i244=0;_i244<definedClosing.length;_i244+=2){if(definedClosing.charCodeAt(_i244)==ch)return definedClosing.charAt(_i244+1);}return fromCodePoint(ch<128?ch:ch+1);}function config(state,pos){return state.languageDataAt("closeBrackets",pos)[0]||defaults2;}function handleInput(view,from,to,insert2){if(view.composing)return false;var sel=view.state.selection.main;if(insert2.length>2||insert2.length==2&&codePointSize(codePointAt(insert2,0))==1||from!=sel.from||to!=sel.to)return false;var tr=insertBracket(view.state,insert2);if(!tr)return false;view.dispatch(tr);return true;}var deleteBracketPair=function deleteBracketPair(_ref79){var state=_ref79.state,dispatch=_ref79.dispatch;var conf=config(state,state.selection.main.head);var tokens=conf.brackets||defaults2.brackets;var dont=null,changes=state.changeByRange(function(range){if(range.empty){var before=prevChar(state.doc,range.head);var _iterator298=_createForOfIteratorHelper(tokens),_step298;try{for(_iterator298.s();!(_step298=_iterator298.n()).done;){var token=_step298.value;if(token==before&&nextChar(state.doc,range.head)==closing(codePointAt(token,0)))return{changes:{from:range.head-token.length,to:range.head+token.length},range:EditorSelection.cursor(range.head-token.length),userEvent:"delete.backward"};}}catch(err){_iterator298.e(err);}finally{_iterator298.f();}}return{range:dont=range};});if(!dont)dispatch(state.update(changes,{scrollIntoView:true}));return!dont;};var closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(state,bracket2){var conf=config(state,state.selection.main.head);var tokens=conf.brackets||defaults2.brackets;var _iterator299=_createForOfIteratorHelper(tokens),_step299;try{for(_iterator299.s();!(_step299=_iterator299.n()).done;){var tok=_step299.value;var closed=closing(codePointAt(tok,0));if(bracket2==tok)return closed==tok?handleSame(state,tok,tokens.indexOf(tok+tok+tok)>-1):handleOpen(state,tok,closed,conf.before||defaults2.before);if(bracket2==closed&&closedBracketAt(state,state.selection.main.from))return handleClose(state,tok,closed);}}catch(err){_iterator299.e(err);}finally{_iterator299.f();}return null;}function closedBracketAt(state,pos){var found=false;state.field(bracketState).between(0,state.doc.length,function(from){if(from==pos)found=true;});return found;}function nextChar(doc6,pos){var next=doc6.sliceString(pos,pos+2);return next.slice(0,codePointSize(codePointAt(next,0)));}function prevChar(doc6,pos){var prev=doc6.sliceString(pos-2,pos);return codePointSize(codePointAt(prev,0))==prev.length?prev:prev.slice(1);}function handleOpen(state,open,close,closeBefore){var dont=null,changes=state.changeByRange(function(range){if(!range.empty)return{changes:[{insert:open,from:range.from},{insert:close,from:range.to}],effects:closeBracketEffect.of(range.to+open.length),range:EditorSelection.range(range.anchor+open.length,range.head+open.length)};var next=nextChar(state.doc,range.head);if(!next||/\s/.test(next)||closeBefore.indexOf(next)>-1)return{changes:{insert:open+close,from:range.head},effects:closeBracketEffect.of(range.head+open.length),range:EditorSelection.cursor(range.head+open.length)};return{range:dont=range};});return dont?null:state.update(changes,{scrollIntoView:true,userEvent:"input.type"});}function handleClose(state,_open,close){var dont=null,moved=state.selection.ranges.map(function(range){if(range.empty&&nextChar(state.doc,range.head)==close)return EditorSelection.cursor(range.head+close.length);return dont=range;});return dont?null:state.update({selection:EditorSelection.create(moved,state.selection.mainIndex),scrollIntoView:true,effects:state.selection.ranges.map(function(_ref80){var from=_ref80.from;return skipBracketEffect.of(from);})});}function handleSame(state,token,allowTriple){var dont=null,changes=state.changeByRange(function(range){if(!range.empty)return{changes:[{insert:token,from:range.from},{insert:token,from:range.to}],effects:closeBracketEffect.of(range.to+token.length),range:EditorSelection.range(range.anchor+token.length,range.head+token.length)};var pos=range.head,next=nextChar(state.doc,pos);if(next==token){if(nodeStart(state,pos)){return{changes:{insert:token+token,from:pos},effects:closeBracketEffect.of(pos+token.length),range:EditorSelection.cursor(pos+token.length)};}else if(closedBracketAt(state,pos)){var isTriple=allowTriple&&state.sliceDoc(pos,pos+token.length*3)==token+token+token;return{range:EditorSelection.cursor(pos+token.length*(isTriple?3:1)),effects:skipBracketEffect.of(pos)};}}else if(allowTriple&&state.sliceDoc(pos-2*token.length,pos)==token+token&&nodeStart(state,pos-2*token.length)){return{changes:{insert:token+token+token+token,from:pos},effects:closeBracketEffect.of(pos+token.length),range:EditorSelection.cursor(pos+token.length)};}else if(state.charCategorizer(pos)(next)!=CharCategory.Word){var prev=state.sliceDoc(pos-1,pos);if(prev!=token&&state.charCategorizer(pos)(prev)!=CharCategory.Word)return{changes:{insert:token+token,from:pos},effects:closeBracketEffect.of(pos+token.length),range:EditorSelection.cursor(pos+token.length)};}return{range:dont=range};});return dont?null:state.update(changes,{scrollIntoView:true,userEvent:"input.type"});}function nodeStart(state,pos){var tree=syntaxTree(state).resolveInner(pos+1);return tree.parent&&tree.from==pos;}// ../node_modules/@codemirror/search/node_modules/@codemirror/view/dist/index.js
function getSelection5(root){var target;if(root.nodeType==11){target=root.getSelection?root:root.ownerDocument;}else{target=root;}return target.getSelection();}function contains5(dom,node){return node?dom.contains(node.nodeType!=1?node.parentNode:node):false;}function deepActiveElement5(){var elt=document.activeElement;while(elt&&elt.shadowRoot){elt=elt.shadowRoot.activeElement;}return elt;}function hasSelection5(dom,selection2){if(!selection2.anchorNode)return false;try{return contains5(dom,selection2.anchorNode);}catch(_){return false;}}function clientRectsFor5(dom){if(dom.nodeType==3)return textRange5(dom,0,dom.nodeValue.length).getClientRects();else if(dom.nodeType==1)return dom.getClientRects();else return[];}function isEquivalentPosition5(node,off,targetNode,targetOff){return targetNode?scanFor5(node,off,targetNode,targetOff,-1)||scanFor5(node,off,targetNode,targetOff,1):false;}function domIndex5(node){for(var index=0;;index++){node=node.previousSibling;if(!node)return index;}}function scanFor5(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return true;if(off==(dir<0?0:maxOffset5(node))){if(node.nodeName=="DIV")return false;var parent=node.parentNode;if(!parent||parent.nodeType!=1)return false;off=domIndex5(node)+(dir<0?0:1);node=parent;}else if(node.nodeType==1){node=node.childNodes[off+(dir<0?-1:0)];if(node.nodeType==1&&node.contentEditable=="false")return false;off=dir<0?maxOffset5(node):0;}else{return false;}}}function maxOffset5(node){return node.nodeType==3?node.nodeValue.length:node.childNodes.length;}var Rect05={left:0,right:0,top:0,bottom:0};function flattenRect5(rect,left){var x=left?rect.left:rect.right;return{left:x,right:x,top:rect.top,bottom:rect.bottom};}function windowRect5(win){return{left:0,right:win.innerWidth,top:0,bottom:win.innerHeight};}function scrollRectIntoView5(dom,rect,side,x,y,xMargin,yMargin,ltr){var doc6=dom.ownerDocument,win=doc6.defaultView;for(var cur2=dom;cur2;){if(cur2.nodeType==1){var bounding=void 0,top2=cur2==doc6.body;if(top2){bounding=windowRect5(win);}else{if(cur2.scrollHeight<=cur2.clientHeight&&cur2.scrollWidth<=cur2.clientWidth){cur2=cur2.parentNode;continue;}var rect2=cur2.getBoundingClientRect();bounding={left:rect2.left,right:rect2.left+cur2.clientWidth,top:rect2.top,bottom:rect2.top+cur2.clientHeight};}var moveX=0,moveY=0;if(y=="nearest"){if(rect.top<bounding.top){moveY=-(bounding.top-rect.top+yMargin);if(side>0&&rect.bottom>bounding.bottom+moveY)moveY=rect.bottom-bounding.bottom+moveY+yMargin;}else if(rect.bottom>bounding.bottom){moveY=rect.bottom-bounding.bottom+yMargin;if(side<0&&rect.top-moveY<bounding.top)moveY=-(bounding.top+moveY-rect.top+yMargin);}}else{var rectHeight=rect.bottom-rect.top,boundingHeight=bounding.bottom-bounding.top;var targetTop=y=="center"&&rectHeight<=boundingHeight?rect.top+rectHeight/2-boundingHeight/2:y=="start"||y=="center"&&side<0?rect.top-yMargin:rect.bottom-boundingHeight+yMargin;moveY=targetTop-bounding.top;}if(x=="nearest"){if(rect.left<bounding.left){moveX=-(bounding.left-rect.left+xMargin);if(side>0&&rect.right>bounding.right+moveX)moveX=rect.right-bounding.right+moveX+xMargin;}else if(rect.right>bounding.right){moveX=rect.right-bounding.right+xMargin;if(side<0&&rect.left<bounding.left+moveX)moveX=-(bounding.left+moveX-rect.left+xMargin);}}else{var targetLeft=x=="center"?rect.left+(rect.right-rect.left)/2-(bounding.right-bounding.left)/2:x=="start"==ltr?rect.left-xMargin:rect.right-(bounding.right-bounding.left)+xMargin;moveX=targetLeft-bounding.left;}if(moveX||moveY){if(top2){win.scrollBy(moveX,moveY);}else{if(moveY){var start=cur2.scrollTop;cur2.scrollTop+=moveY;moveY=cur2.scrollTop-start;}if(moveX){var _start11=cur2.scrollLeft;cur2.scrollLeft+=moveX;moveX=cur2.scrollLeft-_start11;}rect={left:rect.left-moveX,top:rect.top-moveY,right:rect.right-moveX,bottom:rect.bottom-moveY};}}if(top2)break;cur2=cur2.assignedSlot||cur2.parentNode;x=y="nearest";}else if(cur2.nodeType==11){cur2=cur2.host;}else{break;}}}var DOMSelectionState4=/*#__PURE__*/function(){function DOMSelectionState4(){_classCallCheck(this,DOMSelectionState4);this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0;}_createClass(DOMSelectionState4,[{key:"eq",value:function eq(domSel){return this.anchorNode==domSel.anchorNode&&this.anchorOffset==domSel.anchorOffset&&this.focusNode==domSel.focusNode&&this.focusOffset==domSel.focusOffset;}},{key:"setRange",value:function setRange(range){this.set(range.anchorNode,range.anchorOffset,range.focusNode,range.focusOffset);}},{key:"set",value:function set(anchorNode,anchorOffset,focusNode,focusOffset){this.anchorNode=anchorNode;this.anchorOffset=anchorOffset;this.focusNode=focusNode;this.focusOffset=focusOffset;}}]);return DOMSelectionState4;}();var preventScrollSupported5=null;function focusPreventScroll5(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported5)return dom.focus(preventScrollSupported5);var stack=[];for(var cur2=dom;cur2;cur2=cur2.parentNode){stack.push(cur2,cur2.scrollTop,cur2.scrollLeft);if(cur2==cur2.ownerDocument)break;}dom.focus(preventScrollSupported5==null?Object.defineProperties({},{preventScroll:{get:function get(){preventScrollSupported5={preventScroll:true};return true;},configurable:true,enumerable:true}}):void 0);if(!preventScrollSupported5){preventScrollSupported5=false;for(var _i245=0;_i245<stack.length;){var elt=stack[_i245++],top2=stack[_i245++],left=stack[_i245++];if(elt.scrollTop!=top2)elt.scrollTop=top2;if(elt.scrollLeft!=left)elt.scrollLeft=left;}}}var scratchRange5;function textRange5(node,from){var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:from;var range=scratchRange5||(scratchRange5=document.createRange());range.setEnd(node,to);range.setStart(node,from);return range;}function dispatchKey5(elt,name2,code){var options={key:name2,code:name2,keyCode:code,which:code,cancelable:true};var down=new KeyboardEvent("keydown",options);down.synthetic=true;elt.dispatchEvent(down);var up=new KeyboardEvent("keyup",options);up.synthetic=true;elt.dispatchEvent(up);return down.defaultPrevented||up.defaultPrevented;}function getRoot5(node){while(node){if(node&&(node.nodeType==9||node.nodeType==11&&node.host))return node;node=node.assignedSlot||node.parentNode;}return null;}function clearAttributes4(node){while(node.attributes.length){node.removeAttributeNode(node.attributes[0]);}}var DOMPos5=/*#__PURE__*/function(){function DOMPos5(node,offset){var precise=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_classCallCheck(this,DOMPos5);this.node=node;this.offset=offset;this.precise=precise;}_createClass(DOMPos5,null,[{key:"before",value:function before(dom,precise){return new DOMPos5(dom.parentNode,domIndex5(dom),precise);}},{key:"after",value:function after(dom,precise){return new DOMPos5(dom.parentNode,domIndex5(dom)+1,precise);}}]);return DOMPos5;}();var noChildren4=[];var ContentView5=/*#__PURE__*/function(){function ContentView5(){_classCallCheck(this,ContentView5);this.parent=null;this.dom=null;this.dirty=2;}_createClass(ContentView5,[{key:"editorView",get:function get(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"posAtStart",get:function get(){return this.parent?this.parent.posBefore(this):0;}},{key:"posAtEnd",get:function get(){return this.posAtStart+this.length;}},{key:"posBefore",value:function posBefore(view){var pos=this.posAtStart;var _iterator300=_createForOfIteratorHelper(this.children),_step300;try{for(_iterator300.s();!(_step300=_iterator300.n()).done;){var child=_step300.value;if(child==view)return pos;pos+=child.length+child.breakAfter;}}catch(err){_iterator300.e(err);}finally{_iterator300.f();}throw new RangeError("Invalid child in posBefore");}},{key:"posAfter",value:function posAfter(view){return this.posBefore(view)+view.length;}},{key:"coordsAt",value:function coordsAt(_pos,_side){return null;}},{key:"sync",value:function sync(track){if(this.dirty&2){var parent=this.dom;var pos=parent.firstChild;var _iterator301=_createForOfIteratorHelper(this.children),_step301;try{for(_iterator301.s();!(_step301=_iterator301.n()).done;){var child=_step301.value;if(child.dirty){if(!child.dom&&pos){var contentView=ContentView5.get(pos);if(!contentView||!contentView.parent&&contentView.constructor==child.constructor)child.reuseDOM(pos);}child.sync(track);child.dirty=0;}if(track&&!track.written&&track.node==parent&&pos!=child.dom)track.written=true;if(child.dom.parentNode==parent){while(pos&&pos!=child.dom){pos=rm5(pos);}pos=child.dom.nextSibling;}else{parent.insertBefore(child.dom,pos);}}}catch(err){_iterator301.e(err);}finally{_iterator301.f();}if(pos&&track&&track.node==parent)track.written=true;while(pos){pos=rm5(pos);}}else if(this.dirty&1){var _iterator302=_createForOfIteratorHelper(this.children),_step302;try{for(_iterator302.s();!(_step302=_iterator302.n()).done;){var _child5=_step302.value;if(_child5.dirty){_child5.sync(track);_child5.dirty=0;}}}catch(err){_iterator302.e(err);}finally{_iterator302.f();}}}},{key:"reuseDOM",value:function reuseDOM(_dom){}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){var after;if(node==this.dom){after=this.dom.childNodes[offset];}else{var bias=maxOffset5(node)==0?0:offset==0?-1:1;for(;;){var parent=node.parentNode;if(parent==this.dom)break;if(bias==0&&parent.firstChild!=parent.lastChild){if(node==parent.firstChild)bias=-1;else bias=1;}node=parent;}if(bias<0)after=node;else after=node.nextSibling;}if(after==this.dom.firstChild)return 0;while(after&&!ContentView5.get(after)){after=after.nextSibling;}if(!after)return this.length;for(var _i246=0,pos=0;;_i246++){var child=this.children[_i246];if(child.dom==after)return pos;pos+=child.length+child.breakAfter;}}},{key:"domBoundsAround",value:function domBoundsAround(from,to){var offset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var fromI=-1,fromStart=-1,toI=-1,toEnd=-1;for(var _i247=0,pos=offset,prevEnd=offset;_i247<this.children.length;_i247++){var child=this.children[_i247],end=pos+child.length;if(pos<from&&end>to)return child.domBoundsAround(from,to,pos);if(end>=from&&fromI==-1){fromI=_i247;fromStart=pos;}if(pos>to&&child.dom.parentNode==this.dom){toI=_i247;toEnd=prevEnd;break;}prevEnd=end;pos=end+child.breakAfter;}return{from:fromStart,to:toEnd<0?offset+this.length:toEnd,startDOM:(fromI?this.children[fromI-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:toI<this.children.length&&toI>=0?this.children[toI].dom:null};}},{key:"markDirty",value:function markDirty(){var andParent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.dirty|=2;this.markParentsDirty(andParent);}},{key:"markParentsDirty",value:function markParentsDirty(childList){for(var parent=this.parent;parent;parent=parent.parent){if(childList)parent.dirty|=2;if(parent.dirty&1)return;parent.dirty|=1;childList=false;}}},{key:"setParent",value:function setParent(parent){if(this.parent!=parent){this.parent=parent;if(this.dirty)this.markParentsDirty(true);}}},{key:"setDOM",value:function setDOM(dom){if(this.dom)this.dom.cmView=null;this.dom=dom;dom.cmView=this;}},{key:"rootView",get:function get(){for(var v=this;;){var parent=v.parent;if(!parent)return v;v=parent;}}},{key:"replaceChildren",value:function replaceChildren(from,to){var _this$children5;var children=arguments.length>2&&arguments[2]!==undefined?arguments[2]:noChildren4;this.markDirty();for(var _i248=from;_i248<to;_i248++){var child=this.children[_i248];if(child.parent==this)child.destroy();}(_this$children5=this.children).splice.apply(_this$children5,[from,to-from].concat(_toConsumableArray(children)));for(var _i249=0;_i249<children.length;_i249++){children[_i249].setParent(this);}}},{key:"ignoreMutation",value:function ignoreMutation(_rec){return false;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return false;}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;return new ChildCursor5(this.children,pos,this.children.length);}},{key:"childPos",value:function childPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;return this.childCursor().findPos(pos,bias);}},{key:"toString",value:function toString(){var name2=this.constructor.name.replace("View","");return name2+(this.children.length?"("+this.children.join()+")":this.length?"["+(name2=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"");}},{key:"isEditable",get:function get(){return true;}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){return false;}},{key:"become",value:function become(other){return false;}},{key:"getSide",value:function getSide(){return 0;}},{key:"destroy",value:function destroy(){this.parent=null;}}],[{key:"get",value:function get(node){return node.cmView;}}]);return ContentView5;}();ContentView5.prototype.breakAfter=0;function rm5(dom){var next=dom.nextSibling;dom.parentNode.removeChild(dom);return next;}var ChildCursor5=/*#__PURE__*/function(){function ChildCursor5(children,pos,i){_classCallCheck(this,ChildCursor5);this.children=children;this.pos=pos;this.i=i;this.off=0;}_createClass(ChildCursor5,[{key:"findPos",value:function findPos(pos){var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;for(;;){if(pos>this.pos||pos==this.pos&&(bias>0||this.i==0||this.children[this.i-1].breakAfter)){this.off=pos-this.pos;return this;}var next=this.children[--this.i];this.pos-=next.length+next.breakAfter;}}}]);return ChildCursor5;}();function replaceRange4(parent,fromI,fromOff,toI,toOff,insert2,breakAtStart,openStart,openEnd){var children=parent.children;var before=children.length?children[fromI]:null;var last=insert2.length?insert2[insert2.length-1]:null;var breakAtEnd=last?last.breakAfter:breakAtStart;if(fromI==toI&&before&&!breakAtStart&&!breakAtEnd&&insert2.length<2&&before.merge(fromOff,toOff,insert2.length?last:null,fromOff==0,openStart,openEnd))return;if(toI<children.length){var after=children[toI];if(after&&toOff<after.length){if(fromI==toI){after=after.split(toOff);toOff=0;}if(!breakAtEnd&&last&&after.merge(0,toOff,last,true,0,openEnd)){insert2[insert2.length-1]=after;}else{if(toOff)after.merge(0,toOff,null,false,0,openEnd);insert2.push(after);}}else if(after===null||after===void 0?void 0:after.breakAfter){if(last)last.breakAfter=1;else breakAtStart=1;}toI++;}if(before){before.breakAfter=breakAtStart;if(fromOff>0){if(!breakAtStart&&insert2.length&&before.merge(fromOff,before.length,insert2[0],false,openStart,0)){before.breakAfter=insert2.shift().breakAfter;}else if(fromOff<before.length||before.children.length&&before.children[before.children.length-1].length==0){before.merge(fromOff,before.length,null,false,openStart,0);}fromI++;}}while(fromI<toI&&insert2.length){if(children[toI-1].become(insert2[insert2.length-1])){toI--;insert2.pop();openEnd=insert2.length?0:openStart;}else if(children[fromI].become(insert2[0])){fromI++;insert2.shift();openStart=insert2.length?0:openEnd;}else{break;}}if(!insert2.length&&fromI&&toI<children.length&&!children[fromI-1].breakAfter&&children[toI].merge(0,0,children[fromI-1],false,openStart,openEnd))fromI--;if(fromI<toI||insert2.length)parent.replaceChildren(fromI,toI,insert2);}function mergeChildrenInto4(parent,from,to,insert2,openStart,openEnd){var cur2=parent.childCursor();var _cur2$findPos9=cur2.findPos(to,1),toI=_cur2$findPos9.i,toOff=_cur2$findPos9.off;var _cur2$findPos10=cur2.findPos(from,-1),fromI=_cur2$findPos10.i,fromOff=_cur2$findPos10.off;var dLen=from-to;var _iterator303=_createForOfIteratorHelper(insert2),_step303;try{for(_iterator303.s();!(_step303=_iterator303.n()).done;){var view=_step303.value;dLen+=view.length;}}catch(err){_iterator303.e(err);}finally{_iterator303.f();}parent.length+=dLen;replaceRange4(parent,fromI,fromOff,toI,toOff,insert2,0,openStart,openEnd);}var _ref81=typeof navigator!="undefined"?[navigator,document]:[{userAgent:"",vendor:"",platform:""},{documentElement:{style:{}}}],_ref82=_slicedToArray(_ref81,2),nav5=_ref82[0],doc5=_ref82[1];var ie_edge5=/* @__PURE__ */ /Edge\/(\d+)/.exec(nav5.userAgent);var ie_upto105=/* @__PURE__ */ /MSIE \d/.test(nav5.userAgent);var ie_11up5=/* @__PURE__ */ /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav5.userAgent);var ie6=!!(ie_upto105||ie_11up5||ie_edge5);var gecko6=!ie6&&/* @__PURE__ */ /gecko\/(\d+)/i.test(nav5.userAgent);var chrome6=!ie6&&/* @__PURE__ */ /Chrome\/(\d+)/.exec(nav5.userAgent);var webkit5=("webkitFontSmoothing"in doc5.documentElement.style);var safari6=!ie6&&/* @__PURE__ */ /Apple Computer/.test(nav5.vendor);var ios5=safari6&&(/* @__PURE__ */ /Mobile\/\w+/.test(nav5.userAgent)||nav5.maxTouchPoints>2);var browser5={mac:ios5||/* @__PURE__ */ /Mac/.test(nav5.platform),windows:/* @__PURE__ */ /Win/.test(nav5.platform),linux:/* @__PURE__ */ /Linux|X11/.test(nav5.platform),ie:ie6,ie_version:ie_upto105?doc5.documentMode||6:ie_11up5?+ie_11up5[1]:ie_edge5?+ie_edge5[1]:0,gecko:gecko6,gecko_version:gecko6?+(/* @__PURE__ */ /Firefox\/(\d+)/.exec(nav5.userAgent)||[0,0])[1]:0,chrome:!!chrome6,chrome_version:chrome6?+chrome6[1]:0,ios:ios5,android:/* @__PURE__ */ /Android\b/.test(nav5.userAgent),webkit:webkit5,safari:safari6,webkit_version:webkit5?+(/* @__PURE__ */ /\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc5.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var MaxJoinLen5=256;var TextView5=/*#__PURE__*/function(_ContentView26){_inherits(TextView5,_ContentView26);var _super95=_createSuper(TextView5);function TextView5(text){var _this178;_classCallCheck(this,TextView5);_this178=_super95.call(this);_this178.text=text;return _this178;}_createClass(TextView5,[{key:"length",get:function get(){return this.text.length;}},{key:"createDOM",value:function createDOM(textDOM){this.setDOM(textDOM||document.createTextNode(this.text));}},{key:"sync",value:function sync(track){if(!this.dom)this.createDOM();if(this.dom.nodeValue!=this.text){if(track&&track.node==this.dom)track.written=true;this.dom.nodeValue=this.text;}}},{key:"reuseDOM",value:function reuseDOM(dom){if(dom.nodeType==3)this.createDOM(dom);}},{key:"merge",value:function merge(from,to,source){if(source&&(!(source instanceof TextView5)||this.length-(to-from)+source.length>MaxJoinLen5))return false;this.text=this.text.slice(0,from)+(source?source.text:"")+this.text.slice(to);this.markDirty();return true;}},{key:"split",value:function split(from){var result=new TextView5(this.text.slice(from));this.text=this.text.slice(0,from);this.markDirty();return result;}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return node==this.dom?offset:offset?this.text.length:0;}},{key:"domAtPos",value:function domAtPos(pos){return new DOMPos5(this.dom,pos);}},{key:"domBoundsAround",value:function domBoundsAround(_from,_to,offset){return{from:offset,to:offset+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling};}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords5(this.dom,pos,side);}}]);return TextView5;}(ContentView5);var MarkView5=/*#__PURE__*/function(_ContentView27){_inherits(MarkView5,_ContentView27);var _super96=_createSuper(MarkView5);function MarkView5(mark){var _this179;var children=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];var length=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_classCallCheck(this,MarkView5);_this179=_super96.call(this);_this179.mark=mark;_this179.children=children;_this179.length=length;var _iterator304=_createForOfIteratorHelper(children),_step304;try{for(_iterator304.s();!(_step304=_iterator304.n()).done;){var ch=_step304.value;ch.setParent(_assertThisInitialized(_this179));}}catch(err){_iterator304.e(err);}finally{_iterator304.f();}return _this179;}_createClass(MarkView5,[{key:"setAttrs",value:function setAttrs(dom){clearAttributes4(dom);if(this.mark["class"])dom.className=this.mark["class"];if(this.mark.attrs)for(var name2 in this.mark.attrs){dom.setAttribute(name2,this.mark.attrs[name2]);}return dom;}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName==this.mark.tagName.toUpperCase()){this.setDOM(node);this.dirty|=4|2;}}},{key:"sync",value:function sync(track){if(!this.dom)this.setDOM(this.setAttrs(document.createElement(this.mark.tagName)));else if(this.dirty&4)this.setAttrs(this.dom);_get(_getPrototypeOf(MarkView5.prototype),"sync",this).call(this,track);}},{key:"merge",value:function merge(from,to,source,_hasStart,openStart,openEnd){if(source&&(!(source instanceof MarkView5&&source.mark.eq(this.mark))||from&&openStart<=0||to<this.length&&openEnd<=0))return false;mergeChildrenInto4(this,from,to,source?source.children:[],openStart-1,openEnd-1);this.markDirty();return true;}},{key:"split",value:function split(from){var result=[],off=0,detachFrom=-1,i=0;var _iterator305=_createForOfIteratorHelper(this.children),_step305;try{for(_iterator305.s();!(_step305=_iterator305.n()).done;){var elt=_step305.value;var end=off+elt.length;if(end>from)result.push(off<from?elt.split(from-off):elt);if(detachFrom<0&&off>=from)detachFrom=i;off=end;i++;}}catch(err){_iterator305.e(err);}finally{_iterator305.f();}var length=this.length-from;this.length=from;if(detachFrom>-1){this.children.length=detachFrom;this.markDirty();}return new MarkView5(this.mark,result,length);}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos5(this.dom,this.children,pos);}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren5(this,pos,side);}}]);return MarkView5;}(ContentView5);function textCoords5(text,pos,side){var length=text.nodeValue.length;if(pos>length)pos=length;var from=pos,to=pos,flatten2=0;if(pos==0&&side<0||pos==length&&side>=0){if(!(browser5.chrome||browser5.gecko)){if(pos){from--;flatten2=1;}else{to++;flatten2=-1;}}}else{if(side<0)from--;else to++;}var rects=textRange5(text,from,to).getClientRects();if(!rects.length)return Rect05;var rect=rects[(flatten2?flatten2<0:side>=0)?0:rects.length-1];if(browser5.safari&&!flatten2&&rect.width==0)rect=Array.prototype.find.call(rects,function(r){return r.width;})||rect;return flatten2?flattenRect5(rect,flatten2<0):rect||null;}var WidgetView5=/*#__PURE__*/function(_ContentView28){_inherits(WidgetView5,_ContentView28);var _super97=_createSuper(WidgetView5);function WidgetView5(widget,length,side){var _this180;_classCallCheck(this,WidgetView5);_this180=_super97.call(this);_this180.widget=widget;_this180.length=length;_this180.side=side;return _this180;}_createClass(WidgetView5,[{key:"split",value:function split(from){var result=WidgetView5.create(this.widget,this.length-from,this.side);this.length-=from;return result;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"getSide",value:function getSide(){return this.side;}},{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source&&(!(source instanceof WidgetView5)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"become",value:function become(other){if(other.length==this.length&&other instanceof WidgetView5&&other.side==this.side){if(this.widget.constructor==other.widget.constructor){if(!this.widget.eq(other.widget))this.markDirty(true);this.widget=other.widget;return true;}}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}},{key:"overrideDOMText",get:function get(){if(this.length==0)return Text.empty;var top2=this;while(top2.parent){top2=top2.parent;}var view=top2.editorView,text=view&&view.state.doc,start=this.posAtStart;return text?text.slice(start,start+this.length):Text.empty;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos5.before(this.dom):DOMPos5.after(this.dom,pos==this.length);}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){var rects=this.dom.getClientRects(),rect=null;if(!rects.length)return Rect05;for(var _i250=pos>0?rects.length-1:0;;_i250+=pos>0?-1:1){rect=rects[_i250];if(pos>0?_i250==0:_i250==rects.length-1||rect.top<rect.bottom)break;}return pos==0&&side>0||pos==this.length&&side<=0?rect:flattenRect5(rect,pos==0);}},{key:"isEditable",get:function get(){return false;}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(WidgetView5.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom);}}],[{key:"create",value:function create(widget,length,side){return new(widget.customView||WidgetView5)(widget,length,side);}}]);return WidgetView5;}(ContentView5);var CompositionView5=/*#__PURE__*/function(_WidgetView5){_inherits(CompositionView5,_WidgetView5);var _super98=_createSuper(CompositionView5);function CompositionView5(){_classCallCheck(this,CompositionView5);return _super98.apply(this,arguments);}_createClass(CompositionView5,[{key:"domAtPos",value:function domAtPos(pos){return new DOMPos5(this.widget.text,pos);}},{key:"sync",value:function sync(){this.setDOM(this.widget.toDOM());}},{key:"localPosFromDOM",value:function localPosFromDOM(node,offset){return!offset?0:node.nodeType==3?Math.min(offset,this.length):this.length;}},{key:"ignoreMutation",value:function ignoreMutation(){return false;}},{key:"overrideDOMText",get:function get(){return null;}},{key:"coordsAt",value:function coordsAt(pos,side){return textCoords5(this.widget.text,pos,side);}},{key:"isEditable",get:function get(){return true;}}]);return CompositionView5;}(WidgetView5);var ZeroWidthSpace4=browser5.android?"\u200B\u200B":"\u200B";var WidgetBufferView5=/*#__PURE__*/function(_ContentView29){_inherits(WidgetBufferView5,_ContentView29);var _super99=_createSuper(WidgetBufferView5);function WidgetBufferView5(side){var _this181;_classCallCheck(this,WidgetBufferView5);_this181=_super99.call(this);_this181.side=side;return _this181;}_createClass(WidgetBufferView5,[{key:"length",get:function get(){return 0;}},{key:"merge",value:function merge(){return false;}},{key:"become",value:function become(other){return other instanceof WidgetBufferView5&&other.side==this.side;}},{key:"split",value:function split(){return new WidgetBufferView5(this.side);}},{key:"sync",value:function sync(){if(!this.dom)this.setDOM(document.createTextNode(ZeroWidthSpace4));else if(this.dirty&&this.dom.nodeValue!=ZeroWidthSpace4)this.dom.nodeValue=ZeroWidthSpace4;}},{key:"getSide",value:function getSide(){return this.side;}},{key:"domAtPos",value:function domAtPos(pos){return DOMPos5.before(this.dom);}},{key:"localPosFromDOM",value:function localPosFromDOM(){return 0;}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"coordsAt",value:function coordsAt(pos){var rects=clientRectsFor5(this.dom);return rects[rects.length-1]||null;}},{key:"overrideDOMText",get:function get(){return Text.of([this.dom.nodeValue.replace(/\u200b/g,"")]);}}]);return WidgetBufferView5;}(ContentView5);TextView5.prototype.children=WidgetView5.prototype.children=WidgetBufferView5.prototype.children=noChildren4;function inlineDOMAtPos5(dom,children,pos){var i=0;for(var off=0;i<children.length;i++){var child=children[i],end=off+child.length;if(end==off&&child.getSide()<=0)continue;if(pos>off&&pos<end&&child.dom.parentNode==dom)return child.domAtPos(pos-off);if(pos<=off)break;off=end;}for(;i>0;i--){var before=children[i-1].dom;if(before.parentNode==dom)return DOMPos5.after(before);}return new DOMPos5(dom,0);}function joinInlineInto5(parent,view,open){var last,children=parent.children;if(open>0&&view instanceof MarkView5&&children.length&&(last=children[children.length-1])instanceof MarkView5&&last.mark.eq(view.mark)){joinInlineInto5(last,view.children[0],open-1);}else{children.push(view);view.setParent(parent);}parent.length+=view.length;}function coordsInChildren5(view,pos,side){for(var off=0,_i251=0;_i251<view.children.length;_i251++){var child=view.children[_i251],end=off+child.length,next=void 0;if((side<=0||end==view.length||child.getSide()>0?end>=pos:end>pos)&&(pos<end||_i251+1==view.children.length||(next=view.children[_i251+1]).length||next.getSide()>0)){var flatten2=0;if(end==off){if(child.getSide()<=0)continue;flatten2=side=-child.getSide();}var rect=child.coordsAt(pos-off,side);return flatten2&&rect?flattenRect5(rect,side<0):rect;}off=end;}var last=view.dom.lastChild;if(!last)return view.dom.getBoundingClientRect();var rects=clientRectsFor5(last);return rects[rects.length-1]||null;}function combineAttrs5(source,target){for(var name2 in source){if(name2=="class"&&target["class"])target["class"]+=" "+source["class"];else if(name2=="style"&&target.style)target.style+=";"+source.style;else target[name2]=source[name2];}return target;}function attrsEq5(a,b){if(a==b)return true;if(!a||!b)return false;var keysA=Object.keys(a),keysB=Object.keys(b);if(keysA.length!=keysB.length)return false;for(var _i252=0,_keysA5=keysA;_i252<_keysA5.length;_i252++){var key=_keysA5[_i252];if(keysB.indexOf(key)==-1||a[key]!==b[key])return false;}return true;}function updateAttrs5(dom,prev,attrs){if(prev){for(var name2 in prev){if(!(attrs&&name2 in attrs))dom.removeAttribute(name2);}}if(attrs){for(var _name5 in attrs){if(!(prev&&prev[_name5]==attrs[_name5]))dom.setAttribute(_name5,attrs[_name5]);}}}var WidgetType5=/*#__PURE__*/function(){function WidgetType5(){_classCallCheck(this,WidgetType5);}_createClass(WidgetType5,[{key:"eq",value:function eq(_widget){return false;}},{key:"updateDOM",value:function updateDOM(_dom){return false;}},{key:"compare",value:function compare(other){return this==other||this.constructor==other.constructor&&this.eq(other);}},{key:"estimatedHeight",get:function get(){return-1;}},{key:"ignoreEvent",value:function ignoreEvent(_event){return true;}},{key:"customView",get:function get(){return null;}},{key:"destroy",value:function destroy(_dom){}}]);return WidgetType5;}();var BlockType5=/* @__PURE__ */function(BlockType6){BlockType6[BlockType6["Text"]=0]="Text";BlockType6[BlockType6["WidgetBefore"]=1]="WidgetBefore";BlockType6[BlockType6["WidgetAfter"]=2]="WidgetAfter";BlockType6[BlockType6["WidgetRange"]=3]="WidgetRange";return BlockType6;}(BlockType5||(BlockType5={}));var Decoration5=/*#__PURE__*/function(_RangeValue7){_inherits(Decoration5,_RangeValue7);var _super100=_createSuper(Decoration5);function Decoration5(startSide,endSide,widget,spec){var _this182;_classCallCheck(this,Decoration5);_this182=_super100.call(this);_this182.startSide=startSide;_this182.endSide=endSide;_this182.widget=widget;_this182.spec=spec;return _this182;}_createClass(Decoration5,[{key:"heightRelevant",get:function get(){return false;}},{key:"hasHeight",value:function hasHeight(){return this.widget?this.widget.estimatedHeight>-1:false;}}],[{key:"mark",value:function mark(spec){return new MarkDecoration5(spec);}},{key:"widget",value:function widget(spec){var side=spec.side||0,block=!!spec.block;side+=block?side>0?3e8:-4e8:side>0?1e8:-1e8;return new PointDecoration5(spec,side,side,block,spec.widget||null,false);}},{key:"replace",value:function replace(spec){var block=!!spec.block;var _getInclusive9=getInclusive5(spec,block),start=_getInclusive9.start,end=_getInclusive9.end;var startSide=block?start?-3e8:-1:4e8;var endSide=block?end?2e8:1:-5e8;return new PointDecoration5(spec,startSide,endSide,block,spec.widget||null,true);}},{key:"line",value:function line(spec){return new LineDecoration5(spec);}},{key:"set",value:function set(of){var sort=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return RangeSet.of(of,sort);}}]);return Decoration5;}(RangeValue);Decoration5.none=RangeSet.empty;var MarkDecoration5=/*#__PURE__*/function(_Decoration13){_inherits(MarkDecoration5,_Decoration13);var _super101=_createSuper(MarkDecoration5);function MarkDecoration5(spec){var _this183;_classCallCheck(this,MarkDecoration5);var _getInclusive10=getInclusive5(spec),start=_getInclusive10.start,end=_getInclusive10.end;_this183=_super101.call(this,start?-1:4e8,end?1:-5e8,null,spec);_this183.tagName=spec.tagName||"span";_this183["class"]=spec["class"]||"";_this183.attrs=spec.attributes||null;return _this183;}_createClass(MarkDecoration5,[{key:"eq",value:function eq(other){return this==other||other instanceof MarkDecoration5&&this.tagName==other.tagName&&this["class"]==other["class"]&&attrsEq5(this.attrs,other.attrs);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(from>=to)throw new RangeError("Mark decorations may not be empty");return _get(_getPrototypeOf(MarkDecoration5.prototype),"range",this).call(this,from,to);}}]);return MarkDecoration5;}(Decoration5);MarkDecoration5.prototype.point=false;var LineDecoration5=/*#__PURE__*/function(_Decoration14){_inherits(LineDecoration5,_Decoration14);var _super102=_createSuper(LineDecoration5);function LineDecoration5(spec){_classCallCheck(this,LineDecoration5);return _super102.call(this,-2e8,-2e8,null,spec);}_createClass(LineDecoration5,[{key:"eq",value:function eq(other){return other instanceof LineDecoration5&&attrsEq5(this.spec.attributes,other.spec.attributes);}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(to!=from)throw new RangeError("Line decoration ranges must be zero-length");return _get(_getPrototypeOf(LineDecoration5.prototype),"range",this).call(this,from,to);}}]);return LineDecoration5;}(Decoration5);LineDecoration5.prototype.mapMode=MapMode.TrackBefore;LineDecoration5.prototype.point=true;var PointDecoration5=/*#__PURE__*/function(_Decoration15){_inherits(PointDecoration5,_Decoration15);var _super103=_createSuper(PointDecoration5);function PointDecoration5(spec,startSide,endSide,block,widget,isReplace){var _this184;_classCallCheck(this,PointDecoration5);_this184=_super103.call(this,startSide,endSide,widget,spec);_this184.block=block;_this184.isReplace=isReplace;_this184.mapMode=!block?MapMode.TrackDel:startSide<=0?MapMode.TrackBefore:MapMode.TrackAfter;return _this184;}_createClass(PointDecoration5,[{key:"type",get:function get(){return this.startSide<this.endSide?BlockType5.WidgetRange:this.startSide<=0?BlockType5.WidgetBefore:BlockType5.WidgetAfter;}},{key:"heightRelevant",get:function get(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5;}},{key:"eq",value:function eq(other){return other instanceof PointDecoration5&&widgetsEq5(this.widget,other.widget)&&this.block==other.block&&this.startSide==other.startSide&&this.endSide==other.endSide;}},{key:"range",value:function range(from){var to=arguments.length>1&&arguments[1]!==undefined?arguments[1]:from;if(this.isReplace&&(from>to||from==to&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&to!=from)throw new RangeError("Widget decorations can only have zero-length ranges");return _get(_getPrototypeOf(PointDecoration5.prototype),"range",this).call(this,from,to);}}]);return PointDecoration5;}(Decoration5);PointDecoration5.prototype.point=true;function getInclusive5(spec){var block=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var start=spec.inclusiveStart,end=spec.inclusiveEnd;if(start==null)start=spec.inclusive;if(end==null)end=spec.inclusive;return{start:start!==null&&start!==void 0?start:block,end:end!==null&&end!==void 0?end:block};}function widgetsEq5(a,b){return a==b||!!(a&&b&&a.compare(b));}function addRange5(from,to,ranges){var margin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var last=ranges.length-1;if(last>=0&&ranges[last]+margin>=from)ranges[last]=Math.max(ranges[last],to);else ranges.push(from,to);}var LineView5=/*#__PURE__*/function(_ContentView30){_inherits(LineView5,_ContentView30);var _super104=_createSuper(LineView5);function LineView5(){var _this185;_classCallCheck(this,LineView5);_this185=_super104.apply(this,arguments);_this185.children=[];_this185.length=0;_this185.prevAttrs=void 0;_this185.attrs=null;_this185.breakAfter=0;return _this185;}_createClass(LineView5,[{key:"merge",value:function merge(from,to,source,hasStart,openStart,openEnd){if(source){if(!(source instanceof LineView5))return false;if(!this.dom)source.transferDOM(this);}if(hasStart)this.setDeco(source?source.attrs:null);mergeChildrenInto4(this,from,to,source?source.children:[],openStart,openEnd);return true;}},{key:"split",value:function split(at){var end=new LineView5();end.breakAfter=this.breakAfter;if(this.length==0)return end;var _this$childPos5=this.childPos(at),i=_this$childPos5.i,off=_this$childPos5.off;if(off){end.append(this.children[i].split(off),0);this.children[i].merge(off,this.children[i].length,null,false,0,0);i++;}for(var j=i;j<this.children.length;j++){end.append(this.children[j],0);}while(i>0&&this.children[i-1].length==0){this.children[--i].destroy();}this.children.length=i;this.markDirty();this.length=at;return end;}},{key:"transferDOM",value:function transferDOM(other){if(!this.dom)return;other.setDOM(this.dom);other.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs;this.prevAttrs=void 0;this.dom=null;}},{key:"setDeco",value:function setDeco(attrs){if(!attrsEq5(this.attrs,attrs)){if(this.dom){this.prevAttrs=this.attrs;this.markDirty();}this.attrs=attrs;}}},{key:"append",value:function append(child,openStart){joinInlineInto5(this,child,openStart);}},{key:"addLineDeco",value:function addLineDeco(deco){var attrs=deco.spec.attributes,cls=deco.spec["class"];if(attrs)this.attrs=combineAttrs5(attrs,this.attrs||{});if(cls)this.attrs=combineAttrs5({"class":cls},this.attrs||{});}},{key:"domAtPos",value:function domAtPos(pos){return inlineDOMAtPos5(this.dom,this.children,pos);}},{key:"reuseDOM",value:function reuseDOM(node){if(node.nodeName=="DIV"){this.setDOM(node);this.dirty|=4|2;}}},{key:"sync",value:function sync(track){var _a;if(!this.dom){this.setDOM(document.createElement("div"));this.dom.className="cm-line";this.prevAttrs=this.attrs?null:void 0;}else if(this.dirty&4){clearAttributes4(this.dom);this.dom.className="cm-line";this.prevAttrs=this.attrs?null:void 0;}if(this.prevAttrs!==void 0){updateAttrs5(this.dom,this.prevAttrs,this.attrs);this.dom.classList.add("cm-line");this.prevAttrs=void 0;}_get(_getPrototypeOf(LineView5.prototype),"sync",this).call(this,track);var last=this.dom.lastChild;while(last&&ContentView5.get(last)instanceof MarkView5){last=last.lastChild;}if(!last||last.nodeName!="BR"&&((_a=ContentView5.get(last))===null||_a===void 0?void 0:_a.isEditable)==false&&(!browser5.ios||!this.children.some(function(ch){return ch instanceof TextView5;}))){var hack=document.createElement("BR");hack.cmIgnore=true;this.dom.appendChild(hack);}}},{key:"measureTextSize",value:function measureTextSize(){if(this.children.length==0||this.length>20)return null;var totalWidth=0;var _iterator306=_createForOfIteratorHelper(this.children),_step306;try{for(_iterator306.s();!(_step306=_iterator306.n()).done;){var child=_step306.value;if(!(child instanceof TextView5))return null;var rects=clientRectsFor5(child.dom);if(rects.length!=1)return null;totalWidth+=rects[0].width;}}catch(err){_iterator306.e(err);}finally{_iterator306.f();}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:totalWidth/this.length};}},{key:"coordsAt",value:function coordsAt(pos,side){return coordsInChildren5(this,pos,side);}},{key:"become",value:function become(_other){return false;}},{key:"type",get:function get(){return BlockType5.Text;}}],[{key:"find",value:function find(docView,pos){for(var _i253=0,off=0;_i253<docView.children.length;_i253++){var block=docView.children[_i253],end=off+block.length;if(end>=pos){if(block instanceof LineView5)return block;if(end>pos)break;}off=end+block.breakAfter;}return null;}}]);return LineView5;}(ContentView5);var BlockWidgetView5=/*#__PURE__*/function(_ContentView31){_inherits(BlockWidgetView5,_ContentView31);var _super105=_createSuper(BlockWidgetView5);function BlockWidgetView5(widget,length,type){var _this186;_classCallCheck(this,BlockWidgetView5);_this186=_super105.call(this);_this186.widget=widget;_this186.length=length;_this186.type=type;_this186.breakAfter=0;return _this186;}_createClass(BlockWidgetView5,[{key:"merge",value:function merge(from,to,source,_takeDeco,openStart,openEnd){if(source&&(!(source instanceof BlockWidgetView5)||!this.widget.compare(source.widget)||from>0&&openStart<=0||to<this.length&&openEnd<=0))return false;this.length=from+(source?source.length:0)+(this.length-to);return true;}},{key:"domAtPos",value:function domAtPos(pos){return pos==0?DOMPos5.before(this.dom):DOMPos5.after(this.dom,pos==this.length);}},{key:"split",value:function split(at){var len=this.length-at;this.length=at;var end=new BlockWidgetView5(this.widget,len,this.type);end.breakAfter=this.breakAfter;return end;}},{key:"children",get:function get(){return noChildren4;}},{key:"sync",value:function sync(){if(!this.dom||!this.widget.updateDOM(this.dom)){this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false";}}},{key:"overrideDOMText",get:function get(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty;}},{key:"domBoundsAround",value:function domBoundsAround(){return null;}},{key:"become",value:function become(other){if(other instanceof BlockWidgetView5&&other.type==this.type&&other.widget.constructor==this.widget.constructor){if(!other.widget.eq(this.widget))this.markDirty(true);this.widget=other.widget;this.length=other.length;this.breakAfter=other.breakAfter;return true;}return false;}},{key:"ignoreMutation",value:function ignoreMutation(){return true;}},{key:"ignoreEvent",value:function ignoreEvent(event){return this.widget.ignoreEvent(event);}},{key:"destroy",value:function destroy(){_get(_getPrototypeOf(BlockWidgetView5.prototype),"destroy",this).call(this);if(this.dom)this.widget.destroy(this.dom);}}]);return BlockWidgetView5;}(ContentView5);var ContentBuilder5=/*#__PURE__*/function(){function ContentBuilder5(doc6,pos,end,disallowBlockEffectsBelow){_classCallCheck(this,ContentBuilder5);this.doc=doc6;this.pos=pos;this.end=end;this.disallowBlockEffectsBelow=disallowBlockEffectsBelow;this.content=[];this.curLine=null;this.breakAtStart=0;this.pendingBuffer=0;this.atCursorPos=true;this.openStart=-1;this.openEnd=-1;this.text="";this.textOff=0;this.cursor=doc6.iter();this.skip=pos;}_createClass(ContentBuilder5,[{key:"posCovered",value:function posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;var last=this.content[this.content.length-1];return!last.breakAfter&&!(last instanceof BlockWidgetView5&&last.type==BlockType5.WidgetBefore);}},{key:"getLine",value:function getLine(){if(!this.curLine){this.content.push(this.curLine=new LineView5());this.atCursorPos=true;}return this.curLine;}},{key:"flushBuffer",value:function flushBuffer(active){if(this.pendingBuffer){this.curLine.append(wrapMarks5(new WidgetBufferView5(-1),active),active.length);this.pendingBuffer=0;}}},{key:"addBlockWidget",value:function addBlockWidget(view){this.flushBuffer([]);this.curLine=null;this.content.push(view);}},{key:"finish",value:function finish(openEnd){if(!openEnd)this.flushBuffer([]);else this.pendingBuffer=0;if(!this.posCovered())this.getLine();}},{key:"buildText",value:function buildText(length,active,openStart){while(length>0){if(this.textOff==this.text.length){var _this$cursor$next6=this.cursor.next(this.skip),value=_this$cursor$next6.value,lineBreak=_this$cursor$next6.lineBreak,done=_this$cursor$next6.done;this.skip=0;if(done)throw new Error("Ran out of text content when drawing inline views");if(lineBreak){if(!this.posCovered())this.getLine();if(this.content.length)this.content[this.content.length-1].breakAfter=1;else this.breakAtStart=1;this.flushBuffer([]);this.curLine=null;length--;continue;}else{this.text=value;this.textOff=0;}}var take=Math.min(this.text.length-this.textOff,length,512);this.flushBuffer(active.slice(0,openStart));this.getLine().append(wrapMarks5(new TextView5(this.text.slice(this.textOff,this.textOff+take)),active),openStart);this.atCursorPos=true;this.textOff+=take;length-=take;openStart=0;}}},{key:"span",value:function span(from,to,active,openStart){this.buildText(to-from,active,openStart);this.pos=to;if(this.openStart<0)this.openStart=openStart;}},{key:"point",value:function point(from,to,deco,active,openStart){var len=to-from;if(deco instanceof PointDecoration5){if(deco.block){var type=deco.type;if(type==BlockType5.WidgetAfter&&!this.posCovered())this.getLine();this.addBlockWidget(new BlockWidgetView5(deco.widget||new NullWidget5("div"),len,type));}else{var view=WidgetView5.create(deco.widget||new NullWidget5("span"),len,deco.startSide);var cursorBefore=this.atCursorPos&&!view.isEditable&&openStart<=active.length&&(from<to||deco.startSide>0);var cursorAfter=!view.isEditable&&(from<to||deco.startSide<=0);var line=this.getLine();if(this.pendingBuffer==2&&!cursorBefore)this.pendingBuffer=0;this.flushBuffer(active);if(cursorBefore){line.append(wrapMarks5(new WidgetBufferView5(1),active),openStart);openStart=active.length+Math.max(0,openStart-active.length);}line.append(wrapMarks5(view,active),openStart);this.atCursorPos=cursorAfter;this.pendingBuffer=!cursorAfter?0:from<to?1:2;}}else if(this.doc.lineAt(this.pos).from==this.pos){this.getLine().addLineDeco(deco);}if(len){if(this.textOff+len<=this.text.length){this.textOff+=len;}else{this.skip+=len-(this.text.length-this.textOff);this.text="";this.textOff=0;}this.pos=to;}if(this.openStart<0)this.openStart=openStart;}},{key:"filterPoint",value:function filterPoint(from,to,value,index){if(index>=this.disallowBlockEffectsBelow||!(value instanceof PointDecoration5))return true;if(value.block)throw new RangeError("Block decorations may not be specified via plugins");return to<=this.doc.lineAt(this.pos).to;}}],[{key:"build",value:function build(text,from,to,decorations6,pluginDecorationLength){var builder=new ContentBuilder5(text,from,to,pluginDecorationLength);builder.openEnd=RangeSet.spans(decorations6,from,to,builder);if(builder.openStart<0)builder.openStart=builder.openEnd;builder.finish(builder.openEnd);return builder;}}]);return ContentBuilder5;}();function wrapMarks5(view,active){var _iterator307=_createForOfIteratorHelper(active),_step307;try{for(_iterator307.s();!(_step307=_iterator307.n()).done;){var mark=_step307.value;view=new MarkView5(mark,[view],view.length);}}catch(err){_iterator307.e(err);}finally{_iterator307.f();}return view;}var NullWidget5=/*#__PURE__*/function(_WidgetType20){_inherits(NullWidget5,_WidgetType20);var _super106=_createSuper(NullWidget5);function NullWidget5(tag){var _this187;_classCallCheck(this,NullWidget5);_this187=_super106.call(this);_this187.tag=tag;return _this187;}_createClass(NullWidget5,[{key:"eq",value:function eq(other){return other.tag==this.tag;}},{key:"toDOM",value:function toDOM(){return document.createElement(this.tag);}},{key:"updateDOM",value:function updateDOM(elt){return elt.nodeName.toLowerCase()==this.tag;}}]);return NullWidget5;}(WidgetType5);var none7=[];var clickAddsSelectionRange5=/* @__PURE__ */Facet.define();var dragMovesSelection$15=/* @__PURE__ */Facet.define();var mouseSelectionStyle5=/* @__PURE__ */Facet.define();var exceptionSink5=/* @__PURE__ */Facet.define();var updateListener5=/* @__PURE__ */Facet.define();var inputHandler5=/* @__PURE__ */Facet.define();var scrollTo5=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});var centerOn5=/* @__PURE__ */StateEffect.define({map:function map(range,changes){return range.map(changes);}});var ScrollTarget5=/*#__PURE__*/function(){function ScrollTarget5(range){var y=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"nearest";var x=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"nearest";var yMargin=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;var xMargin=arguments.length>4&&arguments[4]!==undefined?arguments[4]:5;_classCallCheck(this,ScrollTarget5);this.range=range;this.y=y;this.x=x;this.yMargin=yMargin;this.xMargin=xMargin;}_createClass(ScrollTarget5,[{key:"map",value:function map(changes){return changes.empty?this:new ScrollTarget5(this.range.map(changes),this.y,this.x,this.yMargin,this.xMargin);}}]);return ScrollTarget5;}();var scrollIntoView4=/* @__PURE__ */StateEffect.define({map:function map(t2,ch){return t2.map(ch);}});function logException5(state,exception,context){var handler=state.facet(exceptionSink5);if(handler.length)handler[0](exception);else if(window.onerror)window.onerror(String(exception),context,void 0,void 0,exception);else if(context)console.error(context+":",exception);else console.error(exception);}var editable5=/* @__PURE__ */Facet.define({combine:function combine(values){return values.length?values[0]:true;}});var PluginFieldProvider5=/*#__PURE__*/_createClass(function PluginFieldProvider5(field,get){_classCallCheck(this,PluginFieldProvider5);this.field=field;this.get=get;});var PluginField5=/*#__PURE__*/function(){function PluginField5(){_classCallCheck(this,PluginField5);}_createClass(PluginField5,[{key:"from",value:function from(get){return new PluginFieldProvider5(this,get);}}],[{key:"define",value:function define(){return new PluginField5();}}]);return PluginField5;}();PluginField5.decorations=/* @__PURE__ */PluginField5.define();PluginField5.atomicRanges=/* @__PURE__ */PluginField5.define();PluginField5.scrollMargins=/* @__PURE__ */PluginField5.define();var nextPluginID5=0;var viewPlugin5=/* @__PURE__ */Facet.define();var ViewPlugin5=/*#__PURE__*/function(){function ViewPlugin5(id,create,fields){_classCallCheck(this,ViewPlugin5);this.id=id;this.create=create;this.fields=fields;this.extension=viewPlugin5.of(this);}_createClass(ViewPlugin5,null,[{key:"define",value:function define(create,spec){var _ref83=spec||{},eventHandlers=_ref83.eventHandlers,provide=_ref83.provide,decorations6=_ref83.decorations;var fields=[];if(provide){var _iterator308=_createForOfIteratorHelper(Array.isArray(provide)?provide:[provide]),_step308;try{for(_iterator308.s();!(_step308=_iterator308.n()).done;){var provider=_step308.value;fields.push(provider);}}catch(err){_iterator308.e(err);}finally{_iterator308.f();}}if(eventHandlers)fields.push(domEventHandlers5.from(function(value){return{plugin:value,handlers:eventHandlers};}));if(decorations6)fields.push(PluginField5.decorations.from(decorations6));return new ViewPlugin5(nextPluginID5++,create,fields);}},{key:"fromClass",value:function fromClass(cls,spec){return ViewPlugin5.define(function(view){return new cls(view);},spec);}}]);return ViewPlugin5;}();var domEventHandlers5=/* @__PURE__ */PluginField5.define();var PluginInstance5=/*#__PURE__*/function(){function PluginInstance5(spec){_classCallCheck(this,PluginInstance5);this.spec=spec;this.mustUpdate=null;this.value=null;}_createClass(PluginInstance5,[{key:"takeField",value:function takeField(type,target){if(this.spec){var _iterator309=_createForOfIteratorHelper(this.spec.fields),_step309;try{for(_iterator309.s();!(_step309=_iterator309.n()).done;){var _step309$value=_step309.value,field=_step309$value.field,get=_step309$value.get;if(field==type)target.push(get(this.value));}}catch(err){_iterator309.e(err);}finally{_iterator309.f();}}}},{key:"update",value:function update(view){if(!this.value){if(this.spec){try{this.value=this.spec.create(view);}catch(e){logException5(view.state,e,"CodeMirror plugin crashed");this.deactivate();}}}else if(this.mustUpdate){var update=this.mustUpdate;this.mustUpdate=null;if(this.value.update){try{this.value.update(update);}catch(e){logException5(update.state,e,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy();}catch(_){}this.deactivate();}}}return this;}},{key:"destroy",value:function destroy(view){var _a;if((_a=this.value)===null||_a===void 0?void 0:_a.destroy){try{this.value.destroy();}catch(e){logException5(view.state,e,"CodeMirror plugin crashed");}}}},{key:"deactivate",value:function deactivate(){this.spec=this.value=null;}}]);return PluginInstance5;}();var editorAttributes5=/* @__PURE__ */Facet.define();var contentAttributes5=/* @__PURE__ */Facet.define();var decorations5=/* @__PURE__ */Facet.define();var styleModule5=/* @__PURE__ */Facet.define();var ChangedRange5=/*#__PURE__*/function(){function ChangedRange5(fromA,toA,fromB,toB){_classCallCheck(this,ChangedRange5);this.fromA=fromA;this.toA=toA;this.fromB=fromB;this.toB=toB;}_createClass(ChangedRange5,[{key:"join",value:function join(other){return new ChangedRange5(Math.min(this.fromA,other.fromA),Math.max(this.toA,other.toA),Math.min(this.fromB,other.fromB),Math.max(this.toB,other.toB));}},{key:"addToSet",value:function addToSet(set){var i=set.length,me=this;for(;i>0;i--){var range=set[i-1];if(range.fromA>me.toA)continue;if(range.toA<me.fromA)break;me=me.join(range);set.splice(i-1,1);}set.splice(i,0,me);return set;}}],[{key:"extendWithRanges",value:function extendWithRanges(diff,ranges){if(ranges.length==0)return diff;var result=[];for(var dI=0,rI=0,posA=0,posB=0;;dI++){var next=dI==diff.length?null:diff[dI],off=posA-posB;var end=next?next.fromB:1e9;while(rI<ranges.length&&ranges[rI]<end){var from=ranges[rI],to=ranges[rI+1];var fromB=Math.max(posB,from),toB=Math.min(end,to);if(fromB<=toB)new ChangedRange5(fromB+off,toB+off,fromB,toB).addToSet(result);if(to>end)break;else rI+=2;}if(!next)return result;new ChangedRange5(next.fromA,next.toA,next.fromB,next.toB).addToSet(result);posA=next.toA;posB=next.toB;}}}]);return ChangedRange5;}();var ViewUpdate5=/*#__PURE__*/function(){function ViewUpdate5(view,state){var transactions=arguments.length>2&&arguments[2]!==undefined?arguments[2]:none7;_classCallCheck(this,ViewUpdate5);this.view=view;this.state=state;this.transactions=transactions;this.flags=0;this.startState=view.state;this.changes=ChangeSet.empty(this.startState.doc.length);var _iterator310=_createForOfIteratorHelper(transactions),_step310;try{for(_iterator310.s();!(_step310=_iterator310.n()).done;){var tr=_step310.value;this.changes=this.changes.compose(tr.changes);}}catch(err){_iterator310.e(err);}finally{_iterator310.f();}var changedRanges=[];this.changes.iterChangedRanges(function(fromA,toA,fromB,toB){return changedRanges.push(new ChangedRange5(fromA,toA,fromB,toB));});this.changedRanges=changedRanges;var focus=view.hasFocus;if(focus!=view.inputState.notifiedFocused){view.inputState.notifiedFocused=focus;this.flags|=1;}}_createClass(ViewUpdate5,[{key:"viewportChanged",get:function get(){return(this.flags&4)>0;}},{key:"heightChanged",get:function get(){return(this.flags&2)>0;}},{key:"geometryChanged",get:function get(){return this.docChanged||(this.flags&(8|2))>0;}},{key:"focusChanged",get:function get(){return(this.flags&1)>0;}},{key:"docChanged",get:function get(){return!this.changes.empty;}},{key:"selectionSet",get:function get(){return this.transactions.some(function(tr){return tr.selection;});}},{key:"empty",get:function get(){return this.flags==0&&this.transactions.length==0;}}]);return ViewUpdate5;}();var Direction5=/* @__PURE__ */function(Direction6){Direction6[Direction6["LTR"]=0]="LTR";Direction6[Direction6["RTL"]=1]="RTL";return Direction6;}(Direction5||(Direction5={}));var LTR5=Direction5.LTR;var RTL5=Direction5.RTL;function dec5(str){var result=[];for(var _i254=0;_i254<str.length;_i254++){result.push(1<<+str[_i254]);}return result;}var LowTypes5=/* @__PURE__ */dec5("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");var ArabicTypes5=/* @__PURE__ */dec5("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");var Brackets5=/* @__PURE__ */Object.create(null);var BracketStack5=[];for(var _i255=0,_arr6=["()","[]","{}"];_i255<_arr6.length;_i255++){var _p9=_arr6[_i255];var _l9=/* @__PURE__ */_p9.charCodeAt(0),_r18=/* @__PURE__ */_p9.charCodeAt(1);Brackets5[_l9]=_r18;Brackets5[_r18]=-_l9;}function charType5(ch){return ch<=247?LowTypes5[ch]:1424<=ch&&ch<=1524?2:1536<=ch&&ch<=1785?ArabicTypes5[ch-1536]:1774<=ch&&ch<=2220?4:8192<=ch&&ch<=8203?256:ch==8204?256:1;}var BidiRE5=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var BidiSpan5=/*#__PURE__*/function(){function BidiSpan5(from,to,level){_classCallCheck(this,BidiSpan5);this.from=from;this.to=to;this.level=level;}_createClass(BidiSpan5,[{key:"dir",get:function get(){return this.level%2?RTL5:LTR5;}},{key:"side",value:function side(end,dir){return this.dir==dir==end?this.to:this.from;}}],[{key:"find",value:function find(order,index,level,assoc){var maybe=-1;for(var _i256=0;_i256<order.length;_i256++){var span=order[_i256];if(span.from<=index&&span.to>=index){if(span.level==level)return _i256;if(maybe<0||(assoc!=0?assoc<0?span.from<index:span.to>index:order[maybe].level>span.level))maybe=_i256;}}if(maybe<0)throw new RangeError("Index out of range");return maybe;}}]);return BidiSpan5;}();var types5=[];function computeOrder5(line,direction){var len=line.length,outerType=direction==LTR5?1:2,oppositeType=direction==LTR5?2:1;if(!line||outerType==1&&!BidiRE5.test(line))return trivialOrder5(len);for(var _i257=0,prev=outerType,prevStrong=outerType;_i257<len;_i257++){var type=charType5(line.charCodeAt(_i257));if(type==512)type=prev;else if(type==8&&prevStrong==4)type=16;types5[_i257]=type==4?2:type;if(type&7)prevStrong=type;prev=type;}for(var _i258=0,_prev5=outerType,_prevStrong5=outerType;_i258<len;_i258++){var _type10=types5[_i258];if(_type10==128){if(_i258<len-1&&_prev5==types5[_i258+1]&&_prev5&24)_type10=types5[_i258]=_prev5;else types5[_i258]=256;}else if(_type10==64){var end=_i258+1;while(end<len&&types5[end]==64){end++;}var replace=_i258&&_prev5==8||end<len&&types5[end]==8?_prevStrong5==1?1:8:256;for(var j=_i258;j<end;j++){types5[j]=replace;}_i258=end-1;}else if(_type10==8&&_prevStrong5==1){types5[_i258]=1;}_prev5=_type10;if(_type10&7)_prevStrong5=_type10;}for(var _i259=0,sI=0,context=0,ch,br,_type11;_i259<len;_i259++){if(br=Brackets5[ch=line.charCodeAt(_i259)]){if(br<0){for(var sJ=sI-3;sJ>=0;sJ-=3){if(BracketStack5[sJ+1]==-br){var flags=BracketStack5[sJ+2];var type2=flags&2?outerType:!(flags&4)?0:flags&1?oppositeType:outerType;if(type2)types5[_i259]=types5[BracketStack5[sJ]]=type2;sI=sJ;break;}}}else if(BracketStack5.length==189){break;}else{BracketStack5[sI++]=_i259;BracketStack5[sI++]=ch;BracketStack5[sI++]=context;}}else if((_type11=types5[_i259])==2||_type11==1){var embed=_type11==outerType;context=embed?0:1;for(var _sJ5=sI-3;_sJ5>=0;_sJ5-=3){var cur2=BracketStack5[_sJ5+2];if(cur2&2)break;if(embed){BracketStack5[_sJ5+2]|=2;}else{if(cur2&4)break;BracketStack5[_sJ5+2]|=4;}}}}for(var _i260=0;_i260<len;_i260++){if(types5[_i260]==256){var _end11=_i260+1;while(_end11<len&&types5[_end11]==256){_end11++;}var beforeL=(_i260?types5[_i260-1]:outerType)==1;var afterL=(_end11<len?types5[_end11]:outerType)==1;var _replace5=beforeL==afterL?beforeL?1:2:outerType;for(var _j9=_i260;_j9<_end11;_j9++){types5[_j9]=_replace5;}_i260=_end11-1;}}var order=[];if(outerType==1){for(var _i261=0;_i261<len;){var start=_i261,rtl=types5[_i261++]!=1;while(_i261<len&&rtl==(types5[_i261]!=1)){_i261++;}if(rtl){for(var _j10=_i261;_j10>start;){var _end12=_j10,_l10=types5[--_j10]!=2;while(_j10>start&&_l10==(types5[_j10-1]!=2)){_j10--;}order.push(new BidiSpan5(_j10,_end12,_l10?2:1));}}else{order.push(new BidiSpan5(start,_i261,0));}}}else{for(var _i262=0;_i262<len;){var _start12=_i262,_rtl5=types5[_i262++]==2;while(_i262<len&&_rtl5==(types5[_i262]==2)){_i262++;}order.push(new BidiSpan5(_start12,_i262,_rtl5?1:2));}}return order;}function trivialOrder5(length){return[new BidiSpan5(0,length,0)];}var movedOver5="";function moveVisually5(line,order,dir,start,forward){var _a;var startIndex=start.head-line.from,spanI=-1;if(startIndex==0){if(!forward||!line.length)return null;if(order[0].level!=dir){startIndex=order[0].side(false,dir);spanI=0;}}else if(startIndex==line.length){if(forward)return null;var last=order[order.length-1];if(last.level!=dir){startIndex=last.side(true,dir);spanI=order.length-1;}}if(spanI<0)spanI=BidiSpan5.find(order,startIndex,(_a=start.bidiLevel)!==null&&_a!==void 0?_a:-1,start.assoc);var span=order[spanI];if(startIndex==span.side(forward,dir)){span=order[spanI+=forward?1:-1];startIndex=span.side(!forward,dir);}var indexForward=forward==(span.dir==dir);var nextIndex=findClusterBreak(line.text,startIndex,indexForward);movedOver5=line.text.slice(Math.min(startIndex,nextIndex),Math.max(startIndex,nextIndex));if(nextIndex!=span.side(forward,dir))return EditorSelection.cursor(nextIndex+line.from,indexForward?-1:1,span.level);var nextSpan=spanI==(forward?order.length-1:0)?null:order[spanI+(forward?1:-1)];if(!nextSpan&&span.level!=dir)return EditorSelection.cursor(forward?line.to:line.from,forward?-1:1,dir);if(nextSpan&&nextSpan.level<span.level)return EditorSelection.cursor(nextSpan.side(!forward,dir)+line.from,forward?1:-1,nextSpan.level);return EditorSelection.cursor(nextIndex+line.from,forward?-1:1,span.level);}var DOMReader5=/*#__PURE__*/function(){function DOMReader5(points,view){_classCallCheck(this,DOMReader5);this.points=points;this.view=view;this.text="";this.lineBreak=view.state.lineBreak;}_createClass(DOMReader5,[{key:"readRange",value:function readRange(start,end){if(!start)return this;var parent=start.parentNode;for(var cur2=start;;){this.findPointBefore(parent,cur2);this.readNode(cur2);var next=cur2.nextSibling;if(next==end)break;var view=ContentView5.get(cur2),nextView=ContentView5.get(next);if(view&&nextView?view.breakAfter:(view?view.breakAfter:isBlockElement5(cur2))||isBlockElement5(next)&&(cur2.nodeName!="BR"||cur2.cmIgnore))this.text+=this.lineBreak;cur2=next;}this.findPointBefore(parent,end);return this;}},{key:"readTextNode",value:function readTextNode(node){var _a,_b;var text=node.nodeValue;if(/^\u200b/.test(text)&&((_a=node.previousSibling)===null||_a===void 0?void 0:_a.contentEditable)=="false")text=text.slice(1);if(/\u200b$/.test(text)&&((_b=node.nextSibling)===null||_b===void 0?void 0:_b.contentEditable)=="false")text=text.slice(0,text.length-1);return text;}},{key:"readNode",value:function readNode(node){if(node.cmIgnore)return;var view=ContentView5.get(node);var fromView=view&&view.overrideDOMText;var text;if(fromView!=null)text=fromView.sliceString(0,void 0,this.lineBreak);else if(node.nodeType==3)text=this.readTextNode(node);else if(node.nodeName=="BR")text=node.nextSibling?this.lineBreak:"";else if(node.nodeType==1)this.readRange(node.firstChild,null);if(text!=null){this.findPointIn(node,text.length);this.text+=text;if(browser5.chrome&&this.view.inputState.lastKeyCode==13&&!node.nextSibling&&/\n\n$/.test(this.text))this.text=this.text.slice(0,-1);}}},{key:"findPointBefore",value:function findPointBefore(node,next){var _iterator311=_createForOfIteratorHelper(this.points),_step311;try{for(_iterator311.s();!(_step311=_iterator311.n()).done;){var point=_step311.value;if(point.node==node&&node.childNodes[point.offset]==next)point.pos=this.text.length;}}catch(err){_iterator311.e(err);}finally{_iterator311.f();}}},{key:"findPointIn",value:function findPointIn(node,maxLen){var _iterator312=_createForOfIteratorHelper(this.points),_step312;try{for(_iterator312.s();!(_step312=_iterator312.n()).done;){var point=_step312.value;if(point.node==node)point.pos=this.text.length+Math.min(point.offset,maxLen);}}catch(err){_iterator312.e(err);}finally{_iterator312.f();}}}]);return DOMReader5;}();function isBlockElement5(node){return node.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(node.nodeName);}var DOMPoint5=/*#__PURE__*/_createClass(function DOMPoint5(node,offset){_classCallCheck(this,DOMPoint5);this.node=node;this.offset=offset;this.pos=-1;});var DocView5=/*#__PURE__*/function(_ContentView32){_inherits(DocView5,_ContentView32);var _super107=_createSuper(DocView5);function DocView5(view){var _this188;_classCallCheck(this,DocView5);_this188=_super107.call(this);_this188.view=view;_this188.compositionDeco=Decoration5.none;_this188.decorations=[];_this188.pluginDecorationLength=0;_this188.minWidth=0;_this188.minWidthFrom=0;_this188.minWidthTo=0;_this188.impreciseAnchor=null;_this188.impreciseHead=null;_this188.forceSelection=false;_this188.lastUpdate=Date.now();_this188.setDOM(view.contentDOM);_this188.children=[new LineView5()];_this188.children[0].setParent(_assertThisInitialized(_this188));_this188.updateDeco();_this188.updateInner([new ChangedRange5(0,0,0,view.state.doc.length)],0);return _this188;}_createClass(DocView5,[{key:"root",get:function get(){return this.view.root;}},{key:"editorView",get:function get(){return this.view;}},{key:"length",get:function get(){return this.view.state.doc.length;}},{key:"update",value:function update(_update28){var _this189=this;var changedRanges=_update28.changedRanges;if(this.minWidth>0&&changedRanges.length){if(!changedRanges.every(function(_ref84){var fromA=_ref84.fromA,toA=_ref84.toA;return toA<_this189.minWidthFrom||fromA>_this189.minWidthTo;})){this.minWidth=this.minWidthFrom=this.minWidthTo=0;}else{this.minWidthFrom=_update28.changes.mapPos(this.minWidthFrom,1);this.minWidthTo=_update28.changes.mapPos(this.minWidthTo,1);}}if(this.view.inputState.composing<0)this.compositionDeco=Decoration5.none;else if(_update28.transactions.length||this.dirty)this.compositionDeco=computeCompositionDeco5(this.view,_update28.changes);if((browser5.ie||browser5.chrome)&&!this.compositionDeco.size&&_update28&&_update28.state.doc.lines!=_update28.startState.doc.lines)this.forceSelection=true;var prevDeco=this.decorations,deco=this.updateDeco();var decoDiff=findChangedDeco5(prevDeco,deco,_update28.changes);changedRanges=ChangedRange5.extendWithRanges(changedRanges,decoDiff);if(this.dirty==0&&changedRanges.length==0){return false;}else{this.updateInner(changedRanges,_update28.startState.doc.length);if(_update28.transactions.length)this.lastUpdate=Date.now();return true;}}},{key:"updateInner",value:function updateInner(changes,oldLength){var _this190=this;this.view.viewState.mustMeasureContent=true;this.updateChildren(changes,oldLength);var observer=this.view.observer;observer.ignore(function(){_this190.dom.style.height=_this190.view.viewState.contentHeight+"px";_this190.dom.style.minWidth=_this190.minWidth?_this190.minWidth+"px":"";var track=browser5.chrome||browser5.ios?{node:observer.selectionRange.focusNode,written:false}:void 0;_this190.sync(track);_this190.dirty=0;if(track&&(track.written||observer.selectionRange.focusNode!=track.node))_this190.forceSelection=true;_this190.dom.style.height="";});var gaps=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length){var _iterator313=_createForOfIteratorHelper(this.children),_step313;try{for(_iterator313.s();!(_step313=_iterator313.n()).done;){var child=_step313.value;if(child instanceof BlockWidgetView5&&child.widget instanceof BlockGapWidget5)gaps.push(child.dom);}}catch(err){_iterator313.e(err);}finally{_iterator313.f();}}observer.updateGaps(gaps);}},{key:"updateChildren",value:function updateChildren(changes,oldLength){var cursor2=this.childCursor(oldLength);for(var _i263=changes.length-1;;_i263--){var next=_i263>=0?changes[_i263]:null;if(!next)break;var fromA=next.fromA,toA=next.toA,fromB=next.fromB,toB=next.toB;var _ContentBuilder5$buil=ContentBuilder5.build(this.view.state.doc,fromB,toB,this.decorations,this.pluginDecorationLength),content2=_ContentBuilder5$buil.content,breakAtStart=_ContentBuilder5$buil.breakAtStart,openStart=_ContentBuilder5$buil.openStart,openEnd=_ContentBuilder5$buil.openEnd;var _cursor2$findPos9=cursor2.findPos(toA,1),toI=_cursor2$findPos9.i,toOff=_cursor2$findPos9.off;var _cursor2$findPos10=cursor2.findPos(fromA,-1),fromI=_cursor2$findPos10.i,fromOff=_cursor2$findPos10.off;replaceRange4(this,fromI,fromOff,toI,toOff,content2,breakAtStart,openStart,openEnd);}}},{key:"updateSelection",value:function updateSelection(){var _this191=this;var mustRead=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var fromPointer=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(mustRead)this.view.observer.readSelectionRange();if(!(fromPointer||this.mayControlSelection())||browser5.ios&&this.view.inputState.rapidCompositionStart)return;var force=this.forceSelection;this.forceSelection=false;var main=this.view.state.selection.main;var anchor=this.domAtPos(main.anchor);var head=main.empty?anchor:this.domAtPos(main.head);if(browser5.gecko&&main.empty&&betweenUneditable5(anchor)){var dummy=document.createTextNode("");this.view.observer.ignore(function(){return anchor.node.insertBefore(dummy,anchor.node.childNodes[anchor.offset]||null);});anchor=head=new DOMPos5(dummy,0);force=true;}var domSel=this.view.observer.selectionRange;if(force||!domSel.focusNode||!isEquivalentPosition5(anchor.node,anchor.offset,domSel.anchorNode,domSel.anchorOffset)||!isEquivalentPosition5(head.node,head.offset,domSel.focusNode,domSel.focusOffset)){this.view.observer.ignore(function(){if(browser5.android&&browser5.chrome&&_this191.dom.contains(domSel.focusNode)&&inUneditable5(domSel.focusNode,_this191.dom)){_this191.dom.blur();_this191.dom.focus({preventScroll:true});}var rawSel=getSelection5(_this191.root);if(main.empty){if(browser5.gecko){var nextTo=nextToUneditable5(anchor.node,anchor.offset);if(nextTo&&nextTo!=(1|2)){var _text13=nearbyTextNode5(anchor.node,anchor.offset,nextTo==1?1:-1);if(_text13)anchor=new DOMPos5(_text13,nextTo==1?0:_text13.nodeValue.length);}}rawSel.collapse(anchor.node,anchor.offset);if(main.bidiLevel!=null&&domSel.cursorBidiLevel!=null)domSel.cursorBidiLevel=main.bidiLevel;}else if(rawSel.extend){rawSel.collapse(anchor.node,anchor.offset);rawSel.extend(head.node,head.offset);}else{var range=document.createRange();if(main.anchor>main.head){var _ref85=[head,anchor];anchor=_ref85[0];head=_ref85[1];}range.setEnd(head.node,head.offset);range.setStart(anchor.node,anchor.offset);rawSel.removeAllRanges();rawSel.addRange(range);}});this.view.observer.setSelectionRange(anchor,head);}this.impreciseAnchor=anchor.precise?null:new DOMPos5(domSel.anchorNode,domSel.anchorOffset);this.impreciseHead=head.precise?null:new DOMPos5(domSel.focusNode,domSel.focusOffset);}},{key:"enforceCursorAssoc",value:function enforceCursorAssoc(){if(this.compositionDeco.size)return;var cursor2=this.view.state.selection.main;var sel=getSelection5(this.root);if(!cursor2.empty||!cursor2.assoc||!sel.modify)return;var line=LineView5.find(this,cursor2.head);if(!line)return;var lineStart=line.posAtStart;if(cursor2.head==lineStart||cursor2.head==lineStart+line.length)return;var before=this.coordsAt(cursor2.head,-1),after=this.coordsAt(cursor2.head,1);if(!before||!after||before.bottom>after.top)return;var dom=this.domAtPos(cursor2.head+cursor2.assoc);sel.collapse(dom.node,dom.offset);sel.modify("move",cursor2.assoc<0?"forward":"backward","lineboundary");}},{key:"mayControlSelection",value:function mayControlSelection(){return this.view.state.facet(editable5)?this.root.activeElement==this.dom:hasSelection5(this.dom,this.view.observer.selectionRange);}},{key:"nearest",value:function nearest(dom){for(var cur2=dom;cur2;){var domView=ContentView5.get(cur2);if(domView&&domView.rootView==this)return domView;cur2=cur2.parentNode;}return null;}},{key:"posFromDOM",value:function posFromDOM(node,offset){var view=this.nearest(node);if(!view)throw new RangeError("Trying to find position for a DOM position outside of the document");return view.localPosFromDOM(node,offset)+view.posAtStart;}},{key:"domAtPos",value:function domAtPos(pos){var _this$childCursor$fin5=this.childCursor().findPos(pos,-1),i=_this$childCursor$fin5.i,off=_this$childCursor$fin5.off;for(;i<this.children.length-1;){var child=this.children[i];if(off<child.length||child instanceof LineView5)break;i++;off=0;}return this.children[i].domAtPos(off);}},{key:"coordsAt",value:function coordsAt(pos,side){for(var off=this.length,_i264=this.children.length-1;;_i264--){var child=this.children[_i264],start=off-child.breakAfter-child.length;if(pos>start||pos==start&&child.type!=BlockType5.WidgetBefore&&child.type!=BlockType5.WidgetAfter&&(!_i264||side==2||this.children[_i264-1].breakAfter||this.children[_i264-1].type==BlockType5.WidgetBefore&&side>-2))return child.coordsAt(pos-start,side);off=start;}}},{key:"measureVisibleLineHeights",value:function measureVisibleLineHeights(){var result=[],_this$view$viewState$5=this.view.viewState.viewport,from=_this$view$viewState$5.from,to=_this$view$viewState$5.to;var contentWidth=this.view.contentDOM.clientWidth;var isWider=contentWidth>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;var widest=-1;for(var pos=0,_i265=0;_i265<this.children.length;_i265++){var child=this.children[_i265],end=pos+child.length;if(end>to)break;if(pos>=from){var childRect=child.dom.getBoundingClientRect();result.push(childRect.height);if(isWider){var last=child.dom.lastChild;var rects=last?clientRectsFor5(last):[];if(rects.length){var rect=rects[rects.length-1];var width=this.view.textDirection==Direction5.LTR?rect.right-childRect.left:childRect.right-rect.left;if(width>widest){widest=width;this.minWidth=contentWidth;this.minWidthFrom=pos;this.minWidthTo=end;}}}}pos=end+child.breakAfter;}return result;}},{key:"measureTextSize",value:function measureTextSize(){var _this192=this;var _iterator314=_createForOfIteratorHelper(this.children),_step314;try{for(_iterator314.s();!(_step314=_iterator314.n()).done;){var child=_step314.value;if(child instanceof LineView5){var measure=child.measureTextSize();if(measure)return measure;}}}catch(err){_iterator314.e(err);}finally{_iterator314.f();}var dummy=document.createElement("div"),lineHeight,charWidth;dummy.className="cm-line";dummy.textContent="abc def ghi jkl mno pqr stu";this.view.observer.ignore(function(){_this192.dom.appendChild(dummy);var rect=clientRectsFor5(dummy.firstChild)[0];lineHeight=dummy.getBoundingClientRect().height;charWidth=rect?rect.width/27:7;dummy.remove();});return{lineHeight:lineHeight,charWidth:charWidth};}},{key:"childCursor",value:function childCursor(){var pos=arguments.length>0&&arguments[0]!==undefined?arguments[0]:this.length;var i=this.children.length;if(i)pos-=this.children[--i].length;return new ChildCursor5(this.children,pos,i);}},{key:"computeBlockGapDeco",value:function computeBlockGapDeco(){var deco=[],vs=this.view.viewState;for(var pos=0,_i266=0;;_i266++){var next=_i266==vs.viewports.length?null:vs.viewports[_i266];var end=next?next.from-1:this.length;if(end>pos){var height=vs.lineBlockAt(end).bottom-vs.lineBlockAt(pos).top;deco.push(Decoration5.replace({widget:new BlockGapWidget5(height),block:true,inclusive:true}).range(pos,end));}if(!next)break;pos=next.to+1;}return Decoration5.set(deco);}},{key:"updateDeco",value:function updateDeco(){var pluginDecorations=this.view.pluginField(PluginField5.decorations);this.pluginDecorationLength=pluginDecorations.length;return this.decorations=[].concat(_toConsumableArray(pluginDecorations),_toConsumableArray(this.view.state.facet(decorations5)),[this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]);}},{key:"scrollIntoView",value:function scrollIntoView(target){var range=target.range;var rect=this.coordsAt(range.head,range.empty?range.assoc:range.head>range.anchor?-1:1),other;if(!rect)return;if(!range.empty&&(other=this.coordsAt(range.anchor,range.anchor>range.head?-1:1)))rect={left:Math.min(rect.left,other.left),top:Math.min(rect.top,other.top),right:Math.max(rect.right,other.right),bottom:Math.max(rect.bottom,other.bottom)};var mLeft=0,mRight=0,mTop=0,mBottom=0;var _iterator315=_createForOfIteratorHelper(this.view.pluginField(PluginField5.scrollMargins)),_step315;try{for(_iterator315.s();!(_step315=_iterator315.n()).done;){var margins=_step315.value;if(margins){var left=margins.left,right=margins.right,top2=margins.top,bottom=margins.bottom;if(left!=null)mLeft=Math.max(mLeft,left);if(right!=null)mRight=Math.max(mRight,right);if(top2!=null)mTop=Math.max(mTop,top2);if(bottom!=null)mBottom=Math.max(mBottom,bottom);}}}catch(err){_iterator315.e(err);}finally{_iterator315.f();}var targetRect={left:rect.left-mLeft,top:rect.top-mTop,right:rect.right+mRight,bottom:rect.bottom+mBottom};scrollRectIntoView5(this.view.scrollDOM,targetRect,range.head<range.anchor?-1:1,target.x,target.y,target.xMargin,target.yMargin,this.view.textDirection==Direction5.LTR);}}]);return DocView5;}(ContentView5);function betweenUneditable5(pos){return pos.node.nodeType==1&&pos.node.firstChild&&(pos.offset==0||pos.node.childNodes[pos.offset-1].contentEditable=="false")&&(pos.offset==pos.node.childNodes.length||pos.node.childNodes[pos.offset].contentEditable=="false");}var BlockGapWidget5=/*#__PURE__*/function(_WidgetType21){_inherits(BlockGapWidget5,_WidgetType21);var _super108=_createSuper(BlockGapWidget5);function BlockGapWidget5(height){var _this193;_classCallCheck(this,BlockGapWidget5);_this193=_super108.call(this);_this193.height=height;return _this193;}_createClass(BlockGapWidget5,[{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");this.updateDOM(elt);return elt;}},{key:"eq",value:function eq(other){return other.height==this.height;}},{key:"updateDOM",value:function updateDOM(elt){elt.style.height=this.height+"px";return true;}},{key:"estimatedHeight",get:function get(){return this.height;}}]);return BlockGapWidget5;}(WidgetType5);function compositionSurroundingNode4(view){var sel=view.observer.selectionRange;var textNode=sel.focusNode&&nearbyTextNode5(sel.focusNode,sel.focusOffset,0);if(!textNode)return null;var cView=view.docView.nearest(textNode);if(!cView)return null;if(cView instanceof LineView5){var topNode=textNode;while(topNode.parentNode!=cView.dom){topNode=topNode.parentNode;}var prev=topNode.previousSibling;while(prev&&!ContentView5.get(prev)){prev=prev.previousSibling;}var pos=prev?ContentView5.get(prev).posAtEnd:cView.posAtStart;return{from:pos,to:pos,node:topNode,text:textNode};}else{for(;;){var _cView4=cView,parent=_cView4.parent;if(!parent)return null;if(parent instanceof LineView5)break;cView=parent;}var from=cView.posAtStart;return{from:from,to:from+cView.length,node:cView.dom,text:textNode};}}function computeCompositionDeco5(view,changes){var surrounding=compositionSurroundingNode4(view);if(!surrounding)return Decoration5.none;var from=surrounding.from,to=surrounding.to,node=surrounding.node,textNode=surrounding.text;var newFrom=changes.mapPos(from,1),newTo=Math.max(newFrom,changes.mapPos(to,-1));var state=view.state,text=node.nodeType==3?node.nodeValue:new DOMReader5([],view).readRange(node.firstChild,null).text;if(newTo-newFrom<text.length){if(state.sliceDoc(newFrom,Math.min(state.doc.length,newFrom+text.length))==text)newTo=newFrom+text.length;else if(state.sliceDoc(Math.max(0,newTo-text.length),newTo)==text)newFrom=newTo-text.length;else return Decoration5.none;}else if(state.sliceDoc(newFrom,newTo)!=text){return Decoration5.none;}return Decoration5.set(Decoration5.replace({widget:new CompositionWidget5(node,textNode)}).range(newFrom,newTo));}var CompositionWidget5=/*#__PURE__*/function(_WidgetType22){_inherits(CompositionWidget5,_WidgetType22);var _super109=_createSuper(CompositionWidget5);function CompositionWidget5(top2,text){var _this194;_classCallCheck(this,CompositionWidget5);_this194=_super109.call(this);_this194.top=top2;_this194.text=text;return _this194;}_createClass(CompositionWidget5,[{key:"eq",value:function eq(other){return this.top==other.top&&this.text==other.text;}},{key:"toDOM",value:function toDOM(){return this.top;}},{key:"ignoreEvent",value:function ignoreEvent(){return false;}},{key:"customView",get:function get(){return CompositionView5;}}]);return CompositionWidget5;}(WidgetType5);function nearbyTextNode5(node,offset,side){for(;;){if(node.nodeType==3)return node;if(node.nodeType==1&&offset>0&&side<=0){node=node.childNodes[offset-1];offset=maxOffset5(node);}else if(node.nodeType==1&&offset<node.childNodes.length&&side>=0){node=node.childNodes[offset];offset=0;}else{return null;}}}function nextToUneditable5(node,offset){if(node.nodeType!=1)return 0;return(offset&&node.childNodes[offset-1].contentEditable=="false"?1:0)|(offset<node.childNodes.length&&node.childNodes[offset].contentEditable=="false"?2:0);}var DecorationComparator$15=/*#__PURE__*/function(){function DecorationComparator$15(){_classCallCheck(this,DecorationComparator$15);this.changes=[];}_createClass(DecorationComparator$15,[{key:"compareRange",value:function compareRange(from,to){addRange5(from,to,this.changes);}},{key:"comparePoint",value:function comparePoint(from,to){addRange5(from,to,this.changes);}}]);return DecorationComparator$15;}();function findChangedDeco5(a,b,diff){var comp=new DecorationComparator$15();RangeSet.compare(a,b,diff,comp);return comp.changes;}function inUneditable5(node,inside6){for(var cur2=node;cur2&&cur2!=inside6;cur2=cur2.assignedSlot||cur2.parentNode){if(cur2.nodeType==1&&cur2.contentEditable=="false"){return true;}}return false;}function groupAt5(state,pos){var bias=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var categorize=state.charCategorizer(pos);var line=state.doc.lineAt(pos),linePos=pos-line.from;if(line.length==0)return EditorSelection.cursor(pos);if(linePos==0)bias=1;else if(linePos==line.length)bias=-1;var from=linePos,to=linePos;if(bias<0)from=findClusterBreak(line.text,linePos,false);else to=findClusterBreak(line.text,linePos);var cat=categorize(line.text.slice(from,to));while(from>0){var prev=findClusterBreak(line.text,from,false);if(categorize(line.text.slice(prev,from))!=cat)break;from=prev;}while(to<line.length){var next=findClusterBreak(line.text,to);if(categorize(line.text.slice(to,next))!=cat)break;to=next;}return EditorSelection.range(from+line.from,to+line.from);}function getdx5(x,rect){return rect.left>x?rect.left-x:Math.max(0,x-rect.right);}function getdy5(y,rect){return rect.top>y?rect.top-y:Math.max(0,y-rect.bottom);}function yOverlap5(a,b){return a.top<b.bottom-1&&a.bottom>b.top+1;}function upTop5(rect,top2){return top2<rect.top?{top:top2,left:rect.left,right:rect.right,bottom:rect.bottom}:rect;}function upBot5(rect,bottom){return bottom>rect.bottom?{top:rect.top,left:rect.left,right:rect.right,bottom:bottom}:rect;}function domPosAtCoords5(parent,x,y){var closest,closestRect,closestX,closestY;var above,below,aboveRect,belowRect;for(var child=parent.firstChild;child;child=child.nextSibling){var rects=clientRectsFor5(child);for(var _i267=0;_i267<rects.length;_i267++){var rect=rects[_i267];if(closestRect&&yOverlap5(closestRect,rect))rect=upTop5(upBot5(rect,closestRect.bottom),closestRect.top);var dx=getdx5(x,rect),dy=getdy5(y,rect);if(dx==0&&dy==0)return child.nodeType==3?domPosInText5(child,x,y):domPosAtCoords5(child,x,y);if(!closest||closestY>dy||closestY==dy&&closestX>dx){closest=child;closestRect=rect;closestX=dx;closestY=dy;}if(dx==0){if(y>rect.bottom&&(!aboveRect||aboveRect.bottom<rect.bottom)){above=child;aboveRect=rect;}else if(y<rect.top&&(!belowRect||belowRect.top>rect.top)){below=child;belowRect=rect;}}else if(aboveRect&&yOverlap5(aboveRect,rect)){aboveRect=upBot5(aboveRect,rect.bottom);}else if(belowRect&&yOverlap5(belowRect,rect)){belowRect=upTop5(belowRect,rect.top);}}}if(aboveRect&&aboveRect.bottom>=y){closest=above;closestRect=aboveRect;}else if(belowRect&&belowRect.top<=y){closest=below;closestRect=belowRect;}if(!closest)return{node:parent,offset:0};var clipX=Math.max(closestRect.left,Math.min(closestRect.right,x));if(closest.nodeType==3)return domPosInText5(closest,clipX,y);if(!closestX&&closest.contentEditable=="true")return domPosAtCoords5(closest,clipX,y);var offset=Array.prototype.indexOf.call(parent.childNodes,closest)+(x>=(closestRect.left+closestRect.right)/2?1:0);return{node:parent,offset:offset};}function domPosInText5(node,x,y){var len=node.nodeValue.length;var closestOffset=-1,closestDY=1e9,generalSide=0;for(var _i268=0;_i268<len;_i268++){var rects=textRange5(node,_i268,_i268+1).getClientRects();for(var j=0;j<rects.length;j++){var rect=rects[j];if(rect.top==rect.bottom)continue;if(!generalSide)generalSide=x-rect.left;var dy=(rect.top>y?rect.top-y:y-rect.bottom)-1;if(rect.left-1<=x&&rect.right+1>=x&&dy<closestDY){var right=x>=(rect.left+rect.right)/2,after=right;if(browser5.chrome||browser5.gecko){var rectBefore=textRange5(node,_i268).getBoundingClientRect();if(rectBefore.left==rect.right)after=!right;}if(dy<=0)return{node:node,offset:_i268+(after?1:0)};closestOffset=_i268+(after?1:0);closestDY=dy;}}}return{node:node,offset:closestOffset>-1?closestOffset:generalSide>0?node.nodeValue.length:0};}function posAtCoords5(view,_ref86,precise){var x=_ref86.x,y=_ref86.y;var bias=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;var _a;var content2=view.contentDOM.getBoundingClientRect(),docTop=content2.top+view.viewState.paddingTop;var block,docHeight=view.viewState.docHeight;var yOffset=y-docTop;if(yOffset<0)return 0;if(yOffset>docHeight)return view.state.doc.length;for(var halfLine=view.defaultLineHeight/2,bounced=false;;){block=view.elementAtHeight(yOffset);if(block.type==BlockType5.Text)break;for(;;){yOffset=bias>0?block.bottom+halfLine:block.top-halfLine;if(yOffset>=0&&yOffset<=docHeight)break;if(bounced)return precise?null:0;bounced=true;bias=-bias;}}y=docTop+yOffset;var lineStart=block.from;if(lineStart<view.viewport.from)return view.viewport.from==0?0:precise?null:posAtCoordsImprecise5(view,content2,block,x,y);if(lineStart>view.viewport.to)return view.viewport.to==view.state.doc.length?view.state.doc.length:precise?null:posAtCoordsImprecise5(view,content2,block,x,y);var doc6=view.dom.ownerDocument;var root=view.root.elementFromPoint?view.root:doc6;var element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null;if(!element){x=Math.max(content2.left+1,Math.min(content2.right-1,x));element=root.elementFromPoint(x,y);if(element&&!view.contentDOM.contains(element))element=null;}var node,offset=-1;if(element&&((_a=view.docView.nearest(element))===null||_a===void 0?void 0:_a.isEditable)!=false){if(doc6.caretPositionFromPoint){var pos=doc6.caretPositionFromPoint(x,y);if(pos){node=pos.offsetNode;offset=pos.offset;}}else if(doc6.caretRangeFromPoint){var range=doc6.caretRangeFromPoint(x,y);if(range){node=range.startContainer;offset=range.startOffset;if(browser5.safari&&isSuspiciousCaretResult5(node,offset,x))node=void 0;}}}if(!node||!view.docView.dom.contains(node)){var line=LineView5.find(view.docView,lineStart);if(!line)return yOffset>block.top+block.height/2?block.to:block.from;var _domPosAtCoords5=domPosAtCoords5(line.dom,x,y);node=_domPosAtCoords5.node;offset=_domPosAtCoords5.offset;}return view.docView.posFromDOM(node,offset);}function posAtCoordsImprecise5(view,contentRect,block,x,y){var into=Math.round((x-contentRect.left)*view.defaultCharacterWidth);if(view.lineWrapping&&block.height>view.defaultLineHeight*1.5){var line=Math.floor((y-block.top)/view.defaultLineHeight);into+=line*view.viewState.heightOracle.lineLength;}var content2=view.state.sliceDoc(block.from,block.to);return block.from+findColumn(content2,into,view.state.tabSize);}function isSuspiciousCaretResult5(node,offset,x){var len;if(node.nodeType!=3||offset!=(len=node.nodeValue.length))return false;for(var next=node.nextSibling;next;next=next.nextSibling){if(next.nodeType!=1||next.nodeName!="BR")return false;}return textRange5(node,len-1,len).getBoundingClientRect().left>x;}function moveToLineBoundary5(view,start,forward,includeWrap){var line=view.state.doc.lineAt(start.head);var coords=!includeWrap||!view.lineWrapping?null:view.coordsAtPos(start.assoc<0&&start.head>line.from?start.head-1:start.head);if(coords){var editorRect=view.dom.getBoundingClientRect();var pos=view.posAtCoords({x:forward==(view.textDirection==Direction5.LTR)?editorRect.right-1:editorRect.left+1,y:(coords.top+coords.bottom)/2});if(pos!=null)return EditorSelection.cursor(pos,forward?-1:1);}var lineView=LineView5.find(view.docView,start.head);var end=lineView?forward?lineView.posAtEnd:lineView.posAtStart:forward?line.to:line.from;return EditorSelection.cursor(end,forward?-1:1);}function moveByChar5(view,start,forward,by){var line=view.state.doc.lineAt(start.head),spans=view.bidiSpans(line);for(var cur2=start,check=null;;){var next=moveVisually5(line,spans,view.textDirection,cur2,forward),_char6=movedOver5;if(!next){if(line.number==(forward?view.state.doc.lines:1))return cur2;_char6="\n";line=view.state.doc.line(line.number+(forward?1:-1));spans=view.bidiSpans(line);next=EditorSelection.cursor(forward?line.from:line.to);}if(!check){if(!by)return next;check=by(_char6);}else if(!check(_char6)){return cur2;}cur2=next;}}function byGroup5(view,pos,start){var categorize=view.state.charCategorizer(pos);var cat=categorize(start);return function(next){var nextCat=categorize(next);if(cat==CharCategory.Space)cat=nextCat;return cat==nextCat;};}function moveVertically5(view,start,forward,distance){var startPos=start.head,dir=forward?1:-1;if(startPos==(forward?view.state.doc.length:0))return EditorSelection.cursor(startPos,start.assoc);var goal=start.goalColumn,startY;var rect=view.contentDOM.getBoundingClientRect();var startCoords=view.coordsAtPos(startPos),docTop=view.documentTop;if(startCoords){if(goal==null)goal=startCoords.left-rect.left;startY=dir<0?startCoords.top:startCoords.bottom;}else{var line=view.viewState.lineBlockAt(startPos-docTop);if(goal==null)goal=Math.min(rect.right-rect.left,view.defaultCharacterWidth*(startPos-line.from));startY=(dir<0?line.top:line.bottom)+docTop;}var resolvedGoal=rect.left+goal;var dist=distance!==null&&distance!==void 0?distance:view.defaultLineHeight>>1;for(var extra=0;;extra+=10){var curY=startY+(dist+extra)*dir;var pos=posAtCoords5(view,{x:resolvedGoal,y:curY},false,dir);if(curY<rect.top||curY>rect.bottom||(dir<0?pos<startPos:pos>startPos))return EditorSelection.cursor(pos,start.assoc,void 0,goal);}}function skipAtoms5(view,oldPos,pos){var atoms=view.pluginField(PluginField5.atomicRanges);for(;;){var moved=false;var _iterator316=_createForOfIteratorHelper(atoms),_step316;try{for(_iterator316.s();!(_step316=_iterator316.n()).done;){var set=_step316.value;set.between(pos.from-1,pos.from+1,function(from,to,value){if(pos.from>from&&pos.from<to){pos=oldPos.from>pos.from?EditorSelection.cursor(from,1):EditorSelection.cursor(to,-1);moved=true;}});}}catch(err){_iterator316.e(err);}finally{_iterator316.f();}if(!moved)return pos;}}var InputState5=/*#__PURE__*/function(){function InputState5(view){var _this195=this;_classCallCheck(this,InputState5);this.lastKeyCode=0;this.lastKeyTime=0;this.pendingIOSKey=void 0;this.lastSelectionOrigin=null;this.lastSelectionTime=0;this.lastEscPress=0;this.lastContextMenu=0;this.scrollHandlers=[];this.registeredEvents=[];this.customHandlers=[];this.composing=-1;this.compositionFirstChange=null;this.compositionEndedAt=0;this.rapidCompositionStart=false;this.mouseSelection=null;var _loop34=function _loop34(type){var handler=handlers5[type];view.contentDOM.addEventListener(type,function(event){if(type=="keydown"&&_this195.keydown(view,event))return;if(!eventBelongsToEditor5(view,event)||_this195.ignoreDuringComposition(event))return;if(_this195.mustFlushObserver(event))view.observer.forceFlush();if(_this195.runCustomHandlers(type,view,event))event.preventDefault();else handler(view,event);});_this195.registeredEvents.push(type);};for(var type in handlers5){_loop34(type);}this.notifiedFocused=view.hasFocus;this.ensureHandlers(view);if(browser5.safari)view.contentDOM.addEventListener("input",function(){return null;});}_createClass(InputState5,[{key:"setSelectionOrigin",value:function setSelectionOrigin(origin){this.lastSelectionOrigin=origin;this.lastSelectionTime=Date.now();}},{key:"ensureHandlers",value:function ensureHandlers(view){var _this196=this;var handlers6=this.customHandlers=view.pluginField(domEventHandlers5);var _iterator317=_createForOfIteratorHelper(handlers6),_step317;try{for(_iterator317.s();!(_step317=_iterator317.n()).done;){var set=_step317.value;var _loop35=function _loop35(type){if(_this196.registeredEvents.indexOf(type)<0&&type!="scroll"){_this196.registeredEvents.push(type);view.contentDOM.addEventListener(type,function(event){if(!eventBelongsToEditor5(view,event))return;if(_this196.runCustomHandlers(type,view,event))event.preventDefault();});}};for(var type in set.handlers){_loop35(type);}}}catch(err){_iterator317.e(err);}finally{_iterator317.f();}}},{key:"runCustomHandlers",value:function runCustomHandlers(type,view,event){var _iterator318=_createForOfIteratorHelper(this.customHandlers),_step318;try{for(_iterator318.s();!(_step318=_iterator318.n()).done;){var set=_step318.value;var handler=set.handlers[type];if(handler){try{if(handler.call(set.plugin,event,view)||event.defaultPrevented)return true;}catch(e){logException5(view.state,e);}}}}catch(err){_iterator318.e(err);}finally{_iterator318.f();}return false;}},{key:"runScrollHandlers",value:function runScrollHandlers(view,event){var _iterator319=_createForOfIteratorHelper(this.customHandlers),_step319;try{for(_iterator319.s();!(_step319=_iterator319.n()).done;){var set=_step319.value;var handler=set.handlers.scroll;if(handler){try{handler.call(set.plugin,event,view);}catch(e){logException5(view.state,e);}}}}catch(err){_iterator319.e(err);}finally{_iterator319.f();}}},{key:"keydown",value:function keydown(view,event){var _this197=this;this.lastKeyCode=event.keyCode;this.lastKeyTime=Date.now();if(this.screenKeyEvent(view,event))return true;if(browser5.android&&browser5.chrome&&!event.synthetic&&(event.keyCode==13||event.keyCode==8)){view.observer.delayAndroidKey(event.key,event.keyCode);return true;}var pending;if(browser5.ios&&(pending=PendingKeys5.find(function(key){return key.keyCode==event.keyCode;}))&&!(event.ctrlKey||event.altKey||event.metaKey)&&!event.synthetic){this.pendingIOSKey=pending;setTimeout(function(){return _this197.flushIOSKey(view);},250);return true;}return false;}},{key:"flushIOSKey",value:function flushIOSKey(view){var key=this.pendingIOSKey;if(!key)return false;this.pendingIOSKey=void 0;return dispatchKey5(view.contentDOM,key.key,key.keyCode);}},{key:"ignoreDuringComposition",value:function ignoreDuringComposition(event){if(!/^key/.test(event.type))return false;if(this.composing>0)return true;if(browser5.safari&&Date.now()-this.compositionEndedAt<500){this.compositionEndedAt=0;return true;}return false;}},{key:"screenKeyEvent",value:function screenKeyEvent(view,event){var protectedTab=event.keyCode==9&&Date.now()<this.lastEscPress+2e3;if(event.keyCode==27)this.lastEscPress=Date.now();else if(modifierCodes5.indexOf(event.keyCode)<0)this.lastEscPress=0;return protectedTab;}},{key:"mustFlushObserver",value:function mustFlushObserver(event){return event.type=="keydown"&&event.keyCode!=229||event.type=="compositionend"&&!browser5.ios;}},{key:"startMouseSelection",value:function startMouseSelection(mouseSelection){if(this.mouseSelection)this.mouseSelection.destroy();this.mouseSelection=mouseSelection;}},{key:"update",value:function update(_update29){if(this.mouseSelection)this.mouseSelection.update(_update29);if(_update29.transactions.length)this.lastKeyCode=this.lastSelectionTime=0;}},{key:"destroy",value:function destroy(){if(this.mouseSelection)this.mouseSelection.destroy();}}]);return InputState5;}();var PendingKeys5=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}];var modifierCodes5=[16,17,18,20,91,92,224,225];var MouseSelection5=/*#__PURE__*/function(){function MouseSelection5(view,startEvent,style,mustSelect){_classCallCheck(this,MouseSelection5);this.view=view;this.style=style;this.mustSelect=mustSelect;this.lastEvent=startEvent;var doc6=view.contentDOM.ownerDocument;doc6.addEventListener("mousemove",this.move=this.move.bind(this));doc6.addEventListener("mouseup",this.up=this.up.bind(this));this.extend=startEvent.shiftKey;this.multiple=view.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange5(view,startEvent);this.dragMove=dragMovesSelection5(view,startEvent);this.dragging=isInPrimarySelection5(view,startEvent)&&getClickType5(startEvent)==1?null:false;if(this.dragging===false){startEvent.preventDefault();this.select(startEvent);}}_createClass(MouseSelection5,[{key:"move",value:function move(event){if(event.buttons==0)return this.destroy();if(this.dragging!==false)return;this.select(this.lastEvent=event);}},{key:"up",value:function up(event){if(this.dragging==null)this.select(this.lastEvent);if(!this.dragging)event.preventDefault();this.destroy();}},{key:"destroy",value:function destroy(){var doc6=this.view.contentDOM.ownerDocument;doc6.removeEventListener("mousemove",this.move);doc6.removeEventListener("mouseup",this.up);this.view.inputState.mouseSelection=null;}},{key:"select",value:function select(event){var selection2=this.style.get(event,this.extend,this.multiple);if(this.mustSelect||!selection2.eq(this.view.state.selection)||selection2.main.assoc!=this.view.state.selection.main.assoc)this.view.dispatch({selection:selection2,userEvent:"select.pointer",scrollIntoView:true});this.mustSelect=false;}},{key:"update",value:function update(_update30){var _this198=this;if(_update30.docChanged&&this.dragging)this.dragging=this.dragging.map(_update30.changes);if(this.style.update(_update30))setTimeout(function(){return _this198.select(_this198.lastEvent);},20);}}]);return MouseSelection5;}();function addsSelectionRange5(view,event){var facet=view.state.facet(clickAddsSelectionRange5);return facet.length?facet[0](event):browser5.mac?event.metaKey:event.ctrlKey;}function dragMovesSelection5(view,event){var facet=view.state.facet(dragMovesSelection$15);return facet.length?facet[0](event):browser5.mac?!event.altKey:!event.ctrlKey;}function isInPrimarySelection5(view,event){var main=view.state.selection.main;if(main.empty)return false;var sel=getSelection5(view.root);if(sel.rangeCount==0)return true;var rects=sel.getRangeAt(0).getClientRects();for(var _i269=0;_i269<rects.length;_i269++){var rect=rects[_i269];if(rect.left<=event.clientX&&rect.right>=event.clientX&&rect.top<=event.clientY&&rect.bottom>=event.clientY)return true;}return false;}function eventBelongsToEditor5(view,event){if(!event.bubbles)return true;if(event.defaultPrevented)return false;for(var node=event.target,cView;node!=view.contentDOM;node=node.parentNode){if(!node||node.nodeType==11||(cView=ContentView5.get(node))&&cView.ignoreEvent(event))return false;}return true;}var handlers5=/* @__PURE__ */Object.create(null);var brokenClipboardAPI5=browser5.ie&&browser5.ie_version<15||browser5.ios&&browser5.webkit_version<604;function capturePaste5(view){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.focus();setTimeout(function(){view.focus();target.remove();doPaste5(view,target.value);},50);}function doPaste5(view,input){var state=view.state,changes,i=1,text=state.toText(input);var byLine=text.lines==state.selection.ranges.length;var linewise=lastLinewiseCopy5!=null&&state.selection.ranges.every(function(r){return r.empty;})&&lastLinewiseCopy5==text.toString();if(linewise){var lastLine=-1;changes=state.changeByRange(function(range){var line=state.doc.lineAt(range.from);if(line.from==lastLine)return{range:range};lastLine=line.from;var insert2=state.toText((byLine?text.line(i++).text:input)+state.lineBreak);return{changes:{from:line.from,insert:insert2},range:EditorSelection.cursor(range.from+insert2.length)};});}else if(byLine){changes=state.changeByRange(function(range){var line=text.line(i++);return{changes:{from:range.from,to:range.to,insert:line.text},range:EditorSelection.cursor(range.from+line.length)};});}else{changes=state.replaceSelection(text);}view.dispatch(changes,{userEvent:"input.paste",scrollIntoView:true});}handlers5.keydown=function(view,event){view.inputState.setSelectionOrigin("select");};var lastTouch5=0;handlers5.touchstart=function(view,e){lastTouch5=Date.now();view.inputState.setSelectionOrigin("select.pointer");};handlers5.touchmove=function(view){view.inputState.setSelectionOrigin("select.pointer");};handlers5.mousedown=function(view,event){view.observer.flush();if(lastTouch5>Date.now()-2e3&&getClickType5(event)==1)return;var style=null;var _iterator320=_createForOfIteratorHelper(view.state.facet(mouseSelectionStyle5)),_step320;try{for(_iterator320.s();!(_step320=_iterator320.n()).done;){var makeStyle=_step320.value;style=makeStyle(view,event);if(style)break;}}catch(err){_iterator320.e(err);}finally{_iterator320.f();}if(!style&&event.button==0)style=basicMouseSelection5(view,event);if(style){var mustFocus=view.root.activeElement!=view.contentDOM;if(mustFocus)view.observer.ignore(function(){return focusPreventScroll5(view.contentDOM);});view.inputState.startMouseSelection(new MouseSelection5(view,event,style,mustFocus));}};function rangeForClick5(view,pos,bias,type){if(type==1){return EditorSelection.cursor(pos,bias);}else if(type==2){return groupAt5(view.state,pos,bias);}else{var visual=LineView5.find(view.docView,pos),line=view.state.doc.lineAt(visual?visual.posAtEnd:pos);var from=visual?visual.posAtStart:line.from,to=visual?visual.posAtEnd:line.to;if(to<view.state.doc.length&&to==line.to)to++;return EditorSelection.range(from,to);}}var insideY5=function insideY5(y,rect){return y>=rect.top&&y<=rect.bottom;};var inside5=function inside5(x,y,rect){return insideY5(y,rect)&&x>=rect.left&&x<=rect.right;};function findPositionSide5(view,pos,x,y){var line=LineView5.find(view.docView,pos);if(!line)return 1;var off=pos-line.posAtStart;if(off==0)return 1;if(off==line.length)return-1;var before=line.coordsAt(off,-1);if(before&&inside5(x,y,before))return-1;var after=line.coordsAt(off,1);if(after&&inside5(x,y,after))return 1;return before&&insideY5(y,before)?-1:1;}function queryPos5(view,event){var pos=view.posAtCoords({x:event.clientX,y:event.clientY},false);return{pos:pos,bias:findPositionSide5(view,pos,event.clientX,event.clientY)};}var BadMouseDetail5=browser5.ie&&browser5.ie_version<=11;var lastMouseDown5=null;var lastMouseDownCount5=0;var lastMouseDownTime5=0;function getClickType5(event){if(!BadMouseDetail5)return event.detail;var last=lastMouseDown5,lastTime=lastMouseDownTime5;lastMouseDown5=event;lastMouseDownTime5=Date.now();return lastMouseDownCount5=!last||lastTime>Date.now()-400&&Math.abs(last.clientX-event.clientX)<2&&Math.abs(last.clientY-event.clientY)<2?(lastMouseDownCount5+1)%3:1;}function basicMouseSelection5(view,event){var start=queryPos5(view,event),type=getClickType5(event);var startSel=view.state.selection;var last=start,lastEvent=event;return{update:function update(_update31){if(_update31.docChanged){if(start)start.pos=_update31.changes.mapPos(start.pos);startSel=startSel.map(_update31.changes);lastEvent=null;}},get:function get(event2,extend2,multiple){var cur2;if(lastEvent&&event2.clientX==lastEvent.clientX&&event2.clientY==lastEvent.clientY)cur2=last;else{cur2=last=queryPos5(view,event2);lastEvent=event2;}if(!cur2||!start)return startSel;var range=rangeForClick5(view,cur2.pos,cur2.bias,type);if(start.pos!=cur2.pos&&!extend2){var startRange=rangeForClick5(view,start.pos,start.bias,type);var from=Math.min(startRange.from,range.from),to=Math.max(startRange.to,range.to);range=from<range.from?EditorSelection.range(from,to):EditorSelection.range(to,from);}if(extend2)return startSel.replaceRange(startSel.main.extend(range.from,range.to));else if(multiple)return startSel.addRange(range);else return EditorSelection.create([range]);}};}handlers5.dragstart=function(view,event){var main=view.state.selection.main;var mouseSelection=view.inputState.mouseSelection;if(mouseSelection)mouseSelection.dragging=main;if(event.dataTransfer){event.dataTransfer.setData("Text",view.state.sliceDoc(main.from,main.to));event.dataTransfer.effectAllowed="copyMove";}};function dropText5(view,event,text,direct){if(!text)return;var dropPos=view.posAtCoords({x:event.clientX,y:event.clientY},false);event.preventDefault();var mouseSelection=view.inputState.mouseSelection;var del=direct&&mouseSelection&&mouseSelection.dragging&&mouseSelection.dragMove?{from:mouseSelection.dragging.from,to:mouseSelection.dragging.to}:null;var ins={from:dropPos,insert:text};var changes=view.state.changes(del?[del,ins]:ins);view.focus();view.dispatch({changes:changes,selection:{anchor:changes.mapPos(dropPos,-1),head:changes.mapPos(dropPos,1)},userEvent:del?"move.drop":"input.drop"});}handlers5.drop=function(view,event){if(!event.dataTransfer)return;if(view.state.readOnly)return event.preventDefault();var files=event.dataTransfer.files;if(files&&files.length){(function(){event.preventDefault();var text=Array(files.length),read=0;var finishFile=function finishFile(){if(++read==files.length)dropText5(view,event,text.filter(function(s){return s!=null;}).join(view.state.lineBreak),false);};var _loop36=function _loop36(_i270){var reader=new FileReader();reader.onerror=finishFile;reader.onload=function(){if(!/[\x00-\x08\x0e-\x1f]{2}/.test(reader.result))text[_i270]=reader.result;finishFile();};reader.readAsText(files[_i270]);};for(var _i270=0;_i270<files.length;_i270++){_loop36(_i270);}})();}else{dropText5(view,event,event.dataTransfer.getData("Text"),true);}};handlers5.paste=function(view,event){if(view.state.readOnly)return event.preventDefault();view.observer.flush();var data=brokenClipboardAPI5?null:event.clipboardData;if(data){doPaste5(view,data.getData("text/plain"));event.preventDefault();}else{capturePaste5(view);}};function captureCopy5(view,text){var parent=view.dom.parentNode;if(!parent)return;var target=parent.appendChild(document.createElement("textarea"));target.style.cssText="position: fixed; left: -10000px; top: 10px";target.value=text;target.focus();target.selectionEnd=text.length;target.selectionStart=0;setTimeout(function(){target.remove();view.focus();},50);}function copiedRange5(state){var content2=[],ranges=[],linewise=false;var _iterator321=_createForOfIteratorHelper(state.selection.ranges),_step321;try{for(_iterator321.s();!(_step321=_iterator321.n()).done;){var range=_step321.value;if(!range.empty){content2.push(state.sliceDoc(range.from,range.to));ranges.push(range);}}}catch(err){_iterator321.e(err);}finally{_iterator321.f();}if(!content2.length){var upto=-1;var _iterator322=_createForOfIteratorHelper(state.selection.ranges),_step322;try{for(_iterator322.s();!(_step322=_iterator322.n()).done;){var from=_step322.value.from;var line=state.doc.lineAt(from);if(line.number>upto){content2.push(line.text);ranges.push({from:line.from,to:Math.min(state.doc.length,line.to+1)});}upto=line.number;}}catch(err){_iterator322.e(err);}finally{_iterator322.f();}linewise=true;}return{text:content2.join(state.lineBreak),ranges:ranges,linewise:linewise};}var lastLinewiseCopy5=null;handlers5.copy=handlers5.cut=function(view,event){var _copiedRange5=copiedRange5(view.state),text=_copiedRange5.text,ranges=_copiedRange5.ranges,linewise=_copiedRange5.linewise;if(!text&&!linewise)return;lastLinewiseCopy5=linewise?text:null;var data=brokenClipboardAPI5?null:event.clipboardData;if(data){event.preventDefault();data.clearData();data.setData("text/plain",text);}else{captureCopy5(view,text);}if(event.type=="cut"&&!view.state.readOnly)view.dispatch({changes:ranges,scrollIntoView:true,userEvent:"delete.cut"});};handlers5.focus=handlers5.blur=function(view){setTimeout(function(){if(view.hasFocus!=view.inputState.notifiedFocused)view.update([]);},10);};handlers5.beforeprint=function(view){view.viewState.printing=true;view.requestMeasure();setTimeout(function(){view.viewState.printing=false;view.requestMeasure();},2e3);};function forceClearComposition5(view,rapid){if(view.docView.compositionDeco.size){view.inputState.rapidCompositionStart=rapid;try{view.update([]);}finally{view.inputState.rapidCompositionStart=false;}}}handlers5.compositionstart=handlers5.compositionupdate=function(view){if(view.inputState.compositionFirstChange==null)view.inputState.compositionFirstChange=true;if(view.inputState.composing<0){view.inputState.composing=0;if(view.docView.compositionDeco.size){view.observer.flush();forceClearComposition5(view,true);}}};handlers5.compositionend=function(view){view.inputState.composing=-1;view.inputState.compositionEndedAt=Date.now();view.inputState.compositionFirstChange=null;setTimeout(function(){if(view.inputState.composing<0)forceClearComposition5(view,false);},50);};handlers5.contextmenu=function(view){view.inputState.lastContextMenu=Date.now();};handlers5.beforeinput=function(view,event){var _a;var pending;if(browser5.chrome&&browser5.android&&(pending=PendingKeys5.find(function(key){return key.inputType==event.inputType;}))){view.observer.delayAndroidKey(pending.key,pending.keyCode);if(pending.key=="Backspace"||pending.key=="Delete"){var startViewHeight=((_a=window.visualViewport)===null||_a===void 0?void 0:_a.height)||0;setTimeout(function(){var _a2;if((((_a2=window.visualViewport)===null||_a2===void 0?void 0:_a2.height)||0)>startViewHeight+10&&view.hasFocus){view.contentDOM.blur();view.focus();}},100);}}};var wrappingWhiteSpace5=["pre-wrap","normal","pre-line","break-spaces"];var HeightOracle5=/*#__PURE__*/function(){function HeightOracle5(){_classCallCheck(this,HeightOracle5);this.doc=Text.empty;this.lineWrapping=false;this.direction=Direction5.LTR;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.lineLength=30;this.heightChanged=false;}_createClass(HeightOracle5,[{key:"heightForGap",value:function heightForGap(from,to){var lines=this.doc.lineAt(to).number-this.doc.lineAt(from).number+1;if(this.lineWrapping)lines+=Math.ceil((to-from-lines*this.lineLength*0.5)/this.lineLength);return this.lineHeight*lines;}},{key:"heightForLine",value:function heightForLine(length){if(!this.lineWrapping)return this.lineHeight;var lines=1+Math.max(0,Math.ceil((length-this.lineLength)/(this.lineLength-5)));return lines*this.lineHeight;}},{key:"setDoc",value:function setDoc(doc6){this.doc=doc6;return this;}},{key:"mustRefreshForStyle",value:function mustRefreshForStyle(whiteSpace,direction){return wrappingWhiteSpace5.indexOf(whiteSpace)>-1!=this.lineWrapping||this.direction!=direction;}},{key:"mustRefreshForHeights",value:function mustRefreshForHeights(lineHeights){var newHeight=false;for(var _i271=0;_i271<lineHeights.length;_i271++){var h=lineHeights[_i271];if(h<0){_i271++;}else if(!this.heightSamples[Math.floor(h*10)]){newHeight=true;this.heightSamples[Math.floor(h*10)]=true;}}return newHeight;}},{key:"refresh",value:function refresh(whiteSpace,direction,lineHeight,charWidth,lineLength,knownHeights){var lineWrapping=wrappingWhiteSpace5.indexOf(whiteSpace)>-1;var changed=Math.round(lineHeight)!=Math.round(this.lineHeight)||this.lineWrapping!=lineWrapping||this.direction!=direction;this.lineWrapping=lineWrapping;this.direction=direction;this.lineHeight=lineHeight;this.charWidth=charWidth;this.lineLength=lineLength;if(changed){this.heightSamples={};for(var _i272=0;_i272<knownHeights.length;_i272++){var h=knownHeights[_i272];if(h<0)_i272++;else this.heightSamples[Math.floor(h*10)]=true;}}return changed;}}]);return HeightOracle5;}();var MeasuredHeights5=/*#__PURE__*/function(){function MeasuredHeights5(from,heights){_classCallCheck(this,MeasuredHeights5);this.from=from;this.heights=heights;this.index=0;}_createClass(MeasuredHeights5,[{key:"more",get:function get(){return this.index<this.heights.length;}}]);return MeasuredHeights5;}();var BlockInfo5=/*#__PURE__*/function(){function BlockInfo5(from,length,top2,height,type){_classCallCheck(this,BlockInfo5);this.from=from;this.length=length;this.top=top2;this.height=height;this.type=type;}_createClass(BlockInfo5,[{key:"to",get:function get(){return this.from+this.length;}},{key:"bottom",get:function get(){return this.top+this.height;}},{key:"join",value:function join(other){var detail=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(other.type)?other.type:[other]);return new BlockInfo5(this.from,this.length+other.length,this.top,this.height+other.height,detail);}},{key:"moveY",value:function moveY(offset){return!offset?this:new BlockInfo5(this.from,this.length,this.top+offset,this.height,Array.isArray(this.type)?this.type.map(function(b){return b.moveY(offset);}):this.type);}}]);return BlockInfo5;}();var QueryType5=/* @__PURE__ */function(QueryType7){QueryType7[QueryType7["ByPos"]=0]="ByPos";QueryType7[QueryType7["ByHeight"]=1]="ByHeight";QueryType7[QueryType7["ByPosNoHeight"]=2]="ByPosNoHeight";return QueryType7;}(QueryType5||(QueryType5={}));var Epsilon5=1e-3;var HeightMap5=/*#__PURE__*/function(){function HeightMap5(length,height){var flags=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;_classCallCheck(this,HeightMap5);this.length=length;this.height=height;this.flags=flags;}_createClass(HeightMap5,[{key:"outdated",get:function get(){return(this.flags&2)>0;},set:function set(value){this.flags=(value?2:0)|this.flags&~2;}},{key:"setHeight",value:function setHeight(oracle,height){if(this.height!=height){if(Math.abs(this.height-height)>Epsilon5)oracle.heightChanged=true;this.height=height;}}},{key:"replace",value:function replace(_from,_to,nodes){return HeightMap5.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(_to,result){result.push(this);}},{key:"decomposeRight",value:function decomposeRight(_from,result){result.push(this);}},{key:"applyChanges",value:function applyChanges(decorations6,oldDoc,oracle,changes){var me=this;for(var _i273=changes.length-1;_i273>=0;_i273--){var _changes$_i5=changes[_i273],fromA=_changes$_i5.fromA,toA=_changes$_i5.toA,fromB=_changes$_i5.fromB,toB=_changes$_i5.toB;var start=me.lineAt(fromA,QueryType5.ByPosNoHeight,oldDoc,0,0);var end=start.to>=toA?start:me.lineAt(toA,QueryType5.ByPosNoHeight,oldDoc,0,0);toB+=end.to-toA;toA=end.to;while(_i273>0&&start.from<=changes[_i273-1].toA){fromA=changes[_i273-1].fromA;fromB=changes[_i273-1].fromB;_i273--;if(fromA<start.from)start=me.lineAt(fromA,QueryType5.ByPosNoHeight,oldDoc,0,0);}fromB+=start.from-fromA;fromA=start.from;var nodes=NodeBuilder5.build(oracle,decorations6,fromB,toB);me=me.replace(fromA,toA,nodes);}return me.updateHeight(oracle,0);}}],[{key:"empty",value:function empty(){return new HeightMapText5(0,0);}},{key:"of",value:function of(nodes){if(nodes.length==1)return nodes[0];var i=0,j=nodes.length,before=0,after=0;for(;;){if(i==j){if(before>after*2){var split=nodes[i-1];if(split["break"])nodes.splice(--i,1,split.left,null,split.right);else nodes.splice(--i,1,split.left,split.right);j+=1+split["break"];before-=split.size;}else if(after>before*2){var _split5=nodes[j];if(_split5["break"])nodes.splice(j,1,_split5.left,null,_split5.right);else nodes.splice(j,1,_split5.left,_split5.right);j+=2+_split5["break"];after-=_split5.size;}else{break;}}else if(before<after){var next=nodes[i++];if(next)before+=next.size;}else{var _next6=nodes[--j];if(_next6)after+=_next6.size;}}var brk=0;if(nodes[i-1]==null){brk=1;i--;}else if(nodes[i]==null){brk=1;j++;}return new HeightMapBranch5(HeightMap5.of(nodes.slice(0,i)),brk,HeightMap5.of(nodes.slice(j)));}}]);return HeightMap5;}();HeightMap5.prototype.size=1;var HeightMapBlock5=/*#__PURE__*/function(_HeightMap13){_inherits(HeightMapBlock5,_HeightMap13);var _super110=_createSuper(HeightMapBlock5);function HeightMapBlock5(length,height,type){var _this199;_classCallCheck(this,HeightMapBlock5);_this199=_super110.call(this,length,height);_this199.type=type;return _this199;}_createClass(HeightMapBlock5,[{key:"blockAt",value:function blockAt(_height,_doc,top2,offset){return new BlockInfo5(offset,this.length,top2,this.height,this.type);}},{key:"lineAt",value:function lineAt(_value,_type,doc6,top2,offset){return this.blockAt(0,doc6,top2,offset);}},{key:"forEachLine",value:function forEachLine(_from,_to,doc6,top2,offset,f){f(this.blockAt(0,doc6,top2,offset));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var _force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);this.outdated=false;return this;}},{key:"toString",value:function toString(){return"block(".concat(this.length,")");}}]);return HeightMapBlock5;}(HeightMap5);var HeightMapText5=/*#__PURE__*/function(_HeightMapBlock5){_inherits(HeightMapText5,_HeightMapBlock5);var _super111=_createSuper(HeightMapText5);function HeightMapText5(length,height){var _this200;_classCallCheck(this,HeightMapText5);_this200=_super111.call(this,length,height,BlockType5.Text);_this200.collapsed=0;_this200.widgetHeight=0;return _this200;}_createClass(HeightMapText5,[{key:"replace",value:function replace(_from,_to,nodes){var node=nodes[0];if(nodes.length==1&&(node instanceof HeightMapText5||node instanceof HeightMapGap5&&node.flags&4)&&Math.abs(this.length-node.length)<10){if(node instanceof HeightMapGap5)node=new HeightMapText5(node.length,this.height);else node.height=this.height;if(!this.outdated)node.outdated=false;return node;}else{return HeightMap5.of(nodes);}}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;if(measured&&measured.from<=offset&&measured.more)this.setHeight(oracle,measured.heights[measured.index++]);else if(force||this.outdated)this.setHeight(oracle,Math.max(this.widgetHeight,oracle.heightForLine(this.length-this.collapsed)));this.outdated=false;return this;}},{key:"toString",value:function toString(){return"line(".concat(this.length).concat(this.collapsed?-this.collapsed:"").concat(this.widgetHeight?":"+this.widgetHeight:"",")");}}]);return HeightMapText5;}(HeightMapBlock5);var HeightMapGap5=/*#__PURE__*/function(_HeightMap14){_inherits(HeightMapGap5,_HeightMap14);var _super112=_createSuper(HeightMapGap5);function HeightMapGap5(length){_classCallCheck(this,HeightMapGap5);return _super112.call(this,length,0);}_createClass(HeightMapGap5,[{key:"lines",value:function lines(doc6,offset){var firstLine=doc6.lineAt(offset).number,lastLine=doc6.lineAt(offset+this.length).number;return{firstLine:firstLine,lastLine:lastLine,lineHeight:this.height/(lastLine-firstLine+1)};}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var _this$lines13=this.lines(doc6,offset),firstLine=_this$lines13.firstLine,lastLine=_this$lines13.lastLine,lineHeight=_this$lines13.lineHeight;var line=Math.max(0,Math.min(lastLine-firstLine,Math.floor((height-top2)/lineHeight)));var _doc6$line5=doc6.line(firstLine+line),from=_doc6$line5.from,length=_doc6$line5.length;return new BlockInfo5(from,length,top2+lineHeight*line,lineHeight,BlockType5.Text);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){if(type==QueryType5.ByHeight)return this.blockAt(value,doc6,top2,offset);if(type==QueryType5.ByPosNoHeight){var _doc6$lineAt9=doc6.lineAt(value),from2=_doc6$lineAt9.from,to=_doc6$lineAt9.to;return new BlockInfo5(from2,to-from2,0,0,BlockType5.Text);}var _this$lines14=this.lines(doc6,offset),firstLine=_this$lines14.firstLine,lineHeight=_this$lines14.lineHeight;var _doc6$lineAt10=doc6.lineAt(value),from=_doc6$lineAt10.from,length=_doc6$lineAt10.length,number2=_doc6$lineAt10.number;return new BlockInfo5(from,length,top2+lineHeight*(number2-firstLine),lineHeight,BlockType5.Text);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var _this$lines15=this.lines(doc6,offset),firstLine=_this$lines15.firstLine,lineHeight=_this$lines15.lineHeight;for(var pos=Math.max(from,offset),end=Math.min(offset+this.length,to);pos<=end;){var line=doc6.lineAt(pos);if(pos==from)top2+=lineHeight*(line.number-firstLine);f(new BlockInfo5(line.from,line.length,top2,lineHeight,BlockType5.Text));top2+=lineHeight;pos=line.to+1;}}},{key:"replace",value:function replace(from,to,nodes){var after=this.length-to;if(after>0){var last=nodes[nodes.length-1];if(last instanceof HeightMapGap5)nodes[nodes.length-1]=new HeightMapGap5(last.length+after);else nodes.push(null,new HeightMapGap5(after-1));}if(from>0){var first=nodes[0];if(first instanceof HeightMapGap5)nodes[0]=new HeightMapGap5(from+first.length);else nodes.unshift(new HeightMapGap5(from-1),null);}return HeightMap5.of(nodes);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){result.push(new HeightMapGap5(to-1),null);}},{key:"decomposeRight",value:function decomposeRight(from,result){result.push(null,new HeightMapGap5(this.length-from-1));}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var end=offset+this.length;if(measured&&measured.from<=offset+this.length&&measured.more){var nodes=[],pos=Math.max(offset,measured.from),singleHeight=-1;var wasChanged=oracle.heightChanged;if(measured.from>offset)nodes.push(new HeightMapGap5(measured.from-offset-1).updateHeight(oracle,offset));while(pos<=end&&measured.more){var len=oracle.doc.lineAt(pos).length;if(nodes.length)nodes.push(null);var height=measured.heights[measured.index++];if(singleHeight==-1)singleHeight=height;else if(Math.abs(height-singleHeight)>=Epsilon5)singleHeight=-2;var line=new HeightMapText5(len,height);line.outdated=false;nodes.push(line);pos+=len+1;}if(pos<=end)nodes.push(null,new HeightMapGap5(end-pos).updateHeight(oracle,pos));var result=HeightMap5.of(nodes);oracle.heightChanged=wasChanged||singleHeight<0||Math.abs(result.height-this.height)>=Epsilon5||Math.abs(singleHeight-this.lines(oracle.doc,offset).lineHeight)>=Epsilon5;return result;}else if(force||this.outdated){this.setHeight(oracle,oracle.heightForGap(offset,offset+this.length));this.outdated=false;}return this;}},{key:"toString",value:function toString(){return"gap(".concat(this.length,")");}}]);return HeightMapGap5;}(HeightMap5);var HeightMapBranch5=/*#__PURE__*/function(_HeightMap15){_inherits(HeightMapBranch5,_HeightMap15);var _super113=_createSuper(HeightMapBranch5);function HeightMapBranch5(left,brk,right){var _this201;_classCallCheck(this,HeightMapBranch5);_this201=_super113.call(this,left.length+brk+right.length,left.height+right.height,brk|(left.outdated||right.outdated?2:0));_this201.left=left;_this201.right=right;_this201.size=left.size+right.size;return _this201;}_createClass(HeightMapBranch5,[{key:"break",get:function get(){return this.flags&1;}},{key:"blockAt",value:function blockAt(height,doc6,top2,offset){var mid=top2+this.left.height;return height<mid?this.left.blockAt(height,doc6,top2,offset):this.right.blockAt(height,doc6,mid,offset+this.left.length+this["break"]);}},{key:"lineAt",value:function lineAt(value,type,doc6,top2,offset){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];var left=type==QueryType5.ByHeight?value<rightTop:value<rightOffset;var base2=left?this.left.lineAt(value,type,doc6,top2,offset):this.right.lineAt(value,type,doc6,rightTop,rightOffset);if(this["break"]||(left?base2.to<rightOffset:base2.from>rightOffset))return base2;var subQuery=type==QueryType5.ByPosNoHeight?QueryType5.ByPosNoHeight:QueryType5.ByPos;if(left)return base2.join(this.right.lineAt(rightOffset,subQuery,doc6,rightTop,rightOffset));else return this.left.lineAt(rightOffset,subQuery,doc6,top2,offset).join(base2);}},{key:"forEachLine",value:function forEachLine(from,to,doc6,top2,offset,f){var rightTop=top2+this.left.height,rightOffset=offset+this.left.length+this["break"];if(this["break"]){if(from<rightOffset)this.left.forEachLine(from,to,doc6,top2,offset,f);if(to>=rightOffset)this.right.forEachLine(from,to,doc6,rightTop,rightOffset,f);}else{var mid=this.lineAt(rightOffset,QueryType5.ByPos,doc6,top2,offset);if(from<mid.from)this.left.forEachLine(from,mid.from-1,doc6,top2,offset,f);if(mid.to>=from&&mid.from<=to)f(mid);if(to>mid.to)this.right.forEachLine(mid.to+1,to,doc6,rightTop,rightOffset,f);}}},{key:"replace",value:function replace(from,to,nodes){var rightStart=this.left.length+this["break"];if(to<rightStart)return this.balanced(this.left.replace(from,to,nodes),this.right);if(from>this.left.length)return this.balanced(this.left,this.right.replace(from-rightStart,to-rightStart,nodes));var result=[];if(from>0)this.decomposeLeft(from,result);var left=result.length;var _iterator323=_createForOfIteratorHelper(nodes),_step323;try{for(_iterator323.s();!(_step323=_iterator323.n()).done;){var node=_step323.value;result.push(node);}}catch(err){_iterator323.e(err);}finally{_iterator323.f();}if(from>0)mergeGaps5(result,left-1);if(to<this.length){var right=result.length;this.decomposeRight(to,result);mergeGaps5(result,right);}return HeightMap5.of(result);}},{key:"decomposeLeft",value:function decomposeLeft(to,result){var left=this.left.length;if(to<=left)return this.left.decomposeLeft(to,result);result.push(this.left);if(this["break"]){left++;if(to>=left)result.push(null);}if(to>left)this.right.decomposeLeft(to-left,result);}},{key:"decomposeRight",value:function decomposeRight(from,result){var left=this.left.length,right=left+this["break"];if(from>=right)return this.right.decomposeRight(from-right,result);if(from<left)this.left.decomposeRight(from,result);if(this["break"]&&from<right)result.push(null);result.push(this.right);}},{key:"balanced",value:function balanced(left,right){if(left.size>2*right.size||right.size>2*left.size)return HeightMap5.of(this["break"]?[left,null,right]:[left,right]);this.left=left;this.right=right;this.height=left.height+right.height;this.outdated=left.outdated||right.outdated;this.size=left.size+right.size;this.length=left.length+this["break"]+right.length;return this;}},{key:"updateHeight",value:function updateHeight(oracle){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var measured=arguments.length>3?arguments[3]:undefined;var left=this.left,right=this.right,rightStart=offset+left.length+this["break"],rebalance=null;if(measured&&measured.from<=offset+left.length&&measured.more)rebalance=left=left.updateHeight(oracle,offset,force,measured);else left.updateHeight(oracle,offset,force);if(measured&&measured.from<=rightStart+right.length&&measured.more)rebalance=right=right.updateHeight(oracle,rightStart,force,measured);else right.updateHeight(oracle,rightStart,force);if(rebalance)return this.balanced(left,right);this.height=this.left.height+this.right.height;this.outdated=false;return this;}},{key:"toString",value:function toString(){return this.left+(this["break"]?" ":"-")+this.right;}}]);return HeightMapBranch5;}(HeightMap5);function mergeGaps5(nodes,around){var before,after;if(nodes[around]==null&&(before=nodes[around-1])instanceof HeightMapGap5&&(after=nodes[around+1])instanceof HeightMapGap5)nodes.splice(around-1,3,new HeightMapGap5(before.length+1+after.length));}var relevantWidgetHeight5=5;var NodeBuilder5=/*#__PURE__*/function(){function NodeBuilder5(pos,oracle){_classCallCheck(this,NodeBuilder5);this.pos=pos;this.oracle=oracle;this.nodes=[];this.lineStart=-1;this.lineEnd=-1;this.covering=null;this.writtenTo=pos;}_createClass(NodeBuilder5,[{key:"isCovered",get:function get(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering;}},{key:"span",value:function span(_from,to){if(this.lineStart>-1){var end=Math.min(to,this.lineEnd),last=this.nodes[this.nodes.length-1];if(last instanceof HeightMapText5)last.length+=end-this.pos;else if(end>this.pos||!this.isCovered)this.nodes.push(new HeightMapText5(end-this.pos,-1));this.writtenTo=end;if(to>end){this.nodes.push(null);this.writtenTo++;this.lineStart=-1;}}this.pos=to;}},{key:"point",value:function point(from,to,deco){if(from<to||deco.heightRelevant){var height=deco.widget?deco.widget.estimatedHeight:0;if(height<0)height=this.oracle.lineHeight;var len=to-from;if(deco.block){this.addBlock(new HeightMapBlock5(len,height,deco.type));}else if(len||height>=relevantWidgetHeight5){this.addLineDeco(height,len);}}else if(to>from){this.span(from,to);}if(this.lineEnd>-1&&this.lineEnd<this.pos)this.lineEnd=this.oracle.doc.lineAt(this.pos).to;}},{key:"enterLine",value:function enterLine(){if(this.lineStart>-1)return;var _this$oracle$doc$line5=this.oracle.doc.lineAt(this.pos),from=_this$oracle$doc$line5.from,to=_this$oracle$doc$line5.to;this.lineStart=from;this.lineEnd=to;if(this.writtenTo<from){if(this.writtenTo<from-1||this.nodes[this.nodes.length-1]==null)this.nodes.push(this.blankContent(this.writtenTo,from-1));this.nodes.push(null);}if(this.pos>from)this.nodes.push(new HeightMapText5(this.pos-from,-1));this.writtenTo=this.pos;}},{key:"blankContent",value:function blankContent(from,to){var gap=new HeightMapGap5(to-from);if(this.oracle.doc.lineAt(from).to==to)gap.flags|=4;return gap;}},{key:"ensureLine",value:function ensureLine(){this.enterLine();var last=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(last instanceof HeightMapText5)return last;var line=new HeightMapText5(0,-1);this.nodes.push(line);return line;}},{key:"addBlock",value:function addBlock(block){this.enterLine();if(block.type==BlockType5.WidgetAfter&&!this.isCovered)this.ensureLine();this.nodes.push(block);this.writtenTo=this.pos=this.pos+block.length;if(block.type!=BlockType5.WidgetBefore)this.covering=block;}},{key:"addLineDeco",value:function addLineDeco(height,length){var line=this.ensureLine();line.length+=length;line.collapsed+=length;line.widgetHeight=Math.max(line.widgetHeight,height);this.writtenTo=this.pos=this.pos+length;}},{key:"finish",value:function finish(from){var last=this.nodes.length==0?null:this.nodes[this.nodes.length-1];if(this.lineStart>-1&&!(last instanceof HeightMapText5)&&!this.isCovered)this.nodes.push(new HeightMapText5(0,-1));else if(this.writtenTo<this.pos||last==null)this.nodes.push(this.blankContent(this.writtenTo,this.pos));var pos=from;var _iterator324=_createForOfIteratorHelper(this.nodes),_step324;try{for(_iterator324.s();!(_step324=_iterator324.n()).done;){var node=_step324.value;if(node instanceof HeightMapText5)node.updateHeight(this.oracle,pos);pos+=node?node.length:1;}}catch(err){_iterator324.e(err);}finally{_iterator324.f();}return this.nodes;}}],[{key:"build",value:function build(oracle,decorations6,from,to){var builder=new NodeBuilder5(from,oracle);RangeSet.spans(decorations6,from,to,builder,0);return builder.finish(from);}}]);return NodeBuilder5;}();function heightRelevantDecoChanges5(a,b,diff){var comp=new DecorationComparator5();RangeSet.compare(a,b,diff,comp,0);return comp.changes;}var DecorationComparator5=/*#__PURE__*/function(){function DecorationComparator5(){_classCallCheck(this,DecorationComparator5);this.changes=[];}_createClass(DecorationComparator5,[{key:"compareRange",value:function compareRange(){}},{key:"comparePoint",value:function comparePoint(from,to,a,b){if(from<to||a&&a.heightRelevant||b&&b.heightRelevant)addRange5(from,to,this.changes,5);}}]);return DecorationComparator5;}();function visiblePixelRange5(dom,paddingTop){var rect=dom.getBoundingClientRect();var left=Math.max(0,rect.left),right=Math.min(innerWidth,rect.right);var top2=Math.max(0,rect.top),bottom=Math.min(innerHeight,rect.bottom);var body=dom.ownerDocument.body;for(var parent=dom.parentNode;parent&&parent!=body;){if(parent.nodeType==1){var elt=parent;var style=window.getComputedStyle(elt);if((elt.scrollHeight>elt.clientHeight||elt.scrollWidth>elt.clientWidth)&&style.overflow!="visible"){var parentRect=elt.getBoundingClientRect();left=Math.max(left,parentRect.left);right=Math.min(right,parentRect.right);top2=Math.max(top2,parentRect.top);bottom=Math.min(bottom,parentRect.bottom);}parent=style.position=="absolute"||style.position=="fixed"?elt.offsetParent:elt.parentNode;}else if(parent.nodeType==11){parent=parent.host;}else{break;}}return{left:left-rect.left,right:Math.max(left,right)-rect.left,top:top2-(rect.top+paddingTop),bottom:Math.max(top2,bottom)-(rect.top+paddingTop)};}var LineGap5=/*#__PURE__*/function(){function LineGap5(from,to,size){_classCallCheck(this,LineGap5);this.from=from;this.to=to;this.size=size;}_createClass(LineGap5,[{key:"draw",value:function draw(wrapping){return Decoration5.replace({widget:new LineGapWidget5(this.size,wrapping)}).range(this.from,this.to);}}],[{key:"same",value:function same(a,b){if(a.length!=b.length)return false;for(var _i274=0;_i274<a.length;_i274++){var gA=a[_i274],gB=b[_i274];if(gA.from!=gB.from||gA.to!=gB.to||gA.size!=gB.size)return false;}return true;}}]);return LineGap5;}();var LineGapWidget5=/*#__PURE__*/function(_WidgetType23){_inherits(LineGapWidget5,_WidgetType23);var _super114=_createSuper(LineGapWidget5);function LineGapWidget5(size,vertical){var _this202;_classCallCheck(this,LineGapWidget5);_this202=_super114.call(this);_this202.size=size;_this202.vertical=vertical;return _this202;}_createClass(LineGapWidget5,[{key:"eq",value:function eq(other){return other.size==this.size&&other.vertical==this.vertical;}},{key:"toDOM",value:function toDOM(){var elt=document.createElement("div");if(this.vertical){elt.style.height=this.size+"px";}else{elt.style.width=this.size+"px";elt.style.height="2px";elt.style.display="inline-block";}return elt;}},{key:"estimatedHeight",get:function get(){return this.vertical?this.size:-1;}}]);return LineGapWidget5;}(WidgetType5);var ViewState5=/*#__PURE__*/function(){function ViewState5(state){_classCallCheck(this,ViewState5);this.state=state;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=true;this.paddingTop=0;this.paddingBottom=0;this.contentDOMWidth=0;this.contentDOMHeight=0;this.editorHeight=0;this.editorWidth=0;this.heightOracle=new HeightOracle5();this.scaler=IdScaler5;this.scrollTarget=null;this.printing=false;this.mustMeasureContent=true;this.visibleRanges=[];this.mustEnforceCursorAssoc=false;this.heightMap=HeightMap5.empty().applyChanges(state.facet(decorations5),Text.empty,this.heightOracle.setDoc(state.doc),[new ChangedRange5(0,0,0,state.doc.length)]);this.viewport=this.getViewport(0,null);this.updateViewportLines();this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Decoration5.set(this.lineGaps.map(function(gap){return gap.draw(false);}));this.computeVisibleRanges();}_createClass(ViewState5,[{key:"updateForViewport",value:function updateForViewport(){var _this203=this;var viewports=[this.viewport],main=this.state.selection.main;var _loop37=function _loop37(_i275){var pos=_i275?main.head:main.anchor;if(!viewports.some(function(_ref87){var from=_ref87.from,to=_ref87.to;return pos>=from&&pos<=to;})){var _this203$lineBlockAt=_this203.lineBlockAt(pos),from=_this203$lineBlockAt.from,to=_this203$lineBlockAt.to;viewports.push(new Viewport5(from,to));}};for(var _i275=0;_i275<=1;_i275++){_loop37(_i275);}this.viewports=viewports.sort(function(a,b){return a.from-b.from;});this.scaler=this.heightMap.height<=7e6?IdScaler5:new BigScaler5(this.heightOracle.doc,this.heightMap,this.viewports);}},{key:"updateViewportLines",value:function updateViewportLines(){var _this204=this;this.viewportLines=[];this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,function(block){_this204.viewportLines.push(_this204.scaler.scale==1?block:scaleBlock5(block,_this204.scaler));});}},{key:"update",value:function update(_update32){var scrollTarget=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var prev=this.state;this.state=_update32.state;var newDeco=this.state.facet(decorations5);var contentChanges=_update32.changedRanges;var heightChanges=ChangedRange5.extendWithRanges(contentChanges,heightRelevantDecoChanges5(_update32.startState.facet(decorations5),newDeco,_update32?_update32.changes:ChangeSet.empty(this.state.doc.length)));var prevHeight=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(newDeco,prev.doc,this.heightOracle.setDoc(this.state.doc),heightChanges);if(this.heightMap.height!=prevHeight)_update32.flags|=2;var viewport=heightChanges.length?this.mapViewport(this.viewport,_update32.changes):this.viewport;if(scrollTarget&&(scrollTarget.range.head<viewport.from||scrollTarget.range.head>viewport.to)||!this.viewportIsAppropriate(viewport))viewport=this.getViewport(0,scrollTarget);var updateLines=!_update32.changes.empty||_update32.flags&2||viewport.from!=this.viewport.from||viewport.to!=this.viewport.to;this.viewport=viewport;this.updateForViewport();if(updateLines)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,_update32.changes)));_update32.flags|=this.computeVisibleRanges();if(scrollTarget)this.scrollTarget=scrollTarget;if(!this.mustEnforceCursorAssoc&&_update32.selectionSet&&_update32.view.lineWrapping&&_update32.state.selection.main.empty&&_update32.state.selection.main.assoc)this.mustEnforceCursorAssoc=true;}},{key:"measure",value:function measure(view){var dom=view.contentDOM,style=window.getComputedStyle(dom);var oracle=this.heightOracle;var whiteSpace=style.whiteSpace,direction=style.direction=="rtl"?Direction5.RTL:Direction5.LTR;var refresh=this.heightOracle.mustRefreshForStyle(whiteSpace,direction);var measureContent=refresh||this.mustMeasureContent||this.contentDOMHeight!=dom.clientHeight;var result=0,bias=0;if(measureContent){this.mustMeasureContent=false;this.contentDOMHeight=dom.clientHeight;var paddingTop=parseInt(style.paddingTop)||0,paddingBottom=parseInt(style.paddingBottom)||0;if(this.paddingTop!=paddingTop||this.paddingBottom!=paddingBottom){result|=8;this.paddingTop=paddingTop;this.paddingBottom=paddingBottom;}}var pixelViewport=this.printing?{top:-1e8,bottom:1e8,left:-1e8,right:1e8}:visiblePixelRange5(dom,this.paddingTop);var dTop=pixelViewport.top-this.pixelViewport.top,dBottom=pixelViewport.bottom-this.pixelViewport.bottom;this.pixelViewport=pixelViewport;var inView=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(inView!=this.inView){this.inView=inView;if(inView)measureContent=true;}if(!this.inView)return 0;var contentWidth=dom.clientWidth;if(this.contentDOMWidth!=contentWidth||this.editorHeight!=view.scrollDOM.clientHeight||this.editorWidth!=view.scrollDOM.clientWidth){this.contentDOMWidth=contentWidth;this.editorHeight=view.scrollDOM.clientHeight;this.editorWidth=view.scrollDOM.clientWidth;result|=8;}if(measureContent){var lineHeights=view.docView.measureVisibleLineHeights();if(oracle.mustRefreshForHeights(lineHeights))refresh=true;if(refresh||oracle.lineWrapping&&Math.abs(contentWidth-this.contentDOMWidth)>oracle.charWidth){var _view$docView$measure4=view.docView.measureTextSize(),lineHeight=_view$docView$measure4.lineHeight,charWidth=_view$docView$measure4.charWidth;refresh=oracle.refresh(whiteSpace,direction,lineHeight,charWidth,contentWidth/charWidth,lineHeights);if(refresh){view.docView.minWidth=0;result|=8;}}if(dTop>0&&dBottom>0)bias=Math.max(dTop,dBottom);else if(dTop<0&&dBottom<0)bias=Math.min(dTop,dBottom);oracle.heightChanged=false;this.heightMap=this.heightMap.updateHeight(oracle,0,refresh,new MeasuredHeights5(this.viewport.from,lineHeights));if(oracle.heightChanged)result|=2;}var viewportChange=!this.viewportIsAppropriate(this.viewport,bias)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);if(viewportChange)this.viewport=this.getViewport(bias,this.scrollTarget);this.updateForViewport();if(result&2||viewportChange)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(refresh?[]:this.lineGaps));result|=this.computeVisibleRanges();if(this.mustEnforceCursorAssoc){this.mustEnforceCursorAssoc=false;view.docView.enforceCursorAssoc();}return result;}},{key:"visibleTop",get:function get(){return this.scaler.fromDOM(this.pixelViewport.top);}},{key:"visibleBottom",get:function get(){return this.scaler.fromDOM(this.pixelViewport.bottom);}},{key:"getViewport",value:function getViewport(bias,scrollTarget){var marginTop=0.5-Math.max(-0.5,Math.min(0.5,bias/1e3/2));var map=this.heightMap,doc6=this.state.doc,visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;var viewport=new Viewport5(map.lineAt(visibleTop-marginTop*1e3,QueryType5.ByHeight,doc6,0,0).from,map.lineAt(visibleBottom+(1-marginTop)*1e3,QueryType5.ByHeight,doc6,0,0).to);if(scrollTarget){var head=scrollTarget.range.head,viewHeight=this.editorHeight;if(head<viewport.from||head>viewport.to){var block=map.lineAt(head,QueryType5.ByPos,doc6,0,0),topPos;if(scrollTarget.y=="center")topPos=(block.top+block.bottom)/2-viewHeight/2;else if(scrollTarget.y=="start"||scrollTarget.y=="nearest"&&head<viewport.from)topPos=block.top;else topPos=block.bottom-viewHeight;viewport=new Viewport5(map.lineAt(topPos-1e3/2,QueryType5.ByHeight,doc6,0,0).from,map.lineAt(topPos+viewHeight+1e3/2,QueryType5.ByHeight,doc6,0,0).to);}}return viewport;}},{key:"mapViewport",value:function mapViewport(viewport,changes){var from=changes.mapPos(viewport.from,-1),to=changes.mapPos(viewport.to,1);return new Viewport5(this.heightMap.lineAt(from,QueryType5.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(to,QueryType5.ByPos,this.state.doc,0,0).to);}},{key:"viewportIsAppropriate",value:function viewportIsAppropriate(_ref88){var from=_ref88.from,to=_ref88.to;var bias=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;if(!this.inView)return true;var _this$heightMap$lineA9=this.heightMap.lineAt(from,QueryType5.ByPos,this.state.doc,0,0),top2=_this$heightMap$lineA9.top;var _this$heightMap$lineA10=this.heightMap.lineAt(to,QueryType5.ByPos,this.state.doc,0,0),bottom=_this$heightMap$lineA10.bottom;var visibleTop=this.visibleTop,visibleBottom=this.visibleBottom;return(from==0||top2<=visibleTop-Math.max(10,Math.min(-bias,250)))&&(to==this.state.doc.length||bottom>=visibleBottom+Math.max(10,Math.min(bias,250)))&&top2>visibleTop-2*1e3&&bottom<visibleBottom+2*1e3;}},{key:"mapLineGaps",value:function mapLineGaps(gaps,changes){if(!gaps.length||changes.empty)return gaps;var mapped=[];var _iterator325=_createForOfIteratorHelper(gaps),_step325;try{for(_iterator325.s();!(_step325=_iterator325.n()).done;){var gap=_step325.value;if(!changes.touchesRange(gap.from,gap.to))mapped.push(new LineGap5(changes.mapPos(gap.from),changes.mapPos(gap.to),gap.size));}}catch(err){_iterator325.e(err);}finally{_iterator325.f();}return mapped;}},{key:"ensureLineGaps",value:function ensureLineGaps(current){var _this205=this;var gaps=[];if(this.heightOracle.direction!=Direction5.LTR)return gaps;var _iterator326=_createForOfIteratorHelper(this.viewportLines),_step326;try{var _loop38=function _loop38(){var line=_step326.value;if(line.length<4e3)return"continue";var structure=lineStructure5(line.from,line.to,_this205.state);if(structure.total<4e3)return"continue";var viewFrom=void 0,viewTo=void 0;if(_this205.heightOracle.lineWrapping){var marginHeight=2e3/_this205.heightOracle.lineLength*_this205.heightOracle.lineHeight;viewFrom=findPosition5(structure,(_this205.visibleTop-line.top-marginHeight)/line.height);viewTo=findPosition5(structure,(_this205.visibleBottom-line.top+marginHeight)/line.height);}else{var totalWidth=structure.total*_this205.heightOracle.charWidth;var marginWidth=2e3*_this205.heightOracle.charWidth;viewFrom=findPosition5(structure,(_this205.pixelViewport.left-marginWidth)/totalWidth);viewTo=findPosition5(structure,(_this205.pixelViewport.right+marginWidth)/totalWidth);}var outside=[];if(viewFrom>line.from)outside.push({from:line.from,to:viewFrom});if(viewTo<line.to)outside.push({from:viewTo,to:line.to});var sel=_this205.state.selection.main;if(sel.from>=line.from&&sel.from<=line.to)cutRange5(outside,sel.from-10,sel.from+10);if(!sel.empty&&sel.to>=line.from&&sel.to<=line.to)cutRange5(outside,sel.to-10,sel.to+10);var _loop39=function _loop39(){var _outside5$_i=_outside5[_i276],from=_outside5$_i.from,to=_outside5$_i.to;if(to-from>1e3){gaps.push(find5(current,function(gap){return gap.from>=line.from&&gap.to<=line.to&&Math.abs(gap.from-from)<1e3&&Math.abs(gap.to-to)<1e3;})||new LineGap5(from,to,_this205.gapSize(line,from,to,structure)));}};for(var _i276=0,_outside5=outside;_i276<_outside5.length;_i276++){_loop39();}};for(_iterator326.s();!(_step326=_iterator326.n()).done;){var _ret5=_loop38();if(_ret5==="continue")continue;}}catch(err){_iterator326.e(err);}finally{_iterator326.f();}return gaps;}},{key:"gapSize",value:function gapSize(line,from,to,structure){var fraction=findFraction5(structure,to)-findFraction5(structure,from);if(this.heightOracle.lineWrapping){return line.height*fraction;}else{return structure.total*this.heightOracle.charWidth*fraction;}}},{key:"updateLineGaps",value:function updateLineGaps(gaps){var _this206=this;if(!LineGap5.same(gaps,this.lineGaps)){this.lineGaps=gaps;this.lineGapDeco=Decoration5.set(gaps.map(function(gap){return gap.draw(_this206.heightOracle.lineWrapping);}));}}},{key:"computeVisibleRanges",value:function computeVisibleRanges(){var deco=this.state.facet(decorations5);if(this.lineGaps.length)deco=deco.concat(this.lineGapDeco);var ranges=[];RangeSet.spans(deco,this.viewport.from,this.viewport.to,{span:function span(from,to){ranges.push({from:from,to:to});},point:function point(){}},20);var changed=ranges.length!=this.visibleRanges.length||this.visibleRanges.some(function(r,i){return r.from!=ranges[i].from||r.to!=ranges[i].to;});this.visibleRanges=ranges;return changed?4:0;}},{key:"lineBlockAt",value:function lineBlockAt(pos){return pos>=this.viewport.from&&pos<=this.viewport.to&&this.viewportLines.find(function(b){return b.from<=pos&&b.to>=pos;})||scaleBlock5(this.heightMap.lineAt(pos,QueryType5.ByPos,this.state.doc,0,0),this.scaler);}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){return scaleBlock5(this.heightMap.lineAt(this.scaler.fromDOM(height),QueryType5.ByHeight,this.state.doc,0,0),this.scaler);}},{key:"elementAtHeight",value:function elementAtHeight(height){return scaleBlock5(this.heightMap.blockAt(this.scaler.fromDOM(height),this.state.doc,0,0),this.scaler);}},{key:"docHeight",get:function get(){return this.scaler.toDOM(this.heightMap.height);}},{key:"contentHeight",get:function get(){return this.docHeight+this.paddingTop+this.paddingBottom;}}]);return ViewState5;}();var Viewport5=/*#__PURE__*/_createClass(function Viewport5(from,to){_classCallCheck(this,Viewport5);this.from=from;this.to=to;});function lineStructure5(from,to,state){var ranges=[],pos=from,total=0;RangeSet.spans(state.facet(decorations5),from,to,{span:function span(){},point:function point(from2,to2){if(from2>pos){ranges.push({from:pos,to:from2});total+=from2-pos;}pos=to2;}},20);if(pos<to){ranges.push({from:pos,to:to});total+=to-pos;}return{total:total,ranges:ranges};}function findPosition5(_ref89,ratio){var total=_ref89.total,ranges=_ref89.ranges;if(ratio<=0)return ranges[0].from;if(ratio>=1)return ranges[ranges.length-1].to;var dist=Math.floor(total*ratio);for(var _i277=0;;_i277++){var _ranges$_i5=ranges[_i277],from=_ranges$_i5.from,to=_ranges$_i5.to,size=to-from;if(dist<=size)return from+dist;dist-=size;}}function findFraction5(structure,pos){var counted=0;var _iterator327=_createForOfIteratorHelper(structure.ranges),_step327;try{for(_iterator327.s();!(_step327=_iterator327.n()).done;){var _step327$value=_step327.value,from=_step327$value.from,to=_step327$value.to;if(pos<=to){counted+=pos-from;break;}counted+=to-from;}}catch(err){_iterator327.e(err);}finally{_iterator327.f();}return counted/structure.total;}function cutRange5(ranges,from,to){for(var _i278=0;_i278<ranges.length;_i278++){var _r19=ranges[_i278];if(_r19.from<to&&_r19.to>from){var pieces=[];if(_r19.from<from)pieces.push({from:_r19.from,to:from});if(_r19.to>to)pieces.push({from:to,to:_r19.to});ranges.splice.apply(ranges,[_i278,1].concat(pieces));_i278+=pieces.length-1;}}}function find5(array,f){var _iterator328=_createForOfIteratorHelper(array),_step328;try{for(_iterator328.s();!(_step328=_iterator328.n()).done;){var val=_step328.value;if(f(val))return val;}}catch(err){_iterator328.e(err);}finally{_iterator328.f();}return void 0;}var IdScaler5={toDOM:function toDOM(n){return n;},fromDOM:function fromDOM(n){return n;},scale:1};var BigScaler5=/*#__PURE__*/function(){function BigScaler5(doc6,heightMap,viewports){_classCallCheck(this,BigScaler5);var vpHeight=0,base2=0,domBase=0;this.viewports=viewports.map(function(_ref90){var from=_ref90.from,to=_ref90.to;var top2=heightMap.lineAt(from,QueryType5.ByPos,doc6,0,0).top;var bottom=heightMap.lineAt(to,QueryType5.ByPos,doc6,0,0).bottom;vpHeight+=bottom-top2;return{from:from,to:to,top:top2,bottom:bottom,domTop:0,domBottom:0};});this.scale=(7e6-vpHeight)/(heightMap.height-vpHeight);var _iterator329=_createForOfIteratorHelper(this.viewports),_step329;try{for(_iterator329.s();!(_step329=_iterator329.n()).done;){var obj=_step329.value;obj.domTop=domBase+(obj.top-base2)*this.scale;domBase=obj.domBottom=obj.domTop+(obj.bottom-obj.top);base2=obj.bottom;}}catch(err){_iterator329.e(err);}finally{_iterator329.f();}}_createClass(BigScaler5,[{key:"toDOM",value:function toDOM(n){for(var _i279=0,base2=0,domBase=0;;_i279++){var vp=_i279<this.viewports.length?this.viewports[_i279]:null;if(!vp||n<vp.top)return domBase+(n-base2)*this.scale;if(n<=vp.bottom)return vp.domTop+(n-vp.top);base2=vp.bottom;domBase=vp.domBottom;}}},{key:"fromDOM",value:function fromDOM(n){for(var _i280=0,base2=0,domBase=0;;_i280++){var vp=_i280<this.viewports.length?this.viewports[_i280]:null;if(!vp||n<vp.domTop)return base2+(n-domBase)/this.scale;if(n<=vp.domBottom)return vp.top+(n-vp.domTop);base2=vp.bottom;domBase=vp.domBottom;}}}]);return BigScaler5;}();function scaleBlock5(block,scaler){if(scaler.scale==1)return block;var bTop=scaler.toDOM(block.top),bBottom=scaler.toDOM(block.bottom);return new BlockInfo5(block.from,block.length,bTop,bBottom-bTop,Array.isArray(block.type)?block.type.map(function(b){return scaleBlock5(b,scaler);}):block.type);}var theme5=/* @__PURE__ */Facet.define({combine:function combine(strs){return strs.join(" ");}});var darkTheme5=/* @__PURE__ */Facet.define({combine:function combine(values){return values.indexOf(true)>-1;}});var baseThemeID5=/* @__PURE__ */StyleModule.newName();var baseLightID5=/* @__PURE__ */StyleModule.newName();var baseDarkID5=/* @__PURE__ */StyleModule.newName();var lightDarkIDs5={"&light":"."+baseLightID5,"&dark":"."+baseDarkID5};function buildTheme5(main,spec,scopes){return new StyleModule(spec,{finish:function finish(sel){return /&/.test(sel)?sel.replace(/&\w*/,function(m){if(m=="&")return main;if(!scopes||!scopes[m])throw new RangeError("Unsupported selector: ".concat(m));return scopes[m];}):main+" "+sel;}});}var baseTheme8=/* @__PURE__ */buildTheme5("."+baseThemeID5,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs5);var observeOptions5={childList:true,characterData:true,subtree:true,attributes:true,characterDataOldValue:true};var useCharData5=browser5.ie&&browser5.ie_version<=11;var DOMObserver5=/*#__PURE__*/function(){function DOMObserver5(view,onChange,onScrollChanged){var _this207=this;_classCallCheck(this,DOMObserver5);this.view=view;this.onChange=onChange;this.onScrollChanged=onScrollChanged;this.active=false;this.selectionRange=new DOMSelectionState4();this.selectionChanged=false;this.delayedFlush=-1;this.resizeTimeout=-1;this.queue=[];this.delayedAndroidKey=null;this.scrollTargets=[];this.intersection=null;this.resize=null;this.intersecting=false;this.gapIntersection=null;this.gaps=[];this.parentCheck=-1;this.dom=view.contentDOM;this.observer=new MutationObserver(function(mutations){var _iterator330=_createForOfIteratorHelper(mutations),_step330;try{for(_iterator330.s();!(_step330=_iterator330.n()).done;){var mut=_step330.value;_this207.queue.push(mut);}}catch(err){_iterator330.e(err);}finally{_iterator330.f();}if((browser5.ie&&browser5.ie_version<=11||browser5.ios&&view.composing)&&mutations.some(function(m){return m.type=="childList"&&m.removedNodes.length||m.type=="characterData"&&m.oldValue.length>m.target.nodeValue.length;}))_this207.flushSoon();else _this207.flush();});if(useCharData5)this.onCharData=function(event){_this207.queue.push({target:event.target,type:"characterData",oldValue:event.prevValue});_this207.flushSoon();};this.onSelectionChange=this.onSelectionChange.bind(this);if(typeof ResizeObserver=="function"){this.resize=new ResizeObserver(function(){if(_this207.view.docView.lastUpdate<Date.now()-75&&_this207.resizeTimeout<0)_this207.resizeTimeout=setTimeout(function(){_this207.resizeTimeout=-1;_this207.view.requestMeasure();},50);});this.resize.observe(view.scrollDOM);}this.start();this.onScroll=this.onScroll.bind(this);window.addEventListener("scroll",this.onScroll);if(typeof IntersectionObserver=="function"){this.intersection=new IntersectionObserver(function(entries){if(_this207.parentCheck<0)_this207.parentCheck=setTimeout(_this207.listenForScroll.bind(_this207),1e3);if(entries.length>0&&entries[entries.length-1].intersectionRatio>0!=_this207.intersecting){_this207.intersecting=!_this207.intersecting;if(_this207.intersecting!=_this207.view.inView)_this207.onScrollChanged(document.createEvent("Event"));}},{});this.intersection.observe(this.dom);this.gapIntersection=new IntersectionObserver(function(entries){if(entries.length>0&&entries[entries.length-1].intersectionRatio>0)_this207.onScrollChanged(document.createEvent("Event"));},{});}this.listenForScroll();this.readSelectionRange();this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange);}_createClass(DOMObserver5,[{key:"onScroll",value:function onScroll(e){if(this.intersecting)this.flush(false);this.onScrollChanged(e);}},{key:"updateGaps",value:function updateGaps(gaps){if(this.gapIntersection&&(gaps.length!=this.gaps.length||this.gaps.some(function(g,i){return g!=gaps[i];}))){this.gapIntersection.disconnect();var _iterator331=_createForOfIteratorHelper(gaps),_step331;try{for(_iterator331.s();!(_step331=_iterator331.n()).done;){var gap=_step331.value;this.gapIntersection.observe(gap);}}catch(err){_iterator331.e(err);}finally{_iterator331.f();}this.gaps=gaps;}}},{key:"onSelectionChange",value:function onSelectionChange(event){if(!this.readSelectionRange()||this.delayedAndroidKey)return;var view=this.view,sel=this.selectionRange;if(view.state.facet(editable5)?view.root.activeElement!=this.dom:!hasSelection5(view.dom,sel))return;var context=sel.anchorNode&&view.docView.nearest(sel.anchorNode);if(context&&context.ignoreEvent(event))return;if((browser5.ie&&browser5.ie_version<=11||browser5.android&&browser5.chrome)&&!view.state.selection.main.empty&&sel.focusNode&&isEquivalentPosition5(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))this.flushSoon();else this.flush(false);}},{key:"readSelectionRange",value:function readSelectionRange(){var root=this.view.root,domSel=getSelection5(root);var range=browser5.safari&&root.nodeType==11&&deepActiveElement5()==this.view.contentDOM&&safariSelectionRangeHack5(this.view)||domSel;if(this.selectionRange.eq(range))return false;this.selectionRange.setRange(range);return this.selectionChanged=true;}},{key:"setSelectionRange",value:function setSelectionRange(anchor,head){this.selectionRange.set(anchor.node,anchor.offset,head.node,head.offset);this.selectionChanged=false;}},{key:"listenForScroll",value:function listenForScroll(){this.parentCheck=-1;var i=0,changed=null;for(var dom=this.dom;dom;){if(dom.nodeType==1){if(!changed&&i<this.scrollTargets.length&&this.scrollTargets[i]==dom)i++;else if(!changed)changed=this.scrollTargets.slice(0,i);if(changed)changed.push(dom);dom=dom.assignedSlot||dom.parentNode;}else if(dom.nodeType==11){dom=dom.host;}else{break;}}if(i<this.scrollTargets.length&&!changed)changed=this.scrollTargets.slice(0,i);if(changed){var _iterator332=_createForOfIteratorHelper(this.scrollTargets),_step332;try{for(_iterator332.s();!(_step332=_iterator332.n()).done;){var _dom10=_step332.value;_dom10.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator332.e(err);}finally{_iterator332.f();}var _iterator333=_createForOfIteratorHelper(this.scrollTargets=changed),_step333;try{for(_iterator333.s();!(_step333=_iterator333.n()).done;){var _dom11=_step333.value;_dom11.addEventListener("scroll",this.onScroll);}}catch(err){_iterator333.e(err);}finally{_iterator333.f();}}}},{key:"ignore",value:function ignore(f){if(!this.active)return f();try{this.stop();return f();}finally{this.start();this.clear();}}},{key:"start",value:function start(){if(this.active)return;this.observer.observe(this.dom,observeOptions5);if(useCharData5)this.dom.addEventListener("DOMCharacterDataModified",this.onCharData);this.active=true;}},{key:"stop",value:function stop(){if(!this.active)return;this.active=false;this.observer.disconnect();if(useCharData5)this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData);}},{key:"clear",value:function clear(){this.observer.takeRecords();this.queue.length=0;this.selectionChanged=false;}},{key:"delayAndroidKey",value:function delayAndroidKey(key,keyCode){var _this208=this;if(!this.delayedAndroidKey)requestAnimationFrame(function(){var key2=_this208.delayedAndroidKey;_this208.delayedAndroidKey=null;var startState=_this208.view.state;if(dispatchKey5(_this208.view.contentDOM,key2.key,key2.keyCode))_this208.processRecords();else _this208.flush();if(_this208.view.state==startState)_this208.view.update([]);});if(!this.delayedAndroidKey||key=="Enter")this.delayedAndroidKey={key:key,keyCode:keyCode};}},{key:"flushSoon",value:function flushSoon(){var _this209=this;if(this.delayedFlush<0)this.delayedFlush=window.setTimeout(function(){_this209.delayedFlush=-1;_this209.flush();},20);}},{key:"forceFlush",value:function forceFlush(){if(this.delayedFlush>=0){window.clearTimeout(this.delayedFlush);this.delayedFlush=-1;this.flush();}}},{key:"processRecords",value:function processRecords(){var records=this.queue;var _iterator334=_createForOfIteratorHelper(this.observer.takeRecords()),_step334;try{for(_iterator334.s();!(_step334=_iterator334.n()).done;){var mut=_step334.value;records.push(mut);}}catch(err){_iterator334.e(err);}finally{_iterator334.f();}if(records.length)this.queue=[];var from=-1,to=-1,typeOver=false;var _iterator335=_createForOfIteratorHelper(records),_step335;try{for(_iterator335.s();!(_step335=_iterator335.n()).done;){var record=_step335.value;var range=this.readMutation(record);if(!range)continue;if(range.typeOver)typeOver=true;if(from==-1){from=range.from;to=range.to;}else{from=Math.min(range.from,from);to=Math.max(range.to,to);}}}catch(err){_iterator335.e(err);}finally{_iterator335.f();}return{from:from,to:to,typeOver:typeOver};}},{key:"flush",value:function flush(){var readSelection=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.delayedFlush>=0||this.delayedAndroidKey)return;if(readSelection)this.readSelectionRange();var _this$processRecords5=this.processRecords(),from=_this$processRecords5.from,to=_this$processRecords5.to,typeOver=_this$processRecords5.typeOver;var newSel=this.selectionChanged&&hasSelection5(this.dom,this.selectionRange);if(from<0&&!newSel)return;this.selectionChanged=false;var startState=this.view.state;this.onChange(from,to,typeOver);if(this.view.state==startState)this.view.update([]);}},{key:"readMutation",value:function readMutation(rec){var cView=this.view.docView.nearest(rec.target);if(!cView||cView.ignoreMutation(rec))return null;cView.markDirty(rec.type=="attributes");if(rec.type=="attributes")cView.dirty|=4;if(rec.type=="childList"){var childBefore=findChild5(cView,rec.previousSibling||rec.target.previousSibling,-1);var childAfter=findChild5(cView,rec.nextSibling||rec.target.nextSibling,1);return{from:childBefore?cView.posAfter(childBefore):cView.posAtStart,to:childAfter?cView.posBefore(childAfter):cView.posAtEnd,typeOver:false};}else if(rec.type=="characterData"){return{from:cView.posAtStart,to:cView.posAtEnd,typeOver:rec.target.nodeValue==rec.oldValue};}else{return null;}}},{key:"destroy",value:function destroy(){var _a,_b,_c;this.stop();(_a=this.intersection)===null||_a===void 0?void 0:_a.disconnect();(_b=this.gapIntersection)===null||_b===void 0?void 0:_b.disconnect();(_c=this.resize)===null||_c===void 0?void 0:_c.disconnect();var _iterator336=_createForOfIteratorHelper(this.scrollTargets),_step336;try{for(_iterator336.s();!(_step336=_iterator336.n()).done;){var dom=_step336.value;dom.removeEventListener("scroll",this.onScroll);}}catch(err){_iterator336.e(err);}finally{_iterator336.f();}window.removeEventListener("scroll",this.onScroll);this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange);clearTimeout(this.parentCheck);clearTimeout(this.resizeTimeout);}}]);return DOMObserver5;}();function findChild5(cView,dom,dir){while(dom){var curView=ContentView5.get(dom);if(curView&&curView.parent==cView)return curView;var parent=dom.parentNode;dom=parent!=cView.dom?parent:dir>0?dom.nextSibling:dom.previousSibling;}return null;}function safariSelectionRangeHack5(view){var found=null;function read(event){event.preventDefault();event.stopImmediatePropagation();found=event.getTargetRanges()[0];}view.contentDOM.addEventListener("beforeinput",read,true);document.execCommand("indent");view.contentDOM.removeEventListener("beforeinput",read,true);if(!found)return null;var anchorNode=found.startContainer,anchorOffset=found.startOffset;var focusNode=found.endContainer,focusOffset=found.endOffset;var curAnchor=view.docView.domAtPos(view.state.selection.main.anchor);if(isEquivalentPosition5(curAnchor.node,curAnchor.offset,focusNode,focusOffset)){var _ref91=[focusNode,focusOffset,anchorNode,anchorOffset];anchorNode=_ref91[0];anchorOffset=_ref91[1];focusNode=_ref91[2];focusOffset=_ref91[3];}return{anchorNode:anchorNode,anchorOffset:anchorOffset,focusNode:focusNode,focusOffset:focusOffset};}function applyDOMChange5(view,start,end,typeOver){var change,newSel;var sel=view.state.selection.main;if(start>-1){var bounds=view.docView.domBoundsAround(start,end,0);if(!bounds||view.state.readOnly)return;var from=bounds.from,to=bounds.to;var selPoints=view.docView.impreciseHead||view.docView.impreciseAnchor?[]:selectionPoints5(view);var reader=new DOMReader5(selPoints,view);reader.readRange(bounds.startDOM,bounds.endDOM);newSel=selectionFromPoints5(selPoints,from);var preferredPos=sel.from,preferredSide=null;if(view.inputState.lastKeyCode===8&&view.inputState.lastKeyTime>Date.now()-100||browser5.android&&reader.text.length<to-from){preferredPos=sel.to;preferredSide="end";}var diff=findDiff5(view.state.sliceDoc(from,to),reader.text,preferredPos-from,preferredSide);if(diff)change={from:from+diff.from,to:from+diff.toA,insert:view.state.toText(reader.text.slice(diff.from,diff.toB))};}else if(view.hasFocus||!view.state.facet(editable5)){var domSel=view.observer.selectionRange;var _view$docView5=view.docView,iHead=_view$docView5.impreciseHead,iAnchor=_view$docView5.impreciseAnchor;var head=iHead&&iHead.node==domSel.focusNode&&iHead.offset==domSel.focusOffset||!contains5(view.contentDOM,domSel.focusNode)?view.state.selection.main.head:view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset);var anchor=iAnchor&&iAnchor.node==domSel.anchorNode&&iAnchor.offset==domSel.anchorOffset||!contains5(view.contentDOM,domSel.anchorNode)?view.state.selection.main.anchor:view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset);if(head!=sel.head||anchor!=sel.anchor)newSel=EditorSelection.single(anchor,head);}if(!change&&!newSel)return;if(!change&&typeOver&&!sel.empty&&newSel&&newSel.main.empty)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,sel.to)};else if(change&&change.from>=sel.from&&change.to<=sel.to&&(change.from!=sel.from||change.to!=sel.to)&&sel.to-sel.from-(change.to-change.from)<=4)change={from:sel.from,to:sel.to,insert:view.state.doc.slice(sel.from,change.from).append(change.insert).append(view.state.doc.slice(change.to,sel.to))};if(change){var startState=view.state;if(browser5.ios&&view.inputState.flushIOSKey(view))return;if(browser5.android&&(change.from==sel.from&&change.to==sel.to&&change.insert.length==1&&change.insert.lines==2&&dispatchKey5(view.contentDOM,"Enter",13)||change.from==sel.from-1&&change.to==sel.to&&change.insert.length==0&&dispatchKey5(view.contentDOM,"Backspace",8)||change.from==sel.from&&change.to==sel.to+1&&change.insert.length==0&&dispatchKey5(view.contentDOM,"Delete",46)))return;var _text14=change.insert.toString();if(view.state.facet(inputHandler5).some(function(h){return h(view,change.from,change.to,_text14);}))return;if(view.inputState.composing>=0)view.inputState.composing++;var tr;if(change.from>=sel.from&&change.to<=sel.to&&change.to-change.from>=(sel.to-sel.from)/3&&(!newSel||newSel.main.empty&&newSel.main.from==change.from+change.insert.length)&&view.inputState.composing<0){var before=sel.from<change.from?startState.sliceDoc(sel.from,change.from):"";var after=sel.to>change.to?startState.sliceDoc(change.to,sel.to):"";tr=startState.replaceSelection(view.state.toText(before+change.insert.sliceString(0,void 0,view.state.lineBreak)+after));}else{var changes=startState.changes(change);var mainSel=newSel&&!startState.selection.main.eq(newSel.main)&&newSel.main.to<=changes.newLength?newSel.main:void 0;if(startState.selection.ranges.length>1&&view.inputState.composing>=0&&change.to<=sel.to&&change.to>=sel.to-10){var replaced=view.state.sliceDoc(change.from,change.to);var compositionRange=compositionSurroundingNode4(view)||view.state.doc.lineAt(sel.head);var offset=sel.to-change.to,size=sel.to-sel.from;tr=startState.changeByRange(function(range){if(range.from==sel.from&&range.to==sel.to)return{changes:changes,range:mainSel||range.map(changes)};var to=range.to-offset,from=to-replaced.length;if(range.to-range.from!=size||view.state.sliceDoc(from,to)!=replaced||compositionRange&&range.to>=compositionRange.from&&range.from<=compositionRange.to)return{range:range};var rangeChanges=startState.changes({from:from,to:to,insert:change.insert}),selOff=range.to-sel.to;return{changes:rangeChanges,range:!mainSel?range.map(rangeChanges):EditorSelection.range(Math.max(0,mainSel.anchor+selOff),Math.max(0,mainSel.head+selOff))};});}else{tr={changes:changes,selection:mainSel&&startState.selection.replaceRange(mainSel)};}}var userEvent="input.type";if(view.composing){userEvent+=".compose";if(view.inputState.compositionFirstChange){userEvent+=".start";view.inputState.compositionFirstChange=false;}}view.dispatch(tr,{scrollIntoView:true,userEvent:userEvent});}else if(newSel&&!newSel.main.eq(sel)){var scrollIntoView6=false,_userEvent5="select";if(view.inputState.lastSelectionTime>Date.now()-50){if(view.inputState.lastSelectionOrigin=="select")scrollIntoView6=true;_userEvent5=view.inputState.lastSelectionOrigin;}view.dispatch({selection:newSel,scrollIntoView:scrollIntoView6,userEvent:_userEvent5});}}function findDiff5(a,b,preferredPos,preferredSide){var minLen=Math.min(a.length,b.length);var from=0;while(from<minLen&&a.charCodeAt(from)==b.charCodeAt(from)){from++;}if(from==minLen&&a.length==b.length)return null;var toA=a.length,toB=b.length;while(toA>0&&toB>0&&a.charCodeAt(toA-1)==b.charCodeAt(toB-1)){toA--;toB--;}if(preferredSide=="end"){var adjust=Math.max(0,from-Math.min(toA,toB));preferredPos-=toA+adjust-from;}if(toA<from&&a.length<b.length){var move=preferredPos<=from&&preferredPos>=toA?from-preferredPos:0;from-=move;toB=from+(toB-toA);toA=from;}else if(toB<from){var _move5=preferredPos<=from&&preferredPos>=toB?from-preferredPos:0;from-=_move5;toA=from+(toA-toB);toB=from;}return{from:from,toA:toA,toB:toB};}function selectionPoints5(view){var result=[];if(view.root.activeElement!=view.contentDOM)return result;var _view$observer$select5=view.observer.selectionRange,anchorNode=_view$observer$select5.anchorNode,anchorOffset=_view$observer$select5.anchorOffset,focusNode=_view$observer$select5.focusNode,focusOffset=_view$observer$select5.focusOffset;if(anchorNode){result.push(new DOMPoint5(anchorNode,anchorOffset));if(focusNode!=anchorNode||focusOffset!=anchorOffset)result.push(new DOMPoint5(focusNode,focusOffset));}return result;}function selectionFromPoints5(points,base2){if(points.length==0)return null;var anchor=points[0].pos,head=points.length==2?points[1].pos:anchor;return anchor>-1&&head>-1?EditorSelection.single(anchor+base2,head+base2):null;}var EditorView5=/*#__PURE__*/function(){function EditorView5(){var _this210=this;var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};_classCallCheck(this,EditorView5);this.plugins=[];this.pluginMap=/* @__PURE__ */new Map();this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.destroyed=false;this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.style.cssText="position: absolute; top: -10000px";this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);this._dispatch=config2.dispatch||function(tr){return _this210.update([tr]);};this.dispatch=this.dispatch.bind(this);this.root=config2.root||getRoot5(config2.parent)||document;this.viewState=new ViewState5(config2.state||EditorState.create());this.plugins=this.state.facet(viewPlugin5).map(function(spec){return new PluginInstance5(spec);});var _iterator337=_createForOfIteratorHelper(this.plugins),_step337;try{for(_iterator337.s();!(_step337=_iterator337.n()).done;){var plugin=_step337.value;plugin.update(this);}}catch(err){_iterator337.e(err);}finally{_iterator337.f();}this.observer=new DOMObserver5(this,function(from,to,typeOver){applyDOMChange5(_this210,from,to,typeOver);},function(event){_this210.inputState.runScrollHandlers(_this210,event);if(_this210.observer.intersecting)_this210.measure();});this.inputState=new InputState5(this);this.docView=new DocView5(this);this.mountStyles();this.updateAttrs();this.updateState=0;ensureGlobalHandler5();this.requestMeasure();if(config2.parent)config2.parent.appendChild(this.dom);}_createClass(EditorView5,[{key:"state",get:function get(){return this.viewState.state;}},{key:"viewport",get:function get(){return this.viewState.viewport;}},{key:"visibleRanges",get:function get(){return this.viewState.visibleRanges;}},{key:"inView",get:function get(){return this.viewState.inView;}},{key:"composing",get:function get(){return this.inputState.composing>0;}},{key:"dispatch",value:function dispatch(){var _this$state5;this._dispatch(arguments.length==1&&(arguments.length<=0?undefined:arguments[0])instanceof Transaction?arguments.length<=0?undefined:arguments[0]:(_this$state5=this.state).update.apply(_this$state5,arguments));}},{key:"update",value:function update(transactions){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");var redrawn=false,update;var state=this.state;var _iterator338=_createForOfIteratorHelper(transactions),_step338;try{for(_iterator338.s();!(_step338=_iterator338.n()).done;){var _tr5=_step338.value;if(_tr5.startState!=state)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");state=_tr5.state;}}catch(err){_iterator338.e(err);}finally{_iterator338.f();}if(this.destroyed){this.viewState.state=state;return;}if(state.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(state);update=new ViewUpdate5(this,state,transactions);var scrollTarget=this.viewState.scrollTarget;try{this.updateState=2;var _iterator339=_createForOfIteratorHelper(transactions),_step339;try{for(_iterator339.s();!(_step339=_iterator339.n()).done;){var tr=_step339.value;if(scrollTarget)scrollTarget=scrollTarget.map(tr.changes);if(tr.scrollIntoView){var main=tr.state.selection.main;scrollTarget=new ScrollTarget5(main.empty?main:EditorSelection.cursor(main.head,main.head>main.anchor?-1:1));}var _iterator340=_createForOfIteratorHelper(tr.effects),_step340;try{for(_iterator340.s();!(_step340=_iterator340.n()).done;){var e=_step340.value;if(e.is(scrollTo5))scrollTarget=new ScrollTarget5(e.value);else if(e.is(centerOn5))scrollTarget=new ScrollTarget5(e.value,"center");else if(e.is(scrollIntoView4))scrollTarget=e.value;}}catch(err){_iterator340.e(err);}finally{_iterator340.f();}}}catch(err){_iterator339.e(err);}finally{_iterator339.f();}this.viewState.update(update,scrollTarget);this.bidiCache=CachedOrder5.update(this.bidiCache,update.changes);if(!update.empty){this.updatePlugins(update);this.inputState.update(update);}redrawn=this.docView.update(update);if(this.state.facet(styleModule5)!=this.styleModules)this.mountStyles();this.updateAttrs();this.showAnnouncements(transactions);this.docView.updateSelection(redrawn,transactions.some(function(tr){return tr.isUserEvent("select.pointer");}));}finally{this.updateState=0;}if(redrawn||scrollTarget||this.viewState.mustEnforceCursorAssoc)this.requestMeasure();if(!update.empty){var _iterator341=_createForOfIteratorHelper(this.state.facet(updateListener5)),_step341;try{for(_iterator341.s();!(_step341=_iterator341.n()).done;){var listener=_step341.value;listener(update);}}catch(err){_iterator341.e(err);}finally{_iterator341.f();}}}},{key:"setState",value:function setState(newState){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=newState;return;}this.updateState=2;var hadFocus=this.hasFocus;try{var _iterator342=_createForOfIteratorHelper(this.plugins),_step342;try{for(_iterator342.s();!(_step342=_iterator342.n()).done;){var plugin=_step342.value;plugin.destroy(this);}}catch(err){_iterator342.e(err);}finally{_iterator342.f();}this.viewState=new ViewState5(newState);this.plugins=newState.facet(viewPlugin5).map(function(spec){return new PluginInstance5(spec);});this.pluginMap.clear();var _iterator343=_createForOfIteratorHelper(this.plugins),_step343;try{for(_iterator343.s();!(_step343=_iterator343.n()).done;){var _plugin14=_step343.value;_plugin14.update(this);}}catch(err){_iterator343.e(err);}finally{_iterator343.f();}this.docView=new DocView5(this);this.inputState.ensureHandlers(this);this.mountStyles();this.updateAttrs();this.bidiCache=[];}finally{this.updateState=0;}if(hadFocus)this.focus();this.requestMeasure();}},{key:"updatePlugins",value:function updatePlugins(update){var prevSpecs=update.startState.facet(viewPlugin5),specs=update.state.facet(viewPlugin5);if(prevSpecs!=specs){var newPlugins=[];var _iterator344=_createForOfIteratorHelper(specs),_step344;try{for(_iterator344.s();!(_step344=_iterator344.n()).done;){var spec=_step344.value;var found=prevSpecs.indexOf(spec);if(found<0){newPlugins.push(new PluginInstance5(spec));}else{var plugin=this.plugins[found];plugin.mustUpdate=update;newPlugins.push(plugin);}}}catch(err){_iterator344.e(err);}finally{_iterator344.f();}var _iterator345=_createForOfIteratorHelper(this.plugins),_step345;try{for(_iterator345.s();!(_step345=_iterator345.n()).done;){var _plugin15=_step345.value;if(_plugin15.mustUpdate!=update)_plugin15.destroy(this);}}catch(err){_iterator345.e(err);}finally{_iterator345.f();}this.plugins=newPlugins;this.pluginMap.clear();this.inputState.ensureHandlers(this);}else{var _iterator346=_createForOfIteratorHelper(this.plugins),_step346;try{for(_iterator346.s();!(_step346=_iterator346.n()).done;){var _p10=_step346.value;_p10.mustUpdate=update;}}catch(err){_iterator346.e(err);}finally{_iterator346.f();}}for(var _i281=0;_i281<this.plugins.length;_i281++){this.plugins[_i281].update(this);}}},{key:"measure",value:function measure(){var _this211=this;var flush=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(this.destroyed)return;if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.measureScheduled=0;if(flush)this.observer.flush();var updated=null;try{for(var _i282=0;;_i282++){this.updateState=1;var oldViewport=this.viewport;var changed=this.viewState.measure(this);if(!changed&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(_i282>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break;}var measuring=[];if(!(changed&4)){var _ref92=[measuring,this.measureRequests];this.measureRequests=_ref92[0];measuring=_ref92[1];}var measured=measuring.map(function(m){try{return m.read(_this211);}catch(e){logException5(_this211.state,e);return BadMeasure5;}});var update=new ViewUpdate5(this,this.state),redrawn=false,scrolled=false;update.flags|=changed;if(!updated)updated=update;else updated.flags|=changed;this.updateState=2;if(!update.empty){this.updatePlugins(update);this.inputState.update(update);this.updateAttrs();redrawn=this.docView.update(update);}for(var i2=0;i2<measuring.length;i2++){if(measured[i2]!=BadMeasure5){try{var m=measuring[i2];if(m.write)m.write(measured[i2],this);}catch(e){logException5(this.state,e);}}}if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget);this.viewState.scrollTarget=null;scrolled=true;}if(redrawn)this.docView.updateSelection(true);if(this.viewport.from==oldViewport.from&&this.viewport.to==oldViewport.to&&!scrolled&&this.measureRequests.length==0)break;}}finally{this.updateState=0;this.measureScheduled=-1;}if(updated&&!updated.empty){var _iterator347=_createForOfIteratorHelper(this.state.facet(updateListener5)),_step347;try{for(_iterator347.s();!(_step347=_iterator347.n()).done;){var listener=_step347.value;listener(updated);}}catch(err){_iterator347.e(err);}finally{_iterator347.f();}}}},{key:"themeClasses",get:function get(){return baseThemeID5+" "+(this.state.facet(darkTheme5)?baseDarkID5:baseLightID5)+" "+this.state.facet(theme5);}},{key:"updateAttrs",value:function updateAttrs(){var _this212=this;var editorAttrs=attrsFromFacet4(this,editorAttributes5,{"class":"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses});var contentAttrs={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:!this.state.facet(editable5)?"false":"true","class":"cm-content",style:"".concat(browser5.tabSize,": ").concat(this.state.tabSize),role:"textbox","aria-multiline":"true"};if(this.state.readOnly)contentAttrs["aria-readonly"]="true";attrsFromFacet4(this,contentAttributes5,contentAttrs);this.observer.ignore(function(){updateAttrs5(_this212.contentDOM,_this212.contentAttrs,contentAttrs);updateAttrs5(_this212.dom,_this212.editorAttrs,editorAttrs);});this.editorAttrs=editorAttrs;this.contentAttrs=contentAttrs;}},{key:"showAnnouncements",value:function showAnnouncements(trs){var first=true;var _iterator348=_createForOfIteratorHelper(trs),_step348;try{for(_iterator348.s();!(_step348=_iterator348.n()).done;){var tr=_step348.value;var _iterator349=_createForOfIteratorHelper(tr.effects),_step349;try{for(_iterator349.s();!(_step349=_iterator349.n()).done;){var effect=_step349.value;if(effect.is(EditorView5.announce)){if(first)this.announceDOM.textContent="";first=false;var div=this.announceDOM.appendChild(document.createElement("div"));div.textContent=effect.value;}}}catch(err){_iterator349.e(err);}finally{_iterator349.f();}}}catch(err){_iterator348.e(err);}finally{_iterator348.f();}}},{key:"mountStyles",value:function mountStyles(){this.styleModules=this.state.facet(styleModule5);StyleModule.mount(this.root,this.styleModules.concat(baseTheme8).reverse());}},{key:"readMeasured",value:function readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");if(this.updateState==0&&this.measureScheduled>-1)this.measure(false);}},{key:"requestMeasure",value:function requestMeasure(request){var _this213=this;if(this.measureScheduled<0)this.measureScheduled=requestAnimationFrame(function(){return _this213.measure();});if(request){if(request.key!=null)for(var _i283=0;_i283<this.measureRequests.length;_i283++){if(this.measureRequests[_i283].key===request.key){this.measureRequests[_i283]=request;return;}}this.measureRequests.push(request);}}},{key:"pluginField",value:function pluginField(field){var result=[];var _iterator350=_createForOfIteratorHelper(this.plugins),_step350;try{for(_iterator350.s();!(_step350=_iterator350.n()).done;){var plugin=_step350.value;plugin.update(this).takeField(field,result);}}catch(err){_iterator350.e(err);}finally{_iterator350.f();}return result;}},{key:"plugin",value:function plugin(_plugin13){var known=this.pluginMap.get(_plugin13);if(known===void 0||known&&known.spec!=_plugin13)this.pluginMap.set(_plugin13,known=this.plugins.find(function(p){return p.spec==_plugin13;})||null);return known&&known.update(this).value;}},{key:"documentTop",get:function get(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop;}},{key:"documentPadding",get:function get(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom};}},{key:"blockAtHeight",value:function blockAtHeight(height,docTop){var top2=ensureTop5(docTop,this);return this.elementAtHeight(height-top2).moveY(top2);}},{key:"elementAtHeight",value:function elementAtHeight(height){this.readMeasured();return this.viewState.elementAtHeight(height);}},{key:"visualLineAtHeight",value:function visualLineAtHeight(height,docTop){var top2=ensureTop5(docTop,this);return this.lineBlockAtHeight(height-top2).moveY(top2);}},{key:"lineBlockAtHeight",value:function lineBlockAtHeight(height){this.readMeasured();return this.viewState.lineBlockAtHeight(height);}},{key:"viewportLines",value:function viewportLines(f,docTop){var top2=ensureTop5(docTop,this);var _iterator351=_createForOfIteratorHelper(this.viewportLineBlocks),_step351;try{for(_iterator351.s();!(_step351=_iterator351.n()).done;){var line=_step351.value;f(line.moveY(top2));}}catch(err){_iterator351.e(err);}finally{_iterator351.f();}}},{key:"viewportLineBlocks",get:function get(){return this.viewState.viewportLines;}},{key:"visualLineAt",value:function visualLineAt(pos){var docTop=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.lineBlockAt(pos).moveY(docTop+this.viewState.paddingTop);}},{key:"lineBlockAt",value:function lineBlockAt(pos){return this.viewState.lineBlockAt(pos);}},{key:"contentHeight",get:function get(){return this.viewState.contentHeight;}},{key:"moveByChar",value:function moveByChar(start,forward,by){return skipAtoms5(this,start,moveByChar5(this,start,forward,by));}},{key:"moveByGroup",value:function moveByGroup(start,forward){var _this214=this;return skipAtoms5(this,start,moveByChar5(this,start,forward,function(initial){return byGroup5(_this214,start.head,initial);}));}},{key:"moveToLineBoundary",value:function moveToLineBoundary(start,forward){var includeWrap=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;return moveToLineBoundary5(this,start,forward,includeWrap);}},{key:"moveVertically",value:function moveVertically(start,forward,distance){return skipAtoms5(this,start,moveVertically5(this,start,forward,distance));}},{key:"scrollPosIntoView",value:function scrollPosIntoView(pos){this.dispatch({effects:scrollTo5.of(EditorSelection.cursor(pos))});}},{key:"domAtPos",value:function domAtPos(pos){return this.docView.domAtPos(pos);}},{key:"posAtDOM",value:function posAtDOM(node){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return this.docView.posFromDOM(node,offset);}},{key:"posAtCoords",value:function posAtCoords(coords){var precise=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;this.readMeasured();return posAtCoords5(this,coords,precise);}},{key:"coordsAtPos",value:function coordsAtPos(pos){var side=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;this.readMeasured();var rect=this.docView.coordsAt(pos,side);if(!rect||rect.left==rect.right)return rect;var line=this.state.doc.lineAt(pos),order=this.bidiSpans(line);var span=order[BidiSpan5.find(order,pos-line.from,-1,side)];return flattenRect5(rect,span.dir==Direction5.LTR==side>0);}},{key:"defaultCharacterWidth",get:function get(){return this.viewState.heightOracle.charWidth;}},{key:"defaultLineHeight",get:function get(){return this.viewState.heightOracle.lineHeight;}},{key:"textDirection",get:function get(){return this.viewState.heightOracle.direction;}},{key:"lineWrapping",get:function get(){return this.viewState.heightOracle.lineWrapping;}},{key:"bidiSpans",value:function bidiSpans(line){if(line.length>MaxBidiLine5)return trivialOrder5(line.length);var dir=this.textDirection;var _iterator352=_createForOfIteratorHelper(this.bidiCache),_step352;try{for(_iterator352.s();!(_step352=_iterator352.n()).done;){var entry=_step352.value;if(entry.from==line.from&&entry.dir==dir)return entry.order;}}catch(err){_iterator352.e(err);}finally{_iterator352.f();}var order=computeOrder5(line.text,this.textDirection);this.bidiCache.push(new CachedOrder5(line.from,line.to,dir,order));return order;}},{key:"hasFocus",get:function get(){var _a;return(document.hasFocus()||browser5.safari&&((_a=this.inputState)===null||_a===void 0?void 0:_a.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM;}},{key:"focus",value:function focus(){var _this215=this;this.observer.ignore(function(){focusPreventScroll5(_this215.contentDOM);_this215.docView.updateSelection();});}},{key:"destroy",value:function destroy(){var _iterator353=_createForOfIteratorHelper(this.plugins),_step353;try{for(_iterator353.s();!(_step353=_iterator353.n()).done;){var plugin=_step353.value;plugin.destroy(this);}}catch(err){_iterator353.e(err);}finally{_iterator353.f();}this.plugins=[];this.inputState.destroy();this.dom.remove();this.observer.destroy();if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.destroyed=true;}}],[{key:"scrollIntoView",value:function scrollIntoView(pos){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return scrollIntoView4.of(new ScrollTarget5(typeof pos=="number"?EditorSelection.cursor(pos):pos,options.y,options.x,options.yMargin,options.xMargin));}},{key:"domEventHandlers",value:function domEventHandlers(handlers6){return ViewPlugin5.define(function(){return{};},{eventHandlers:handlers6});}},{key:"theme",value:function theme(spec,options){var prefix=StyleModule.newName();var result=[theme5.of(prefix),styleModule5.of(buildTheme5(".".concat(prefix),spec))];if(options&&options.dark)result.push(darkTheme5.of(true));return result;}},{key:"baseTheme",value:function baseTheme(spec){return Prec.lowest(styleModule5.of(buildTheme5("."+baseThemeID5,spec,lightDarkIDs5)));}}]);return EditorView5;}();EditorView5.scrollTo=scrollTo5;EditorView5.centerOn=centerOn5;EditorView5.styleModule=styleModule5;EditorView5.inputHandler=inputHandler5;EditorView5.exceptionSink=exceptionSink5;EditorView5.updateListener=updateListener5;EditorView5.editable=editable5;EditorView5.mouseSelectionStyle=mouseSelectionStyle5;EditorView5.dragMovesSelection=dragMovesSelection$15;EditorView5.clickAddsSelectionRange=clickAddsSelectionRange5;EditorView5.decorations=decorations5;EditorView5.darkTheme=darkTheme5;EditorView5.contentAttributes=contentAttributes5;EditorView5.editorAttributes=editorAttributes5;EditorView5.lineWrapping=/* @__PURE__ */EditorView5.contentAttributes.of({"class":"cm-lineWrapping"});EditorView5.announce=/* @__PURE__ */StateEffect.define();var MaxBidiLine5=4096;function ensureTop5(given,view){return(given==null?view.contentDOM.getBoundingClientRect().top:given)+view.viewState.paddingTop;}var resizeDebounce5=-1;function ensureGlobalHandler5(){window.addEventListener("resize",function(){if(resizeDebounce5==-1)resizeDebounce5=setTimeout(handleResize5,50);});}function handleResize5(){resizeDebounce5=-1;var found=document.querySelectorAll(".cm-content");for(var _i284=0;_i284<found.length;_i284++){var docView=ContentView5.get(found[_i284]);if(docView)docView.editorView.requestMeasure();}}var BadMeasure5={};var CachedOrder5=/*#__PURE__*/function(){function CachedOrder5(from,to,dir,order){_classCallCheck(this,CachedOrder5);this.from=from;this.to=to;this.dir=dir;this.order=order;}_createClass(CachedOrder5,null,[{key:"update",value:function update(cache,changes){if(changes.empty)return cache;var result=[],lastDir=cache.length?cache[cache.length-1].dir:Direction5.LTR;for(var _i285=Math.max(0,cache.length-10);_i285<cache.length;_i285++){var entry=cache[_i285];if(entry.dir==lastDir&&!changes.touchesRange(entry.from,entry.to))result.push(new CachedOrder5(changes.mapPos(entry.from,1),changes.mapPos(entry.to,-1),entry.dir,entry.order));}return result;}}]);return CachedOrder5;}();function attrsFromFacet4(view,facet,base2){for(var sources=view.state.facet(facet),_i286=sources.length-1;_i286>=0;_i286--){var source=sources[_i286],value=typeof source=="function"?source(view):source;if(value)combineAttrs5(value,base2);}return base2;}var currentPlatform5=browser5.mac?"mac":browser5.windows?"win":browser5.linux?"linux":"key";function normalizeKeyName2(name2,platform){var parts=name2.split(/-(?!$)/);var result=parts[parts.length-1];if(result=="Space")result=" ";var alt,ctrl,shift2,meta2;for(var _i287=0;_i287<parts.length-1;++_i287){var mod=parts[_i287];if(/^(cmd|meta|m)$/i.test(mod))meta2=true;else if(/^a(lt)?$/i.test(mod))alt=true;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=true;else if(/^s(hift)?$/i.test(mod))shift2=true;else if(/^mod$/i.test(mod)){if(platform=="mac")meta2=true;else ctrl=true;}else throw new Error("Unrecognized modifier name: "+mod);}if(alt)result="Alt-"+result;if(ctrl)result="Ctrl-"+result;if(meta2)result="Meta-"+result;if(shift2)result="Shift-"+result;return result;}function modifiers2(name2,event,shift2){if(event.altKey)name2="Alt-"+name2;if(event.ctrlKey)name2="Ctrl-"+name2;if(event.metaKey)name2="Meta-"+name2;if(shift2!==false&&event.shiftKey)name2="Shift-"+name2;return name2;}var handleKeyEvents2=/* @__PURE__ */EditorView5.domEventHandlers({keydown:function keydown(event,view){return runHandlers2(getKeymap2(view.state),event,view,"editor");}});var keymap2=/* @__PURE__ */Facet.define({enables:handleKeyEvents2});var Keymaps2=/* @__PURE__ */new WeakMap();function getKeymap2(state){var bindings=state.facet(keymap2);var map=Keymaps2.get(bindings);if(!map)Keymaps2.set(bindings,map=buildKeymap2(bindings.reduce(function(a,b){return a.concat(b);},[])));return map;}function runScopeHandlers(view,event,scope){return runHandlers2(getKeymap2(view.state),event,view,scope);}var storedPrefix2=null;var PrefixTimeout2=4e3;function buildKeymap2(bindings){var platform=arguments.length>1&&arguments[1]!==undefined?arguments[1]:currentPlatform5;var bound=/* @__PURE__ */Object.create(null);var isPrefix=/* @__PURE__ */Object.create(null);var checkPrefix=function checkPrefix(name2,is){var current=isPrefix[name2];if(current==null)isPrefix[name2]=is;else if(current!=is)throw new Error("Key binding "+name2+" is used both as a regular binding and as a multi-stroke prefix");};var add2=function add2(scope,key,command2,preventDefault){var scopeObj=bound[scope]||(bound[scope]=/* @__PURE__ */Object.create(null));var parts=key.split(/ (?!$)/).map(function(k){return normalizeKeyName2(k,platform);});var _loop40=function _loop40(_i288){var prefix=parts.slice(0,_i288).join(" ");checkPrefix(prefix,true);if(!scopeObj[prefix])scopeObj[prefix]={preventDefault:true,commands:[function(view){var ourObj=storedPrefix2={view:view,prefix:prefix,scope:scope};setTimeout(function(){if(storedPrefix2==ourObj)storedPrefix2=null;},PrefixTimeout2);return true;}]};};for(var _i288=1;_i288<parts.length;_i288++){_loop40(_i288);}var full=parts.join(" ");checkPrefix(full,false);var binding=scopeObj[full]||(scopeObj[full]={preventDefault:false,commands:[]});binding.commands.push(command2);if(preventDefault)binding.preventDefault=true;};var _iterator354=_createForOfIteratorHelper(bindings),_step354;try{for(_iterator354.s();!(_step354=_iterator354.n()).done;){var b=_step354.value;var name2=b[platform]||b.key;if(!name2)continue;var _iterator355=_createForOfIteratorHelper(b.scope?b.scope.split(" "):["editor"]),_step355;try{for(_iterator355.s();!(_step355=_iterator355.n()).done;){var scope=_step355.value;add2(scope,name2,b.run,b.preventDefault);if(b.shift)add2(scope,"Shift-"+name2,b.shift,b.preventDefault);}}catch(err){_iterator355.e(err);}finally{_iterator355.f();}}}catch(err){_iterator354.e(err);}finally{_iterator354.f();}return bound;}function runHandlers2(map,event,view,scope){var name2=keyName(event),isChar=name2.length==1&&name2!=" ";var prefix="",fallthrough=false;if(storedPrefix2&&storedPrefix2.view==view&&storedPrefix2.scope==scope){prefix=storedPrefix2.prefix+" ";if(fallthrough=modifierCodes5.indexOf(event.keyCode)<0)storedPrefix2=null;}var runFor=function runFor(binding){if(binding){var _iterator356=_createForOfIteratorHelper(binding.commands),_step356;try{for(_iterator356.s();!(_step356=_iterator356.n()).done;){var cmd2=_step356.value;if(cmd2(view))return true;}}catch(err){_iterator356.e(err);}finally{_iterator356.f();}if(binding.preventDefault)fallthrough=true;}return false;};var scopeObj=map[scope],baseName;if(scopeObj){if(runFor(scopeObj[prefix+modifiers2(name2,event,!isChar)]))return true;if(isChar&&(event.shiftKey||event.altKey||event.metaKey)&&(baseName=base[event.keyCode])&&baseName!=name2){if(runFor(scopeObj[prefix+modifiers2(baseName,event,true)]))return true;}else if(isChar&&event.shiftKey){if(runFor(scopeObj[prefix+modifiers2(name2,event,true)]))return true;}}return fallthrough;}var CanHidePrimary5=!browser5.ios;var themeSpec5={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};if(CanHidePrimary5)themeSpec5[".cm-line"].caretColor="transparent !important";var UnicodeRegexpSupport5=/x/.unicode!=null?"gu":"g";// ../node_modules/@codemirror/panel/dist/index.js
var panelConfig=/* @__PURE__ */Facet.define({combine:function combine(configs){var topContainer,bottomContainer;var _iterator357=_createForOfIteratorHelper(configs),_step357;try{for(_iterator357.s();!(_step357=_iterator357.n()).done;){var c=_step357.value;topContainer=topContainer||c.topContainer;bottomContainer=bottomContainer||c.bottomContainer;}}catch(err){_iterator357.e(err);}finally{_iterator357.f();}return{topContainer:topContainer,bottomContainer:bottomContainer};}});function getPanel(view,panel){var plugin=view.plugin(panelPlugin);var index=plugin?plugin.specs.indexOf(panel):-1;return index>-1?plugin.panels[index]:null;}var panelPlugin=/* @__PURE__ */ViewPlugin.fromClass(/*#__PURE__*/function(){function _class10(view){_classCallCheck(this,_class10);this.input=view.state.facet(showPanel);this.specs=this.input.filter(function(s){return s;});this.panels=this.specs.map(function(spec){return spec(view);});var conf=view.state.facet(panelConfig);this.top=new PanelGroup(view,true,conf.topContainer);this.bottom=new PanelGroup(view,false,conf.bottomContainer);this.top.sync(this.panels.filter(function(p){return p.top;}));this.bottom.sync(this.panels.filter(function(p){return!p.top;}));var _iterator358=_createForOfIteratorHelper(this.panels),_step358;try{for(_iterator358.s();!(_step358=_iterator358.n()).done;){var _p11=_step358.value;_p11.dom.classList.add("cm-panel");if(_p11.mount)_p11.mount();}}catch(err){_iterator358.e(err);}finally{_iterator358.f();}}_createClass(_class10,[{key:"update",value:function update(_update33){var conf=_update33.state.facet(panelConfig);if(this.top.container!=conf.topContainer){this.top.sync([]);this.top=new PanelGroup(_update33.view,true,conf.topContainer);}if(this.bottom.container!=conf.bottomContainer){this.bottom.sync([]);this.bottom=new PanelGroup(_update33.view,false,conf.bottomContainer);}this.top.syncClasses();this.bottom.syncClasses();var input=_update33.state.facet(showPanel);if(input!=this.input){var specs=input.filter(function(x){return x;});var panels=[],top2=[],bottom=[],mount=[];var _iterator359=_createForOfIteratorHelper(specs),_step359;try{for(_iterator359.s();!(_step359=_iterator359.n()).done;){var spec=_step359.value;var known=this.specs.indexOf(spec),panel=void 0;if(known<0){panel=spec(_update33.view);mount.push(panel);}else{panel=this.panels[known];if(panel.update)panel.update(_update33);}panels.push(panel);(panel.top?top2:bottom).push(panel);}}catch(err){_iterator359.e(err);}finally{_iterator359.f();}this.specs=specs;this.panels=panels;this.top.sync(top2);this.bottom.sync(bottom);for(var _i289=0,_mount=mount;_i289<_mount.length;_i289++){var _p12=_mount[_i289];_p12.dom.classList.add("cm-panel");if(_p12.mount)_p12.mount();}}else{var _iterator360=_createForOfIteratorHelper(this.panels),_step360;try{for(_iterator360.s();!(_step360=_iterator360.n()).done;){var _p13=_step360.value;if(_p13.update)_p13.update(_update33);}}catch(err){_iterator360.e(err);}finally{_iterator360.f();}}}},{key:"destroy",value:function destroy(){this.top.sync([]);this.bottom.sync([]);}}]);return _class10;}(),{provide:/* @__PURE__ */PluginField.scrollMargins.from(function(value){return{top:value.top.scrollMargin(),bottom:value.bottom.scrollMargin()};})});var PanelGroup=/*#__PURE__*/function(){function PanelGroup(view,top2,container){_classCallCheck(this,PanelGroup);this.view=view;this.top=top2;this.container=container;this.dom=void 0;this.classes="";this.panels=[];this.syncClasses();}_createClass(PanelGroup,[{key:"sync",value:function sync(panels){var _iterator361=_createForOfIteratorHelper(this.panels),_step361;try{for(_iterator361.s();!(_step361=_iterator361.n()).done;){var _p14=_step361.value;if(_p14.destroy&&panels.indexOf(_p14)<0)_p14.destroy();}}catch(err){_iterator361.e(err);}finally{_iterator361.f();}this.panels=panels;this.syncDOM();}},{key:"syncDOM",value:function syncDOM(){if(this.panels.length==0){if(this.dom){this.dom.remove();this.dom=void 0;}return;}if(!this.dom){this.dom=document.createElement("div");this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom";this.dom.style[this.top?"top":"bottom"]="0";var parent=this.container||this.view.dom;parent.insertBefore(this.dom,this.top?parent.firstChild:null);}var curDOM=this.dom.firstChild;var _iterator362=_createForOfIteratorHelper(this.panels),_step362;try{for(_iterator362.s();!(_step362=_iterator362.n()).done;){var panel=_step362.value;if(panel.dom.parentNode==this.dom){while(curDOM!=panel.dom){curDOM=rm6(curDOM);}curDOM=curDOM.nextSibling;}else{this.dom.insertBefore(panel.dom,curDOM);}}}catch(err){_iterator362.e(err);}finally{_iterator362.f();}while(curDOM){curDOM=rm6(curDOM);}}},{key:"scrollMargin",value:function scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top);}},{key:"syncClasses",value:function syncClasses(){if(!this.container||this.classes==this.view.themeClasses)return;var _iterator363=_createForOfIteratorHelper(this.classes.split(" ")),_step363;try{for(_iterator363.s();!(_step363=_iterator363.n()).done;){var cls=_step363.value;if(cls)this.container.classList.remove(cls);}}catch(err){_iterator363.e(err);}finally{_iterator363.f();}var _iterator364=_createForOfIteratorHelper((this.classes=this.view.themeClasses).split(" ")),_step364;try{for(_iterator364.s();!(_step364=_iterator364.n()).done;){var _cls=_step364.value;if(_cls)this.container.classList.add(_cls);}}catch(err){_iterator364.e(err);}finally{_iterator364.f();}}}]);return PanelGroup;}();function rm6(node){var next=node.nextSibling;node.remove();return next;}var baseTheme9=/* @__PURE__ */EditorView.baseTheme({".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"}});var showPanel=/* @__PURE__ */Facet.define({enables:[panelPlugin,baseTheme9]});// ../node_modules/crelt/index.es.js
function crelt(){var elt=arguments[0];if(typeof elt=="string")elt=document.createElement(elt);var i=1,next=arguments[1];if(next&&_typeof(next)=="object"&&next.nodeType==null&&!Array.isArray(next)){for(var name2 in next){if(Object.prototype.hasOwnProperty.call(next,name2)){var value=next[name2];if(typeof value=="string")elt.setAttribute(name2,value);else if(value!=null)elt[name2]=value;}}i++;}for(;i<arguments.length;i++){add(elt,arguments[i]);}return elt;}function add(elt,child){if(typeof child=="string"){elt.appendChild(document.createTextNode(child));}else if(child==null){}else if(child.nodeType!=null){elt.appendChild(child);}else if(Array.isArray(child)){for(var i=0;i<child.length;i++){add(elt,child[i]);}}else{throw new RangeError("Unsupported child node: "+child);}}// ../node_modules/@codemirror/search/dist/index.js
var basicNormalize=typeof String.prototype.normalize=="function"?function(x){return x.normalize("NFKD");}:function(x){return x;};var SearchCursor=/*#__PURE__*/function(){function SearchCursor(text,query){var from=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var to=arguments.length>3&&arguments[3]!==undefined?arguments[3]:text.length;var normalize=arguments.length>4?arguments[4]:undefined;_classCallCheck(this,SearchCursor);this.value={from:0,to:0};this.done=false;this.matches=[];this.buffer="";this.bufferPos=0;this.iter=text.iterRange(from,to);this.bufferStart=from;this.normalize=normalize?function(x){return normalize(basicNormalize(x));}:basicNormalize;this.query=this.normalize(query);}_createClass(SearchCursor,[{key:"peek",value:function peek(){if(this.bufferPos==this.buffer.length){this.bufferStart+=this.buffer.length;this.iter.next();if(this.iter.done)return-1;this.bufferPos=0;this.buffer=this.iter.value;}return codePointAt(this.buffer,this.bufferPos);}},{key:"next",value:function next(){while(this.matches.length){this.matches.pop();}return this.nextOverlapping();}},{key:"nextOverlapping",value:function nextOverlapping(){for(;;){var next=this.peek();if(next<0){this.done=true;return this;}var str=fromCodePoint(next),start=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(next);var norm=this.normalize(str);for(var _i290=0,pos=start;;_i290++){var _code=norm.charCodeAt(_i290);var match=this.match(_code,pos);if(match){this.value=match;return this;}if(_i290==norm.length-1)break;if(pos==start&&_i290<str.length&&str.charCodeAt(_i290)==_code)pos++;}}}},{key:"match",value:function match(code,pos){var match=null;for(var _i291=0;_i291<this.matches.length;_i291+=2){var index=this.matches[_i291],keep=false;if(this.query.charCodeAt(index)==code){if(index==this.query.length-1){match={from:this.matches[_i291+1],to:pos+1};}else{this.matches[_i291]++;keep=true;}}if(!keep){this.matches.splice(_i291,2);_i291-=2;}}if(this.query.charCodeAt(0)==code){if(this.query.length==1)match={from:pos,to:pos+1};else this.matches.push(1,pos);}return match;}}]);return SearchCursor;}();if(typeof Symbol!="undefined")SearchCursor.prototype[Symbol.iterator]=function(){return this;};var empty={from:-1,to:-1,match:/* @__PURE__ */ /.*/.exec("")};var baseFlags="gm"+(/x/.unicode==null?"":"u");var RegExpCursor=/*#__PURE__*/function(){function RegExpCursor(text,query,options){var from=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var to=arguments.length>4&&arguments[4]!==undefined?arguments[4]:text.length;_classCallCheck(this,RegExpCursor);this.to=to;this.curLine="";this.done=false;this.value=empty;if(/\\[sWDnr]|\n|\r|\[\^/.test(query))return new MultilineRegExpCursor(text,query,options,from,to);this.re=new RegExp(query,baseFlags+((options===null||options===void 0?void 0:options.ignoreCase)?"i":""));this.iter=text.iter();var startLine=text.lineAt(from);this.curLineStart=startLine.from;this.matchPos=from;this.getLine(this.curLineStart);}_createClass(RegExpCursor,[{key:"getLine",value:function getLine(skip){this.iter.next(skip);if(this.iter.lineBreak){this.curLine="";}else{this.curLine=this.iter.value;if(this.curLineStart+this.curLine.length>this.to)this.curLine=this.curLine.slice(0,this.to-this.curLineStart);this.iter.next();}}},{key:"nextLine",value:function nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1;if(this.curLineStart>this.to)this.curLine="";else this.getLine(0);}},{key:"next",value:function next(){for(var off=this.matchPos-this.curLineStart;;){this.re.lastIndex=off;var match=this.matchPos<=this.to&&this.re.exec(this.curLine);if(match){var from=this.curLineStart+match.index,to=from+match[0].length;this.matchPos=to+(from==to?1:0);if(from==this.curLine.length)this.nextLine();if(from<to||from>this.value.to){this.value={from:from,to:to,match:match};return this;}off=this.matchPos-this.curLineStart;}else if(this.curLineStart+this.curLine.length<this.to){this.nextLine();off=0;}else{this.done=true;return this;}}}}]);return RegExpCursor;}();var flattened=/* @__PURE__ */new WeakMap();var FlattenedDoc=/*#__PURE__*/function(){function FlattenedDoc(from,text){_classCallCheck(this,FlattenedDoc);this.from=from;this.text=text;}_createClass(FlattenedDoc,[{key:"to",get:function get(){return this.from+this.text.length;}}],[{key:"get",value:function get(doc6,from,to){var cached=flattened.get(doc6);if(!cached||cached.from>=to||cached.to<=from){var flat=new FlattenedDoc(from,doc6.sliceString(from,to));flattened.set(doc6,flat);return flat;}if(cached.from==from&&cached.to==to)return cached;var text=cached.text,cachedFrom=cached.from;if(cachedFrom>from){text=doc6.sliceString(from,cachedFrom)+text;cachedFrom=from;}if(cached.to<to)text+=doc6.sliceString(cached.to,to);flattened.set(doc6,new FlattenedDoc(cachedFrom,text));return new FlattenedDoc(from,text.slice(from-cachedFrom,to-cachedFrom));}}]);return FlattenedDoc;}();var MultilineRegExpCursor=/*#__PURE__*/function(){function MultilineRegExpCursor(text,query,options,from,to){_classCallCheck(this,MultilineRegExpCursor);this.text=text;this.to=to;this.done=false;this.value=empty;this.matchPos=from;this.re=new RegExp(query,baseFlags+((options===null||options===void 0?void 0:options.ignoreCase)?"i":""));this.flat=FlattenedDoc.get(text,from,this.chunkEnd(from+5e3));}_createClass(MultilineRegExpCursor,[{key:"chunkEnd",value:function chunkEnd(pos){return pos>=this.to?this.to:this.text.lineAt(pos).to;}},{key:"next",value:function next(){for(;;){var off=this.re.lastIndex=this.matchPos-this.flat.from;var match=this.re.exec(this.flat.text);if(match&&!match[0]&&match.index==off){this.re.lastIndex=off+1;match=this.re.exec(this.flat.text);}if(match&&this.flat.to<this.to&&match.index+match[0].length>this.flat.text.length-10)match=null;if(match){var from=this.flat.from+match.index,to=from+match[0].length;this.value={from:from,to:to,match:match};this.matchPos=to+(from==to?1:0);return this;}else{if(this.flat.to==this.to){this.done=true;return this;}this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2));}}}}]);return MultilineRegExpCursor;}();if(typeof Symbol!="undefined"){RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this;};}function validRegExp(source){try{new RegExp(source,baseFlags);return true;}catch(_a){return false;}}function createLineDialog(view){var input=crelt("input",{"class":"cm-textfield",name:"line"});var dom=crelt("form",{"class":"cm-gotoLine",onkeydown:function onkeydown(event){if(event.keyCode==27){event.preventDefault();view.dispatch({effects:dialogEffect.of(false)});view.focus();}else if(event.keyCode==13){event.preventDefault();go();}},onsubmit:function onsubmit(event){event.preventDefault();go();}},crelt("label",view.state.phrase("Go to line"),": ",input)," ",crelt("button",{"class":"cm-button",type:"submit"},view.state.phrase("go")));function go(){var match=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(input.value);if(!match)return;var state=view.state,startLine=state.doc.lineAt(state.selection.main.head);var _match=_slicedToArray(match,5),sign=_match[1],ln=_match[2],cl=_match[3],percent=_match[4];var col=cl?+cl.slice(1):0;var line=ln?+ln:startLine.number;if(ln&&percent){var pc=line/100;if(sign)pc=pc*(sign=="-"?-1:1)+startLine.number/state.doc.lines;line=Math.round(state.doc.lines*pc);}else if(ln&&sign){line=line*(sign=="-"?-1:1)+startLine.number;}var docLine=state.doc.line(Math.max(1,Math.min(state.doc.lines,line)));view.dispatch({effects:dialogEffect.of(false),selection:EditorSelection.cursor(docLine.from+Math.max(0,Math.min(col,docLine.length))),scrollIntoView:true});view.focus();}return{dom:dom,pos:-10};}var dialogEffect=/* @__PURE__ */StateEffect.define();var dialogField=/* @__PURE__ */StateField.define({create:function create(){return true;},update:function update(value,tr){var _iterator365=_createForOfIteratorHelper(tr.effects),_step365;try{for(_iterator365.s();!(_step365=_iterator365.n()).done;){var e=_step365.value;if(e.is(dialogEffect))value=e.value;}}catch(err){_iterator365.e(err);}finally{_iterator365.f();}return value;},provide:function provide(f){return showPanel.from(f,function(val){return val?createLineDialog:null;});}});var gotoLine=function gotoLine(view){var panel=getPanel(view,createLineDialog);if(!panel){var effects=[dialogEffect.of(true)];if(view.state.field(dialogField,false)==null)effects.push(StateEffect.appendConfig.of([dialogField,baseTheme$1]));view.dispatch({effects:effects});panel=getPanel(view,createLineDialog);}if(panel)panel.dom.querySelector("input").focus();return true;};var baseTheme$1=/* @__PURE__ */EditorView5.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}});var defaultHighlightOptions={highlightWordAroundCursor:false,minSelectionLength:1,maxMatches:100};var highlightConfig=/* @__PURE__ */Facet.define({combine:function combine(options){return combineConfig(options,defaultHighlightOptions,{highlightWordAroundCursor:function highlightWordAroundCursor(a,b){return a||b;},minSelectionLength:Math.min,maxMatches:Math.min});}});function highlightSelectionMatches(options){var ext=[defaultTheme,matchHighlighter];if(options)ext.push(highlightConfig.of(options));return ext;}var matchDeco=/* @__PURE__ */Decoration5.mark({"class":"cm-selectionMatch"});var mainMatchDeco=/* @__PURE__ */Decoration5.mark({"class":"cm-selectionMatch cm-selectionMatch-main"});var matchHighlighter=/* @__PURE__ */ViewPlugin5.fromClass(/*#__PURE__*/function(){function _class11(view){_classCallCheck(this,_class11);this.decorations=this.getDeco(view);}_createClass(_class11,[{key:"update",value:function update(_update34){if(_update34.selectionSet||_update34.docChanged||_update34.viewportChanged)this.decorations=this.getDeco(_update34.view);}},{key:"getDeco",value:function getDeco(view){var conf=view.state.facet(highlightConfig);var state=view.state,sel=state.selection;if(sel.ranges.length>1)return Decoration5.none;var range=sel.main,query,check=null;if(range.empty){if(!conf.highlightWordAroundCursor)return Decoration5.none;var word=state.wordAt(range.head);if(!word)return Decoration5.none;check=state.charCategorizer(range.head);query=state.sliceDoc(word.from,word.to);}else{var len=range.to-range.from;if(len<conf.minSelectionLength||len>200)return Decoration5.none;query=state.sliceDoc(range.from,range.to).trim();if(!query)return Decoration5.none;}var deco=[];var _iterator366=_createForOfIteratorHelper(view.visibleRanges),_step366;try{for(_iterator366.s();!(_step366=_iterator366.n()).done;){var part=_step366.value;var cursor2=new SearchCursor(state.doc,query,part.from,part.to);while(!cursor2.next().done){var _cursor2$value=cursor2.value,from=_cursor2$value.from,to=_cursor2$value.to;if(!check||(from==0||check(state.sliceDoc(from-1,from))!=CharCategory.Word)&&(to==state.doc.length||check(state.sliceDoc(to,to+1))!=CharCategory.Word)){if(check&&from<=range.from&&to>=range.to)deco.push(mainMatchDeco.range(from,to));else if(from>=range.to||to<=range.from)deco.push(matchDeco.range(from,to));if(deco.length>conf.maxMatches)return Decoration5.none;}}}}catch(err){_iterator366.e(err);}finally{_iterator366.f();}return Decoration5.set(deco);}}]);return _class11;}(),{decorations:function decorations(v){return v.decorations;}});var defaultTheme=/* @__PURE__ */EditorView5.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}});var selectWord=function selectWord(_ref93){var state=_ref93.state,dispatch=_ref93.dispatch;var selection2=state.selection;var newSel=EditorSelection.create(selection2.ranges.map(function(range){return state.wordAt(range.head)||EditorSelection.cursor(range.head);}),selection2.mainIndex);if(newSel.eq(selection2))return false;dispatch(state.update({selection:newSel}));return true;};function findNextOccurrence(state,query){var _state$selection=state.selection,main=_state$selection.main,ranges=_state$selection.ranges;var word=state.wordAt(main.head),fullWord=word&&word.from==main.from&&word.to==main.to;var _loop41=function _loop41(_cycled,_cursor){_cursor.next();if(_cursor.done){if(_cycled){cursor2=_cursor;{cycled=_cycled;return{v:null};}}_cursor=new SearchCursor(state.doc,query,0,Math.max(0,ranges[ranges.length-1].from-1));_cycled=true;}else{if(_cycled&&ranges.some(function(r){return r.from==_cursor.value.from;})){cursor2=_cursor;{cycled=_cycled;return"continue";}}if(fullWord){var word2=state.wordAt(_cursor.value.from);if(!word2||word2.from!=_cursor.value.from||word2.to!=_cursor.value.to){cursor2=_cursor;{cycled=_cycled;return"continue";}}}cycled=_cycled;cursor2=_cursor;return{v:_cursor.value};}cycled=_cycled;cursor2=_cursor;};for(var cycled=false,cursor2=new SearchCursor(state.doc,query,ranges[ranges.length-1].to);;){var _ret6=_loop41(cycled,cursor2);if(_ret6==="continue")continue;if(_typeof(_ret6)==="object")return _ret6.v;}}var selectNextOccurrence=function selectNextOccurrence(_ref94){var state=_ref94.state,dispatch=_ref94.dispatch;var ranges=state.selection.ranges;if(ranges.some(function(sel){return sel.from===sel.to;}))return selectWord({state:state,dispatch:dispatch});var searchedText=state.sliceDoc(ranges[0].from,ranges[0].to);if(state.selection.ranges.some(function(r){return state.sliceDoc(r.from,r.to)!=searchedText;}))return false;var range=findNextOccurrence(state,searchedText);if(!range)return false;dispatch(state.update({selection:state.selection.addRange(EditorSelection.range(range.from,range.to),false),effects:EditorView5.scrollIntoView(range.to)}));return true;};var searchConfigFacet=/* @__PURE__ */Facet.define({combine:function combine(configs){var _a;return{top:configs.reduce(function(val,conf){return val!==null&&val!==void 0?val:conf.top;},void 0)||false,caseSensitive:configs.reduce(function(val,conf){return val!==null&&val!==void 0?val:conf.caseSensitive||conf.matchCase;},void 0)||false,createPanel:((_a=configs.find(function(c){return c.createPanel;}))===null||_a===void 0?void 0:_a.createPanel)||function(view){return new SearchPanel(view);}};}});var SearchQuery=/*#__PURE__*/function(){function SearchQuery(config2){_classCallCheck(this,SearchQuery);this.search=config2.search;this.caseSensitive=!!config2.caseSensitive;this.regexp=!!config2.regexp;this.replace=config2.replace||"";this.valid=!!this.search&&(!this.regexp||validRegExp(this.search));}_createClass(SearchQuery,[{key:"eq",value:function eq(other){return this.search==other.search&&this.replace==other.replace&&this.caseSensitive==other.caseSensitive&&this.regexp==other.regexp;}},{key:"create",value:function create(){return this.regexp?new RegExpQuery(this):new StringQuery(this);}}]);return SearchQuery;}();var QueryType6=/*#__PURE__*/_createClass(function QueryType6(spec){_classCallCheck(this,QueryType6);this.spec=spec;});var StringQuery=/*#__PURE__*/function(_QueryType){_inherits(StringQuery,_QueryType);var _super115=_createSuper(StringQuery);function StringQuery(spec){var _this216;_classCallCheck(this,StringQuery);_this216=_super115.call(this,spec);_this216.unquoted=spec.search.replace(/\\([nrt\\])/g,function(_,ch){return ch=="n"?"\n":ch=="r"?"\r":ch=="t"?"	":"\\";});return _this216;}_createClass(StringQuery,[{key:"cursor",value:function cursor(doc6){var from=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:doc6.length;return new SearchCursor(doc6,this.unquoted,from,to,this.spec.caseSensitive?void 0:function(x){return x.toLowerCase();});}},{key:"nextMatch",value:function nextMatch(doc6,curFrom,curTo){var cursor2=this.cursor(doc6,curTo).nextOverlapping();if(cursor2.done)cursor2=this.cursor(doc6,0,curFrom).nextOverlapping();return cursor2.done?null:cursor2.value;}},{key:"prevMatchInRange",value:function prevMatchInRange(doc6,from,to){for(var pos=to;;){var start=Math.max(from,pos-1e4-this.unquoted.length);var _cursor2=this.cursor(doc6,start,pos),range=null;while(!_cursor2.nextOverlapping().done){range=_cursor2.value;}if(range)return range;if(start==from)return null;pos-=1e4;}}},{key:"prevMatch",value:function prevMatch(doc6,curFrom,curTo){return this.prevMatchInRange(doc6,0,curFrom)||this.prevMatchInRange(doc6,curTo,doc6.length);}},{key:"getReplacement",value:function getReplacement(_result){return this.spec.replace;}},{key:"matchAll",value:function matchAll(doc6,limit){var cursor2=this.cursor(doc6),ranges=[];while(!cursor2.next().done){if(ranges.length>=limit)return null;ranges.push(cursor2.value);}return ranges;}},{key:"highlight",value:function highlight(doc6,from,to,add2){var cursor2=this.cursor(doc6,Math.max(0,from-this.unquoted.length),Math.min(to+this.unquoted.length,doc6.length));while(!cursor2.next().done){add2(cursor2.value.from,cursor2.value.to);}}}]);return StringQuery;}(QueryType6);var RegExpQuery=/*#__PURE__*/function(_QueryType2){_inherits(RegExpQuery,_QueryType2);var _super116=_createSuper(RegExpQuery);function RegExpQuery(){_classCallCheck(this,RegExpQuery);return _super116.apply(this,arguments);}_createClass(RegExpQuery,[{key:"cursor",value:function cursor(doc6){var from=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var to=arguments.length>2&&arguments[2]!==undefined?arguments[2]:doc6.length;return new RegExpCursor(doc6,this.spec.search,this.spec.caseSensitive?void 0:{ignoreCase:true},from,to);}},{key:"nextMatch",value:function nextMatch(doc6,curFrom,curTo){var cursor2=this.cursor(doc6,curTo).next();if(cursor2.done)cursor2=this.cursor(doc6,0,curFrom).next();return cursor2.done?null:cursor2.value;}},{key:"prevMatchInRange",value:function prevMatchInRange(doc6,from,to){for(var size=1;;size++){var start=Math.max(from,to-size*1e4);var _cursor3=this.cursor(doc6,start,to),range=null;while(!_cursor3.next().done){range=_cursor3.value;}if(range&&(start==from||range.from>start+10))return range;if(start==from)return null;}}},{key:"prevMatch",value:function prevMatch(doc6,curFrom,curTo){return this.prevMatchInRange(doc6,0,curFrom)||this.prevMatchInRange(doc6,curTo,doc6.length);}},{key:"getReplacement",value:function getReplacement(result){return this.spec.replace.replace(/\$([$&\d+])/g,function(m,i){return i=="$"?"$":i=="&"?result.match[0]:i!="0"&&+i<result.match.length?result.match[i]:m;});}},{key:"matchAll",value:function matchAll(doc6,limit){var cursor2=this.cursor(doc6),ranges=[];while(!cursor2.next().done){if(ranges.length>=limit)return null;ranges.push(cursor2.value);}return ranges;}},{key:"highlight",value:function highlight(doc6,from,to,add2){var cursor2=this.cursor(doc6,Math.max(0,from-250),Math.min(to+250,doc6.length));while(!cursor2.next().done){add2(cursor2.value.from,cursor2.value.to);}}}]);return RegExpQuery;}(QueryType6);var setSearchQuery=/* @__PURE__ */StateEffect.define();var togglePanel=/* @__PURE__ */StateEffect.define();var searchState=/* @__PURE__ */StateField.define({create:function create(state){return new SearchState(defaultQuery(state).create(),createSearchPanel);},update:function update(value,tr){var _iterator367=_createForOfIteratorHelper(tr.effects),_step367;try{for(_iterator367.s();!(_step367=_iterator367.n()).done;){var effect=_step367.value;if(effect.is(setSearchQuery))value=new SearchState(effect.value.create(),value.panel);else if(effect.is(togglePanel))value=new SearchState(value.query,effect.value?createSearchPanel:null);}}catch(err){_iterator367.e(err);}finally{_iterator367.f();}return value;},provide:function provide(f){return showPanel.from(f,function(val){return val.panel;});}});var SearchState=/*#__PURE__*/_createClass(function SearchState(query,panel){_classCallCheck(this,SearchState);this.query=query;this.panel=panel;});var matchMark=/* @__PURE__ */Decoration5.mark({"class":"cm-searchMatch"});var selectedMatchMark=/* @__PURE__ */Decoration5.mark({"class":"cm-searchMatch cm-searchMatch-selected"});var searchHighlighter=/* @__PURE__ */ViewPlugin5.fromClass(/*#__PURE__*/function(){function _class12(view){_classCallCheck(this,_class12);this.view=view;this.decorations=this.highlight(view.state.field(searchState));}_createClass(_class12,[{key:"update",value:function update(_update35){var state=_update35.state.field(searchState);if(state!=_update35.startState.field(searchState)||_update35.docChanged||_update35.selectionSet)this.decorations=this.highlight(state);}},{key:"highlight",value:function highlight(_ref95){var query=_ref95.query,panel=_ref95.panel;if(!panel||!query.spec.valid)return Decoration5.none;var view=this.view;var builder=new RangeSetBuilder();for(var _i292=0,ranges=view.visibleRanges,_l11=ranges.length;_i292<_l11;_i292++){var _ranges$_i6=ranges[_i292],from=_ranges$_i6.from,to=_ranges$_i6.to;while(_i292<_l11-1&&to>ranges[_i292+1].from-2*250){to=ranges[++_i292].to;}query.highlight(view.state.doc,from,to,function(from2,to2){var selected=view.state.selection.ranges.some(function(r){return r.from==from2&&r.to==to2;});builder.add(from2,to2,selected?selectedMatchMark:matchMark);});}return builder.finish();}}]);return _class12;}(),{decorations:function decorations(v){return v.decorations;}});function searchCommand(f){return function(view){var state=view.state.field(searchState,false);return state&&state.query.spec.valid?f(view,state):openSearchPanel(view);};}var findNext=/* @__PURE__ */searchCommand(function(view,_ref96){var query=_ref96.query;var _view$state$selection=view.state.selection.main,from=_view$state$selection.from,to=_view$state$selection.to;var next=query.nextMatch(view.state.doc,from,to);if(!next||next.from==from&&next.to==to)return false;view.dispatch({selection:{anchor:next.from,head:next.to},scrollIntoView:true,effects:announceMatch(view,next),userEvent:"select.search"});return true;});var findPrevious=/* @__PURE__ */searchCommand(function(view,_ref97){var query=_ref97.query;var state=view.state,_state$selection$main=state.selection.main,from=_state$selection$main.from,to=_state$selection$main.to;var range=query.prevMatch(state.doc,from,to);if(!range)return false;view.dispatch({selection:{anchor:range.from,head:range.to},scrollIntoView:true,effects:announceMatch(view,range),userEvent:"select.search"});return true;});var selectMatches=/* @__PURE__ */searchCommand(function(view,_ref98){var query=_ref98.query;var ranges=query.matchAll(view.state.doc,1e3);if(!ranges||!ranges.length)return false;view.dispatch({selection:EditorSelection.create(ranges.map(function(r){return EditorSelection.range(r.from,r.to);})),userEvent:"select.search.matches"});return true;});var selectSelectionMatches=function selectSelectionMatches(_ref99){var state=_ref99.state,dispatch=_ref99.dispatch;var sel=state.selection;if(sel.ranges.length>1||sel.main.empty)return false;var _sel$main=sel.main,from=_sel$main.from,to=_sel$main.to;var ranges=[],main=0;for(var cur2=new SearchCursor(state.doc,state.sliceDoc(from,to));!cur2.next().done;){if(ranges.length>1e3)return false;if(cur2.value.from==from)main=ranges.length;ranges.push(EditorSelection.range(cur2.value.from,cur2.value.to));}dispatch(state.update({selection:EditorSelection.create(ranges,main),userEvent:"select.search.matches"}));return true;};var replaceNext=/* @__PURE__ */searchCommand(function(view,_ref100){var query=_ref100.query;var state=view.state,_state$selection$main2=state.selection.main,from=_state$selection$main2.from,to=_state$selection$main2.to;if(state.readOnly)return false;var next=query.nextMatch(state.doc,from,from);if(!next)return false;var changes=[],selection2,replacement;if(next.from==from&&next.to==to){replacement=state.toText(query.getReplacement(next));changes.push({from:next.from,to:next.to,insert:replacement});next=query.nextMatch(state.doc,next.from,next.to);}if(next){var off=changes.length==0||changes[0].from>=next.to?0:next.to-next.from-replacement.length;selection2={anchor:next.from-off,head:next.to-off};}view.dispatch({changes:changes,selection:selection2,scrollIntoView:!!selection2,effects:next?announceMatch(view,next):void 0,userEvent:"input.replace"});return true;});var replaceAll=/* @__PURE__ */searchCommand(function(view,_ref101){var query=_ref101.query;if(view.state.readOnly)return false;var changes=query.matchAll(view.state.doc,1e9).map(function(match){var from=match.from,to=match.to;return{from:from,to:to,insert:query.getReplacement(match)};});if(!changes.length)return false;view.dispatch({changes:changes,userEvent:"input.replace.all"});return true;});function createSearchPanel(view){return view.state.facet(searchConfigFacet).createPanel(view);}function defaultQuery(state,fallback){var _a;var sel=state.selection.main;var selText=sel.empty||sel.to>sel.from+100?"":state.sliceDoc(sel.from,sel.to);var caseSensitive=(_a=fallback===null||fallback===void 0?void 0:fallback.caseSensitive)!==null&&_a!==void 0?_a:state.facet(searchConfigFacet).caseSensitive;return fallback&&!selText?fallback:new SearchQuery({search:selText.replace(/\n/g,"\\n"),caseSensitive:caseSensitive});}var openSearchPanel=function openSearchPanel(view){var state=view.state.field(searchState,false);if(state&&state.panel){var panel=getPanel(view,createSearchPanel);if(!panel)return false;var searchInput=panel.dom.querySelector("[name=search]");if(searchInput!=view.root.activeElement){var query=defaultQuery(view.state,state.query.spec);if(query.valid)view.dispatch({effects:setSearchQuery.of(query)});searchInput.focus();searchInput.select();}}else{view.dispatch({effects:[togglePanel.of(true),state?setSearchQuery.of(defaultQuery(view.state,state.query.spec)):StateEffect.appendConfig.of(searchExtensions)]});}return true;};var closeSearchPanel=function closeSearchPanel(view){var state=view.state.field(searchState,false);if(!state||!state.panel)return false;var panel=getPanel(view,createSearchPanel);if(panel&&panel.dom.contains(view.root.activeElement))view.focus();view.dispatch({effects:togglePanel.of(false)});return true;};var searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:true},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:true},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence,preventDefault:true}];var SearchPanel=/*#__PURE__*/function(){function SearchPanel(view){var _this217=this;_classCallCheck(this,SearchPanel);this.view=view;var query=this.query=view.state.field(searchState).query.spec;this.commit=this.commit.bind(this);this.searchField=crelt("input",{value:query.search,placeholder:phrase(view,"Find"),"aria-label":phrase(view,"Find"),"class":"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit});this.replaceField=crelt("input",{value:query.replace,placeholder:phrase(view,"Replace"),"aria-label":phrase(view,"Replace"),"class":"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit});this.caseField=crelt("input",{type:"checkbox",name:"case",checked:query.caseSensitive,onchange:this.commit});this.reField=crelt("input",{type:"checkbox",name:"re",checked:query.regexp,onchange:this.commit});function button(name2,onclick,content2){return crelt("button",{"class":"cm-button",name:name2,onclick:onclick,type:"button"},content2);}this.dom=crelt("div",{onkeydown:function onkeydown(e){return _this217.keydown(e);},"class":"cm-search"},[this.searchField,button("next",function(){return findNext(view);},[phrase(view,"next")]),button("prev",function(){return findPrevious(view);},[phrase(view,"previous")]),button("select",function(){return selectMatches(view);},[phrase(view,"all")]),crelt("label",null,[this.caseField,phrase(view,"match case")]),crelt("label",null,[this.reField,phrase(view,"regexp")])].concat(_toConsumableArray(view.state.readOnly?[]:[crelt("br"),this.replaceField,button("replace",function(){return replaceNext(view);},[phrase(view,"replace")]),button("replaceAll",function(){return replaceAll(view);},[phrase(view,"replace all")]),crelt("button",{name:"close",onclick:function onclick(){return closeSearchPanel(view);},"aria-label":phrase(view,"close"),type:"button"},["\xD7"])])));}_createClass(SearchPanel,[{key:"commit",value:function commit(){var query=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});if(!query.eq(this.query)){this.query=query;this.view.dispatch({effects:setSearchQuery.of(query)});}}},{key:"keydown",value:function keydown(e){if(runScopeHandlers(this.view,e,"search-panel")){e.preventDefault();}else if(e.keyCode==13&&e.target==this.searchField){e.preventDefault();(e.shiftKey?findPrevious:findNext)(this.view);}else if(e.keyCode==13&&e.target==this.replaceField){e.preventDefault();replaceNext(this.view);}}},{key:"update",value:function update(_update36){var _iterator368=_createForOfIteratorHelper(_update36.transactions),_step368;try{for(_iterator368.s();!(_step368=_iterator368.n()).done;){var tr=_step368.value;var _iterator369=_createForOfIteratorHelper(tr.effects),_step369;try{for(_iterator369.s();!(_step369=_iterator369.n()).done;){var effect=_step369.value;if(effect.is(setSearchQuery)&&!effect.value.eq(this.query))this.setQuery(effect.value);}}catch(err){_iterator369.e(err);}finally{_iterator369.f();}}}catch(err){_iterator368.e(err);}finally{_iterator368.f();}}},{key:"setQuery",value:function setQuery(query){this.query=query;this.searchField.value=query.search;this.replaceField.value=query.replace;this.caseField.checked=query.caseSensitive;this.reField.checked=query.regexp;}},{key:"mount",value:function mount(){this.searchField.select();}},{key:"pos",get:function get(){return 80;}},{key:"top",get:function get(){return this.view.state.facet(searchConfigFacet).top;}}]);return SearchPanel;}();function phrase(view,phrase2){return view.state.phrase(phrase2);}var AnnounceMargin=30;var Break=/[\s\.,:;?!]/;function announceMatch(view,_ref102){var from=_ref102.from,to=_ref102.to;var lineStart=view.state.doc.lineAt(from).from,lineEnd=view.state.doc.lineAt(to).to;var start=Math.max(lineStart,from-AnnounceMargin),end=Math.min(lineEnd,to+AnnounceMargin);var text=view.state.sliceDoc(start,end);if(start!=lineStart){for(var _i293=0;_i293<AnnounceMargin;_i293++){if(!Break.test(text[_i293+1])&&Break.test(text[_i293])){text=text.slice(_i293);break;}}}if(end!=lineEnd){for(var _i294=text.length-1;_i294>text.length-AnnounceMargin;_i294--){if(!Break.test(text[_i294-1])&&Break.test(text[_i294])){text=text.slice(0,_i294);break;}}}return EditorView5.announce.of("".concat(view.state.phrase("current match"),". ").concat(text," ").concat(view.state.phrase("on line")," ").concat(view.state.doc.lineAt(from).number));}var baseTheme10=/* @__PURE__ */EditorView5.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}});var searchExtensions=[searchState,/* @__PURE__ */Prec.lowest(searchHighlighter),baseTheme10];// ../node_modules/@codemirror/autocomplete/dist/index.js
var dist_exports2={};__export(dist_exports2,{CompletionContext:function CompletionContext(){return _CompletionContext;},acceptCompletion:function acceptCompletion(){return _acceptCompletion;},autocompletion:function autocompletion(){return _autocompletion;},clearSnippet:function clearSnippet(){return _clearSnippet;},closeCompletion:function closeCompletion(){return _closeCompletion;},completeAnyWord:function completeAnyWord(){return _completeAnyWord;},completeFromList:function completeFromList(){return _completeFromList;},completionKeymap:function completionKeymap(){return _completionKeymap;},completionStatus:function completionStatus(){return _completionStatus;},currentCompletions:function currentCompletions(){return _currentCompletions;},ifIn:function ifIn(){return _ifIn;},ifNotIn:function ifNotIn(){return _ifNotIn;},moveCompletionSelection:function moveCompletionSelection(){return _moveCompletionSelection;},nextSnippetField:function nextSnippetField(){return _nextSnippetField;},pickedCompletion:function pickedCompletion(){return _pickedCompletion;},prevSnippetField:function prevSnippetField(){return _prevSnippetField;},selectedCompletion:function selectedCompletion(){return _selectedCompletion;},snippet:function snippet(){return _snippet;},snippetCompletion:function snippetCompletion(){return _snippetCompletion;},snippetKeymap:function snippetKeymap(){return _snippetKeymap;},startCompletion:function startCompletion(){return _startCompletion;}});// ../node_modules/@codemirror/tooltip/dist/index.js
var dist_exports={};__export(dist_exports,{closeHoverTooltips:function closeHoverTooltips(){return _closeHoverTooltips;},getTooltip:function getTooltip(){return _getTooltip;},hasHoverTooltips:function hasHoverTooltips(){return _hasHoverTooltips;},hoverTooltip:function hoverTooltip(){return _hoverTooltip;},repositionTooltips:function repositionTooltips(){return _repositionTooltips;},showTooltip:function showTooltip(){return _showTooltip;},tooltips:function tooltips(){return _tooltips;}});var ios6=typeof navigator!="undefined"&&!/* @__PURE__ */ /Edge\/(\d+)/.exec(navigator.userAgent)&&/* @__PURE__ */ /Apple Computer/.test(navigator.vendor)&&(/* @__PURE__ */ /Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2);var Outside="-10000px";var TooltipViewManager=/*#__PURE__*/function(){function TooltipViewManager(view,facet,createTooltipView){_classCallCheck(this,TooltipViewManager);this.facet=facet;this.createTooltipView=createTooltipView;this.input=view.state.facet(facet);this.tooltips=this.input.filter(function(t2){return t2;});this.tooltipViews=this.tooltips.map(createTooltipView);}_createClass(TooltipViewManager,[{key:"update",value:function update(_update37){var input=_update37.state.facet(this.facet);var tooltips2=input.filter(function(x){return x;});if(input===this.input){var _iterator370=_createForOfIteratorHelper(this.tooltipViews),_step370;try{for(_iterator370.s();!(_step370=_iterator370.n()).done;){var t2=_step370.value;if(t2.update)t2.update(_update37);}}catch(err){_iterator370.e(err);}finally{_iterator370.f();}return false;}var tooltipViews=[];for(var _i295=0;_i295<tooltips2.length;_i295++){var tip=tooltips2[_i295],known=-1;if(!tip)continue;for(var i2=0;i2<this.tooltips.length;i2++){var other=this.tooltips[i2];if(other&&other.create==tip.create)known=i2;}if(known<0){tooltipViews[_i295]=this.createTooltipView(tip);}else{var tooltipView=tooltipViews[_i295]=this.tooltipViews[known];if(tooltipView.update)tooltipView.update(_update37);}}var _iterator371=_createForOfIteratorHelper(this.tooltipViews),_step371;try{for(_iterator371.s();!(_step371=_iterator371.n()).done;){var _t2=_step371.value;if(tooltipViews.indexOf(_t2)<0)_t2.dom.remove();}}catch(err){_iterator371.e(err);}finally{_iterator371.f();}this.input=input;this.tooltips=tooltips2;this.tooltipViews=tooltipViews;return true;}}]);return TooltipViewManager;}();function _tooltips(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return tooltipConfig.of(config2);}function windowSpace(){return{top:0,left:0,bottom:innerHeight,right:innerWidth};}var tooltipConfig=/* @__PURE__ */Facet.define({combine:function combine(values){var _a,_b,_c;return{position:ios6?"absolute":((_a=values.find(function(conf){return conf.position;}))===null||_a===void 0?void 0:_a.position)||"fixed",parent:((_b=values.find(function(conf){return conf.parent;}))===null||_b===void 0?void 0:_b.parent)||null,tooltipSpace:((_c=values.find(function(conf){return conf.tooltipSpace;}))===null||_c===void 0?void 0:_c.tooltipSpace)||windowSpace};}});var tooltipPlugin=/* @__PURE__ */ViewPlugin.fromClass(/*#__PURE__*/function(){function _class13(view){var _this218=this;_classCallCheck(this,_class13);var _a;this.view=view;this.inView=true;this.lastTransaction=0;this.measureTimeout=-1;var config2=view.state.facet(tooltipConfig);this.position=config2.position;this.parent=config2.parent;this.classes=view.themeClasses;this.createContainer();this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this};this.manager=new TooltipViewManager(view,_showTooltip,function(t2){return _this218.createTooltip(t2);});this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(function(entries){if(Date.now()>_this218.lastTransaction-50&&entries.length>0&&entries[entries.length-1].intersectionRatio<1)_this218.measureSoon();},{threshold:[1]}):null;this.observeIntersection();(_a=view.dom.ownerDocument.defaultView)===null||_a===void 0?void 0:_a.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this));this.maybeMeasure();}_createClass(_class13,[{key:"createContainer",value:function createContainer(){if(this.parent){this.container=document.createElement("div");this.container.style.position="relative";this.container.className=this.view.themeClasses;this.parent.appendChild(this.container);}else{this.container=this.view.dom;}}},{key:"observeIntersection",value:function observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();var _iterator372=_createForOfIteratorHelper(this.manager.tooltipViews),_step372;try{for(_iterator372.s();!(_step372=_iterator372.n()).done;){var tooltip=_step372.value;this.intersectionObserver.observe(tooltip.dom);}}catch(err){_iterator372.e(err);}finally{_iterator372.f();}}}},{key:"measureSoon",value:function measureSoon(){var _this219=this;if(this.measureTimeout<0)this.measureTimeout=setTimeout(function(){_this219.measureTimeout=-1;_this219.maybeMeasure();},50);}},{key:"update",value:function update(_update38){if(_update38.transactions.length)this.lastTransaction=Date.now();var updated=this.manager.update(_update38);if(updated)this.observeIntersection();var shouldMeasure=updated||_update38.geometryChanged;var newConfig=_update38.state.facet(tooltipConfig);if(newConfig.position!=this.position){this.position=newConfig.position;var _iterator373=_createForOfIteratorHelper(this.manager.tooltipViews),_step373;try{for(_iterator373.s();!(_step373=_iterator373.n()).done;){var t2=_step373.value;t2.dom.style.position=this.position;}}catch(err){_iterator373.e(err);}finally{_iterator373.f();}shouldMeasure=true;}if(newConfig.parent!=this.parent){if(this.parent)this.container.remove();this.parent=newConfig.parent;this.createContainer();var _iterator374=_createForOfIteratorHelper(this.manager.tooltipViews),_step374;try{for(_iterator374.s();!(_step374=_iterator374.n()).done;){var _t3=_step374.value;this.container.appendChild(_t3.dom);}}catch(err){_iterator374.e(err);}finally{_iterator374.f();}shouldMeasure=true;}else if(this.parent&&this.view.themeClasses!=this.classes){this.classes=this.container.className=this.view.themeClasses;}if(shouldMeasure)this.maybeMeasure();}},{key:"createTooltip",value:function createTooltip(tooltip){var tooltipView=tooltip.create(this.view);tooltipView.dom.classList.add("cm-tooltip");if(tooltip.arrow&&!tooltipView.dom.querySelector("cm-tooltip > cm-tooltip-arrow")){var arrow=document.createElement("div");arrow.className="cm-tooltip-arrow";tooltipView.dom.appendChild(arrow);}tooltipView.dom.style.position=this.position;tooltipView.dom.style.top=Outside;this.container.appendChild(tooltipView.dom);if(tooltipView.mount)tooltipView.mount(this.view);return tooltipView;}},{key:"destroy",value:function destroy(){var _a,_b;(_a=this.view.dom.ownerDocument.defaultView)===null||_a===void 0?void 0:_a.removeEventListener("resize",this.measureSoon);var _iterator375=_createForOfIteratorHelper(this.manager.tooltipViews),_step375;try{for(_iterator375.s();!(_step375=_iterator375.n()).done;){var dom=_step375.value.dom;dom.remove();}}catch(err){_iterator375.e(err);}finally{_iterator375.f();}(_b=this.intersectionObserver)===null||_b===void 0?void 0:_b.disconnect();clearTimeout(this.measureTimeout);}},{key:"readMeasure",value:function readMeasure(){var _this220=this;var editor=this.view.dom.getBoundingClientRect();return{editor:editor,parent:this.parent?this.container.getBoundingClientRect():editor,pos:this.manager.tooltips.map(function(t2){return _this220.view.coordsAtPos(t2.pos);}),size:this.manager.tooltipViews.map(function(_ref103){var dom=_ref103.dom;return dom.getBoundingClientRect();}),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view)};}},{key:"writeMeasure",value:function writeMeasure(measured){var editor=measured.editor,space=measured.space;var others=[];for(var _i296=0;_i296<this.manager.tooltips.length;_i296++){var tooltip=this.manager.tooltips[_i296],tView=this.manager.tooltipViews[_i296],dom=tView.dom;var pos=measured.pos[_i296],size=measured.size[_i296];if(!pos||pos.bottom<=Math.max(editor.top,space.top)||pos.top>=Math.min(editor.bottom,space.bottom)||pos.right<=Math.max(editor.left,space.left)||pos.left>=Math.min(editor.right,space.right)){dom.style.top=Outside;continue;}var arrow=tooltip.arrow?tView.dom.querySelector(".cm-tooltip-arrow"):null;var arrowHeight=arrow?7:0;var width=size.right-size.left,height=size.bottom-size.top;var offset=tView.offset||noOffset,ltr=this.view.textDirection==Direction.LTR;var left=size.width>space.right-space.left?ltr?space.left:space.right-size.width:ltr?Math.min(pos.left-(arrow?14:0)+offset.x,space.right-width):Math.max(space.left,pos.left-width+(arrow?14:0)-offset.x);var above=!!tooltip.above;if(!tooltip.strictSide&&(above?pos.top-(size.bottom-size.top)-offset.y<space.top:pos.bottom+(size.bottom-size.top)+offset.y>space.bottom)&&above==space.bottom-pos.bottom>pos.top-space.top)above=!above;var top2=above?pos.top-height-arrowHeight-offset.y:pos.bottom+arrowHeight+offset.y;var right=left+width;if(tView.overlap!==true){var _iterator376=_createForOfIteratorHelper(others),_step376;try{for(_iterator376.s();!(_step376=_iterator376.n()).done;){var _r20=_step376.value;if(_r20.left<right&&_r20.right>left&&_r20.top<top2+height&&_r20.bottom>top2)top2=above?_r20.top-height-2-arrowHeight:_r20.bottom+arrowHeight+2;}}catch(err){_iterator376.e(err);}finally{_iterator376.f();}}if(this.position=="absolute"){dom.style.top=top2-measured.parent.top+"px";dom.style.left=left-measured.parent.left+"px";}else{dom.style.top=top2+"px";dom.style.left=left+"px";}if(arrow)arrow.style.left="".concat(pos.left+(ltr?offset.x:-offset.x)-(left+14-7),"px");if(tView.overlap!==true)others.push({left:left,top:top2,right:right,bottom:top2+height});dom.classList.toggle("cm-tooltip-above",above);dom.classList.toggle("cm-tooltip-below",!above);if(tView.positioned)tView.positioned();}}},{key:"maybeMeasure",value:function maybeMeasure(){if(this.manager.tooltips.length){if(this.view.inView)this.view.requestMeasure(this.measureReq);if(this.inView!=this.view.inView){this.inView=this.view.inView;if(!this.inView){var _iterator377=_createForOfIteratorHelper(this.manager.tooltipViews),_step377;try{for(_iterator377.s();!(_step377=_iterator377.n()).done;){var tv=_step377.value;tv.dom.style.top=Outside;}}catch(err){_iterator377.e(err);}finally{_iterator377.f();}}}}}}]);return _class13;}(),{eventHandlers:{scroll:function scroll(){this.maybeMeasure();}}});var baseTheme11=/* @__PURE__ */EditorView.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"".concat(7,"px"),width:"".concat(7*2,"px"),position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"".concat(7,"px solid transparent"),borderRight:"".concat(7,"px solid transparent")},".cm-tooltip-above &":{bottom:"-".concat(7,"px"),"&:before":{borderTop:"".concat(7,"px solid #bbb")},"&:after":{borderTop:"".concat(7,"px solid #f5f5f5"),bottom:"1px"}},".cm-tooltip-below &":{top:"-".concat(7,"px"),"&:before":{borderBottom:"".concat(7,"px solid #bbb")},"&:after":{borderBottom:"".concat(7,"px solid #f5f5f5"),top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}});var noOffset={x:0,y:0};var _showTooltip=/* @__PURE__ */Facet.define({enables:[tooltipPlugin,baseTheme11]});var showHoverTooltip=/* @__PURE__ */Facet.define();var HoverTooltipHost=/*#__PURE__*/function(){function HoverTooltipHost(view){var _this221=this;_classCallCheck(this,HoverTooltipHost);this.view=view;this.mounted=false;this.dom=document.createElement("div");this.dom.classList.add("cm-tooltip-hover");this.manager=new TooltipViewManager(view,showHoverTooltip,function(t2){return _this221.createHostedView(t2);});}_createClass(HoverTooltipHost,[{key:"createHostedView",value:function createHostedView(tooltip){var hostedView=tooltip.create(this.view);hostedView.dom.classList.add("cm-tooltip-section");this.dom.appendChild(hostedView.dom);if(this.mounted&&hostedView.mount)hostedView.mount(this.view);return hostedView;}},{key:"mount",value:function mount(view){var _iterator378=_createForOfIteratorHelper(this.manager.tooltipViews),_step378;try{for(_iterator378.s();!(_step378=_iterator378.n()).done;){var hostedView=_step378.value;if(hostedView.mount)hostedView.mount(view);}}catch(err){_iterator378.e(err);}finally{_iterator378.f();}this.mounted=true;}},{key:"positioned",value:function positioned(){var _iterator379=_createForOfIteratorHelper(this.manager.tooltipViews),_step379;try{for(_iterator379.s();!(_step379=_iterator379.n()).done;){var hostedView=_step379.value;if(hostedView.positioned)hostedView.positioned();}}catch(err){_iterator379.e(err);}finally{_iterator379.f();}}},{key:"update",value:function update(_update39){this.manager.update(_update39);}}],[{key:"create",value:function create(view){return new HoverTooltipHost(view);}}]);return HoverTooltipHost;}();var showHoverTooltipHost=/* @__PURE__ */_showTooltip.compute([showHoverTooltip],function(state){var tooltips2=state.facet(showHoverTooltip).filter(function(t2){return t2;});if(tooltips2.length===0)return null;return{pos:Math.min.apply(Math,_toConsumableArray(tooltips2.map(function(t2){return t2.pos;}))),end:Math.max.apply(Math,_toConsumableArray(tooltips2.filter(function(t2){return t2.end!=null;}).map(function(t2){return t2.end;}))),create:HoverTooltipHost.create,above:tooltips2[0].above,arrow:tooltips2.some(function(t2){return t2.arrow;})};});var HoverPlugin=/*#__PURE__*/function(){function HoverPlugin(view,source,field,setHover,hoverTime){_classCallCheck(this,HoverPlugin);this.view=view;this.source=source;this.field=field;this.setHover=setHover;this.hoverTime=hoverTime;this.hoverTimeout=-1;this.restartTimeout=-1;this.pending=null;this.lastMove={x:0,y:0,target:view.dom,time:0};this.checkHover=this.checkHover.bind(this);view.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this));view.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this));}_createClass(HoverPlugin,[{key:"update",value:function update(){var _this222=this;if(this.pending){this.pending=null;clearTimeout(this.restartTimeout);this.restartTimeout=setTimeout(function(){return _this222.startHover();},20);}}},{key:"active",get:function get(){return this.view.state.field(this.field);}},{key:"checkHover",value:function checkHover(){this.hoverTimeout=-1;if(this.active)return;var hovered=Date.now()-this.lastMove.time;if(hovered<this.hoverTime)this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-hovered);else this.startHover();}},{key:"startHover",value:function startHover(){var _this223=this;var _a;clearTimeout(this.restartTimeout);var lastMove=this.lastMove;var pos=this.view.contentDOM.contains(lastMove.target)?this.view.posAtCoords(lastMove):null;if(pos==null)return;var posCoords=this.view.coordsAtPos(pos);if(posCoords==null||lastMove.y<posCoords.top||lastMove.y>posCoords.bottom||lastMove.x<posCoords.left-this.view.defaultCharacterWidth||lastMove.x>posCoords.right+this.view.defaultCharacterWidth)return;var bidi=this.view.bidiSpans(this.view.state.doc.lineAt(pos)).find(function(s){return s.from<=pos&&s.to>=pos;});var rtl=bidi&&bidi.dir==Direction.RTL?-1:1;var open=this.source(this.view,pos,lastMove.x<posCoords.left?-rtl:rtl);if((_a=open)===null||_a===void 0?void 0:_a.then){var pending=this.pending={pos:pos};open.then(function(result){if(_this223.pending==pending){_this223.pending=null;if(result)_this223.view.dispatch({effects:_this223.setHover.of(result)});}},function(e){return logException(_this223.view.state,e,"hover tooltip");});}else if(open){this.view.dispatch({effects:this.setHover.of(open)});}}},{key:"mousemove",value:function mousemove(event){var _a;this.lastMove={x:event.clientX,y:event.clientY,target:event.target,time:Date.now()};if(this.hoverTimeout<0)this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime);var tooltip=this.active;if(tooltip&&!isInTooltip(this.lastMove.target)||this.pending){var _ref104=tooltip||this.pending,pos=_ref104.pos,end=(_a=tooltip===null||tooltip===void 0?void 0:tooltip.end)!==null&&_a!==void 0?_a:pos;if(pos==end?this.view.posAtCoords(this.lastMove)!=pos:!isOverRange(this.view,pos,end,event.clientX,event.clientY,6)){this.view.dispatch({effects:this.setHover.of(null)});this.pending=null;}}}},{key:"mouseleave",value:function mouseleave(){clearTimeout(this.hoverTimeout);this.hoverTimeout=-1;if(this.active)this.view.dispatch({effects:this.setHover.of(null)});}},{key:"destroy",value:function destroy(){clearTimeout(this.hoverTimeout);this.view.dom.removeEventListener("mouseleave",this.mouseleave);this.view.dom.removeEventListener("mousemove",this.mousemove);}}]);return HoverPlugin;}();function isInTooltip(elt){for(var cur2=elt;cur2;cur2=cur2.parentNode){if(cur2.nodeType==1&&cur2.classList.contains("cm-tooltip"))return true;}return false;}function isOverRange(view,from,to,x,y,margin){var range=document.createRange();var fromDOM=view.domAtPos(from),toDOM=view.domAtPos(to);range.setEnd(toDOM.node,toDOM.offset);range.setStart(fromDOM.node,fromDOM.offset);var rects=range.getClientRects();range.detach();for(var _i297=0;_i297<rects.length;_i297++){var rect=rects[_i297];var dist=Math.max(rect.top-y,y-rect.bottom,rect.left-x,x-rect.right);if(dist<=margin)return true;}return false;}function _hoverTooltip(source){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var setHover=StateEffect.define();var hoverState=StateField.define({create:function create(){return null;},update:function update(value,tr){if(value&&options.hideOnChange&&(tr.docChanged||tr.selection))return null;var _iterator380=_createForOfIteratorHelper(tr.effects),_step380;try{for(_iterator380.s();!(_step380=_iterator380.n()).done;){var effect=_step380.value;if(effect.is(setHover))return effect.value;if(effect.is(closeHoverTooltipEffect))return null;}}catch(err){_iterator380.e(err);}finally{_iterator380.f();}if(value&&tr.docChanged){var newPos=tr.changes.mapPos(value.pos,-1,MapMode.TrackDel);if(newPos==null)return null;var copy=Object.assign(/* @__PURE__ */Object.create(null),value);copy.pos=newPos;if(value.end!=null)copy.end=tr.changes.mapPos(value.end);return copy;}return value;},provide:function provide(f){return showHoverTooltip.from(f);}});var hoverTime=options.hoverTime||600;return[hoverState,ViewPlugin.define(function(view){return new HoverPlugin(view,source,hoverState,setHover,hoverTime);}),showHoverTooltipHost];}function _getTooltip(view,tooltip){var plugin=view.plugin(tooltipPlugin);if(!plugin)return null;var found=plugin.manager.tooltips.indexOf(tooltip);return found<0?null:plugin.manager.tooltipViews[found];}function _hasHoverTooltips(state){return state.facet(showHoverTooltip).some(function(x){return x;});}var closeHoverTooltipEffect=/* @__PURE__ */StateEffect.define();var _closeHoverTooltips=/* @__PURE__ */closeHoverTooltipEffect.of(null);function _repositionTooltips(view){var _a;(_a=view.plugin(tooltipPlugin))===null||_a===void 0?void 0:_a.maybeMeasure();}// ../node_modules/@codemirror/autocomplete/dist/index.js
var _CompletionContext=/*#__PURE__*/function(){function _CompletionContext(state,pos,explicit){_classCallCheck(this,_CompletionContext);this.state=state;this.pos=pos;this.explicit=explicit;this.abortListeners=[];}_createClass(_CompletionContext,[{key:"tokenBefore",value:function tokenBefore(types6){var token=syntaxTree(this.state).resolveInner(this.pos,-1);while(token&&types6.indexOf(token.name)<0){token=token.parent;}return token?{from:token.from,to:this.pos,text:this.state.sliceDoc(token.from,this.pos),type:token.type}:null;}},{key:"matchBefore",value:function matchBefore(expr){var line=this.state.doc.lineAt(this.pos);var start=Math.max(line.from,this.pos-250);var str=line.text.slice(start-line.from,this.pos-line.from);var found=str.search(ensureAnchor(expr,false));return found<0?null:{from:start+found,to:this.pos,text:str.slice(found)};}},{key:"aborted",get:function get(){return this.abortListeners==null;}},{key:"addEventListener",value:function addEventListener(type,listener){if(type=="abort"&&this.abortListeners)this.abortListeners.push(listener);}}]);return _CompletionContext;}();function toSet(chars){var flat=Object.keys(chars).join("");var words=/\w/.test(flat);if(words)flat=flat.replace(/\w/g,"");return"[".concat(words?"\\w":"").concat(flat.replace(/[^\w\s]/g,"\\$&"),"]");}function prefixMatch(options){var first=/* @__PURE__ */Object.create(null),rest=/* @__PURE__ */Object.create(null);var _iterator381=_createForOfIteratorHelper(options),_step381;try{for(_iterator381.s();!(_step381=_iterator381.n()).done;){var label=_step381.value.label;first[label[0]]=true;for(var _i298=1;_i298<label.length;_i298++){rest[label[_i298]]=true;}}}catch(err){_iterator381.e(err);}finally{_iterator381.f();}var source=toSet(first)+toSet(rest)+"*$";return[new RegExp("^"+source),new RegExp(source)];}function _completeFromList(list){var options=list.map(function(o){return typeof o=="string"?{label:o}:o;});var _ref105=options.every(function(o){return /^\w+$/.test(o.label);})?[/\w*$/,/\w+$/]:prefixMatch(options),_ref106=_slicedToArray(_ref105,2),span=_ref106[0],match=_ref106[1];return function(context){var token=context.matchBefore(match);return token||context.explicit?{from:token?token.from:context.pos,options:options,span:span}:null;};}function _ifIn(nodes,source){return function(context){for(var pos=syntaxTree(context.state).resolveInner(context.pos,-1);pos;pos=pos.parent){if(nodes.indexOf(pos.name)>-1)return source(context);}return null;};}function _ifNotIn(nodes,source){return function(context){for(var pos=syntaxTree(context.state).resolveInner(context.pos,-1);pos;pos=pos.parent){if(nodes.indexOf(pos.name)>-1)return null;}return source(context);};}var Option=/*#__PURE__*/_createClass(function Option(completion,source,match){_classCallCheck(this,Option);this.completion=completion;this.source=source;this.match=match;});function cur(state){return state.selection.main.head;}function ensureAnchor(expr,start){var _a;var source=expr.source;var addStart=start&&source[0]!="^",addEnd=source[source.length-1]!="$";if(!addStart&&!addEnd)return expr;return new RegExp("".concat(addStart?"^":"","(?:").concat(source,")").concat(addEnd?"$":""),(_a=expr.flags)!==null&&_a!==void 0?_a:expr.ignoreCase?"i":"");}var _pickedCompletion=/* @__PURE__ */Annotation.define();function applyCompletion(view,option){var apply=option.completion.apply||option.completion.label;var result=option.source;if(typeof apply=="string"){view.dispatch({changes:{from:result.from,to:result.to,insert:apply},selection:{anchor:result.from+apply.length},userEvent:"input.complete",annotations:_pickedCompletion.of(option.completion)});}else{apply(view,option.completion,result.from,result.to);}}var SourceCache=/* @__PURE__ */new WeakMap();function asSource(source){if(!Array.isArray(source))return source;var known=SourceCache.get(source);if(!known)SourceCache.set(source,known=_completeFromList(source));return known;}var FuzzyMatcher=/*#__PURE__*/function(){function FuzzyMatcher(pattern){_classCallCheck(this,FuzzyMatcher);this.pattern=pattern;this.chars=[];this.folded=[];this.any=[];this.precise=[];this.byWord=[];for(var _p15=0;_p15<pattern.length;){var _char7=codePointAt(pattern,_p15),size=codePointSize(_char7);this.chars.push(_char7);var part=pattern.slice(_p15,_p15+size),upper=part.toUpperCase();this.folded.push(codePointAt(upper==part?part.toLowerCase():upper,0));_p15+=size;}this.astral=pattern.length!=this.chars.length;}_createClass(FuzzyMatcher,[{key:"match",value:function match(word){if(this.pattern.length==0)return[0];if(word.length<this.pattern.length)return null;var chars=this.chars,folded=this.folded,any=this.any,precise=this.precise,byWord=this.byWord;if(chars.length==1){var first=codePointAt(word,0);return first==chars[0]?[0,0,codePointSize(first)]:first==folded[0]?[-200,0,codePointSize(first)]:null;}var direct=word.indexOf(this.pattern);if(direct==0)return[0,0,this.pattern.length];var len=chars.length,anyTo=0;if(direct<0){for(var _i299=0,e=Math.min(word.length,200);_i299<e&&anyTo<len;){var next=codePointAt(word,_i299);if(next==chars[anyTo]||next==folded[anyTo])any[anyTo++]=_i299;_i299+=codePointSize(next);}if(anyTo<len)return null;}var preciseTo=0;var byWordTo=0,byWordFolded=false;var adjacentTo=0,adjacentStart=-1,adjacentEnd=-1;var hasLower=/[a-z]/.test(word),wordAdjacent=true;for(var _i300=0,_e2=Math.min(word.length,200),prevType=0;_i300<_e2&&byWordTo<len;){var _next7=codePointAt(word,_i300);if(direct<0){if(preciseTo<len&&_next7==chars[preciseTo])precise[preciseTo++]=_i300;if(adjacentTo<len){if(_next7==chars[adjacentTo]||_next7==folded[adjacentTo]){if(adjacentTo==0)adjacentStart=_i300;adjacentEnd=_i300+1;adjacentTo++;}else{adjacentTo=0;}}}var ch=void 0,type=_next7<255?_next7>=48&&_next7<=57||_next7>=97&&_next7<=122?2:_next7>=65&&_next7<=90?1:0:(ch=fromCodePoint(_next7))!=ch.toLowerCase()?1:ch!=ch.toUpperCase()?2:0;if(!_i300||type==1&&hasLower||prevType==0&&type!=0){if(chars[byWordTo]==_next7||folded[byWordTo]==_next7&&(byWordFolded=true))byWord[byWordTo++]=_i300;else if(byWord.length)wordAdjacent=false;}prevType=type;_i300+=codePointSize(_next7);}if(byWordTo==len&&byWord[0]==0&&wordAdjacent)return this.result(-100+(byWordFolded?-200:0),byWord,word);if(adjacentTo==len&&adjacentStart==0)return[-200-word.length,0,adjacentEnd];if(direct>-1)return[-700-word.length,direct,direct+this.pattern.length];if(adjacentTo==len)return[-200+-700-word.length,adjacentStart,adjacentEnd];if(byWordTo==len)return this.result(-100+(byWordFolded?-200:0)+-700+(wordAdjacent?0:-1100),byWord,word);return chars.length==2?null:this.result((any[0]?-700:0)+-200+-1100,any,word);}},{key:"result",value:function result(score2,positions,word){var result=[score2-word.length],i=1;var _iterator382=_createForOfIteratorHelper(positions),_step382;try{for(_iterator382.s();!(_step382=_iterator382.n()).done;){var pos=_step382.value;var to=pos+(this.astral?codePointSize(codePointAt(word,pos)):1);if(i>1&&result[i-1]==pos)result[i-1]=to;else{result[i++]=pos;result[i++]=to;}}}catch(err){_iterator382.e(err);}finally{_iterator382.f();}return result;}}]);return FuzzyMatcher;}();var completionConfig=/* @__PURE__ */Facet.define({combine:function combine(configs){return combineConfig(configs,{activateOnTyping:true,override:null,maxRenderedOptions:100,defaultKeymap:true,optionClass:function optionClass(){return"";},aboveCursor:false,icons:true,addToOptions:[]},{defaultKeymap:function defaultKeymap(a,b){return a&&b;},icons:function icons(a,b){return a&&b;},optionClass:function optionClass(a,b){return function(c){return joinClass(a(c),b(c));};},addToOptions:function addToOptions(a,b){return a.concat(b);}});}});function joinClass(a,b){return a?b?a+" "+b:a:b;}function optionContent(config2){var content2=config2.addToOptions.slice();if(config2.icons)content2.push({render:function render(completion){var _icon$classList;var icon=document.createElement("div");icon.classList.add("cm-completionIcon");if(completion.type)(_icon$classList=icon.classList).add.apply(_icon$classList,_toConsumableArray(completion.type.split(/\s+/g).map(function(cls){return"cm-completionIcon-"+cls;})));icon.setAttribute("aria-hidden","true");return icon;},position:20});content2.push({render:function render(completion,_s,match){var labelElt=document.createElement("span");labelElt.className="cm-completionLabel";var label=completion.label,off=0;for(var j=1;j<match.length;){var from=match[j++],to=match[j++];if(from>off)labelElt.appendChild(document.createTextNode(label.slice(off,from)));var span=labelElt.appendChild(document.createElement("span"));span.appendChild(document.createTextNode(label.slice(from,to)));span.className="cm-completionMatchedText";off=to;}if(off<label.length)labelElt.appendChild(document.createTextNode(label.slice(off)));return labelElt;},position:50},{render:function render(completion){if(!completion.detail)return null;var detailElt=document.createElement("span");detailElt.className="cm-completionDetail";detailElt.textContent=completion.detail;return detailElt;},position:80});return content2.sort(function(a,b){return a.position-b.position;}).map(function(a){return a.render;});}function createInfoDialog(option,view){var dom=document.createElement("div");dom.className="cm-tooltip cm-completionInfo";var info=option.completion.info;if(typeof info=="string"){dom.textContent=info;}else{var content2=info(option.completion);if(content2.then)content2.then(function(node){return dom.appendChild(node);},function(e){return logException(view.state,e,"completion info");});else dom.appendChild(content2);}return dom;}function rangeAroundSelected(total,selected,max){if(total<=max)return{from:0,to:total};if(selected<=total>>1){var off2=Math.floor(selected/max);return{from:off2*max,to:(off2+1)*max};}var off=Math.floor((total-selected)/max);return{from:total-(off+1)*max,to:total-off*max};}var CompletionTooltip=/*#__PURE__*/function(){function CompletionTooltip(view,stateField){var _this224=this;_classCallCheck(this,CompletionTooltip);this.view=view;this.stateField=stateField;this.info=null;this.placeInfo={read:function read(){return _this224.measureInfo();},write:function write(pos){return _this224.positionInfo(pos);},key:this};var cState=view.state.field(stateField);var _cState$open=cState.open,options=_cState$open.options,selected=_cState$open.selected;var config2=view.state.facet(completionConfig);this.optionContent=optionContent(config2);this.optionClass=config2.optionClass;this.range=rangeAroundSelected(options.length,selected,config2.maxRenderedOptions);this.dom=document.createElement("div");this.dom.className="cm-tooltip-autocomplete";this.dom.addEventListener("mousedown",function(e){for(var dom=e.target,match;dom&&dom!=_this224.dom;dom=dom.parentNode){if(dom.nodeName=="LI"&&(match=/-(\d+)$/.exec(dom.id))&&+match[1]<options.length){applyCompletion(view,options[+match[1]]);e.preventDefault();return;}}});this.list=this.dom.appendChild(this.createListBox(options,cState.id,this.range));this.list.addEventListener("scroll",function(){if(_this224.info)_this224.view.requestMeasure(_this224.placeInfo);});}_createClass(CompletionTooltip,[{key:"mount",value:function mount(){this.updateSel();}},{key:"update",value:function update(_update40){if(_update40.state.field(this.stateField)!=_update40.startState.field(this.stateField))this.updateSel();}},{key:"positioned",value:function positioned(){if(this.info)this.view.requestMeasure(this.placeInfo);}},{key:"updateSel",value:function updateSel(){var _this225=this;var cState=this.view.state.field(this.stateField),open=cState.open;if(open.selected<this.range.from||open.selected>=this.range.to){this.range=rangeAroundSelected(open.options.length,open.selected,this.view.state.facet(completionConfig).maxRenderedOptions);this.list.remove();this.list=this.dom.appendChild(this.createListBox(open.options,cState.id,this.range));this.list.addEventListener("scroll",function(){if(_this225.info)_this225.view.requestMeasure(_this225.placeInfo);});}if(this.updateSelectedOption(open.selected)){if(this.info){this.info.remove();this.info=null;}var option=open.options[open.selected];if(option.completion.info){this.info=this.dom.appendChild(createInfoDialog(option,this.view));this.view.requestMeasure(this.placeInfo);}}}},{key:"updateSelectedOption",value:function updateSelectedOption(selected){var set=null;for(var opt=this.list.firstChild,_i301=this.range.from;opt;opt=opt.nextSibling,_i301++){if(_i301==selected){if(!opt.hasAttribute("aria-selected")){opt.setAttribute("aria-selected","true");set=opt;}}else{if(opt.hasAttribute("aria-selected"))opt.removeAttribute("aria-selected");}}if(set)scrollIntoView5(this.list,set);return set;}},{key:"measureInfo",value:function measureInfo(){var sel=this.dom.querySelector("[aria-selected]");if(!sel||!this.info)return null;var listRect=this.dom.getBoundingClientRect();var infoRect=this.info.getBoundingClientRect();var selRect=sel.getBoundingClientRect();if(selRect.top>Math.min(innerHeight,listRect.bottom)-10||selRect.bottom<Math.max(0,listRect.top)+10)return null;var top2=Math.max(0,Math.min(selRect.top,innerHeight-infoRect.height))-listRect.top;var left=this.view.textDirection==Direction.RTL;var spaceLeft=listRect.left,spaceRight=innerWidth-listRect.right;if(left&&spaceLeft<Math.min(infoRect.width,spaceRight))left=false;else if(!left&&spaceRight<Math.min(infoRect.width,spaceLeft))left=true;return{top:top2,left:left};}},{key:"positionInfo",value:function positionInfo(pos){if(this.info){this.info.style.top=(pos?pos.top:-1e6)+"px";if(pos){this.info.classList.toggle("cm-completionInfo-left",pos.left);this.info.classList.toggle("cm-completionInfo-right",!pos.left);}}}},{key:"createListBox",value:function createListBox(options,id,range){var ul=document.createElement("ul");ul.id=id;ul.setAttribute("role","listbox");for(var _i302=range.from;_i302<range.to;_i302++){var _options$_i=options[_i302],completion=_options$_i.completion,match=_options$_i.match;var li=ul.appendChild(document.createElement("li"));li.id=id+"-"+_i302;li.setAttribute("role","option");var cls=this.optionClass(completion);if(cls)li.className=cls;var _iterator383=_createForOfIteratorHelper(this.optionContent),_step383;try{for(_iterator383.s();!(_step383=_iterator383.n()).done;){var source=_step383.value;var node=source(completion,this.view.state,match);if(node)li.appendChild(node);}}catch(err){_iterator383.e(err);}finally{_iterator383.f();}}if(range.from)ul.classList.add("cm-completionListIncompleteTop");if(range.to<options.length)ul.classList.add("cm-completionListIncompleteBottom");return ul;}}]);return CompletionTooltip;}();function completionTooltip(stateField){return function(view){return new CompletionTooltip(view,stateField);};}function scrollIntoView5(container,element){var parent=container.getBoundingClientRect();var self=element.getBoundingClientRect();if(self.top<parent.top)container.scrollTop-=parent.top-self.top;else if(self.bottom>parent.bottom)container.scrollTop+=self.bottom-parent.bottom;}var MaxOptions=300;function score(option){return(option.boost||0)*100+(option.apply?10:0)+(option.info?5:0)+(option.type?1:0);}function sortOptions(active,state){var options=[],i=0;var _iterator384=_createForOfIteratorHelper(active),_step384;try{for(_iterator384.s();!(_step384=_iterator384.n()).done;){var a=_step384.value;if(a.hasResult()){if(a.result.filter===false){var _iterator386=_createForOfIteratorHelper(a.result.options),_step386;try{for(_iterator386.s();!(_step386=_iterator386.n()).done;){var option=_step386.value;options.push(new Option(option,a,[1e9-i++]));}}catch(err){_iterator386.e(err);}finally{_iterator386.f();}}else{var matcher=new FuzzyMatcher(state.sliceDoc(a.from,a.to)),match=void 0;var _iterator387=_createForOfIteratorHelper(a.result.options),_step387;try{for(_iterator387.s();!(_step387=_iterator387.n()).done;){var _option=_step387.value;if(match=matcher.match(_option.label)){if(_option.boost!=null)match[0]+=_option.boost;options.push(new Option(_option,a,match));}}}catch(err){_iterator387.e(err);}finally{_iterator387.f();}}}}}catch(err){_iterator384.e(err);}finally{_iterator384.f();}options.sort(cmpOption);var result=[],prev=null;var _iterator385=_createForOfIteratorHelper(options.sort(cmpOption)),_step385;try{for(_iterator385.s();!(_step385=_iterator385.n()).done;){var opt=_step385.value;if(result.length==MaxOptions)break;if(!prev||prev.label!=opt.completion.label||prev.detail!=opt.completion.detail||prev.type!=opt.completion.type||prev.apply!=opt.completion.apply)result.push(opt);else if(score(opt.completion)>score(prev))result[result.length-1]=opt;prev=opt.completion;}}catch(err){_iterator385.e(err);}finally{_iterator385.f();}return result;}var CompletionDialog=/*#__PURE__*/function(){function CompletionDialog(options,attrs,tooltip,timestamp,selected){_classCallCheck(this,CompletionDialog);this.options=options;this.attrs=attrs;this.tooltip=tooltip;this.timestamp=timestamp;this.selected=selected;}_createClass(CompletionDialog,[{key:"setSelected",value:function setSelected(selected,id){return selected==this.selected||selected>=this.options.length?this:new CompletionDialog(this.options,makeAttrs(id,selected),this.tooltip,this.timestamp,selected);}},{key:"map",value:function map(changes){return new CompletionDialog(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:changes.mapPos(this.tooltip.pos)}),this.timestamp,this.selected);}}],[{key:"build",value:function build(active,state,id,prev,conf){var options=sortOptions(active,state);if(!options.length)return null;var selected=0;if(prev&&prev.selected){var selectedValue=prev.options[prev.selected].completion;for(var _i303=0;_i303<options.length&&!selected;_i303++){if(options[_i303].completion==selectedValue)selected=_i303;}}return new CompletionDialog(options,makeAttrs(id,selected),{pos:active.reduce(function(a,b){return b.hasResult()?Math.min(a,b.from):a;},1e8),create:completionTooltip(completionState),above:conf.aboveCursor},prev?prev.timestamp:Date.now(),selected);}}]);return CompletionDialog;}();var CompletionState=/*#__PURE__*/function(){function CompletionState(active,id,open){_classCallCheck(this,CompletionState);this.active=active;this.id=id;this.open=open;}_createClass(CompletionState,[{key:"update",value:function update(tr){var _this226=this;var state=tr.state,conf=state.facet(completionConfig);var sources=conf.override||state.languageDataAt("autocomplete",cur(state)).map(asSource);var active=sources.map(function(source){var value=_this226.active.find(function(s){return s.source==source;})||new ActiveSource(source,_this226.active.some(function(a){return a.state!=0;})?1:0);return value.update(tr,conf);});if(active.length==this.active.length&&active.every(function(a,i){return a==_this226.active[i];}))active=this.active;var open=tr.selection||active.some(function(a){return a.hasResult()&&tr.changes.touchesRange(a.from,a.to);})||!sameResults(active,this.active)?CompletionDialog.build(active,state,this.id,this.open,conf):this.open&&tr.docChanged?this.open.map(tr.changes):this.open;if(!open&&active.every(function(a){return a.state!=1;})&&active.some(function(a){return a.hasResult();}))active=active.map(function(a){return a.hasResult()?new ActiveSource(a.source,0):a;});var _iterator388=_createForOfIteratorHelper(tr.effects),_step388;try{for(_iterator388.s();!(_step388=_iterator388.n()).done;){var effect=_step388.value;if(effect.is(setSelectedEffect))open=open&&open.setSelected(effect.value,this.id);}}catch(err){_iterator388.e(err);}finally{_iterator388.f();}return active==this.active&&open==this.open?this:new CompletionState(active,this.id,open);}},{key:"tooltip",get:function get(){return this.open?this.open.tooltip:null;}},{key:"attrs",get:function get(){return this.open?this.open.attrs:baseAttrs;}}],[{key:"start",value:function start(){return new CompletionState(none8,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null);}}]);return CompletionState;}();function sameResults(a,b){if(a==b)return true;for(var iA=0,iB=0;;){while(iA<a.length&&!a[iA].hasResult){iA++;}while(iB<b.length&&!b[iB].hasResult){iB++;}var endA=iA==a.length,endB=iB==b.length;if(endA||endB)return endA==endB;if(a[iA++].result!=b[iB++].result)return false;}}var baseAttrs={"aria-autocomplete":"list","aria-expanded":"false"};function makeAttrs(id,selected){return{"aria-autocomplete":"list","aria-expanded":"true","aria-activedescendant":id+"-"+selected,"aria-controls":id};}var none8=[];function cmpOption(a,b){var dScore=b.match[0]-a.match[0];if(dScore)return dScore;return a.completion.label.localeCompare(b.completion.label);}function getUserEvent(tr){return tr.isUserEvent("input.type")?"input":tr.isUserEvent("delete.backward")?"delete":null;}var ActiveSource=/*#__PURE__*/function(){function ActiveSource(source,state){var explicitPos=arguments.length>2&&arguments[2]!==undefined?arguments[2]:-1;_classCallCheck(this,ActiveSource);this.source=source;this.state=state;this.explicitPos=explicitPos;}_createClass(ActiveSource,[{key:"hasResult",value:function hasResult(){return false;}},{key:"update",value:function update(tr,conf){var event=getUserEvent(tr),value=this;if(event)value=value.handleUserEvent(tr,event,conf);else if(tr.docChanged)value=value.handleChange(tr);else if(tr.selection&&value.state!=0)value=new ActiveSource(value.source,0);var _iterator389=_createForOfIteratorHelper(tr.effects),_step389;try{for(_iterator389.s();!(_step389=_iterator389.n()).done;){var effect=_step389.value;if(effect.is(startCompletionEffect))value=new ActiveSource(value.source,1,effect.value?cur(tr.state):-1);else if(effect.is(closeCompletionEffect))value=new ActiveSource(value.source,0);else if(effect.is(setActiveEffect)){var _iterator390=_createForOfIteratorHelper(effect.value),_step390;try{for(_iterator390.s();!(_step390=_iterator390.n()).done;){var active=_step390.value;if(active.source==value.source)value=active;}}catch(err){_iterator390.e(err);}finally{_iterator390.f();}}}}catch(err){_iterator389.e(err);}finally{_iterator389.f();}return value;}},{key:"handleUserEvent",value:function handleUserEvent(tr,type,conf){return type=="delete"||!conf.activateOnTyping?this.map(tr.changes):new ActiveSource(this.source,1);}},{key:"handleChange",value:function handleChange(tr){return tr.changes.touchesRange(cur(tr.startState))?new ActiveSource(this.source,0):this.map(tr.changes);}},{key:"map",value:function map(changes){return changes.empty||this.explicitPos<0?this:new ActiveSource(this.source,this.state,changes.mapPos(this.explicitPos));}}]);return ActiveSource;}();var ActiveResult=/*#__PURE__*/function(_ActiveSource){_inherits(ActiveResult,_ActiveSource);var _super117=_createSuper(ActiveResult);function ActiveResult(source,explicitPos,result,from,to,span){var _this227;_classCallCheck(this,ActiveResult);_this227=_super117.call(this,source,2,explicitPos);_this227.result=result;_this227.from=from;_this227.to=to;_this227.span=span;return _this227;}_createClass(ActiveResult,[{key:"hasResult",value:function hasResult(){return true;}},{key:"handleUserEvent",value:function handleUserEvent(tr,type,conf){var from=tr.changes.mapPos(this.from),to=tr.changes.mapPos(this.to,1);var pos=cur(tr.state);if((this.explicitPos>-1?pos<from:pos<=from)||pos>to)return new ActiveSource(this.source,type=="input"&&conf.activateOnTyping?1:0);var explicitPos=this.explicitPos<0?-1:tr.changes.mapPos(this.explicitPos);if(this.span&&(from==to||this.span.test(tr.state.sliceDoc(from,to))))return new ActiveResult(this.source,explicitPos,this.result,from,to,this.span);return new ActiveSource(this.source,1,explicitPos);}},{key:"handleChange",value:function handleChange(tr){return tr.changes.touchesRange(this.from,this.to)?new ActiveSource(this.source,0):this.map(tr.changes);}},{key:"map",value:function map(mapping){return mapping.empty?this:new ActiveResult(this.source,this.explicitPos<0?-1:mapping.mapPos(this.explicitPos),this.result,mapping.mapPos(this.from),mapping.mapPos(this.to,1),this.span);}}]);return ActiveResult;}(ActiveSource);var startCompletionEffect=/* @__PURE__ */StateEffect.define();var closeCompletionEffect=/* @__PURE__ */StateEffect.define();var setActiveEffect=/* @__PURE__ */StateEffect.define({map:function map(sources,mapping){return sources.map(function(s){return s.map(mapping);});}});var setSelectedEffect=/* @__PURE__ */StateEffect.define();var completionState=/* @__PURE__ */StateField.define({create:function create(){return CompletionState.start();},update:function update(value,tr){return value.update(tr);},provide:function provide(f){return[_showTooltip.from(f,function(val){return val.tooltip;}),EditorView.contentAttributes.from(f,function(state){return state.attrs;})];}});var CompletionInteractMargin=75;function _moveCompletionSelection(forward){var by=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"option";return function(view){var cState=view.state.field(completionState,false);if(!cState||!cState.open||Date.now()-cState.open.timestamp<CompletionInteractMargin)return false;var step=1,tooltip;if(by=="page"&&(tooltip=_getTooltip(view,cState.open.tooltip)))step=Math.max(2,Math.floor(tooltip.dom.offsetHeight/tooltip.dom.querySelector("li").offsetHeight)-1);var selected=cState.open.selected+step*(forward?1:-1),length=cState.open.options.length;if(selected<0)selected=by=="page"?0:length-1;else if(selected>=length)selected=by=="page"?length-1:0;view.dispatch({effects:setSelectedEffect.of(selected)});return true;};}var _acceptCompletion=function _acceptCompletion(view){var cState=view.state.field(completionState,false);if(view.state.readOnly||!cState||!cState.open||Date.now()-cState.open.timestamp<CompletionInteractMargin)return false;applyCompletion(view,cState.open.options[cState.open.selected]);return true;};var _startCompletion=function _startCompletion(view){var cState=view.state.field(completionState,false);if(!cState)return false;view.dispatch({effects:startCompletionEffect.of(true)});return true;};var _closeCompletion=function _closeCompletion(view){var cState=view.state.field(completionState,false);if(!cState||!cState.active.some(function(a){return a.state!=0;}))return false;view.dispatch({effects:closeCompletionEffect.of(null)});return true;};var RunningQuery=/*#__PURE__*/_createClass(function RunningQuery(active,context){_classCallCheck(this,RunningQuery);this.active=active;this.context=context;this.time=Date.now();this.updates=[];this.done=void 0;});var DebounceTime=50;var MaxUpdateCount=50;var MinAbortTime=1e3;var completionPlugin=/* @__PURE__ */ViewPlugin.fromClass(/*#__PURE__*/function(){function _class14(view){_classCallCheck(this,_class14);this.view=view;this.debounceUpdate=-1;this.running=[];this.debounceAccept=-1;this.composing=0;var _iterator391=_createForOfIteratorHelper(view.state.field(completionState).active),_step391;try{for(_iterator391.s();!(_step391=_iterator391.n()).done;){var active=_step391.value;if(active.state==1)this.startQuery(active);}}catch(err){_iterator391.e(err);}finally{_iterator391.f();}}_createClass(_class14,[{key:"update",value:function update(_update41){var _this228=this;var cState=_update41.state.field(completionState);if(!_update41.selectionSet&&!_update41.docChanged&&_update41.startState.field(completionState)==cState)return;var doesReset=_update41.transactions.some(function(tr){return(tr.selection||tr.docChanged)&&!getUserEvent(tr);});for(var _i304=0;_i304<this.running.length;_i304++){var query=this.running[_i304];if(doesReset||query.updates.length+_update41.transactions.length>MaxUpdateCount&&query.time-Date.now()>MinAbortTime){var _iterator392=_createForOfIteratorHelper(query.context.abortListeners),_step392;try{for(_iterator392.s();!(_step392=_iterator392.n()).done;){var handler=_step392.value;try{handler();}catch(e){logException(this.view.state,e);}}}catch(err){_iterator392.e(err);}finally{_iterator392.f();}query.context.abortListeners=null;this.running.splice(_i304--,1);}else{var _query$updates;(_query$updates=query.updates).push.apply(_query$updates,_toConsumableArray(_update41.transactions));}}if(this.debounceUpdate>-1)clearTimeout(this.debounceUpdate);this.debounceUpdate=cState.active.some(function(a){return a.state==1&&!_this228.running.some(function(q){return q.active.source==a.source;});})?setTimeout(function(){return _this228.startUpdate();},DebounceTime):-1;if(this.composing!=0){var _iterator393=_createForOfIteratorHelper(_update41.transactions),_step393;try{for(_iterator393.s();!(_step393=_iterator393.n()).done;){var tr=_step393.value;if(getUserEvent(tr)=="input")this.composing=2;else if(this.composing==2&&tr.selection)this.composing=3;}}catch(err){_iterator393.e(err);}finally{_iterator393.f();}}}},{key:"startUpdate",value:function startUpdate(){var _this229=this;this.debounceUpdate=-1;var state=this.view.state,cState=state.field(completionState);var _iterator394=_createForOfIteratorHelper(cState.active),_step394;try{var _loop42=function _loop42(){var active=_step394.value;if(active.state==1&&!_this229.running.some(function(r){return r.active.source==active.source;}))_this229.startQuery(active);};for(_iterator394.s();!(_step394=_iterator394.n()).done;){_loop42();}}catch(err){_iterator394.e(err);}finally{_iterator394.f();}}},{key:"startQuery",value:function startQuery(active){var _this230=this;var state=this.view.state,pos=cur(state);var context=new _CompletionContext(state,pos,active.explicitPos==pos);var pending=new RunningQuery(active,context);this.running.push(pending);Promise.resolve(active.source(context)).then(function(result){if(!pending.context.aborted){pending.done=result||null;_this230.scheduleAccept();}},function(err){_this230.view.dispatch({effects:closeCompletionEffect.of(null)});logException(_this230.view.state,err);});}},{key:"scheduleAccept",value:function scheduleAccept(){var _this231=this;if(this.running.every(function(q){return q.done!==void 0;}))this.accept();else if(this.debounceAccept<0)this.debounceAccept=setTimeout(function(){return _this231.accept();},DebounceTime);}},{key:"accept",value:function accept(){var _this232=this;var _a;if(this.debounceAccept>-1)clearTimeout(this.debounceAccept);this.debounceAccept=-1;var updated=[];var conf=this.view.state.facet(completionConfig);var _loop43=function _loop43(_i306){var query=_this232.running[_i306];if(query.done===void 0){_i305=_i306;return"continue";}_this232.running.splice(_i306--,1);if(query.done){var active=new ActiveResult(query.active.source,query.active.explicitPos,query.done,query.done.from,(_a=query.done.to)!==null&&_a!==void 0?_a:cur(query.updates.length?query.updates[0].startState:_this232.view.state),query.done.span&&query.done.filter!==false?ensureAnchor(query.done.span,true):null);var _iterator395=_createForOfIteratorHelper(query.updates),_step395;try{for(_iterator395.s();!(_step395=_iterator395.n()).done;){var tr=_step395.value;active=active.update(tr,conf);}}catch(err){_iterator395.e(err);}finally{_iterator395.f();}if(active.hasResult()){updated.push(active);_i305=_i306;return"continue";}}var current=_this232.view.state.field(completionState).active.find(function(a){return a.source==query.active.source;});if(current&&current.state==1){if(query.done==null){var _active=new ActiveSource(query.active.source,0);var _iterator396=_createForOfIteratorHelper(query.updates),_step396;try{for(_iterator396.s();!(_step396=_iterator396.n()).done;){var _tr6=_step396.value;_active=_active.update(_tr6,conf);}}catch(err){_iterator396.e(err);}finally{_iterator396.f();}if(_active.state!=1)updated.push(_active);}else{_this232.startQuery(current);}}_i305=_i306;};for(var _i305=0;_i305<this.running.length;_i305++){var _ret7=_loop43(_i305);if(_ret7==="continue")continue;}if(updated.length)this.view.dispatch({effects:setActiveEffect.of(updated)});}}]);return _class14;}(),{eventHandlers:{compositionstart:function compositionstart(){this.composing=1;},compositionend:function compositionend(){var _this233=this;if(this.composing==3){setTimeout(function(){return _this233.view.dispatch({effects:startCompletionEffect.of(false)});},20);}this.composing=0;}}});var baseTheme12=/* @__PURE__ */EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"\xB7\xB7\xB7"',opacity:0.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'\u0192'"}},".cm-completionIcon-class":{"&:after":{content:"'\u25CB'"}},".cm-completionIcon-interface":{"&:after":{content:"'\u25CC'"}},".cm-completionIcon-variable":{"&:after":{content:"'\uD835\uDC65'"}},".cm-completionIcon-constant":{"&:after":{content:"'\uD835\uDC36'"}},".cm-completionIcon-type":{"&:after":{content:"'\uD835\uDC61'"}},".cm-completionIcon-enum":{"&:after":{content:"'\u222A'"}},".cm-completionIcon-property":{"&:after":{content:"'\u25A1'"}},".cm-completionIcon-keyword":{"&:after":{content:"'\uD83D\uDD11\uFE0E'"}},".cm-completionIcon-namespace":{"&:after":{content:"'\u25A2'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});var FieldPos=/*#__PURE__*/_createClass(function FieldPos(field,line,from,to){_classCallCheck(this,FieldPos);this.field=field;this.line=line;this.from=from;this.to=to;});var FieldRange=/*#__PURE__*/function(){function FieldRange(field,from,to){_classCallCheck(this,FieldRange);this.field=field;this.from=from;this.to=to;}_createClass(FieldRange,[{key:"map",value:function map(changes){return new FieldRange(this.field,changes.mapPos(this.from,-1),changes.mapPos(this.to,1));}}]);return FieldRange;}();var Snippet=/*#__PURE__*/function(){function Snippet(lines,fieldPositions){_classCallCheck(this,Snippet);this.lines=lines;this.fieldPositions=fieldPositions;}_createClass(Snippet,[{key:"instantiate",value:function instantiate(state,pos){var text=[],lineStart=[pos];var lineObj=state.doc.lineAt(pos),baseIndent=/^\s*/.exec(lineObj.text)[0];var _iterator397=_createForOfIteratorHelper(this.lines),_step397;try{for(_iterator397.s();!(_step397=_iterator397.n()).done;){var line=_step397.value;if(text.length){var indent=baseIndent,tabs=/^\t*/.exec(line)[0].length;for(var _i307=0;_i307<tabs;_i307++){indent+=state.facet(indentUnit);}lineStart.push(pos+indent.length-tabs);line=indent+line.slice(tabs);}text.push(line);pos+=line.length+1;}}catch(err){_iterator397.e(err);}finally{_iterator397.f();}var ranges=this.fieldPositions.map(function(pos2){return new FieldRange(pos2.field,lineStart[pos2.line]+pos2.from,lineStart[pos2.line]+pos2.to);});return{text:text,ranges:ranges};}}],[{key:"parse",value:function parse(template){var fields=[];var lines=[],positions=[],m;var _iterator398=_createForOfIteratorHelper(template.split(/\r\n?|\n/)),_step398;try{for(_iterator398.s();!(_step398=_iterator398.n()).done;){var line=_step398.value;while(m=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(line)){var seq=m[1]?+m[1]:null,name2=m[2]||m[3]||"",found=-1;for(var _i308=0;_i308<fields.length;_i308++){if(seq!=null?fields[_i308].seq==seq:name2?fields[_i308].name==name2:false)found=_i308;}if(found<0){var _i309=0;while(_i309<fields.length&&(seq==null||fields[_i309].seq!=null&&fields[_i309].seq<seq)){_i309++;}fields.splice(_i309,0,{seq:seq,name:name2});found=_i309;var _iterator399=_createForOfIteratorHelper(positions),_step399;try{for(_iterator399.s();!(_step399=_iterator399.n()).done;){var pos=_step399.value;if(pos.field>=found)pos.field++;}}catch(err){_iterator399.e(err);}finally{_iterator399.f();}}positions.push(new FieldPos(found,lines.length,m.index,m.index+name2.length));line=line.slice(0,m.index)+name2+line.slice(m.index+m[0].length);}lines.push(line);}}catch(err){_iterator398.e(err);}finally{_iterator398.f();}return new Snippet(lines,positions);}}]);return Snippet;}();var fieldMarker=/* @__PURE__ */Decoration.widget({widget:/* @__PURE__ */new(/*#__PURE__*/function(_WidgetType24){_inherits(_class15,_WidgetType24);var _super118=_createSuper(_class15);function _class15(){_classCallCheck(this,_class15);return _super118.apply(this,arguments);}_createClass(_class15,[{key:"toDOM",value:function toDOM(){var span=document.createElement("span");span.className="cm-snippetFieldPosition";return span;}},{key:"ignoreEvent",value:function ignoreEvent(){return false;}}]);return _class15;}(WidgetType))()});var fieldRange=/* @__PURE__ */Decoration.mark({"class":"cm-snippetField"});var ActiveSnippet=/*#__PURE__*/function(){function ActiveSnippet(ranges,active){_classCallCheck(this,ActiveSnippet);this.ranges=ranges;this.active=active;this.deco=Decoration.set(ranges.map(function(r){return(r.from==r.to?fieldMarker:fieldRange).range(r.from,r.to);}));}_createClass(ActiveSnippet,[{key:"map",value:function map(changes){return new ActiveSnippet(this.ranges.map(function(r){return r.map(changes);}),this.active);}},{key:"selectionInsideField",value:function selectionInsideField(sel){var _this234=this;return sel.ranges.every(function(range){return _this234.ranges.some(function(r){return r.field==_this234.active&&r.from<=range.from&&r.to>=range.to;});});}}]);return ActiveSnippet;}();var setActive=/* @__PURE__ */StateEffect.define({map:function map(value,changes){return value&&value.map(changes);}});var moveToField=/* @__PURE__ */StateEffect.define();var snippetState=/* @__PURE__ */StateField.define({create:function create(){return null;},update:function update(value,tr){var _iterator400=_createForOfIteratorHelper(tr.effects),_step400;try{for(_iterator400.s();!(_step400=_iterator400.n()).done;){var effect=_step400.value;if(effect.is(setActive))return effect.value;if(effect.is(moveToField)&&value)return new ActiveSnippet(value.ranges,effect.value);}}catch(err){_iterator400.e(err);}finally{_iterator400.f();}if(value&&tr.docChanged)value=value.map(tr.changes);if(value&&tr.selection&&!value.selectionInsideField(tr.selection))value=null;return value;},provide:function provide(f){return EditorView.decorations.from(f,function(val){return val?val.deco:Decoration.none;});}});function fieldSelection(ranges,field){return EditorSelection.create(ranges.filter(function(r){return r.field==field;}).map(function(r){return EditorSelection.range(r.from,r.to);}));}function _snippet(template){var snippet2=Snippet.parse(template);return function(editor,_completion,from,to){var _snippet2$instantiate=snippet2.instantiate(editor.state,from),text=_snippet2$instantiate.text,ranges=_snippet2$instantiate.ranges;var spec={changes:{from:from,to:to,insert:Text.of(text)}};if(ranges.length)spec.selection=fieldSelection(ranges,0);if(ranges.length>1){var active=new ActiveSnippet(ranges,0);var effects=spec.effects=[setActive.of(active)];if(editor.state.field(snippetState,false)===void 0)effects.push(StateEffect.appendConfig.of([snippetState,addSnippetKeymap,snippetPointerHandler,baseTheme12]));}editor.dispatch(editor.state.update(spec));};}function moveField(dir){return function(_ref107){var state=_ref107.state,dispatch=_ref107.dispatch;var active=state.field(snippetState,false);if(!active||dir<0&&active.active==0)return false;var next=active.active+dir,last=dir>0&&!active.ranges.some(function(r){return r.field==next+dir;});dispatch(state.update({selection:fieldSelection(active.ranges,next),effects:setActive.of(last?null:new ActiveSnippet(active.ranges,next))}));return true;};}var _clearSnippet=function _clearSnippet(_ref108){var state=_ref108.state,dispatch=_ref108.dispatch;var active=state.field(snippetState,false);if(!active)return false;dispatch(state.update({effects:setActive.of(null)}));return true;};var _nextSnippetField=/* @__PURE__ */moveField(1);var _prevSnippetField=/* @__PURE__ */moveField(-1);var defaultSnippetKeymap=[{key:"Tab",run:_nextSnippetField,shift:_prevSnippetField},{key:"Escape",run:_clearSnippet}];var _snippetKeymap=/* @__PURE__ */Facet.define({combine:function combine(maps){return maps.length?maps[0]:defaultSnippetKeymap;}});var addSnippetKeymap=/* @__PURE__ */Prec.highest(/* @__PURE__ */keymap.compute([_snippetKeymap],function(state){return state.facet(_snippetKeymap);}));function _snippetCompletion(template,completion){return Object.assign(Object.assign({},completion),{apply:_snippet(template)});}var snippetPointerHandler=/* @__PURE__ */EditorView.domEventHandlers({mousedown:function mousedown(event,view){var active=view.state.field(snippetState,false),pos;if(!active||(pos=view.posAtCoords({x:event.clientX,y:event.clientY}))==null)return false;var match=active.ranges.find(function(r){return r.from<=pos&&r.to>=pos;});if(!match||match.field==active.active)return false;view.dispatch({selection:fieldSelection(active.ranges,match.field),effects:setActive.of(active.ranges.some(function(r){return r.field>match.field;})?new ActiveSnippet(active.ranges,match.field):null)});return true;}});function wordRE(wordChars){var escaped=wordChars.replace(/[\\[.+*?(){|^$]/g,"\\$&");try{return new RegExp("[\\p{Alphabetic}\\p{Number}_".concat(escaped,"]+"),"ug");}catch(_a){return new RegExp("[w".concat(escaped,"]"),"g");}}function mapRE(re,f){return new RegExp(f(re.source),re.unicode?"u":"");}var wordCaches=/* @__PURE__ */Object.create(null);function wordCache(wordChars){return wordCaches[wordChars]||(wordCaches[wordChars]=/* @__PURE__ */new WeakMap());}function storeWords(doc6,wordRE2,result,seen,ignoreAt){for(var lines=doc6.iterLines(),pos=0;!lines.next().done;){var value=lines.value,m=void 0;wordRE2.lastIndex=0;while(m=wordRE2.exec(value)){if(!seen[m[0]]&&pos+m.index!=ignoreAt){result.push({type:"text",label:m[0]});seen[m[0]]=true;if(result.length>=2e3)return;}}pos+=value.length+1;}}function collectWords(doc6,cache,wordRE2,to,ignoreAt){var big=doc6.length>=1e3;var cached=big&&cache.get(doc6);if(cached)return cached;var result=[],seen=/* @__PURE__ */Object.create(null);if(doc6.children){var pos=0;var _iterator401=_createForOfIteratorHelper(doc6.children),_step401;try{for(_iterator401.s();!(_step401=_iterator401.n()).done;){var ch=_step401.value;if(ch.length>=1e3){var _iterator402=_createForOfIteratorHelper(collectWords(ch,cache,wordRE2,to-pos,ignoreAt-pos)),_step402;try{for(_iterator402.s();!(_step402=_iterator402.n()).done;){var c=_step402.value;if(!seen[c.label]){seen[c.label]=true;result.push(c);}}}catch(err){_iterator402.e(err);}finally{_iterator402.f();}}else{storeWords(ch,wordRE2,result,seen,ignoreAt-pos);}pos+=ch.length+1;}}catch(err){_iterator401.e(err);}finally{_iterator401.f();}}else{storeWords(doc6,wordRE2,result,seen,ignoreAt);}if(big&&result.length<2e3)cache.set(doc6,result);return result;}var _completeAnyWord=function _completeAnyWord(context){var wordChars=context.state.languageDataAt("wordChars",context.pos).join("");var re=wordRE(wordChars);var token=context.matchBefore(mapRE(re,function(s){return s+"$";}));if(!token&&!context.explicit)return null;var from=token?token.from:context.pos;var options=collectWords(context.state.doc,wordCache(wordChars),re,5e4,from);return{from:from,options:options,span:mapRE(re,function(s){return"^"+s;})};};function _autocompletion(){var config2=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return[completionState,completionConfig.of(config2),completionPlugin,completionKeymapExt,baseTheme12];}var _completionKeymap=[{key:"Ctrl-Space",run:_startCompletion},{key:"Escape",run:_closeCompletion},{key:"ArrowDown",run:/* @__PURE__ */_moveCompletionSelection(true)},{key:"ArrowUp",run:/* @__PURE__ */_moveCompletionSelection(false)},{key:"PageDown",run:/* @__PURE__ */_moveCompletionSelection(true,"page")},{key:"PageUp",run:/* @__PURE__ */_moveCompletionSelection(false,"page")},{key:"Enter",run:_acceptCompletion}];var completionKeymapExt=/* @__PURE__ */Prec.highest(/* @__PURE__ */keymap.computeN([completionConfig],function(state){return state.facet(completionConfig).defaultKeymap?[_completionKeymap]:[];}));function _completionStatus(state){var cState=state.field(completionState,false);return cState&&cState.active.some(function(a){return a.state==1;})?"pending":cState&&cState.active.some(function(a){return a.state!=0;})?"active":null;}function _currentCompletions(state){var _a;var open=(_a=state.field(completionState,false))===null||_a===void 0?void 0:_a.open;return open?open.options.map(function(o){return o.completion;}):[];}function _selectedCompletion(state){var _a;var open=(_a=state.field(completionState,false))===null||_a===void 0?void 0:_a.open;return open?open.options[open.selected].completion:null;}// ../node_modules/@codemirror/comment/dist/index.js
var toggleComment=function toggleComment(target){var config2=getConfig(target.state);return config2.line?toggleLineComment(target):config2.block?toggleBlockComment(target):false;};function command(f,option){return function(_ref109){var state=_ref109.state,dispatch=_ref109.dispatch;var tr=f(option,state.selection.ranges,state);if(!tr)return false;dispatch(state.update(tr));return true;};}var toggleLineComment=/* @__PURE__ */command(changeLineComment,0);var toggleBlockComment=/* @__PURE__ */command(changeBlockComment,0);var commentKeymap=[{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment}];function getConfig(state){var pos=arguments.length>1&&arguments[1]!==undefined?arguments[1]:state.selection.main.head;var data=state.languageDataAt("commentTokens",pos);return data.length?data[0]:{};}var SearchMargin=50;function findBlockComment(state,_ref110,from,to){var open=_ref110.open,close=_ref110.close;var textBefore=state.sliceDoc(from-SearchMargin,from);var textAfter=state.sliceDoc(to,to+SearchMargin);var spaceBefore=/\s*$/.exec(textBefore)[0].length,spaceAfter=/^\s*/.exec(textAfter)[0].length;var beforeOff=textBefore.length-spaceBefore;if(textBefore.slice(beforeOff-open.length,beforeOff)==open&&textAfter.slice(spaceAfter,spaceAfter+close.length)==close){return{open:{pos:from-spaceBefore,margin:spaceBefore&&1},close:{pos:to+spaceAfter,margin:spaceAfter&&1}};}var startText,endText;if(to-from<=2*SearchMargin){startText=endText=state.sliceDoc(from,to);}else{startText=state.sliceDoc(from,from+SearchMargin);endText=state.sliceDoc(to-SearchMargin,to);}var startSpace=/^\s*/.exec(startText)[0].length,endSpace=/\s*$/.exec(endText)[0].length;var endOff=endText.length-endSpace-close.length;if(startText.slice(startSpace,startSpace+open.length)==open&&endText.slice(endOff,endOff+close.length)==close){return{open:{pos:from+startSpace+open.length,margin:/\s/.test(startText.charAt(startSpace+open.length))?1:0},close:{pos:to-endSpace-close.length,margin:/\s/.test(endText.charAt(endOff-1))?1:0}};}return null;}function changeBlockComment(option,ranges,state){var tokens=ranges.map(function(r){return getConfig(state,r.from).block;});if(!tokens.every(function(c){return c;}))return null;var comments=ranges.map(function(r,i){return findBlockComment(state,tokens[i],r.from,r.to);});if(option!=2&&!comments.every(function(c){return c;})){var index=0;return state.changeByRange(function(range){var _tokens$index=tokens[index++],open=_tokens$index.open,close=_tokens$index.close;if(comments[index])return{range:range};var shift2=open.length+1;return{changes:[{from:range.from,insert:open+" "},{from:range.to,insert:" "+close}],range:EditorSelection.range(range.anchor+shift2,range.head+shift2)};});}else if(option!=1&&comments.some(function(c){return c;})){var changes=[];for(var _i310=0,comment2;_i310<comments.length;_i310++){if(comment2=comments[_i310]){var token=tokens[_i310],_comment=comment2,open=_comment.open,close=_comment.close;changes.push({from:open.pos-token.open.length,to:open.pos+open.margin},{from:close.pos-close.margin,to:close.pos+token.close.length});}}return{changes:changes};}return null;}function changeLineComment(option,ranges,state){var lines=[];var prevLine=-1;var _iterator403=_createForOfIteratorHelper(ranges),_step403;try{for(_iterator403.s();!(_step403=_iterator403.n()).done;){var _step403$value=_step403.value,_from2=_step403$value.from,_to2=_step403$value.to;var startI=lines.length,minIndent=1e9;for(var pos=_from2;pos<=_to2;){var _line3=state.doc.lineAt(pos);if(_line3.from>prevLine&&(_from2==_to2||_to2>_line3.from)){prevLine=_line3.from;var _token2=getConfig(state,pos).line;if(!_token2)continue;var _indent=/^\s*/.exec(_line3.text)[0].length;var _empty=_indent==_line3.length;var _comment2=_line3.text.slice(_indent,_indent+_token2.length)==_token2?_indent:-1;if(_indent<_line3.text.length&&_indent<minIndent)minIndent=_indent;lines.push({line:_line3,comment:_comment2,token:_token2,indent:_indent,empty:_empty,single:false});}pos=_line3.to+1;}if(minIndent<1e9){for(var _i311=startI;_i311<lines.length;_i311++){if(lines[_i311].indent<lines[_i311].line.text.length)lines[_i311].indent=minIndent;}}if(lines.length==startI+1)lines[startI].single=true;}}catch(err){_iterator403.e(err);}finally{_iterator403.f();}if(option!=2&&lines.some(function(l){return l.comment<0&&(!l.empty||l.single);})){var changes=[];var _iterator404=_createForOfIteratorHelper(lines),_step404;try{for(_iterator404.s();!(_step404=_iterator404.n()).done;){var _step404$value=_step404.value,line=_step404$value.line,token=_step404$value.token,indent=_step404$value.indent,empty2=_step404$value.empty,single=_step404$value.single;if(single||!empty2)changes.push({from:line.from+indent,insert:token+" "});}}catch(err){_iterator404.e(err);}finally{_iterator404.f();}var changeSet=state.changes(changes);return{changes:changeSet,selection:state.selection.map(changeSet,1)};}else if(option!=1&&lines.some(function(l){return l.comment>=0;})){var _changes2=[];var _iterator405=_createForOfIteratorHelper(lines),_step405;try{for(_iterator405.s();!(_step405=_iterator405.n()).done;){var _step405$value=_step405.value,_line2=_step405$value.line,comment2=_step405$value.comment,_token=_step405$value.token;if(comment2>=0){var from=_line2.from+comment2,to=from+_token.length;if(_line2.text[to-_line2.from]==" ")to++;_changes2.push({from:from,to:to});}}}catch(err){_iterator405.e(err);}finally{_iterator405.f();}return{changes:_changes2};}return null;}// ../node_modules/@codemirror/rectangular-selection/dist/index.js
var MaxOff=2e3;function rectangleFor(state,a,b){var startLine=Math.min(a.line,b.line),endLine=Math.max(a.line,b.line);var ranges=[];if(a.off>MaxOff||b.off>MaxOff||a.col<0||b.col<0){var startOff=Math.min(a.off,b.off),endOff=Math.max(a.off,b.off);for(var _i312=startLine;_i312<=endLine;_i312++){var line=state.doc.line(_i312);if(line.length<=endOff)ranges.push(EditorSelection.range(line.from+startOff,line.to+endOff));}}else{var startCol=Math.min(a.col,b.col),endCol=Math.max(a.col,b.col);for(var _i313=startLine;_i313<=endLine;_i313++){var _line4=state.doc.line(_i313);var start=findColumn(_line4.text,startCol,state.tabSize,true);if(start>-1){var end=findColumn(_line4.text,endCol,state.tabSize);ranges.push(EditorSelection.range(_line4.from+start,_line4.from+end));}}}return ranges;}function absoluteColumn(view,x){var ref=view.coordsAtPos(view.viewport.from);return ref?Math.round(Math.abs((ref.left-x)/view.defaultCharacterWidth)):-1;}function getPos(view,event){var offset=view.posAtCoords({x:event.clientX,y:event.clientY},false);var line=view.state.doc.lineAt(offset),off=offset-line.from;var col=off>MaxOff?-1:off==line.length?absoluteColumn(view,event.clientX):_countColumn(line.text,view.state.tabSize,offset-line.from);return{line:line.number,col:col,off:off};}function rectangleSelectionStyle(view,event){var start=getPos(view,event),startSel=view.state.selection;if(!start)return null;return{update:function update(_update42){if(_update42.docChanged){var newStart=_update42.changes.mapPos(_update42.startState.doc.line(start.line).from);var newLine=_update42.state.doc.lineAt(newStart);start={line:newLine.number,col:start.col,off:Math.min(start.off,newLine.length)};startSel=startSel.map(_update42.changes);}},get:function get(event2,_extend,multiple){var cur2=getPos(view,event2);if(!cur2)return startSel;var ranges=rectangleFor(view.state,start,cur2);if(!ranges.length)return startSel;if(multiple)return EditorSelection.create(ranges.concat(startSel.ranges));else return EditorSelection.create(ranges);}};}function rectangularSelection(options){var filter=(options===null||options===void 0?void 0:options.eventFilter)||function(e){return e.altKey&&e.button==0;};return EditorView.mouseSelectionStyle.of(function(view,event){return filter(event)?rectangleSelectionStyle(view,event):null;});}// ../node_modules/@codemirror/highlight/dist/index.js
var nextTagID=0;var Tag=/*#__PURE__*/function(){function Tag(set,base2,modified){_classCallCheck(this,Tag);this.set=set;this.base=base2;this.modified=modified;this.id=nextTagID++;}_createClass(Tag,null,[{key:"define",value:function define(parent){if(parent===null||parent===void 0?void 0:parent.base)throw new Error("Can not derive from a modified tag");var tag=new Tag([],null,[]);tag.set.push(tag);if(parent){var _iterator406=_createForOfIteratorHelper(parent.set),_step406;try{for(_iterator406.s();!(_step406=_iterator406.n()).done;){var t2=_step406.value;tag.set.push(t2);}}catch(err){_iterator406.e(err);}finally{_iterator406.f();}}return tag;}},{key:"defineModifier",value:function defineModifier(){var mod=new Modifier();return function(tag){if(tag.modified.indexOf(mod)>-1)return tag;return Modifier.get(tag.base||tag,tag.modified.concat(mod).sort(function(a,b){return a.id-b.id;}));};}}]);return Tag;}();var nextModifierID=0;var Modifier=/*#__PURE__*/function(){function Modifier(){_classCallCheck(this,Modifier);this.instances=[];this.id=nextModifierID++;}_createClass(Modifier,null,[{key:"get",value:function get(base2,mods){if(!mods.length)return base2;var exists=mods[0].instances.find(function(t2){return t2.base==base2&&sameArray2(mods,t2.modified);});if(exists)return exists;var set=[],tag=new Tag(set,base2,mods);var _iterator407=_createForOfIteratorHelper(mods),_step407;try{for(_iterator407.s();!(_step407=_iterator407.n()).done;){var m=_step407.value;m.instances.push(tag);}}catch(err){_iterator407.e(err);}finally{_iterator407.f();}var configs=permute(mods);var _iterator408=_createForOfIteratorHelper(base2.set),_step408;try{for(_iterator408.s();!(_step408=_iterator408.n()).done;){var parent=_step408.value;var _iterator409=_createForOfIteratorHelper(configs),_step409;try{for(_iterator409.s();!(_step409=_iterator409.n()).done;){var config2=_step409.value;set.push(Modifier.get(parent,config2));}}catch(err){_iterator409.e(err);}finally{_iterator409.f();}}}catch(err){_iterator408.e(err);}finally{_iterator408.f();}return tag;}}]);return Modifier;}();function sameArray2(a,b){return a.length==b.length&&a.every(function(x,i){return x==b[i];});}function permute(array){var result=[array];for(var _i314=0;_i314<array.length;_i314++){var _iterator410=_createForOfIteratorHelper(permute(array.slice(0,_i314).concat(array.slice(_i314+1)))),_step410;try{for(_iterator410.s();!(_step410=_iterator410.n()).done;){var a=_step410.value;result.push(a);}}catch(err){_iterator410.e(err);}finally{_iterator410.f();}}return result;}function styleTags(spec){var byName=/* @__PURE__ */Object.create(null);for(var prop in spec){var tags2=spec[prop];if(!Array.isArray(tags2))tags2=[tags2];var _iterator411=_createForOfIteratorHelper(prop.split(" ")),_step411;try{for(_iterator411.s();!(_step411=_iterator411.n()).done;){var part=_step411.value;if(part){var pieces=[],mode=2,rest=part;for(var pos=0;;){if(rest=="..."&&pos>0&&pos+3==part.length){mode=1;break;}var m=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(rest);if(!m)throw new RangeError("Invalid path: "+part);pieces.push(m[0]=="*"?null:m[0][0]=='"'?JSON.parse(m[0]):m[0]);pos+=m[0].length;if(pos==part.length)break;var next=part[pos++];if(pos==part.length&&next=="!"){mode=0;break;}if(next!="/")throw new RangeError("Invalid path: "+part);rest=part.slice(pos);}var last=pieces.length-1,inner=pieces[last];if(!inner)throw new RangeError("Invalid path: "+part);var rule=new Rule(tags2,mode,last>0?pieces.slice(0,last):null);byName[inner]=rule.sort(byName[inner]);}}}catch(err){_iterator411.e(err);}finally{_iterator411.f();}}return ruleNodeProp.add(byName);}var ruleNodeProp=/* @__PURE__ */new NodeProp();var highlightStyle=/* @__PURE__ */Facet.define({combine:function combine(stylings){return stylings.length?HighlightStyle.combinedMatch(stylings):null;}});var fallbackHighlightStyle=/* @__PURE__ */Facet.define({combine:function combine(values){return values.length?values[0].match:null;}});function getHighlightStyle(state){return state.facet(highlightStyle)||state.facet(fallbackHighlightStyle);}var Rule=/*#__PURE__*/function(){function Rule(tags2,mode,context,next){_classCallCheck(this,Rule);this.tags=tags2;this.mode=mode;this.context=context;this.next=next;}_createClass(Rule,[{key:"sort",value:function sort(other){if(!other||other.depth<this.depth){this.next=other;return this;}other.next=this.sort(other.next);return other;}},{key:"depth",get:function get(){return this.context?this.context.length:0;}}]);return Rule;}();var HighlightStyle=/*#__PURE__*/function(){function HighlightStyle(spec,options){_classCallCheck(this,HighlightStyle);this.map=/* @__PURE__ */Object.create(null);var modSpec;function def(spec2){var cls=StyleModule.newName();(modSpec||(modSpec=/* @__PURE__ */Object.create(null)))["."+cls]=spec2;return cls;}this.all=typeof options.all=="string"?options.all:options.all?def(options.all):null;var _iterator412=_createForOfIteratorHelper(spec),_step412;try{for(_iterator412.s();!(_step412=_iterator412.n()).done;){var style=_step412.value;var cls=(style["class"]||def(Object.assign({},style,{tag:null})))+(this.all?" "+this.all:"");var tags2=style.tag;if(!Array.isArray(tags2))this.map[tags2.id]=cls;else{var _iterator413=_createForOfIteratorHelper(tags2),_step413;try{for(_iterator413.s();!(_step413=_iterator413.n()).done;){var tag=_step413.value;this.map[tag.id]=cls;}}catch(err){_iterator413.e(err);}finally{_iterator413.f();}}}}catch(err){_iterator412.e(err);}finally{_iterator412.f();}this.module=modSpec?new StyleModule(modSpec):null;this.scope=options.scope||null;this.match=this.match.bind(this);var ext=[treeHighlighter];if(this.module)ext.push(EditorView.styleModule.of(this.module));this.extension=ext.concat(highlightStyle.of(this));this.fallback=ext.concat(fallbackHighlightStyle.of(this));}_createClass(HighlightStyle,[{key:"match",value:function match(tag,scope){if(this.scope&&scope!=this.scope)return null;var _iterator414=_createForOfIteratorHelper(tag.set),_step414;try{for(_iterator414.s();!(_step414=_iterator414.n()).done;){var t2=_step414.value;var match=this.map[t2.id];if(match!==void 0){if(t2!=tag)this.map[tag.id]=match;return match;}}}catch(err){_iterator414.e(err);}finally{_iterator414.f();}return this.map[tag.id]=this.all;}}],[{key:"combinedMatch",value:function combinedMatch(styles){if(styles.length==1)return styles[0].match;var cache=styles.some(function(s){return s.scope;})?void 0:/* @__PURE__ */Object.create(null);return function(tag,scope){var cached=cache&&cache[tag.id];if(cached!==void 0)return cached;var result=null;var _iterator415=_createForOfIteratorHelper(styles),_step415;try{for(_iterator415.s();!(_step415=_iterator415.n()).done;){var style=_step415.value;var value=style.match(tag,scope);if(value)result=result?result+" "+value:value;}}catch(err){_iterator415.e(err);}finally{_iterator415.f();}if(cache)cache[tag.id]=result;return result;};}},{key:"define",value:function define(specs,options){return new HighlightStyle(specs,options||{});}},{key:"get",value:function get(state,tag,scope){var style=getHighlightStyle(state);return style&&style(tag,scope||NodeType.none);}}]);return HighlightStyle;}();var TreeHighlighter=/*#__PURE__*/function(){function TreeHighlighter(view){_classCallCheck(this,TreeHighlighter);this.markCache=/* @__PURE__ */Object.create(null);this.tree=syntaxTree(view.state);this.decorations=this.buildDeco(view,getHighlightStyle(view.state));}_createClass(TreeHighlighter,[{key:"update",value:function update(_update43){var tree=syntaxTree(_update43.state),style=getHighlightStyle(_update43.state);var styleChange=style!=_update43.startState.facet(highlightStyle);if(tree.length<_update43.view.viewport.to&&!styleChange&&tree.type==this.tree.type){this.decorations=this.decorations.map(_update43.changes);}else if(tree!=this.tree||_update43.viewportChanged||styleChange){this.tree=tree;this.decorations=this.buildDeco(_update43.view,style);}}},{key:"buildDeco",value:function buildDeco(view,match){var _this235=this;if(!match||!this.tree.length)return Decoration.none;var builder=new RangeSetBuilder();var _iterator416=_createForOfIteratorHelper(view.visibleRanges),_step416;try{for(_iterator416.s();!(_step416=_iterator416.n()).done;){var _step416$value=_step416.value,from=_step416$value.from,to=_step416$value.to;highlightTreeRange(this.tree,from,to,match,function(from2,to2,style){builder.add(from2,to2,_this235.markCache[style]||(_this235.markCache[style]=Decoration.mark({"class":style})));});}}catch(err){_iterator416.e(err);}finally{_iterator416.f();}return builder.finish();}}]);return TreeHighlighter;}();var treeHighlighter=/* @__PURE__ */Prec.high(/* @__PURE__ */ViewPlugin.fromClass(TreeHighlighter,{decorations:function decorations(v){return v.decorations;}}));var nodeStack=[""];var HighlightBuilder=/*#__PURE__*/function(){function HighlightBuilder(at,style,span){_classCallCheck(this,HighlightBuilder);this.at=at;this.style=style;this.span=span;this["class"]="";}_createClass(HighlightBuilder,[{key:"startSpan",value:function startSpan(at,cls){if(cls!=this["class"]){this.flush(at);if(at>this.at)this.at=at;this["class"]=cls;}}},{key:"flush",value:function flush(to){if(to>this.at&&this["class"])this.span(this.at,to,this["class"]);}},{key:"highlightRange",value:function highlightRange(cursor2,from,to,inheritedClass,depth,scope){var type=cursor2.type,start=cursor2.from,end=cursor2.to;if(start>=to||end<=from)return;nodeStack[depth]=type.name;if(type.isTop)scope=type;var cls=inheritedClass;var rule=type.prop(ruleNodeProp),opaque=false;while(rule){if(!rule.context||matchContext(rule.context,nodeStack,depth)){var _iterator417=_createForOfIteratorHelper(rule.tags),_step417;try{for(_iterator417.s();!(_step417=_iterator417.n()).done;){var tag=_step417.value;var st=this.style(tag,scope);if(st){if(cls)cls+=" ";cls+=st;if(rule.mode==1)inheritedClass+=(inheritedClass?" ":"")+st;else if(rule.mode==0)opaque=true;}}}catch(err){_iterator417.e(err);}finally{_iterator417.f();}break;}rule=rule.next;}this.startSpan(cursor2.from,cls);if(opaque)return;var mounted=cursor2.tree&&cursor2.tree.prop(NodeProp.mounted);if(mounted&&mounted.overlay){var inner=cursor2.node.enter(mounted.overlay[0].from+start,1);var hasChild2=cursor2.firstChild();for(var _i315=0,pos=start;;_i315++){var next=_i315<mounted.overlay.length?mounted.overlay[_i315]:null;var nextPos=next?next.from+start:end;var rangeFrom=Math.max(from,pos),rangeTo=Math.min(to,nextPos);if(rangeFrom<rangeTo&&hasChild2){while(cursor2.from<rangeTo){this.highlightRange(cursor2,rangeFrom,rangeTo,inheritedClass,depth+1,scope);this.startSpan(Math.min(to,cursor2.to),cls);if(cursor2.to>=nextPos||!cursor2.nextSibling())break;}}if(!next||nextPos>to)break;pos=next.to+start;if(pos>from){this.highlightRange(inner.cursor,Math.max(from,next.from+start),Math.min(to,pos),inheritedClass,depth,mounted.tree.type);this.startSpan(pos,cls);}}if(hasChild2)cursor2.parent();}else if(cursor2.firstChild()){do{if(cursor2.to<=from)continue;if(cursor2.from>=to)break;this.highlightRange(cursor2,from,to,inheritedClass,depth+1,scope);this.startSpan(Math.min(to,cursor2.to),cls);}while(cursor2.nextSibling());cursor2.parent();}}}]);return HighlightBuilder;}();function highlightTreeRange(tree,from,to,style,span){var builder=new HighlightBuilder(from,style,span);builder.highlightRange(tree.cursor(),from,to,"",0,tree.type);builder.flush(to);}function matchContext(context,stack,depth){if(context.length>depth-1)return false;for(var d=depth-1,_i316=context.length-1;_i316>=0;_i316--,d--){var check=context[_i316];if(check&&check!=stack[d])return false;}return true;}var t=Tag.define;var comment=/* @__PURE__ */t();var name=/* @__PURE__ */t();var typeName=/* @__PURE__ */t(name);var propertyName=/* @__PURE__ */t(name);var literal=/* @__PURE__ */t();var string=/* @__PURE__ */t(literal);var number=/* @__PURE__ */t(literal);var content=/* @__PURE__ */t();var heading=/* @__PURE__ */t(content);var keyword=/* @__PURE__ */t();var operator=/* @__PURE__ */t();var punctuation=/* @__PURE__ */t();var bracket=/* @__PURE__ */t(punctuation);var meta=/* @__PURE__ */t();var tags={comment:comment,lineComment:/* @__PURE__ */t(comment),blockComment:/* @__PURE__ */t(comment),docComment:/* @__PURE__ */t(comment),name:name,variableName:/* @__PURE__ */t(name),typeName:typeName,tagName:/* @__PURE__ */t(typeName),propertyName:propertyName,attributeName:/* @__PURE__ */t(propertyName),className:/* @__PURE__ */t(name),labelName:/* @__PURE__ */t(name),namespace:/* @__PURE__ */t(name),macroName:/* @__PURE__ */t(name),literal:literal,string:string,docString:/* @__PURE__ */t(string),character:/* @__PURE__ */t(string),attributeValue:/* @__PURE__ */t(string),number:number,integer:/* @__PURE__ */t(number),"float":/* @__PURE__ */t(number),bool:/* @__PURE__ */t(literal),regexp:/* @__PURE__ */t(literal),escape:/* @__PURE__ */t(literal),color:/* @__PURE__ */t(literal),url:/* @__PURE__ */t(literal),keyword:keyword,self:/* @__PURE__ */t(keyword),"null":/* @__PURE__ */t(keyword),atom:/* @__PURE__ */t(keyword),unit:/* @__PURE__ */t(keyword),modifier:/* @__PURE__ */t(keyword),operatorKeyword:/* @__PURE__ */t(keyword),controlKeyword:/* @__PURE__ */t(keyword),definitionKeyword:/* @__PURE__ */t(keyword),moduleKeyword:/* @__PURE__ */t(keyword),operator:operator,derefOperator:/* @__PURE__ */t(operator),arithmeticOperator:/* @__PURE__ */t(operator),logicOperator:/* @__PURE__ */t(operator),bitwiseOperator:/* @__PURE__ */t(operator),compareOperator:/* @__PURE__ */t(operator),updateOperator:/* @__PURE__ */t(operator),definitionOperator:/* @__PURE__ */t(operator),typeOperator:/* @__PURE__ */t(operator),controlOperator:/* @__PURE__ */t(operator),punctuation:punctuation,separator:/* @__PURE__ */t(punctuation),bracket:bracket,angleBracket:/* @__PURE__ */t(bracket),squareBracket:/* @__PURE__ */t(bracket),paren:/* @__PURE__ */t(bracket),brace:/* @__PURE__ */t(bracket),content:content,heading:heading,heading1:/* @__PURE__ */t(heading),heading2:/* @__PURE__ */t(heading),heading3:/* @__PURE__ */t(heading),heading4:/* @__PURE__ */t(heading),heading5:/* @__PURE__ */t(heading),heading6:/* @__PURE__ */t(heading),contentSeparator:/* @__PURE__ */t(content),list:/* @__PURE__ */t(content),quote:/* @__PURE__ */t(content),emphasis:/* @__PURE__ */t(content),strong:/* @__PURE__ */t(content),link:/* @__PURE__ */t(content),monospace:/* @__PURE__ */t(content),strikethrough:/* @__PURE__ */t(content),inserted:/* @__PURE__ */t(),deleted:/* @__PURE__ */t(),changed:/* @__PURE__ */t(),invalid:/* @__PURE__ */t(),meta:meta,documentMeta:/* @__PURE__ */t(meta),annotation:/* @__PURE__ */t(meta),processingInstruction:/* @__PURE__ */t(meta),definition:/* @__PURE__ */Tag.defineModifier(),constant:/* @__PURE__ */Tag.defineModifier(),"function":/* @__PURE__ */Tag.defineModifier(),standard:/* @__PURE__ */Tag.defineModifier(),local:/* @__PURE__ */Tag.defineModifier(),special:/* @__PURE__ */Tag.defineModifier()};var defaultHighlightStyle=/* @__PURE__ */HighlightStyle.define([{tag:tags.link,textDecoration:"underline"},{tag:tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strong,fontWeight:"bold"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.keyword,color:"#708"},{tag:[tags.atom,tags.bool,tags.url,tags.contentSeparator,tags.labelName],color:"#219"},{tag:[tags.literal,tags.inserted],color:"#164"},{tag:[tags.string,tags.deleted],color:"#a11"},{tag:[tags.regexp,tags.escape,/* @__PURE__ */tags.special(tags.string)],color:"#e40"},{tag:/* @__PURE__ */tags.definition(tags.variableName),color:"#00f"},{tag:/* @__PURE__ */tags.local(tags.variableName),color:"#30a"},{tag:[tags.typeName,tags.namespace],color:"#085"},{tag:tags.className,color:"#167"},{tag:[/* @__PURE__ */tags.special(tags.variableName),tags.macroName],color:"#256"},{tag:/* @__PURE__ */tags.definition(tags.propertyName),color:"#00c"},{tag:tags.comment,color:"#940"},{tag:tags.meta,color:"#7a757a"},{tag:tags.invalid,color:"#f00"}]);var classHighlightStyle=/* @__PURE__ */HighlightStyle.define([{tag:tags.link,"class":"cmt-link"},{tag:tags.heading,"class":"cmt-heading"},{tag:tags.emphasis,"class":"cmt-emphasis"},{tag:tags.strong,"class":"cmt-strong"},{tag:tags.keyword,"class":"cmt-keyword"},{tag:tags.atom,"class":"cmt-atom"},{tag:tags.bool,"class":"cmt-bool"},{tag:tags.url,"class":"cmt-url"},{tag:tags.labelName,"class":"cmt-labelName"},{tag:tags.inserted,"class":"cmt-inserted"},{tag:tags.deleted,"class":"cmt-deleted"},{tag:tags.literal,"class":"cmt-literal"},{tag:tags.string,"class":"cmt-string"},{tag:tags.number,"class":"cmt-number"},{tag:[tags.regexp,tags.escape,/* @__PURE__ */tags.special(tags.string)],"class":"cmt-string2"},{tag:tags.variableName,"class":"cmt-variableName"},{tag:/* @__PURE__ */tags.local(tags.variableName),"class":"cmt-variableName cmt-local"},{tag:/* @__PURE__ */tags.definition(tags.variableName),"class":"cmt-variableName cmt-definition"},{tag:/* @__PURE__ */tags.special(tags.variableName),"class":"cmt-variableName2"},{tag:/* @__PURE__ */tags.definition(tags.propertyName),"class":"cmt-propertyName cmt-definition"},{tag:tags.typeName,"class":"cmt-typeName"},{tag:tags.namespace,"class":"cmt-namespace"},{tag:tags.className,"class":"cmt-className"},{tag:tags.macroName,"class":"cmt-macroName"},{tag:tags.propertyName,"class":"cmt-propertyName"},{tag:tags.operator,"class":"cmt-operator"},{tag:tags.comment,"class":"cmt-comment"},{tag:tags.meta,"class":"cmt-meta"},{tag:tags.invalid,"class":"cmt-invalid"},{tag:tags.punctuation,"class":"cmt-punctuation"}]);// ../node_modules/@codemirror/lint/dist/index.js
var dist_exports3={};__export(dist_exports3,{closeLintPanel:function closeLintPanel(){return _closeLintPanel;},diagnosticCount:function diagnosticCount(){return _diagnosticCount;},forceLinting:function forceLinting(){return _forceLinting;},lintGutter:function lintGutter(){return _lintGutter;},lintKeymap:function lintKeymap(){return _lintKeymap;},linter:function linter(){return _linter;},nextDiagnostic:function nextDiagnostic(){return _nextDiagnostic;},openLintPanel:function openLintPanel(){return _openLintPanel;},setDiagnostics:function setDiagnostics(){return _setDiagnostics;},setDiagnosticsEffect:function setDiagnosticsEffect(){return _setDiagnosticsEffect;}});var SelectedDiagnostic=/*#__PURE__*/_createClass(function SelectedDiagnostic(from,to,diagnostic){_classCallCheck(this,SelectedDiagnostic);this.from=from;this.to=to;this.diagnostic=diagnostic;});var LintState=/*#__PURE__*/function(){function LintState(diagnostics,panel,selected){_classCallCheck(this,LintState);this.diagnostics=diagnostics;this.panel=panel;this.selected=selected;}_createClass(LintState,null,[{key:"init",value:function init(diagnostics,panel,state){var ranges=Decoration.set(diagnostics.map(function(d){return d.from==d.to||d.from==d.to-1&&state.doc.lineAt(d.from).to==d.from?Decoration.widget({widget:new DiagnosticWidget(d),diagnostic:d}).range(d.from):Decoration.mark({attributes:{"class":"cm-lintRange cm-lintRange-"+d.severity},diagnostic:d}).range(d.from,d.to);}),true);return new LintState(ranges,panel,findDiagnostic(ranges));}}]);return LintState;}();function findDiagnostic(diagnostics){var diagnostic=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var after=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var found=null;diagnostics.between(after,1e9,function(from,to,_ref111){var spec=_ref111.spec;if(diagnostic&&spec.diagnostic!=diagnostic)return;found=new SelectedDiagnostic(from,to,spec.diagnostic);return false;});return found;}function maybeEnableLint(state,effects){return state.field(lintState,false)?effects:effects.concat(StateEffect.appendConfig.of([lintState,EditorView.decorations.compute([lintState],function(state2){var _state2$field=state2.field(lintState),selected=_state2$field.selected,panel=_state2$field.panel;return!selected||!panel||selected.from==selected.to?Decoration.none:Decoration.set([activeMark.range(selected.from,selected.to)]);}),_hoverTooltip(lintTooltip),baseTheme13]));}function _setDiagnostics(state,diagnostics){return{effects:maybeEnableLint(state,[_setDiagnosticsEffect.of(diagnostics)])};}var _setDiagnosticsEffect=/* @__PURE__ */StateEffect.define();var togglePanel2=/* @__PURE__ */StateEffect.define();var movePanelSelection=/* @__PURE__ */StateEffect.define();var lintState=/* @__PURE__ */StateField.define({create:function create(){return new LintState(Decoration.none,null,null);},update:function update(value,tr){if(tr.docChanged){var mapped=value.diagnostics.map(tr.changes),selected=null;if(value.selected){var selPos=tr.changes.mapPos(value.selected.from,1);selected=findDiagnostic(mapped,value.selected.diagnostic,selPos)||findDiagnostic(mapped,null,selPos);}value=new LintState(mapped,value.panel,selected);}var _iterator418=_createForOfIteratorHelper(tr.effects),_step418;try{for(_iterator418.s();!(_step418=_iterator418.n()).done;){var effect=_step418.value;if(effect.is(_setDiagnosticsEffect)){value=LintState.init(effect.value,value.panel,tr.state);}else if(effect.is(togglePanel2)){value=new LintState(value.diagnostics,effect.value?LintPanel.open:null,value.selected);}else if(effect.is(movePanelSelection)){value=new LintState(value.diagnostics,value.panel,effect.value);}}}catch(err){_iterator418.e(err);}finally{_iterator418.f();}return value;},provide:function provide(f){return[showPanel.from(f,function(val){return val.panel;}),EditorView.decorations.from(f,function(s){return s.diagnostics;})];}});function _diagnosticCount(state){var lint=state.field(lintState,false);return lint?lint.diagnostics.size:0;}var activeMark=/* @__PURE__ */Decoration.mark({"class":"cm-lintRange cm-lintRange-active"});function lintTooltip(view,pos,side){var _view$state$field=view.state.field(lintState),diagnostics=_view$state$field.diagnostics;var found=[],stackStart=2e8,stackEnd=0;diagnostics.between(pos-(side<0?1:0),pos+(side>0?1:0),function(from,to,_ref112){var spec=_ref112.spec;if(pos>=from&&pos<=to&&(from==to||(pos>from||side>0)&&(pos<to||side<0))){found.push(spec.diagnostic);stackStart=Math.min(from,stackStart);stackEnd=Math.max(to,stackEnd);}});if(!found.length)return null;return{pos:stackStart,end:stackEnd,above:view.state.doc.lineAt(stackStart).to<stackEnd,create:function create(){return{dom:diagnosticsTooltip(view,found)};}};}function diagnosticsTooltip(view,diagnostics){return crelt("ul",{"class":"cm-tooltip-lint"},diagnostics.map(function(d){return renderDiagnostic(view,d,false);}));}var _openLintPanel=function _openLintPanel(view){var field=view.state.field(lintState,false);if(!field||!field.panel)view.dispatch({effects:maybeEnableLint(view.state,[togglePanel2.of(true)])});var panel=getPanel(view,LintPanel.open);if(panel)panel.dom.querySelector(".cm-panel-lint ul").focus();return true;};var _closeLintPanel=function _closeLintPanel(view){var field=view.state.field(lintState,false);if(!field||!field.panel)return false;view.dispatch({effects:togglePanel2.of(false)});return true;};var _nextDiagnostic=function _nextDiagnostic(view){var field=view.state.field(lintState,false);if(!field)return false;var sel=view.state.selection.main,next=field.diagnostics.iter(sel.to+1);if(!next.value){next=field.diagnostics.iter(0);if(!next.value||next.from==sel.from&&next.to==sel.to)return false;}view.dispatch({selection:{anchor:next.from,head:next.to},scrollIntoView:true});return true;};var _lintKeymap=[{key:"Mod-Shift-m",run:_openLintPanel},{key:"F8",run:_nextDiagnostic}];var lintPlugin=/* @__PURE__ */ViewPlugin.fromClass(/*#__PURE__*/function(){function _class16(view){_classCallCheck(this,_class16);this.view=view;this.timeout=-1;this.set=true;var _view$state$facet=view.state.facet(lintSource),delay=_view$state$facet.delay;this.lintTime=Date.now()+delay;this.run=this.run.bind(this);this.timeout=setTimeout(this.run,delay);}_createClass(_class16,[{key:"run",value:function run(){var _this236=this;var now=Date.now();if(now<this.lintTime-10){setTimeout(this.run,this.lintTime-now);}else{this.set=false;var state=this.view.state,_state$facet=state.facet(lintSource),sources=_state$facet.sources;Promise.all(sources.map(function(source){return Promise.resolve(source(_this236.view));})).then(function(annotations){var _a,_b;var all=annotations.reduce(function(a,b){return a.concat(b);});if(_this236.view.state.doc==state.doc&&(all.length||((_b=(_a=_this236.view.state.field(lintState,false))===null||_a===void 0?void 0:_a.diagnostics)===null||_b===void 0?void 0:_b.size)))_this236.view.dispatch(_setDiagnostics(_this236.view.state,all));},function(error){logException(_this236.view.state,error);});}}},{key:"update",value:function update(_update44){var source=_update44.state.facet(lintSource);if(_update44.docChanged||source!=_update44.startState.facet(lintSource)){this.lintTime=Date.now()+source.delay;if(!this.set){this.set=true;this.timeout=setTimeout(this.run,source.delay);}}}},{key:"force",value:function force(){if(this.set){this.lintTime=Date.now();this.run();}}},{key:"destroy",value:function destroy(){clearTimeout(this.timeout);}}]);return _class16;}());var lintSource=/* @__PURE__ */Facet.define({combine:function combine(input){return{sources:input.map(function(i){return i.source;}),delay:input.length?Math.max.apply(Math,_toConsumableArray(input.map(function(i){return i.delay;}))):750};},enables:lintPlugin});function _linter(source){var config2=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var _a;return lintSource.of({source:source,delay:(_a=config2.delay)!==null&&_a!==void 0?_a:750});}function _forceLinting(view){var plugin=view.plugin(lintPlugin);if(plugin)plugin.force();}function assignKeys(actions){var assigned=[];if(actions){var _iterator419=_createForOfIteratorHelper(actions),_step419;try{actions:for(_iterator419.s();!(_step419=_iterator419.n()).done;){var name2=_step419.value.name;var _loop44=function _loop44(_i317){var ch=name2[_i317];if(/[a-zA-Z]/.test(ch)&&!assigned.some(function(c){return c.toLowerCase()==ch.toLowerCase();})){assigned.push(ch);return"continue|actions";}};for(var _i317=0;_i317<name2.length;_i317++){var _ret8=_loop44(_i317);if(_ret8==="continue|actions")continue actions;}assigned.push("");}}catch(err){_iterator419.e(err);}finally{_iterator419.f();}}return assigned;}function renderDiagnostic(view,diagnostic,inPanel){var _a;var keys=inPanel?assignKeys(diagnostic.actions):[];return crelt("li",{"class":"cm-diagnostic cm-diagnostic-"+diagnostic.severity},crelt("span",{"class":"cm-diagnosticText"},diagnostic.message),(_a=diagnostic.actions)===null||_a===void 0?void 0:_a.map(function(action,i){var click=function click(e){e.preventDefault();var found=findDiagnostic(view.state.field(lintState).diagnostics,diagnostic);if(found)action.apply(view,found.from,found.to);};var name2=action.name,keyIndex=keys[i]?name2.indexOf(keys[i]):-1;var nameElt=keyIndex<0?name2:[name2.slice(0,keyIndex),crelt("u",name2.slice(keyIndex,keyIndex+1)),name2.slice(keyIndex+1)];return crelt("button",{type:"button","class":"cm-diagnosticAction",onclick:click,onmousedown:click,"aria-label":" Action: ".concat(name2).concat(keyIndex<0?"":" (access key \"".concat(keys[i],")\""),".")},nameElt);}),diagnostic.source&&crelt("div",{"class":"cm-diagnosticSource"},diagnostic.source));}var DiagnosticWidget=/*#__PURE__*/function(_WidgetType25){_inherits(DiagnosticWidget,_WidgetType25);var _super119=_createSuper(DiagnosticWidget);function DiagnosticWidget(diagnostic){var _this237;_classCallCheck(this,DiagnosticWidget);_this237=_super119.call(this);_this237.diagnostic=diagnostic;return _this237;}_createClass(DiagnosticWidget,[{key:"eq",value:function eq(other){return other.diagnostic==this.diagnostic;}},{key:"toDOM",value:function toDOM(){return crelt("span",{"class":"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity});}}]);return DiagnosticWidget;}(WidgetType);var PanelItem=/*#__PURE__*/_createClass(function PanelItem(view,diagnostic){_classCallCheck(this,PanelItem);this.diagnostic=diagnostic;this.id="item_"+Math.floor(Math.random()*4294967295).toString(16);this.dom=renderDiagnostic(view,diagnostic,true);this.dom.id=this.id;this.dom.setAttribute("role","option");});var LintPanel=/*#__PURE__*/function(){function LintPanel(view){var _this238=this;_classCallCheck(this,LintPanel);this.view=view;this.items=[];var onkeydown=function onkeydown(event){if(event.keyCode==27){_closeLintPanel(_this238.view);_this238.view.focus();}else if(event.keyCode==38||event.keyCode==33){_this238.moveSelection((_this238.selectedIndex-1+_this238.items.length)%_this238.items.length);}else if(event.keyCode==40||event.keyCode==34){_this238.moveSelection((_this238.selectedIndex+1)%_this238.items.length);}else if(event.keyCode==36){_this238.moveSelection(0);}else if(event.keyCode==35){_this238.moveSelection(_this238.items.length-1);}else if(event.keyCode==13){_this238.view.focus();}else if(event.keyCode>=65&&event.keyCode<=90&&_this238.selectedIndex>=0){var diagnostic=_this238.items[_this238.selectedIndex].diagnostic,keys=assignKeys(diagnostic.actions);for(var _i318=0;_i318<keys.length;_i318++){if(keys[_i318].toUpperCase().charCodeAt(0)==event.keyCode){var found=findDiagnostic(_this238.view.state.field(lintState).diagnostics,diagnostic);if(found)diagnostic.actions[_i318].apply(view,found.from,found.to);}}}else{return;}event.preventDefault();};var onclick=function onclick(event){for(var _i319=0;_i319<_this238.items.length;_i319++){if(_this238.items[_i319].dom.contains(event.target))_this238.moveSelection(_i319);}};this.list=crelt("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:onkeydown,onclick:onclick});this.dom=crelt("div",{"class":"cm-panel-lint"},this.list,crelt("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:function onclick(){return _closeLintPanel(_this238.view);}},"\xD7"));this.update();}_createClass(LintPanel,[{key:"selectedIndex",get:function get(){var selected=this.view.state.field(lintState).selected;if(!selected)return-1;for(var _i320=0;_i320<this.items.length;_i320++){if(this.items[_i320].diagnostic==selected.diagnostic)return _i320;}return-1;}},{key:"update",value:function update(){var _this239=this;var _this$view$state$fiel=this.view.state.field(lintState),diagnostics=_this$view$state$fiel.diagnostics,selected=_this$view$state$fiel.selected;var i=0,needsSync=false,newSelectedItem=null;diagnostics.between(0,this.view.state.doc.length,function(_start,_end,_ref113){var spec=_ref113.spec;var found=-1,item;for(var j=i;j<_this239.items.length;j++){if(_this239.items[j].diagnostic==spec.diagnostic){found=j;break;}}if(found<0){item=new PanelItem(_this239.view,spec.diagnostic);_this239.items.splice(i,0,item);needsSync=true;}else{item=_this239.items[found];if(found>i){_this239.items.splice(i,found-i);needsSync=true;}}if(selected&&item.diagnostic==selected.diagnostic){if(!item.dom.hasAttribute("aria-selected")){item.dom.setAttribute("aria-selected","true");newSelectedItem=item;}}else if(item.dom.hasAttribute("aria-selected")){item.dom.removeAttribute("aria-selected");}i++;});while(i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0)){needsSync=true;this.items.pop();}if(this.items.length==0){this.items.push(new PanelItem(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")}));needsSync=true;}if(newSelectedItem){this.list.setAttribute("aria-activedescendant",newSelectedItem.id);this.view.requestMeasure({key:this,read:function read(){return{sel:newSelectedItem.dom.getBoundingClientRect(),panel:_this239.list.getBoundingClientRect()};},write:function write(_ref114){var sel=_ref114.sel,panel=_ref114.panel;if(sel.top<panel.top)_this239.list.scrollTop-=panel.top-sel.top;else if(sel.bottom>panel.bottom)_this239.list.scrollTop+=sel.bottom-panel.bottom;}});}else if(this.selectedIndex<0){this.list.removeAttribute("aria-activedescendant");}if(needsSync)this.sync();}},{key:"sync",value:function sync(){var domPos=this.list.firstChild;function rm7(){var prev=domPos;domPos=prev.nextSibling;prev.remove();}var _iterator420=_createForOfIteratorHelper(this.items),_step420;try{for(_iterator420.s();!(_step420=_iterator420.n()).done;){var item=_step420.value;if(item.dom.parentNode==this.list){while(domPos!=item.dom){rm7();}domPos=item.dom.nextSibling;}else{this.list.insertBefore(item.dom,domPos);}}}catch(err){_iterator420.e(err);}finally{_iterator420.f();}while(domPos){rm7();}}},{key:"moveSelection",value:function moveSelection(selectedIndex){if(this.selectedIndex<0)return;var field=this.view.state.field(lintState);var selection2=findDiagnostic(field.diagnostics,this.items[selectedIndex].diagnostic);if(!selection2)return;this.view.dispatch({selection:{anchor:selection2.from,head:selection2.to},scrollIntoView:true,effects:movePanelSelection.of(selection2)});}}],[{key:"open",value:function open(view){return new LintPanel(view);}}]);return LintPanel;}();function svg(content2){var attrs=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"viewBox=\"0 0 40 40\"";return"url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" ".concat(attrs,">").concat(encodeURIComponent(content2),"</svg>')");}function underline(color){return svg("<path d=\"m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0\" stroke=\"".concat(color,"\" fill=\"none\" stroke-width=\".7\"/>"),"width=\"6\" height=\"3\"");}var baseTheme13=/* @__PURE__ */EditorView.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px"},".cm-diagnosticSource":{fontSize:"70%",opacity:0.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:/* @__PURE__ */underline("#d11")},".cm-lintRange-warning":{backgroundImage:/* @__PURE__ */underline("orange")},".cm-lintRange-info":{backgroundImage:/* @__PURE__ */underline("#999")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});var LintGutterMarker=/*#__PURE__*/function(_GutterMarker4){_inherits(LintGutterMarker,_GutterMarker4);var _super120=_createSuper(LintGutterMarker);function LintGutterMarker(diagnostics){var _this240;_classCallCheck(this,LintGutterMarker);_this240=_super120.call(this);_this240.diagnostics=diagnostics;_this240.severity=diagnostics.reduce(function(max,d){var s=d.severity;return s=="error"||s=="warning"&&max=="info"?s:max;},"info");return _this240;}_createClass(LintGutterMarker,[{key:"toDOM",value:function toDOM(view){var _this241=this;var elt=document.createElement("div");elt.className="cm-lint-marker cm-lint-marker-"+this.severity;elt.onmouseover=function(){return gutterMarkerMouseOver(view,elt,_this241.diagnostics);};return elt;}}]);return LintGutterMarker;}(GutterMarker);function trackHoverOn(view,marker){var mousemove=function mousemove(event){var rect=marker.getBoundingClientRect();if(event.clientX>rect.left-10&&event.clientX<rect.right+10&&event.clientY>rect.top-10&&event.clientY<rect.bottom+10)return;for(var target=event.target;target;target=target.parentNode){if(target.nodeType==1&&target.classList.contains("cm-tooltip-lint"))return;}window.removeEventListener("mousemove",mousemove);if(view.state.field(lintGutterTooltip))view.dispatch({effects:setLintGutterTooltip.of(null)});};window.addEventListener("mousemove",mousemove);}function gutterMarkerMouseOver(view,marker,diagnostics){function hovered(){var line=view.visualLineAtHeight(marker.getBoundingClientRect().top+5);var linePos=view.coordsAtPos(line.from),markerRect=marker.getBoundingClientRect();if(linePos){view.dispatch({effects:setLintGutterTooltip.of({pos:line.from,above:false,create:function create(){return{dom:diagnosticsTooltip(view,diagnostics),offset:{x:markerRect.left-linePos.left,y:0}};}})});}marker.onmouseout=marker.onmousemove=null;trackHoverOn(view,marker);}var hoverTimeout=setTimeout(hovered,600);marker.onmouseout=function(){clearTimeout(hoverTimeout);marker.onmouseout=marker.onmousemove=null;};marker.onmousemove=function(){clearTimeout(hoverTimeout);hoverTimeout=setTimeout(hovered,600);};}function markersForDiagnostics(doc6,diagnostics){var byLine=/* @__PURE__ */Object.create(null);var _iterator421=_createForOfIteratorHelper(diagnostics),_step421;try{for(_iterator421.s();!(_step421=_iterator421.n()).done;){var diagnostic=_step421.value;var _line5=doc6.lineAt(diagnostic.from);(byLine[_line5.from]||(byLine[_line5.from]=[])).push(diagnostic);}}catch(err){_iterator421.e(err);}finally{_iterator421.f();}var markers=[];for(var line in byLine){markers.push(new LintGutterMarker(byLine[line]).range(+line));}return RangeSet.of(markers,true);}var lintGutterExtension=/* @__PURE__ */gutter({"class":"cm-gutter-lint",markers:function markers(view){return view.state.field(lintGutterMarkers);}});var lintGutterMarkers=/* @__PURE__ */StateField.define({create:function create(){return RangeSet.empty;},update:function update(markers,tr){markers=markers.map(tr.changes);var _iterator422=_createForOfIteratorHelper(tr.effects),_step422;try{for(_iterator422.s();!(_step422=_iterator422.n()).done;){var effect=_step422.value;if(effect.is(_setDiagnosticsEffect)){markers=markersForDiagnostics(tr.state.doc,effect.value);}}}catch(err){_iterator422.e(err);}finally{_iterator422.f();}return markers;}});var setLintGutterTooltip=/* @__PURE__ */StateEffect.define();var lintGutterTooltip=/* @__PURE__ */StateField.define({create:function create(){return null;},update:function update(tooltip,tr){if(tooltip&&tr.docChanged)tooltip=Object.assign(Object.assign({},tooltip),{pos:tr.changes.mapPos(tooltip.pos)});return tr.effects.reduce(function(t2,e){return e.is(setLintGutterTooltip)?e.value:t2;},tooltip);},provide:function provide(field){return _showTooltip.from(field);}});var lintGutterTheme=/* @__PURE__ */EditorView.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:"0 .2em",display:"flex",flexDirection:"column",justifyContent:"center"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:/* @__PURE__ */svg("<path fill=\"#aaf\" stroke=\"#77e\" stroke-width=\"6\" stroke-linejoin=\"round\" d=\"M5 5L35 5L35 35L5 35Z\"/>")},".cm-lint-marker-warning":{content:/* @__PURE__ */svg("<path fill=\"#fe8\" stroke=\"#fd7\" stroke-width=\"6\" stroke-linejoin=\"round\" d=\"M20 6L37 35L3 35Z\"/>")},".cm-lint-marker-error:before":{content:/* @__PURE__ */svg("<circle cx=\"20\" cy=\"20\" r=\"15\" fill=\"#f87\" stroke=\"#f43\" stroke-width=\"6\"/>")}});function _lintGutter(){return[lintGutterMarkers,lintGutterExtension,lintGutterTheme,lintGutterTooltip];}// ../node_modules/@codemirror/basic-setup/dist/index.js
var basicSetup=[/* @__PURE__ */lineNumbers(),/* @__PURE__ */highlightActiveLineGutter(),/* @__PURE__ */highlightSpecialChars(),/* @__PURE__ */history(),/* @__PURE__ */foldGutter(),/* @__PURE__ */drawSelection(),/* @__PURE__ */EditorState.allowMultipleSelections.of(true),/* @__PURE__ */indentOnInput(),defaultHighlightStyle.fallback,/* @__PURE__ */bracketMatching(),/* @__PURE__ */closeBrackets(),/* @__PURE__ */_autocompletion(),/* @__PURE__ */rectangularSelection(),/* @__PURE__ */highlightActiveLine(),/* @__PURE__ */highlightSelectionMatches(),/* @__PURE__ */keymap.of([].concat(closeBracketsKeymap,_toConsumableArray(defaultKeymap),searchKeymap,historyKeymap,foldKeymap,commentKeymap,_completionKeymap,_lintKeymap))];// ../node_modules/@codemirror/theme-one-dark/dist/index.js
var dist_exports4={};__export(dist_exports4,{oneDark:function oneDark(){return _oneDark;},oneDarkHighlightStyle:function oneDarkHighlightStyle(){return _oneDarkHighlightStyle;},oneDarkTheme:function oneDarkTheme(){return _oneDarkTheme;}});var chalky="#e5c07b";var coral="#e06c75";var cyan="#56b6c2";var invalid="#ffffff";var ivory="#abb2bf";var stone="#7d8799";var malibu="#61afef";var sage="#98c379";var whiskey="#d19a66";var violet="#c678dd";var darkBackground="#21252b";var highlightBackground="#2c313a";var background="#282c34";var tooltipBackground="#353a42";var selection="#3E4451";var cursor="#528bff";var _oneDarkTheme=/* @__PURE__ */EditorView.theme({"&":{color:ivory,backgroundColor:background},".cm-content":{caretColor:cursor},"&.cm-focused .cm-cursor":{borderLeftColor:cursor},"&.cm-focused .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:selection},".cm-panels":{backgroundColor:darkBackground,color:ivory},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:highlightBackground},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847",outline:"1px solid #515a6b"},".cm-gutters":{backgroundColor:background,color:stone,border:"none"},".cm-activeLineGutter":{backgroundColor:highlightBackground},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:tooltipBackground},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:tooltipBackground,borderBottomColor:tooltipBackground},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:highlightBackground,color:ivory}}},{dark:true});var _oneDarkHighlightStyle=/* @__PURE__ */HighlightStyle.define([{tag:tags.keyword,color:violet},{tag:[tags.name,tags.deleted,tags.character,tags.propertyName,tags.macroName],color:coral},{tag:[/* @__PURE__ */tags["function"](tags.variableName),tags.labelName],color:malibu},{tag:[tags.color,/* @__PURE__ */tags.constant(tags.name),/* @__PURE__ */tags.standard(tags.name)],color:whiskey},{tag:[/* @__PURE__ */tags.definition(tags.name),tags.separator],color:ivory},{tag:[tags.typeName,tags.className,tags.number,tags.changed,tags.annotation,tags.modifier,tags.self,tags.namespace],color:chalky},{tag:[tags.operator,tags.operatorKeyword,tags.url,tags.escape,tags.regexp,tags.link,/* @__PURE__ */tags.special(tags.string)],color:cyan},{tag:[tags.meta,tags.comment],color:stone},{tag:tags.strong,fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.link,color:stone,textDecoration:"underline"},{tag:tags.heading,fontWeight:"bold",color:coral},{tag:[tags.atom,tags.bool,/* @__PURE__ */tags.special(tags.variableName)],color:whiskey},{tag:[tags.processingInstruction,tags.string,tags.inserted],color:sage},{tag:tags.invalid,color:invalid}]);var _oneDark=[_oneDarkTheme,_oneDarkHighlightStyle];// ../node_modules/@codemirror/stream-parser/dist/index.js
var dist_exports5={};__export(dist_exports5,{StreamLanguage:function StreamLanguage(){return _StreamLanguage;},StringStream:function StringStream(){return _StringStream;}});function countCol(string2,end,tabSize){var startIndex=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var startValue=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;if(end==null){end=string2.search(/[^\s\u00a0]/);if(end==-1)end=string2.length;}var n=startValue;for(var _i321=startIndex;_i321<end;_i321++){if(string2.charCodeAt(_i321)==9)n+=tabSize-n%tabSize;else n++;}return n;}var _StringStream=/*#__PURE__*/function(){function _StringStream(string2,tabSize,indentUnit2){_classCallCheck(this,_StringStream);this.string=string2;this.tabSize=tabSize;this.indentUnit=indentUnit2;this.pos=0;this.start=0;this.lastColumnPos=0;this.lastColumnValue=0;}_createClass(_StringStream,[{key:"eol",value:function eol(){return this.pos>=this.string.length;}},{key:"sol",value:function sol(){return this.pos==0;}},{key:"peek",value:function peek(){return this.string.charAt(this.pos)||void 0;}},{key:"next",value:function next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++);}},{key:"eat",value:function eat(match){var ch=this.string.charAt(this.pos);var ok;if(typeof match=="string")ok=ch==match;else ok=ch&&(match instanceof RegExp?match.test(ch):match(ch));if(ok){++this.pos;return ch;}}},{key:"eatWhile",value:function eatWhile(match){var start=this.pos;while(this.eat(match)){}return this.pos>start;}},{key:"eatSpace",value:function eatSpace(){var start=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++this.pos;}return this.pos>start;}},{key:"skipToEnd",value:function skipToEnd(){this.pos=this.string.length;}},{key:"skipTo",value:function skipTo(ch){var found=this.string.indexOf(ch,this.pos);if(found>-1){this.pos=found;return true;}}},{key:"backUp",value:function backUp(n){this.pos-=n;}},{key:"column",value:function column(){if(this.lastColumnPos<this.start){this.lastColumnValue=countCol(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);this.lastColumnPos=this.start;}return this.lastColumnValue;}},{key:"indentation",value:function indentation(){return countCol(this.string,null,this.tabSize);}},{key:"match",value:function match(pattern,consume,caseInsensitive){if(typeof pattern=="string"){var cased=function cased(str){return caseInsensitive?str.toLowerCase():str;};var substr=this.string.substr(this.pos,pattern.length);if(cased(substr)==cased(pattern)){if(consume!==false)this.pos+=pattern.length;return true;}else return null;}else{var match=this.string.slice(this.pos).match(pattern);if(match&&match.index>0)return null;if(match&&consume!==false)this.pos+=match[0].length;return match;}}},{key:"current",value:function current(){return this.string.slice(this.start,this.pos);}}]);return _StringStream;}();function fullParser(spec){return{token:spec.token,blankLine:spec.blankLine||function(){},startState:spec.startState||function(){return true;},copyState:spec.copyState||defaultCopyState,indent:spec.indent||function(){return null;},languageData:spec.languageData||{}};}function defaultCopyState(state){if(_typeof(state)!="object")return state;var newState={};for(var prop in state){var val=state[prop];newState[prop]=val instanceof Array?val.slice():val;}return newState;}var _StreamLanguage=/*#__PURE__*/function(_Language){_inherits(_StreamLanguage,_Language);var _super121=_createSuper(_StreamLanguage);function _StreamLanguage(parser){var _this242;_classCallCheck(this,_StreamLanguage);var data=defineLanguageFacet(parser.languageData);var p=fullParser(parser),self;var impl=new(/*#__PURE__*/function(_Parser2){_inherits(_class17,_Parser2);var _super122=_createSuper(_class17);function _class17(){_classCallCheck(this,_class17);return _super122.apply(this,arguments);}_createClass(_class17,[{key:"createParse",value:function createParse(input,fragments,ranges){return new Parse(self,input,fragments,ranges);}}]);return _class17;}(Parser))();_this242=_super121.call(this,data,impl,docID(data),[indentService.of(function(cx,pos){return _this242.getIndent(cx,pos);})]);self=_assertThisInitialized(_this242);_this242.streamParser=p;_this242.stateAfter=new NodeProp({perNode:true});return _this242;}_createClass(_StreamLanguage,[{key:"getIndent",value:function getIndent(cx,pos){var tree=syntaxTree(cx.state),at=tree.resolve(pos);while(at&&at.type!=this.topNode){at=at.parent;}if(!at)return null;var start=findState(this,tree,0,at.from,pos),statePos,state;if(start){state=start.state;statePos=start.pos+1;}else{state=this.streamParser.startState(cx.unit);statePos=0;}if(pos-statePos>1e4)return null;while(statePos<pos){var line=cx.state.doc.lineAt(statePos),end=Math.min(pos,line.to);if(line.length){var stream=new _StringStream(line.text,cx.state.tabSize,cx.unit);while(stream.pos<end-line.from){readToken(this.streamParser.token,stream,state);}}else{this.streamParser.blankLine(state,cx.unit);}if(end==pos)break;statePos=line.to+1;}var _cx$state$doc$lineAt=cx.state.doc.lineAt(pos),text=_cx$state$doc$lineAt.text;return this.streamParser.indent(state,/^\s*(.*)/.exec(text)[1],cx);}},{key:"allowsNesting",get:function get(){return false;}}],[{key:"define",value:function define(spec){return new _StreamLanguage(spec);}}]);return _StreamLanguage;}(Language);function findState(lang,tree,off,startPos,before){var state=off>=startPos&&off+tree.length<=before&&tree.prop(lang.stateAfter);if(state)return{state:lang.streamParser.copyState(state),pos:off+tree.length};for(var _i322=tree.children.length-1;_i322>=0;_i322--){var child=tree.children[_i322],pos=off+tree.positions[_i322];var found=child instanceof Tree&&pos<before&&findState(lang,child,pos,startPos,before);if(found)return found;}return null;}function cutTree(lang,tree,from,to,inside6){if(inside6&&from<=0&&to>=tree.length)return tree;if(!inside6&&tree.type==lang.topNode)inside6=true;for(var _i323=tree.children.length-1;_i323>=0;_i323--){var pos=tree.positions[_i323]+from,child=tree.children[_i323],inner=void 0;if(pos<to&&child instanceof Tree){if(!(inner=cutTree(lang,child,from-pos,to-pos,inside6)))break;return!inside6?inner:new Tree(tree.type,tree.children.slice(0,_i323).concat(inner),tree.positions.slice(0,_i323+1),pos+inner.length);}}return null;}function findStartInFragments(lang,fragments,startPos,editorState){var _iterator423=_createForOfIteratorHelper(fragments),_step423;try{for(_iterator423.s();!(_step423=_iterator423.n()).done;){var f=_step423.value;var from=f.from+(f.openStart?25:0),to=f.to-(f.openEnd?25:0);var found=from<=startPos&&to>startPos&&findState(lang,f.tree,0-f.offset,startPos,to),tree=void 0;if(found&&(tree=cutTree(lang,f.tree,startPos+f.offset,found.pos+f.offset,false)))return{state:found.state,tree:tree};}}catch(err){_iterator423.e(err);}finally{_iterator423.f();}return{state:lang.streamParser.startState(editorState?getIndentUnit(editorState):4),tree:Tree.empty};}var Parse=/*#__PURE__*/function(){function Parse(lang,input,fragments,ranges){_classCallCheck(this,Parse);this.lang=lang;this.input=input;this.fragments=fragments;this.ranges=ranges;this.stoppedAt=null;this.chunks=[];this.chunkPos=[];this.chunk=[];this.chunkReused=void 0;this.rangeIndex=0;this.to=ranges[ranges.length-1].to;var context=ParseContext.get(),from=ranges[0].from;var _findStartInFragments=findStartInFragments(lang,fragments,from,context===null||context===void 0?void 0:context.state),state=_findStartInFragments.state,tree=_findStartInFragments.tree;this.state=state;this.parsedPos=this.chunkStart=from+tree.length;if(tree.length){this.chunks.push(tree);this.chunkPos.push(0);}if(context&&this.parsedPos<context.viewport.from-1e5){this.state=this.lang.streamParser.startState(getIndentUnit(context.state));context.skipUntilInView(this.parsedPos,context.viewport.from);this.parsedPos=context.viewport.from;}}_createClass(Parse,[{key:"advance",value:function advance(){var context=ParseContext.get();var parseEnd=this.stoppedAt==null?this.to:this.stoppedAt;var end=Math.min(parseEnd,this.chunkStart+2048);if(context)end=Math.min(end,context.viewport.to);while(this.parsedPos<end){this.parseLine(context);}if(this.chunkStart<this.parsedPos)this.finishChunk();if(this.parsedPos>=parseEnd)return this.finish();if(context&&this.parsedPos>context.viewport.to){context.skipUntilInView(this.parsedPos,parseEnd);return this.finish();}return null;}},{key:"stopAt",value:function stopAt(pos){this.stoppedAt=pos;}},{key:"lineAfter",value:function lineAfter(pos){var chunk=this.input.chunk(pos);if(!this.input.lineChunks){var eol=chunk.indexOf("\n");if(eol>-1)chunk=chunk.slice(0,eol);}else if(chunk=="\n"){chunk="";}return pos+chunk.length<=this.to?chunk:chunk.slice(0,this.to-pos);}},{key:"nextLine",value:function nextLine(){var from=this.parsedPos,line=this.lineAfter(from),end=from+line.length;for(var index=this.rangeIndex;;){var rangeEnd2=this.ranges[index].to;if(rangeEnd2>=end)break;line=line.slice(0,rangeEnd2-(end-line.length));index++;if(index==this.ranges.length)break;var rangeStart=this.ranges[index].from;var after=this.lineAfter(rangeStart);line+=after;end=rangeStart+after.length;}return{line:line,end:end};}},{key:"skipGapsTo",value:function skipGapsTo(pos,offset,side){for(;;){var end=this.ranges[this.rangeIndex].to,offPos=pos+offset;if(side>0?end>offPos:end>=offPos)break;var start=this.ranges[++this.rangeIndex].from;offset+=start-end;}return offset;}},{key:"emitToken",value:function emitToken(id,from,to,size,offset){if(this.ranges.length>1){offset=this.skipGapsTo(from,offset,1);from+=offset;var len0=this.chunk.length;offset=this.skipGapsTo(to,offset,-1);to+=offset;size+=this.chunk.length-len0;}this.chunk.push(id,from,to,size);return offset;}},{key:"parseLine",value:function parseLine(context){var _this$nextLine=this.nextLine(),line=_this$nextLine.line,end=_this$nextLine.end,offset=0,streamParser=this.lang.streamParser;var stream=new _StringStream(line,context?context.state.tabSize:4,context?getIndentUnit(context.state):2);if(stream.eol()){streamParser.blankLine(this.state,stream.indentUnit);}else{while(!stream.eol()){var token=readToken(streamParser.token,stream,this.state);if(token)offset=this.emitToken(tokenID(token),this.parsedPos+stream.start,this.parsedPos+stream.pos,4,offset);}}this.parsedPos=end;if(this.parsedPos<this.to)this.parsedPos++;}},{key:"finishChunk",value:function finishChunk(){var tree=Tree.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:nodeSet,topID:0,maxBufferLength:2048,reused:this.chunkReused});tree=new Tree(tree.type,tree.children,tree.positions,tree.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]);this.chunks.push(tree);this.chunkPos.push(this.chunkStart-this.ranges[0].from);this.chunk=[];this.chunkReused=void 0;this.chunkStart=this.parsedPos;}},{key:"finish",value:function finish(){return new Tree(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance();}}]);return Parse;}();function readToken(token,stream,state){stream.start=stream.pos;for(var _i324=0;_i324<10;_i324++){var result=token(stream,state);if(stream.pos>stream.start)return result;}throw new Error("Stream parser failed to advance stream.");}var tokenTable=/* @__PURE__ */Object.create(null);var typeArray=[NodeType.none];var nodeSet=/* @__PURE__ */new NodeSet(typeArray);var warned=[];function tokenID(tag){return!tag?0:tokenTable[tag]||(tokenTable[tag]=createTokenType(tag));}for(var _i325=0,_arr7=[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","typeName"],["attribute","propertyName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]];_i325<_arr7.length;_i325++){var _arr7$_i=_slicedToArray(_arr7[_i325],2),legacyName=_arr7$_i[0],name2=_arr7$_i[1];tokenTable[legacyName]=/* @__PURE__ */tokenID(name2);}function warnForPart(part,msg){if(warned.indexOf(part)>-1)return;warned.push(part);console.warn(msg);}function createTokenType(tagStr){var tag=null;var _iterator424=_createForOfIteratorHelper(tagStr.split(".")),_step424;try{for(_iterator424.s();!(_step424=_iterator424.n()).done;){var part=_step424.value;var value=tags[part];if(!value){warnForPart(part,"Unknown highlighting tag ".concat(part));}else if(typeof value=="function"){if(!tag)warnForPart(part,"Modifier ".concat(part," used at start of tag"));else tag=value(tag);}else{if(tag)warnForPart(part,"Tag ".concat(part," used as modifier"));else tag=value;}}}catch(err){_iterator424.e(err);}finally{_iterator424.f();}if(!tag)return 0;var name2=tagStr.replace(/ /g,"_"),type=NodeType.define({id:typeArray.length,name:name2,props:[styleTags(_defineProperty({},name2,tag))]});typeArray.push(type);return type.id;}function docID(data){var type=NodeType.define({id:typeArray.length,name:"Document",props:[languageDataProp.add(function(){return data;})]});typeArray.push(type);return type;}// ../node_modules/@codemirror/legacy-modes/mode/mllike.js
function mlLike(parserConfig){var words={"as":"keyword","do":"keyword","else":"keyword","end":"keyword","exception":"keyword","fun":"keyword","functor":"keyword","if":"keyword","in":"keyword","include":"keyword","let":"keyword","of":"keyword","open":"keyword","rec":"keyword","struct":"keyword","then":"keyword","type":"keyword","val":"keyword","while":"keyword","with":"keyword"};var extraWords=parserConfig.extraWords||{};for(var prop in extraWords){if(extraWords.hasOwnProperty(prop)){words[prop]=parserConfig.extraWords[prop];}}var hintWords=[];for(var k in words){hintWords.push(k);}function tokenBase(stream,state){var ch=stream.next();if(ch==='"'){state.tokenize=tokenString;return state.tokenize(stream,state);}if(ch==="{"){if(stream.eat("|")){state.longString=true;state.tokenize=tokenLongString;return state.tokenize(stream,state);}}if(ch==="("){if(stream.eat("*")){state.commentLevel++;state.tokenize=tokenComment;return state.tokenize(stream,state);}}if(ch==="~"||ch==="?"){stream.eatWhile(/\w/);return"variableName.special";}if(ch==="`"){stream.eatWhile(/\w/);return"quote";}if(ch==="/"&&parserConfig.slashComments&&stream.eat("/")){stream.skipToEnd();return"comment";}if(/\d/.test(ch)){if(ch==="0"&&stream.eat(/[bB]/)){stream.eatWhile(/[01]/);}if(ch==="0"&&stream.eat(/[xX]/)){stream.eatWhile(/[0-9a-fA-F]/);}if(ch==="0"&&stream.eat(/[oO]/)){stream.eatWhile(/[0-7]/);}else{stream.eatWhile(/[\d_]/);if(stream.eat(".")){stream.eatWhile(/[\d]/);}if(stream.eat(/[eE]/)){stream.eatWhile(/[\d\-+]/);}}return"number";}if(/[+\-*&%=<>!?|@\.~:]/.test(ch)){return"operator";}if(/[\w\xa1-\uffff]/.test(ch)){stream.eatWhile(/[\w\xa1-\uffff]/);var cur2=stream.current();return words.hasOwnProperty(cur2)?words[cur2]:"variable";}return null;}function tokenString(stream,state){var next,end=false,escaped=false;while((next=stream.next())!=null){if(next==='"'&&!escaped){end=true;break;}escaped=!escaped&&next==="\\";}if(end&&!escaped){state.tokenize=tokenBase;}return"string";};function tokenComment(stream,state){var prev,next;while(state.commentLevel>0&&(next=stream.next())!=null){if(prev==="("&&next==="*")state.commentLevel++;if(prev==="*"&&next===")")state.commentLevel--;prev=next;}if(state.commentLevel<=0){state.tokenize=tokenBase;}return"comment";}function tokenLongString(stream,state){var prev,next;while(state.longString&&(next=stream.next())!=null){if(prev==="|"&&next==="}")state.longString=false;prev=next;}if(!state.longString){state.tokenize=tokenBase;}return"string";}return{startState:function startState(){return{tokenize:tokenBase,commentLevel:0,longString:false};},token:function token(stream,state){if(stream.eatSpace())return null;return state.tokenize(stream,state);},languageData:{autocomplete:hintWords,commentTokens:{line:parserConfig.slashComments?"//":void 0,block:{open:"(*",close:"*)"}}}};}var oCaml=mlLike({extraWords:{"and":"keyword","assert":"keyword","begin":"keyword","class":"keyword","constraint":"keyword","done":"keyword","downto":"keyword","external":"keyword","function":"keyword","initializer":"keyword","lazy":"keyword","match":"keyword","method":"keyword","module":"keyword","mutable":"keyword","new":"keyword","nonrec":"keyword","object":"keyword","private":"keyword","sig":"keyword","to":"keyword","try":"keyword","value":"keyword","virtual":"keyword","when":"keyword","raise":"builtin","failwith":"builtin","true":"builtin","false":"builtin","asr":"builtin","land":"builtin","lor":"builtin","lsl":"builtin","lsr":"builtin","lxor":"builtin","mod":"builtin","or":"builtin","raise_notrace":"builtin","trace":"builtin","exit":"builtin","print_string":"builtin","print_endline":"builtin","int":"type","float":"type","bool":"type","char":"type","string":"type","unit":"type","List":"builtin"}});var fSharp=mlLike({extraWords:{"abstract":"keyword","assert":"keyword","base":"keyword","begin":"keyword","class":"keyword","default":"keyword","delegate":"keyword","do!":"keyword","done":"keyword","downcast":"keyword","downto":"keyword","elif":"keyword","extern":"keyword","finally":"keyword","for":"keyword","function":"keyword","global":"keyword","inherit":"keyword","inline":"keyword","interface":"keyword","internal":"keyword","lazy":"keyword","let!":"keyword","match":"keyword","member":"keyword","module":"keyword","mutable":"keyword","namespace":"keyword","new":"keyword","null":"keyword","override":"keyword","private":"keyword","public":"keyword","return!":"keyword","return":"keyword","select":"keyword","static":"keyword","to":"keyword","try":"keyword","upcast":"keyword","use!":"keyword","use":"keyword","void":"keyword","when":"keyword","yield!":"keyword","yield":"keyword","atomic":"keyword","break":"keyword","checked":"keyword","component":"keyword","const":"keyword","constraint":"keyword","constructor":"keyword","continue":"keyword","eager":"keyword","event":"keyword","external":"keyword","fixed":"keyword","method":"keyword","mixin":"keyword","object":"keyword","parallel":"keyword","process":"keyword","protected":"keyword","pure":"keyword","sealed":"keyword","tailcall":"keyword","trait":"keyword","virtual":"keyword","volatile":"keyword","List":"builtin","Seq":"builtin","Map":"builtin","Set":"builtin","Option":"builtin","int":"builtin","string":"builtin","not":"builtin","true":"builtin","false":"builtin","raise":"builtin","failwith":"builtin"},slashComments:true});var sml=mlLike({extraWords:{"abstype":"keyword","and":"keyword","andalso":"keyword","case":"keyword","datatype":"keyword","fn":"keyword","handle":"keyword","infix":"keyword","infixr":"keyword","local":"keyword","nonfix":"keyword","op":"keyword","orelse":"keyword","raise":"keyword","withtype":"keyword","eqtype":"keyword","sharing":"keyword","sig":"keyword","signature":"keyword","structure":"keyword","where":"keyword","true":"keyword","false":"keyword","int":"builtin","real":"builtin","string":"builtin","char":"builtin","bool":"builtin"},slashComments:true});// includes.js
joo_global_object.__CM__view=EditorView;joo_global_object.__CM__state=EditorState;joo_global_object.__CM__lint=dist_exports3;joo_global_object.__CM__autocomplete=dist_exports2;joo_global_object.__CM__tooltip=dist_exports;joo_global_object.__CM__basic_setup=basicSetup;joo_global_object.__CM__dark=dist_exports4;joo_global_object.__CM__stream_parser=dist_exports5;joo_global_object.__CM__mllike=oCaml;})();
